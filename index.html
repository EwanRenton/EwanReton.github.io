
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Ewan Reton</title>
	<meta name="author" content="Ewan Reton">

	
	<meta name="description" content="java JSP九大内置对象详解 内置对象简介 JSP 内置对象是 Web 容器创建的一组对象，不需使用 new 关键字就可以直接使用的内置对象。 1
2
3
4
5
6
&lt;% int[] value = {10,20,30}; for(int i : value){ //Java &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Ewan Reton" type="application/atom+xml">
	
	<link rel="canonical" href="http://ewanreton.github.io/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'>	<link type="text/css" rel="stylesheet" href='/prettify/prettify.css' >
	<script src="//libs.baidu.com/jquery/1.9.1/jquery.min.js"></script>
	<script type="text/javascript" src="/prettify/prettify.js"></script>
	<!--<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>-->
	<script>
  function addBlankTargetForLinks () {
    $('a[href^="http"]').each(function(){
      $(this).attr('target', '_blank');
    });
  }
  $(document).bind('DOMNodeInserted', function(event) {
    addBlankTargetForLinks();
  });
</script>
  

</head>


<body onload="prettyPrint()">
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript" src="/prettify/prettify.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("liukedi001@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
			
		});
	</script>
	
</div>

<div>
	<h1><a href="/">Ewan Reton</a></h1>
	
		<h2 style="color:#666">Never be touched by yourself</h2>
	
</div>
<nav id="main-nav"><ul class="main">
    <li><a href="/">Blog</a></li>
    <li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="main-nav"><section>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/git/'>git (3)</a></li>
<li class='category'><a href='/blog/categories/java/'>java (2)</a></li>
<li class='category'><a href='/blog/categories/javascript/'>javascript (2)</a></li>
<li class='category'><a href='/blog/categories/linux/'>linux (6)</a></li>
<li class='category'><a href='/blog/categories/mysql/'>mysql (4)</a></li>
<li class='category'><a href='/blog/categories/nginx/'>nginx (5)</a></li>
<li class='category'><a href='/blog/categories/octopress/'>octopress (3)</a></li>
<li class='category'><a href='/blog/categories/php/'>php (22)</a></li>
<li class='category'><a href='/blog/categories/weixin/'>weixin (1)</a></li>

  </ul>
</section></nav> 
<nav id="sub-nav">
	<div class="social">
		
			<a class="email" href="mailto:liukedi001@gmail.com" title="Email">Email</a>
		
		
		
			<a class="google" href="https://plus.google.com/116687730759120454062" rel="author" title="Google+">Google+</a>
		
		
		
			<a class="github" href="https://github.com/EwanReton" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		
		
		
    	
    	
			<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2016-06-17T15:15:51+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/java/'>java</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2016/06/17/jsp-object/" itemprop="url">JSP九大内置对象详解</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h1>内置对象简介</h1>

<blockquote><p>JSP 内置对象是 Web 容器创建的一组对象，不需使用 new 关键字就可以直接使用的内置对象。</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;%</span>
</span><span class='line'>    <span class="kt">int</span><span class="o">[]</span> <span class="n">value</span> <span class="o">=</span> <span class="o">{</span><span class="mi">10</span><span class="o">,</span><span class="mi">20</span><span class="o">,</span><span class="mi">30</span><span class="o">};</span>
</span><span class='line'>    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">:</span> <span class="n">value</span><span class="o">){</span> <span class="c1">//Java 中for循环的增强形式</span>
</span><span class='line'>        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">value</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span> <span class="c1">//out 为 JSP 中的内置对象</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>九大内置对象</h1>

<ol>
<li>五大常用的内置对象：out、request、reponse、session、application</li>
<li>不常用的内置对象：Page、pageContext、exception、config</li>
</ol>


<h2>缓冲区</h2>

<ul>
<li>缓冲区：Buffer,所谓缓冲区就是内存的一块区域用来保存临时的数据。举个例子，刚煮好的一大锅米饭，一粒一粒吃会吃得很慢，而我们就会选择把米饭乘到碗里，一碗一碗吃岂不痛快。淡然，也可以把勺子当做容器，将米饭在不同的容器中传递，最后通过勺子吃掉，在这里勺子就可以看做缓冲区，多个字节在不同的缓冲区传递</li>
</ul>


<h2>out 内置对象</h2>

<ul>
<li>out 对象是JspWriter类实例，是向客户端输出内容常用的对象</li>
<li><p>常用方法如下</p>

<ol>
<li>void println() 向客户端打印字符串</li>
<li>void flush() 将缓冲区的内容输出到客户端</li>
<li>void clear() 清楚缓存区的内容，如果在 flush 之后则调用会抛出异常</li>
<li>void clearBuffer() 清楚缓冲区的内容，如果在 flush 之后调用不会出现异常</li>
<li>int getBufferSize() 返回缓冲区字节数大小，若不设设置缓冲区则为0</li>
<li>int getRemaining() 返回缓冲区还剩余多少字节可用</li>
<li>boolean isAutoFlush() 返回缓冲区满时，是自动清空还是抛出异常

<h2>request 内置对象</h2></li>
</ol>
</li>
<li><p>客户端的请求信息被封装在 request 对象中，通过它才能了解到客户的需求，然后做出相应。它是 HttpServletRequest类的实例。request 具有请求域，即在完成用户请求前，该对象一直有效。</p></li>
<li>常见的方法

<ol>
<li>请求方法名：request.getMethod</li>
<li>请求的资源：request.getRequestURL</li>
<li>请求使用的协议：request.getProtocol</li>
<li>请求使用的服务器 IP：request.getServerName</li>
<li>请求的服务器端口：request.getServerPort</li>
<li>客户端的 IP 地址：request.getRemoteAddr</li>
<li>客户端的主机名：request.getRemoteHost</li>
<li>获取表单提交的值：request.getParameter</li>
<li>返回请求者的MIME类型：request.getContentType</li>
<li>获取表单提交的多个值：request.getParameterValues</li>
<li>web 组件之间共享信息,储存：request.setAttribute</li>
<li>web 组件之间共享信息,获取：request.getAttribute</li>
</ol>
</li>
<li>下面以一个录入注册例子简单理解 request</li>
</ul>


<p>先是 用户注册 register.jsp，这里只要是创建了一个表单，有用户名、密码、爱好几个注册内容块。</p>

<figure class='code'><figcaption><span>register.jsp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;!</span><span class="n">DOCTYPE</span> <span class="n">HTML</span> <span class="n">PUBLIC</span> <span class="s">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">录入注册信息</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">用户注册</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">hr</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">form</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;do_register.jsp&quot;</span> <span class="n">methed</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="n">table</span><span class="o">&gt;</span>
</span><span class='line'>            <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">用户名</span><span class="err">：</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;userName&quot;</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</span><span class='line'>            <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</span><span class='line'>            <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">密码</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;passWord&quot;</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</span><span class='line'>            <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</span><span class='line'>            <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">爱好</span><span class="err">：</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;checkbox&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;favorite&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;Java&quot;</span><span class="o">&gt;</span><span class="n">Java</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;checkbox&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;favorite&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;Android&quot;</span><span class="o">&gt;</span><span class="n">Android</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;checkbox&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;favorite&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;JavaWeb&quot;</span><span class="o">&gt;</span><span class="n">JavaWeb</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;checkbox&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;favorite&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;PHP&quot;</span><span class="o">&gt;</span><span class="n">PHP</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;checkbox&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;favorite&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;IOS&quot;</span><span class="o">&gt;</span><span class="n">IOS</span>
</span><span class='line'>                <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</span><span class='line'>            <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;</span><span class="n">td</span> <span class="n">colspan</span><span class="o">=</span><span class="s">&quot;2&quot;</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span> <span class="o">=</span> <span class="s">&quot;submit&quot;</span> <span class="n">value</span> <span class="o">=</span> <span class="s">&quot;提交&quot;</span><span class="o">&gt;</span> <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>再是处理注册信息 do_register.jsp，这里主要是通过request 来处理注册的信息</p>

<figure class='code'><figcaption><span>do_register.jsp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;%</span><span class="err">@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="o">%&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;!</span><span class="n">DOCTYPE</span> <span class="n">HTML</span> <span class="n">PUBLIC</span> <span class="s">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">处理注册信息</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;%</span>
</span><span class='line'>            <span class="n">String</span> <span class="n">userName</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;userName&quot;</span><span class="o">);</span>
</span><span class='line'>            <span class="n">String</span> <span class="n">passWord</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;passWord&quot;</span><span class="o">);</span>
</span><span class='line'>            <span class="c1">//利用out内置对象输出</span>
</span><span class='line'>            <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">userName</span><span class="o">);</span>
</span><span class='line'>            <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;&lt;br&gt;&quot;</span><span class="o">);</span>
</span><span class='line'>            <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">passWord</span><span class="o">);</span>
</span><span class='line'>        <span class="o">%&gt;&lt;</span><span class="n">br</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;%</span>
</span><span class='line'>            <span class="n">String</span> <span class="n">favorite</span><span class="o">[]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameterValues</span><span class="o">(</span><span class="s">&quot;favorite&quot;</span><span class="o">);</span>
</span><span class='line'>            <span class="n">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;&lt;br&gt;&quot;</span><span class="o">);</span>
</span><span class='line'>            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">favorite</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
</span><span class='line'>                <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">favorite</span><span class="o">[</span><span class="n">i</span><span class="o">]+</span><span class="s">&quot; &amp;nbsp&quot;</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">%&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>reponse 内置对象</h2>

<ul>
<li>reponse 对象包含了响应客户端请求的有关信息，但在 jsp 中很少直接使用到它。他是 HttpServletResponse 类的实例。reponse 对象具有页面作用域，即方位一个页面时，该页面内的 reponse 对象只能对这次访问有效，其他页面的 reponse 对象对当前页面无效。</li>
<li>常用方法如下

<ol>
<li>String getCharacterEncoding() 返回响应用的何种字符编码</li>
<li>void setContentType(String type) 设置响应的MIME类型</li>
<li>PrintWriter getWriter() 返回可以向客户端输出字符的一个对象（注意与内置对象out的区别：一般情况下，PrintWriter 的输出都会在内置对象out之前显示，即使PrintWriter 代码靠后，但是可以在out 之后调用flush 方法可以解决）</li>
<li>sendRedirect(java.lang.String location) 重新定向客户端的请求</li>
</ol>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;%</span><span class="nd">@page</span> <span class="n">import</span><span class="o">=</span><span class="s">&quot;java.io.PrintWriter&quot;</span><span class="o">%&gt;</span>
</span><span class='line'><span class="o">&lt;%</span><span class="err">@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="o">%&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;%</span>
</span><span class='line'>    <span class="c1">//设置响应的MIME类型</span>
</span><span class='line'>    <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">&quot;text/html;charset=utf-8&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;&lt;h1&gt;reponse内置对象&lt;/h1&gt;&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;&lt;br&gt;&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="c1">//out.flush();//将缓冲区内容输出到客户端，避免先显示 PrintWriter 输出</span>
</span><span class='line'>    <span class="n">PrintWriter</span> <span class="n">outer</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">();</span>
</span><span class='line'>    <span class="n">outer</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;这是reponse对象生成的输出流&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="c1">//请求重定向到register 代码2, 此时将flush()注释掉不然会抛出异常</span>
</span><span class='line'>    <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">&quot;register.jsp&quot;</span><span class="o">);</span>
</span><span class='line'><span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>请求重定向：客户端行为，response.sedRedirect(),从本质上讲等同于两次请求，前一次的请求对象不会保存，地址栏的的URL会发生改变。可以这么理解,你先乘车去了A公司，但是A公司的人说这个事不归他们管，让你去去B公司；然后你就从A公司退了出来，自己乘车去了B公司。</li>
<li>请求转发：服务器行为，request.getRequestDispatcher().forworder(req,resp);适宜次请求，转发后请求对象会保存，地址栏的URL地址不会改变。一样也可以这样理解，你去A公司办事，A公司看了以后发现这件事该归B公司管，但是并没有把你退回来，而是A公司自己去联系了B公司，让B公司办好后，送了过来</li>
</ul>


<h2>session 内置对象</h2>

<ul>
<li>session 对象是 HttpSession 类的实例</li>
<li>session 表示客户端与服务器的一次会话，在服务的内存在保存着不同用户的 session 对象。</li>
<li>Web 中的 session 指的是用户在游览某个网站时，从进入网站到关闭游览器所经过的这段时间，也就是用户游览这个网站的所花费的时间，session 实际上就是一个特定的时间概念</li>
<li>session 对象是在第一个JSP页面被装载时自动创建的，完成会话期的管理</li>
<li>当一个客户访问一个服务器时，可能会在服务器的几个页面之间来回切换，此时服务器就应该有某种方法来知道这是同一个用户</li>
<li>常用方法

<ol>
<li>long getCreationTime() 返回 session 的创建时间</li>
<li>String getId() 返回 session 创建时JSP引擎为它创建的唯一ID号</li>
<li>Object setAttribute(String name,Object value) 使用指定名称将对象绑定到此会话</li>
<li>Object getAttribute(String name) 返回与此会话中的指定名称绑定在一起时的对象，若无则返回null</li>
<li>String[] getValueNames() 返回一个包含此session中所有可用属性的数组</li>
<li>int getMaxInactiveInterval() 返回两次请求间隔时间多长时间此session被取消</li>
</ol>
</li>
</ul>


<p> 结合以下代码理解</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;%</span><span class="nd">@page</span> <span class="n">import</span><span class="o">=</span><span class="s">&quot;java.text.SimpleDateFormat,java.util.*&quot;</span><span class="o">%&gt;</span>
</span><span class='line'><span class="o">&lt;%</span><span class="err">@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="o">%&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;!</span><span class="n">DOCTYPE</span> <span class="n">HTML</span> <span class="n">PUBLIC</span> <span class="s">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">session内置对象</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">session内置对象</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">hr</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;%</span>
</span><span class='line'>      <span class="n">SimpleDateFormat</span> <span class="n">sdf</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">SimpleDateFormat</span><span class="o">(</span><span class="s">&quot;yyyy年MM月dd日 HH:mm:ss&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;userName&quot;</span><span class="o">,</span> <span class="s">&quot;admin&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;otherName&quot;</span><span class="o">,</span> <span class="s">&quot;otherUser&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="c1">//设置当前session最大生命期限   单位是秒</span>
</span><span class='line'>    <span class="n">session</span><span class="o">.</span><span class="na">setMaxInactiveInterval</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span><span class="c1">//10秒钟</span>
</span><span class='line'>  <span class="o">%&gt;</span>
</span><span class='line'>      <span class="n">session</span> <span class="n">创建时间</span><span class="err">：</span><span class="o">&lt;%=</span> <span class="n">sdf</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="nf">Date</span><span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">getCreationTime</span><span class="o">()))</span> <span class="o">%&gt;&lt;</span><span class="n">br</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="n">获取session的ID</span><span class="err">：</span><span class="o">&lt;%=</span><span class="n">session</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">%&gt;&lt;</span><span class="n">br</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="n">从</span> <span class="n">session</span> <span class="n">中获取用户名</span><span class="err">：</span><span class="o">&lt;%=</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;userName&quot;</span><span class="o">)</span> <span class="o">%&gt;&lt;</span><span class="n">br</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="n">获取所有可用属性的值</span><span class="err">：</span><span class="o">&lt;%</span>
</span><span class='line'>                        <span class="n">String</span> <span class="n">str</span><span class="o">[]</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getValueNames</span><span class="o">();</span>
</span><span class='line'>                        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">str</span><span class="o">.</span><span class="na">length</span><span class="o">;</span><span class="n">i</span><span class="o">++)</span>
</span><span class='line'>                        <span class="o">{</span>
</span><span class='line'>                            <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">[</span><span class="n">i</span><span class="o">]+</span><span class="s">&quot; &amp;nbsp&quot;</span><span class="o">);</span>
</span><span class='line'>                        <span class="o">}</span>
</span><span class='line'>                    <span class="o">%&gt;&lt;</span><span class="n">br</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">&quot;reponse.jsp&quot;</span> <span class="n">target</span><span class="o">=</span><span class="s">&quot;_blank&quot;</span><span class="o">&gt;</span><span class="n">跳转到response</span><span class="o">.</span><span class="na">jsp</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>session 的生命周期</h2>

<ul>
<li>创建：当客户端第一次访问某个JSP或者 Servlet 时候，服务器会为当前会话创建一个 session ID，每次客户端向服务器发送请求时，都会将此 ID 携带过去与服务器进行校检。</li>
<li>活动：某次会话当中通过超链接打开得新页面属于同一次会话；只要当前全部会话页面没有全部关闭，重新打开的新的游览器窗口访问同一个项目资源属于同一个会话；除非将本次会话的所有页面全部关闭，再次访问就会创建新的session ID。注意事项，原有会话还会存在，只是这个旧的session ID 任然存在于服务器，只不过再也没有客户端携带者它来向服务器访问了。</li>
<li>销毁：Session 的三种销毁方式，调用 session.invalidate() 方法；session 过期（超时）；服务器重新启动。</li>
</ul>


<h2>application 内置对象</h2>

<ul>
<li>application 对象实现了用户间的数据共享，可存放全局变量</li>
<li>application 开始于服务器的启动，终止于服务器的关闭</li>
<li>在用户的前后连接和不同用户之间的连接中，可以对 application 同一属性进行操作</li>
<li>在任何地方对 application 对象进行操作，都将影响到其他用户对此的访问</li>
<li>服务器的启动和关闭决定了 application 的声明周期</li>
<li>application 对象是 ServletContext 类的实例</li>
<li>常用方法

<ol>
<li>void setAttribute(String name,Object value) 使用指定的名称将对象绑定到会话</li>
<li>Object getAttribute(String name) 返回与会话名称绑在一起的对象，如果没有对象绑定在此名称下，则返回 null</li>
<li>Enumeration getAttributeNames() 返回所有可用属性名的枚举类型</li>
<li>String getServerInfo() 返回 JSP(SERVLET) 引擎名及版本号</li>
</ol>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;%</span><span class="err">@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span>
</span><span class='line'>    <span class="n">import</span><span class="o">=</span><span class="s">&quot;java.util.*&quot;</span>
</span><span class='line'><span class="o">%&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;!</span><span class="n">DOCTYPE</span> <span class="n">HTML</span> <span class="n">PUBLIC</span> <span class="s">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">application</span><span class="o">.</span><span class="na">jsp</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;%</span>
</span><span class='line'>      <span class="n">application</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;小明&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">application</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;age&quot;</span><span class="o">,</span> <span class="s">&quot;10&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="o">%&gt;</span>
</span><span class='line'>      <span class="n">名字是</span><span class="err">：</span><span class="o">&lt;%=</span><span class="n">application</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span> <span class="o">%&gt;&lt;</span><span class="n">br</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="n">获取application所有属性</span><span class="err">：</span><span class="o">&lt;%</span>
</span><span class='line'>          <span class="n">Enumeration</span> <span class="n">attribute</span> <span class="o">=</span>  <span class="n">application</span><span class="o">.</span><span class="na">getAttributeNames</span><span class="o">();</span>
</span><span class='line'>          <span class="k">while</span><span class="o">(</span><span class="n">attribute</span><span class="o">.</span><span class="na">hasMoreElements</span><span class="o">())</span>
</span><span class='line'>              <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">attribute</span><span class="o">.</span><span class="na">nextElement</span><span class="o">());</span>
</span><span class='line'>      <span class="o">%&gt;&lt;</span><span class="n">br</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="n">当前引擎名及版本号</span><span class="err">：</span><span class="o">&lt;%=</span><span class="n">application</span><span class="o">.</span><span class="na">getServerInfo</span><span class="o">()</span> <span class="o">%&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Page 内置对象</h2>

<ul>
<li>Page 对象就是指向当前JSP页面本身，有点像类中的 this，它是 java.long.Object 类的实例</li>
<li>常用方法

<ol>
<li>class getClass() 返回此 Object 的类</li>
<li>int hashCode() 返回此 Objcet 的 hash 码</li>
<li>boolean equals(Object obj) 判断此 Object 是否与指定的 Object 对象相等</li>
<li>void copy(Object obj) 把此 Object 拷贝到指定的 Object 对象中</li>
<li>Object clone() 克隆此 Object 对象</li>
<li>String toString() 把此 Object 对象转换成 String 类的对象</li>
<li>void notify() 唤醒一个等待的线程</li>
<li>void notifyAll() 唤醒所有等待的线程</li>
<li>void wait(int timeout) 使一个线程处于等待直到 timeout 结束或被唤醒</li>
<li>void wait() 是一个线程处于等待直到被唤醒</li>
</ol>
</li>
</ul>


<p>通过观察以上的方法基本上都是 Object 类中方法的实现，以下就选择常用的 toString 方法实验</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;%</span><span class="err">@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="o">%&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;!</span><span class="n">DOCTYPE</span> <span class="n">HTML</span> <span class="n">PUBLIC</span> <span class="s">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Page</span><span class="o">.</span><span class="na">jsp</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="nl">当前page页面对象字符串描述:</span><span class="o">&lt;%=</span><span class="n">page</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span> <span class="o">%&gt;&lt;</span><span class="n">br</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>打印的为：</p>

<pre><code>当前page页面对象字符串描述:org.apache.jsp.InnerObject.Page_jsp@526f75ab
</code></pre>

<h2>PageContext 内置对象</h2>

<ul>
<li>pageContext 对象提供了对JSP页面内所有的对象及名字空间的访问，也就是说他可以访问到本页所在的 SESSION .也可以取本页面所在的</li>
<li>application 的某一属性值</li>
<li>它相当于页面中所有功能的集大成者,它的本类名也叫 pageContext</li>
<li>常用方法

<ol>
<li>JspWriter getOut() 返回当前客户端响应被使用的</li>
<li>JspWriter 流（out）</li>
<li>HttpSession getSession() 返回当前客户端响应被使用的 HttpSession 对象（session）</li>
<li>Object getPage() 返回当前页面的 Object 对象（page）</li>
<li>ServletRequest getRequest() 返回当前页的 ServletRequest 对象（request）</li>
<li>ServletResponse() 返回当前页面的 ServletResponse 对象（response）</li>
<li>void setAttribute(String name,Object attribute) 设置属性及属性值</li>
<li>Object getAttribute(String name，int scope) 在指定范围内获取属性的值</li>
<li>int getAttributeScope(String name) 返回某属性的作用范围</li>
<li>void forward(String relativeUrlPath) 返回当前页面重导另一个页面</li>
<li>void include(String relativeUrlPath) 在当前位置包含另一文件</li>
</ol>
</li>
</ul>


<h2>Config 内置对象</h2>

<ul>
<li>Config 对象是在一个Servlet 初始化时，JSP 引擎向它传递信息用的，此信息包括 Servlet 初始化时所需要用到的参数（通常属性名和属性值构成）以及服务器有关信息（通过传递一个ServletContext 对象）</li>
<li>常用方法

<ol>
<li>ServletContext getServletContext() 返回有关服务器相关信息的ServletContext 对象</li>
<li>String getInitParameter(String name) 返回初始化参数的值</li>
<li>Enumeration getInitParameterNames() 返回 Servlet 初始化所需所有参数的枚举</li>
</ol>
</li>
</ul>


<h2>Exception 内置对象</h2>

<ul>
<li>Exception 对象是一个异常对象，当一个页面运行中发生了异常，就产生了这个对象。如果一个 Jsp 页面要引用此对象，就必须 isErrorPage 设为 true ,否则无法编译。它实际上市 java.lang,Throwable 的对象</li>
<li>常用方法

<ol>
<li>String getMessage() 返回描述异常消息</li>
<li>String toString() 返回有关异常的简短描述消息</li>
<li>void printStackTrace() 显示异常及其栈轨迹</li>
<li>Throwable FillInStackTrace() 重写异常的执行栈轨迹</li>
</ol>
</li>
</ul>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2016-06-16T12:53:01+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/java/'>java</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2016/06/16/jsp-bianyizhiling-dongzuozhiling/" itemprop="url">Jsp三个编译指令和七个动作指令</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<blockquote><p>最近开始学习JSP的相关知识，先作为一个入门的了解。</p></blockquote>

<h1>三个编译指令</h1>

<ol>
<li>page指令</li>
</ol>


<p>page指令用户定义JSP页面中的全局属性，它的语法格式如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;%</span><span class="n">page</span>
</span><span class='line'><span class="o">{</span><span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span><span class="o">}</span>
</span><span class='line'><span class="o">{</span><span class="kd">extends</span><span class="o">=</span><span class="s">&quot;package.class&quot;</span><span class="o">}</span>
</span><span class='line'><span class="o">{</span><span class="n">import</span><span class="o">=</span><span class="s">&quot;{package.class|package.*},...&quot;</span><span class="o">}</span>
</span><span class='line'><span class="o">{</span><span class="n">session</span><span class="o">=</span><span class="s">&quot;true | false&quot;</span><span class="o">}</span>
</span><span class='line'><span class="o">{</span><span class="n">buffer</span><span class="o">=</span><span class="s">&quot;none | 8kb | sizekb&quot;</span><span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="kc">false</span><span class="s">&quot;}</span>
</span><span class='line'><span class="s">{isThreadSafe=&quot;</span><span class="kc">true</span> <span class="o">|</span> <span class="kc">false</span><span class="s">&quot;}</span>
</span><span class='line'><span class="s">{info=&quot;</span><span class="n">text</span><span class="s">&quot;}</span>
</span><span class='line'><span class="s">{errorPage=&quot;</span><span class="n">relativeURL</span><span class="s">&quot;}</span>
</span><span class='line'><span class="s">{contentType=&quot;</span><span class="n">mimeType</span> <span class="o">[;</span><span class="n">charset</span><span class="o">=</span><span class="n">characterSet</span><span class="o">]</span><span class="s">&quot; | &quot;</span><span class="n">text</span><span class="o">/</span><span class="n">html</span> <span class="o">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">ISO</span><span class="o">-</span><span class="mi">8859</span><span class="o">-</span><span class="mi">1</span><span class="s">&quot;}</span>
</span><span class='line'><span class="s">{isErrorPage=&quot;</span><span class="kc">true</span> <span class="o">|</span> <span class="kc">false</span><span class="s">&quot;}</span>
</span><span class='line'><span class="s">{pageEncoding=&quot;</span><span class="n">charset</span><span class="o">=</span><span class="n">characrerSet</span> <span class="o">|</span> <span class="n">ISO</span><span class="o">-</span><span class="mi">8859</span><span class="o">-</span><span class="mi">1</span><span class="err">&quot;</span><span class="o">}</span>
</span><span class='line'><span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p> page指令对整个页面有效，包括静态的包含文件，但page指令不能用于被动态包含的文件，例如使用<code>&lt;jsp:include&gt;</code>包含的文件。在一个JSP页面中可以使用多个page指令，但page指令中的属性只能出现一次(import属性除外)。</p>

<ol>
<li>include指令</li>
</ol>


<p>include指令用于在JSP页面中包含其他文件，它的语法格式如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;%</span> <span class="n">include</span> <span class="n">file</span><span class="o">=</span><span class="s">&quot;路径名&quot;</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>include指令仅有一个属性file，其值为文件的相对路径。include指令包含的过程是静态的，包含的文件可以是JSP、HTML或者Inc文件等。</p>

<ol>
<li>taglib指令</li>
</ol>


<p>taglib指令允许用户使用标签库自定义新的标签，它的语法格式如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;%</span> <span class="n">taglib</span> <span class="n">uri</span><span class="o">=</span><span class="s">&quot;taglibURI&quot;</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;tabPrefix&quot;</span><span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>taglib指令中的uri属性用于根据标签的前缀对自定义的标签进行唯一的命名，其值可以食相对路径，就对路径或标签库描述文件。属性prefix制定了标签的前缀。</p>

<h1>七个动作指令</h1>

<blockquote><p>动作指令与编译指令不间，编译指令是通知 Servlet 引擎的处理消息，而动作指令只是运行时的脚本动作。编译指令在将JSP 编译成 Servlet 时起作用:处理指令通常可替换成 Java脚本，是 JSP脚本的标准化写法。</p></blockquote>

<p> JSP7 个 动作指令如下 ：</p>

<ul>
<li>jsp:forward: 执行页面转向，将请求的处理转发到下一个页面。</li>
<li>jsp:param: 用于传递参数，必须与其他支持参数曲标签一起使用。</li>
<li>jsp:include: 用于动态引入一个 JSP 页面。</li>
<li>jsp:p1ugin: 用于下载 JavaBean 或 Applet 到客户端执行。</li>
<li>jsp:useBean: 使用 JavaBean。</li>
<li>jsp:setProperty: 修改 JavaBean 实例的属性值。</li>
<li>jsp:getProperty: 获取 JavaBean 实例的属性值。</li>
</ul>


<p><strong>jsp:forward</strong></p>

<blockquote><p>jsp:forward动作把请求转到另外的页面。可以转发静态的HTML页面，也可以转发动态的JSP页面，或者转发到容器中的servlet jsp:forward标记只有一个属性page。 page属性包含的是一个相对URL。 page的值既可以直接给出，也可以在请求的时候动态计算</p></blockquote>

<figure class='code'><figcaption><span>index.jsp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;%</span><span class="err">@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span>
</span><span class='line'>    <span class="n">pageEncoding</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="o">%&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nl">jsp:</span><span class="n">forward</span> <span class="n">page</span><span class="o">=</span><span class="s">&quot;login.jsp&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nl">jsp:</span><span class="n">param</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;reton&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;userName&quot;</span><span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nl">jsp:</span><span class="n">param</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;reton&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;passWord&quot;</span><span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nl">jsp:</span><span class="n">forward</span><span class="o">&gt;</span> <span class="c1">//forward下面的代码不会被执行</span>
</span><span class='line'><span class="n">dddddd</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>login.jsp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;%</span><span class="err">@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span>
</span><span class='line'>    <span class="n">pageEncoding</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="o">%&gt;</span>
</span><span class='line'><span class="o">&lt;!</span><span class="n">DOCTYPE</span> <span class="n">html</span> <span class="n">PUBLIC</span> <span class="s">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="s">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">meta</span> <span class="n">http</span><span class="o">-</span><span class="n">equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="n">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Login</span> <span class="n">here</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;%</span>
</span><span class='line'> <span class="n">String</span> <span class="n">userName</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;userName&quot;</span><span class="o">);</span>
</span><span class='line'> <span class="n">String</span> <span class="n">passWord</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;passWord&quot;</span><span class="o">);</span>
</span><span class='line'> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">userName</span><span class="o">);</span>
</span><span class='line'> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;&lt;br/&gt;&quot;</span><span class="o">);</span>
</span><span class='line'> <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">passWord</span><span class="o">);</span>
</span><span class='line'><span class="o">%&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>jsp:include动作</strong></p>

<blockquote><p>（拿目标页面插入原有页面）该动作是一个动态的include指令，也用于带入某个页面，他不会导入被include页面的编译指令，仅仅导入页面的body内容插入到本页面　　该动作把指定文件插入正在生成的页面。</p></blockquote>

<ul>
<li>flush：用于指定输出缓存是否转移到被导入的文件中，

<ul>
<li>true：包含在被导入的文件中</li>
<li>false：包含在源文件中</li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>　<span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span>
</span><span class='line'>　　<span class="n">Here</span> <span class="n">is</span> <span class="n">a</span> <span class="n">summary</span> <span class="n">of</span> <span class="n">our</span> <span class="n">four</span> <span class="n">most</span> <span class="n">recent</span> <span class="n">news</span> <span class="nl">stories:</span>
</span><span class='line'>　　<span class="o">&lt;</span><span class="n">OL</span><span class="o">&gt;</span>
</span><span class='line'>　　<span class="o">&lt;</span><span class="n">LI</span><span class="o">&gt;&lt;</span><span class="nl">jsp:</span><span class="n">include</span> <span class="n">page</span><span class="o">=</span><span class="s">&quot;news/Item1.html&quot;</span> <span class="n">flush</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="o">/&gt;</span>
</span><span class='line'>　　<span class="o">&lt;</span><span class="n">LI</span><span class="o">&gt;&lt;</span><span class="nl">jsp:</span><span class="n">include</span> <span class="n">page</span><span class="o">=</span><span class="s">&quot;news/Item2.html&quot;</span> <span class="n">flush</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="o">/&gt;</span>
</span><span class='line'>　　<span class="o">&lt;</span><span class="n">LI</span><span class="o">&gt;&lt;</span><span class="nl">jsp:</span><span class="n">include</span> <span class="n">page</span><span class="o">=</span><span class="s">&quot;news/Item3.html&quot;</span> <span class="n">flush</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="o">/&gt;</span>
</span><span class='line'>　　<span class="o">&lt;</span><span class="n">LI</span><span class="o">&gt;&lt;</span><span class="nl">jsp:</span><span class="n">include</span> <span class="n">page</span><span class="o">=</span><span class="s">&quot;news/Item4.html&quot;</span> <span class="n">flush</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="o">/&gt;</span>
</span><span class='line'>　　<span class="o">&lt;/</span><span class="n">OL</span><span class="o">&gt;</span>　
</span></code></pre></td></tr></table></div></figure>


<p>　前面已经介绍过include指令，它是在JSP文件被转换成Servlet的时候引入文件，而这里的jsp:include动作不同，插入文件的时间是在页面被请求的时候。jsp:include动作的文件引入时间决定了它的效率要稍微差一点，而且被引用文件不能包含某些JSP代码（例如不能设置HTTP头），但它的灵活性却要好得多。</p>

<p><strong>jsp:useBean</strong></p>

<blockquote><p>jsp:useBean动作用来装载一个将在JSP页面中使用的JavaBean。这个功能非常有用，因为它使得我们既可以发挥Java组件重用的优势，同时也避免了损失JSP区别于Servlet的方便性。</p></blockquote>

<p>jsp:useBean动作最简单的语法为：</p>

<p>&lt;jsp:useBean id=&ldquo;user&rdquo; class=&ldquo;com.reton.entity.UserEntity&rdquo;>&lt;/jsp:useBean></p>

<p>这行代码的含义是：“创建一个由class属性指定的类的实例，然后把它绑定到其名字由id属性给出的变量上”。不过，就象我们接下来会看到的，定义一个scope属性可以让Bean关联到更多的页面。此时，jsp:useBean动作只有在不存在同样id和scope的Bean时才创建新的对象实例，同时，获得现有Bean的引用就变得很有必要。</p>

<p>获得Bean实例之后，要修改Bean的属性既可以通过jsp:setProperty动作进行，也可以在Scriptlet中利用id属性所命名的对象变量，通过调用该对象的方法显式地修改其属性。这使我们想起，当我们说“某个Bean有一个类型为X的属性foo”时，就意味着“这个类有一个返回值类型为X的getFoo方法，还有一个setFoo方法以X类型的值为参数”。</p>

<p>有关jsp:setProperty动作的详细情况在后面讨论。但现在必须了解的是，我们既可以通过jsp:setProperty动作的value属性直接提供一个值，也可以通过param属性声明Bean的属性值来自指定的请求参数，还可以列出Bean属性表明它的值应该来自请求参数中的同名变量。</p>

<p>在JSP表达式或Scriptlet中读取Bean属性通过调用相应的getXXX方法实现，或者更一般地，使用jsp:getProperty动作。</p>

<p>注意包含Bean的类文件应该放到服务器正式存放Java类的目录下，而不是保留给修改后能够自动装载的类的目录。例如，对于Java Web Server来说，Bean和所有Bean用到的类都应该放入classes目录，或者封装进jar文件后放入lib目录，但不应该放到servlets下。</p>

<p>一个简单的例子：</p>

<figure class='code'><figcaption><span>JavaResources/src/com.reton.entity</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">reton</span><span class="o">.</span><span class="na">entity</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserEntity</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">String</span> <span class="n">userName</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">String</span> <span class="n">passWord</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="nf">UserEntity</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getUserName</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">userName</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserName</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">this</span><span class="o">.</span><span class="na">userName</span> <span class="o">=</span> <span class="n">userName</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getPassWord</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">passWord</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPassWord</span><span class="o">(</span><span class="n">String</span> <span class="n">passWord</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">this</span><span class="o">.</span><span class="na">passWord</span> <span class="o">=</span> <span class="n">passWord</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>register.jsp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;%</span><span class="err">@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span>
</span><span class='line'>    <span class="n">pageEncoding</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="o">%&gt;</span>
</span><span class='line'><span class="o">&lt;!</span><span class="n">DOCTYPE</span> <span class="n">html</span> <span class="n">PUBLIC</span> <span class="s">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="s">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">meta</span> <span class="n">http</span><span class="o">-</span><span class="n">equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="n">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Insert</span> <span class="n">title</span> <span class="n">here</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">form</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;do_register.jsp&quot;</span> <span class="n">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="n">用户名</span><span class="err">：</span><span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;userName&quot;</span><span class="o">/&gt;</span>
</span><span class='line'>  <span class="nl">密码:</span><span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;passWord&quot;</span><span class="o">/&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;提交&quot;</span><span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>do_register.jsp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;%</span><span class="err">@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span>
</span><span class='line'>    <span class="n">pageEncoding</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="o">%&gt;</span>
</span><span class='line'><span class="o">&lt;!</span><span class="n">DOCTYPE</span> <span class="n">html</span> <span class="n">PUBLIC</span> <span class="s">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="s">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">meta</span> <span class="n">http</span><span class="o">-</span><span class="n">equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="n">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">注册信息</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nl">jsp:</span><span class="n">useBean</span> <span class="n">id</span><span class="o">=</span><span class="s">&quot;user&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s">&quot;com.reton.entity.UserEntity&quot;</span><span class="o">&gt;&lt;/</span><span class="nl">jsp:</span><span class="n">useBean</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nl">jsp:</span><span class="n">setProperty</span> <span class="n">property</span><span class="o">=</span><span class="s">&quot;userName&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;user&quot;</span><span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nl">jsp:</span><span class="n">setProperty</span> <span class="n">property</span><span class="o">=</span><span class="s">&quot;passWord&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;user&quot;</span><span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;%</span>
</span><span class='line'><span class="n">request</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span><span class="s">&quot;utf-8&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="n">String</span> <span class="n">userName</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;userName&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="n">String</span> <span class="n">passWord</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;passWord&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">userName</span><span class="o">);</span>
</span><span class='line'>  <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;&lt;br/&gt;&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">passWord</span><span class="o">);</span>
</span><span class='line'><span class="o">%&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">br</span><span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nl">jsp:</span><span class="n">getProperty</span> <span class="n">property</span><span class="o">=</span><span class="s">&quot;userName&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;user&quot;</span><span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nl">jsp:</span><span class="n">getProperty</span> <span class="n">property</span><span class="o">=</span><span class="s">&quot;passWord&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;user&quot;</span><span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>GetProperty</strong></p>

<p>&lt;jsp:getProperty>标签表示获取BEAN的属性的值并将之转化为一个字符串，然后将其插入到输出的页面中。</p>

<p>语法：</p>

<p>&lt;jsp:getProperty name=&ldquo;name&rdquo; property=&ldquo;propertyName&rdquo; /></p>

<p>注：</p>

<p>1、在使用&lt;jsp:getProperty>之前，必须用&lt;jsp:useBean>来创建它。</p>

<p>2、不能使用&lt;jsp:getProperty>来检索一个已经被索引了的属性。</p>

<p>3、能够和JavaBeans组件一起使用&lt;jsp:getProperty>，但是不能与Enterprise Java Bean一起使用。</p>

<p><strong>SetProperty指令</strong></p>

<p>&lt;jsp:setProperty>标签表示用来设置Bean中的属性值。</p>

<p>语法：</p>

<p>&lt;jsp:setProperty name=&ldquo;beanName&rdquo; prop_expr /></p>

<p>其中prop_expr有以下几种可能的情形：</p>

<p>property=&ldquo;*&rdquo; | property=&ldquo;propertyName&rdquo; | property=&ldquo;propertyName&rdquo; param=&ldquo;parameterName&rdquo; | property=&ldquo;propertyName&rdquo; value=&ldquo;propertyValue&rdquo;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;!--</span> <span class="n">id表示实例名</span>  <span class="n">class表示类名</span> <span class="n">scope</span> <span class="n">表示作用的范围</span> <span class="o">--&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nl">jsp:</span><span class="n">useBean</span> <span class="n">id</span><span class="o">=</span><span class="s">&quot;pe&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s">&quot;com.reton.entity&quot;</span> <span class="n">scope</span><span class="o">=</span><span class="s">&quot;page&quot;</span><span class="o">&gt;&lt;/</span><span class="nl">jsp:</span><span class="n">useBean</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;!--</span> <span class="n">name表示实例名</span>  <span class="n">property表示属性</span> <span class="n">vaue表示属性值</span> <span class="o">--&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nl">jsp:</span><span class="n">setProperty</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;pe&quot;</span>   <span class="n">property</span><span class="o">=</span><span class="s">&quot;name&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;xxx&quot;</span><span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nl">jsp:</span><span class="n">setProperty</span> <span class="n">property</span><span class="o">=</span><span class="s">&quot;age&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;pe&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;23&quot;</span><span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nl">jsp:</span><span class="n">getProperty</span> <span class="n">property</span><span class="o">=</span><span class="s">&quot;name&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;pe&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nl">jsp:</span><span class="n">getProperty</span> <span class="n">property</span><span class="o">=</span><span class="s">&quot;age&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;pe&quot;</span> <span class="o">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>param</strong></p>

<p>param指令用于设置参数值，这个指令本身不能单独使用，单独的param没有实际意义，param指令可与一下三个指令结合使用：</p>

<p>jsp:include</p>

<p>jsp:forward</p>

<p>jsp:plugin</p>

<p>param指令的语法格式如下：</p>

<p>&lt;jsp:param  name=&ldquo;paramName&rdquo; value=&ldquo;paramValue&rdquo;></p>

<p><strong>Plugin</strong></p>

<p> （用于下载服务器端的javaBean或applet到客户端）　　jsp:plugin动作用来根据浏览器的类型，插入通过Java插件运行Java Applet所必需的OBJECT或EMBED元素。</p>

<p>&lt;jsp:plugin<br/>
  type=&ldquo;bean | applet&rdquo;   : 被执行的java程序的类型
  code=&ldquo;classFileName&rdquo; ：被执行的文件名，必须以  .class 结尾
  codebase=&ldquo;classFileDirectoryName&rdquo;   ：被执行文件的所在目录
  [ name=&ldquo;instanceName&rdquo; ] :给程序起一个名字用来标识该程序
  [ archive=&ldquo;URIToArchive, &hellip;&rdquo; ] ：指向一些要预先载入的将要使用到的类
  [ align=&ldquo;bottom | top | middle | left | right&rdquo; ] ：
  [ height=&ldquo;displayPixels&rdquo; ]
  [ width=&ldquo;displayPixels&rdquo; ]
  [ hspace=&ldquo;leftRightPixels&rdquo; ]
  [ vspace=&ldquo;topBottomPixels&rdquo; ]
  [ jreversion=&ldquo;JREVersionNumber | 1.1&rdquo; ]   ：能正确运行改程序必须的JRE的版本
  [ nspluginurl=&ldquo;URLToPlugin&rdquo; ]<br/>
  [ iepluginurl=&ldquo;URLToPlugin&rdquo; ] >
  [ &lt;jsp:params>
  [ &lt;jsp:param name=&ldquo;parameterName&rdquo; value=&ldquo;{parameterValue | &lt;%= expression %>}&rdquo; /> ]+
  &lt;/jsp:params> ]
  [ &lt;jsp:fallback> text message for user &lt;/jsp:fallback> ]  ：当不能正确显示该Applet时，显示该指令中的文本提示
 &lt;jsp:plugin></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2016-06-07T23:30:32+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/php/'>php</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2016/06/07/php-design-9/" itemprop="url">PHP设计模式(九)-代理模式</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h1>1、模式定义</h1>

<p>代理模式（Proxy）为其他对象提供一种代理以控制对这个对象的访问。使用代理模式创建代理对象，让代理对象控制目标对象的访问（目标对象可以是远程的对象、创建开销大的对象或需要安全控制的对象），并且可以在不改变目标对象的情况下添加一些额外的功能。</p>

<p>在某些情况下，一个客户不想或者不能直接引用另一个对象，而代理对象可以在客户端和目标对象之间起到中介的作用，并且可以通过代理对象去掉客户不能看到的内容和服务或者添加客户需要的额外服务。</p>

<p>经典例子就是网络代理，你想访问 Facebook 或者 Twitter ，如何绕过 GFW？找个代理网站。</p>

<h1>2、UML类图</h1>

<p><img src="http://laravelacademy.org/wp-content/uploads/2015/12/Proxy-Design-Pattern-UML.png" alt="" /></p>

<h1>3、示例代码</h1>

<figure class='code'><figcaption><span>Record.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Proxy</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Record类</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Record</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var array|null</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$data</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @param null $data</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$data</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span> <span class="o">=</span> <span class="p">(</span><span class="k">array</span><span class="p">)</span> <span class="nv">$data</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * magic setter</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param string $name</span>
</span><span class='line'><span class="sd">     * @param mixed  $value</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__set</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">[(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$name</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * magic getter</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param string $name</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return mixed|null</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__get</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">[(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$name</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>RecordProxy.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Proxy</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * RecordProxy类</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">RecordProxy</span> <span class="k">extends</span> <span class="nx">Record</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var bool</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$isDirty</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var bool</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$isInitialized</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @param array $data</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// when the record has data, mark it as initialized</span>
</span><span class='line'>        <span class="c1">// since Record will hold our business logic, we don&#39;t want to</span>
</span><span class='line'>        <span class="c1">// implement this behaviour there, but instead in a new proxy class</span>
</span><span class='line'>        <span class="c1">// that extends the Record class</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="o">!==</span> <span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isInitialized</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isDirty</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * magic setter</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param string $name</span>
</span><span class='line'><span class="sd">     * @param mixed  $value</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__set</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isDirty</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>        <span class="k">parent</span><span class="o">::</span><span class="na">__set</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>4、测试代码</h1>

<figure class='code'><figcaption><span>ProxyTest.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Proxy\Tests</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">DesignPatterns\Structural\Proxy\Record</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">DesignPatterns\Structural\Proxy\RecordProxy</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">ProxyTest</span> <span class="k">extends</span> <span class="nx">\PHPUnit_Framework_TestCase</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testSetAttribute</span><span class="p">(){</span>
</span><span class='line'>        <span class="nv">$data</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>        <span class="nv">$proxy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RecordProxy</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$proxy</span><span class="o">-&gt;</span><span class="na">xyz</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$proxy</span><span class="o">-&gt;</span><span class="na">xyz</span><span class="o">===</span><span class="k">false</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>5、总结</h1>

<p>代理模式在很多情况下都非常有用，特别是你想强行控制一个对象的时候，比如延迟加载、监视状态变更的方法等等。</p>

<p>与类似接口的区别：</p>

<ul>
<li>适配器模式 —— 适配器模式为它所适配的对象提供了一个不同的接口，而代理提供了与它的实体相同的接口。</li>
<li>装饰器模式 —— 两者目的不同：装饰器为对象添加一个或多个功能，而代理则控制对对象的访问。</li>
</ul>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2016-06-07T12:59:44+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/php/'>php</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2016/06/07/php-design-8/" itemprop="url">PHP设计模式(八)-迭代器模式</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h1>1、模式定义</h1>

<p>迭代器模式（Iterator），又叫做游标（Cursor）模式。提供一种方法访问一个容器（Container）对象中各个元素，而又不需暴露该对象的内部细节。</p>

<p>当你需要访问一个聚合对象，而且不管这些对象是什么都需要遍历的时候，就应该考虑使用迭代器模式。另外，当需要对聚集有多种方式遍历时，可以考虑去使用迭代器模式。迭代器模式为遍历不同的聚集结构提供如开始、下一个、是否结束、当前哪一项等统一的接口。</p>

<p>PHP标准库（SPL）中提供了迭代器接口 Iterator，要实现迭代器模式，实现该接口即可。</p>

<h1>2、UML类图</h1>

<p><img src="http://laravelacademy.org/wp-content/uploads/2016/01/Iterator-Design-Pattern-UML.png" alt="" /></p>

<h1>3、实例代码</h1>

<figure class='code'><figcaption><span>Book.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Iterator</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Book</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$author</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$title</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$title</span><span class="p">,</span> <span class="nv">$author</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">author</span> <span class="o">=</span> <span class="nv">$author</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="nv">$title</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getAuthor</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">author</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getTitle</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getAuthorAndTitle</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getTitle</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39; by &#39;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getAuthor</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>BookList.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Iterator</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">BookList</span> <span class="k">implements</span> <span class="nx">\Countable</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$books</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getBook</span><span class="p">(</span><span class="nv">$bookNumberToGet</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">books</span><span class="p">[</span><span class="nv">$bookNumberToGet</span><span class="p">]))</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">books</span><span class="p">[</span><span class="nv">$bookNumberToGet</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">addBook</span><span class="p">(</span><span class="nx">Book</span> <span class="nv">$book</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">books</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$book</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">removeBook</span><span class="p">(</span><span class="nx">Book</span> <span class="nv">$bookToRemove</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">books</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$book</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="sd">/** @var Book $book */</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nv">$book</span><span class="o">-&gt;</span><span class="na">getAuthorAndTitle</span><span class="p">()</span> <span class="o">===</span> <span class="nv">$bookToRemove</span><span class="o">-&gt;</span><span class="na">getAuthorAndTitle</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>                <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">books</span><span class="p">[</span><span class="nv">$key</span><span class="p">]);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">count</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">books</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>BookListIterator.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Iterator</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">BookListIterator</span> <span class="k">implements</span> <span class="nx">\Iterator</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var BookList</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$bookList</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var int</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$currentBook</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">BookList</span> <span class="nv">$bookList</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bookList</span> <span class="o">=</span> <span class="nv">$bookList</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Return the current book</span>
</span><span class='line'><span class="sd">     * @link http://php.net/manual/en/iterator.current.php</span>
</span><span class='line'><span class="sd">     * @return Book Can return any type.</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">current</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bookList</span><span class="o">-&gt;</span><span class="na">getBook</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentBook</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * (PHP 5 &gt;= 5.0.0)</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Move forward to next element</span>
</span><span class='line'><span class="sd">     * @link http://php.net/manual/en/iterator.next.php</span>
</span><span class='line'><span class="sd">     * @return void Any returned value is ignored.</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">next</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentBook</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * (PHP 5 &gt;= 5.0.0)</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Return the key of the current element</span>
</span><span class='line'><span class="sd">     * @link http://php.net/manual/en/iterator.key.php</span>
</span><span class='line'><span class="sd">     * @return mixed scalar on success, or null on failure.</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">key</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentBook</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * (PHP 5 &gt;= 5.0.0)</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Checks if current position is valid</span>
</span><span class='line'><span class="sd">     * @link http://php.net/manual/en/iterator.valid.php</span>
</span><span class='line'><span class="sd">     * @return boolean The return value will be casted to boolean and then evaluated.</span>
</span><span class='line'><span class="sd">     *       Returns true on success or false on failure.</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">valid</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">null</span> <span class="o">!==</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bookList</span><span class="o">-&gt;</span><span class="na">getBook</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentBook</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * (PHP 5 &gt;= 5.0.0)</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Rewind the Iterator to the first element</span>
</span><span class='line'><span class="sd">     * @link http://php.net/manual/en/iterator.rewind.php</span>
</span><span class='line'><span class="sd">     * @return void Any returned value is ignored.</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">rewind</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentBook</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>BookListReverseIterator.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Iterator</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">BookListReverseIterator</span> <span class="k">implements</span> <span class="nx">\Iterator</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var BookList</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$bookList</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var int</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$currentBook</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">BookList</span> <span class="nv">$bookList</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bookList</span> <span class="o">=</span> <span class="nv">$bookList</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentBook</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bookList</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Return the current book</span>
</span><span class='line'><span class="sd">     * @link http://php.net/manual/en/iterator.current.php</span>
</span><span class='line'><span class="sd">     * @return Book Can return any type.</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">current</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bookList</span><span class="o">-&gt;</span><span class="na">getBook</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentBook</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * (PHP 5 &gt;= 5.0.0)</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Move forward to next element</span>
</span><span class='line'><span class="sd">     * @link http://php.net/manual/en/iterator.next.php</span>
</span><span class='line'><span class="sd">     * @return void Any returned value is ignored.</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">next</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentBook</span><span class="o">--</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * (PHP 5 &gt;= 5.0.0)</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Return the key of the current element</span>
</span><span class='line'><span class="sd">     * @link http://php.net/manual/en/iterator.key.php</span>
</span><span class='line'><span class="sd">     * @return mixed scalar on success, or null on failure.</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">key</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentBook</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * (PHP 5 &gt;= 5.0.0)</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Checks if current position is valid</span>
</span><span class='line'><span class="sd">     * @link http://php.net/manual/en/iterator.valid.php</span>
</span><span class='line'><span class="sd">     * @return boolean The return value will be casted to boolean and then evaluated.</span>
</span><span class='line'><span class="sd">     *       Returns true on success or false on failure.</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">valid</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">null</span> <span class="o">!==</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bookList</span><span class="o">-&gt;</span><span class="na">getBook</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentBook</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * (PHP 5 &gt;= 5.0.0)</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Rewind the Iterator to the first element</span>
</span><span class='line'><span class="sd">     * @link http://php.net/manual/en/iterator.rewind.php</span>
</span><span class='line'><span class="sd">     * @return void Any returned value is ignored.</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">rewind</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentBook</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bookList</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>4、测试代码</h1>

<figure class='code'><figcaption><span>Tests/IteratorTest.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Iterator\Tests</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Iterator\Book</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Iterator\BookList</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Iterator\BookListIterator</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Iterator\BookListReverseIterator</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">IteratorTest</span> <span class="k">extends</span> <span class="nx">\PHPUnit_Framework_TestCase</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var BookList</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$bookList</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">protected</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bookList</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BookList</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bookList</span><span class="o">-&gt;</span><span class="na">addBook</span><span class="p">(</span><span class="k">new</span> <span class="nx">Book</span><span class="p">(</span><span class="s1">&#39;Learning PHP Design Patterns&#39;</span><span class="p">,</span> <span class="s1">&#39;William Sanders&#39;</span><span class="p">));</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bookList</span><span class="o">-&gt;</span><span class="na">addBook</span><span class="p">(</span><span class="k">new</span> <span class="nx">Book</span><span class="p">(</span><span class="s1">&#39;Professional Php Design Patterns&#39;</span><span class="p">,</span> <span class="s1">&#39;Aaron Saray&#39;</span><span class="p">));</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bookList</span><span class="o">-&gt;</span><span class="na">addBook</span><span class="p">(</span><span class="k">new</span> <span class="nx">Book</span><span class="p">(</span><span class="s1">&#39;Clean Code&#39;</span><span class="p">,</span> <span class="s1">&#39;Robert C. Martin&#39;</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">expectedAuthors</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>            <span class="k">array</span><span class="p">(</span>
</span><span class='line'>                <span class="k">array</span><span class="p">(</span>
</span><span class='line'>                    <span class="s1">&#39;Learning PHP Design Patterns by William Sanders&#39;</span><span class="p">,</span>
</span><span class='line'>                    <span class="s1">&#39;Professional Php Design Patterns by Aaron Saray&#39;</span><span class="p">,</span>
</span><span class='line'>                    <span class="s1">&#39;Clean Code by Robert C. Martin&#39;</span>
</span><span class='line'>                <span class="p">)</span>
</span><span class='line'>            <span class="p">),</span>
</span><span class='line'>        <span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @dataProvider expectedAuthors</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testUseAIteratorAndValidateAuthors</span><span class="p">(</span><span class="nv">$expected</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$iterator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BookListIterator</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bookList</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">while</span> <span class="p">(</span><span class="nv">$iterator</span><span class="o">-&gt;</span><span class="na">valid</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$expectedBook</span> <span class="o">=</span> <span class="nb">array_shift</span><span class="p">(</span><span class="nv">$expected</span><span class="p">);</span>
</span><span class='line'>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="nv">$expectedBook</span><span class="p">,</span> <span class="nv">$iterator</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getAuthorAndTitle</span><span class="p">());</span>
</span><span class='line'>            <span class="nv">$iterator</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @dataProvider expectedAuthors</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testUseAReverseIteratorAndValidateAuthors</span><span class="p">(</span><span class="nv">$expected</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$iterator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BookListReverseIterator</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bookList</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">while</span> <span class="p">(</span><span class="nv">$iterator</span><span class="o">-&gt;</span><span class="na">valid</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$expectedBook</span> <span class="o">=</span> <span class="nb">array_pop</span><span class="p">(</span><span class="nv">$expected</span><span class="p">);</span>
</span><span class='line'>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="nv">$expectedBook</span><span class="p">,</span> <span class="nv">$iterator</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getAuthorAndTitle</span><span class="p">());</span>
</span><span class='line'>            <span class="nv">$iterator</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Test BookList Remove</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testBookRemove</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bookList</span><span class="o">-&gt;</span><span class="na">removeBook</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bookList</span><span class="o">-&gt;</span><span class="na">getBook</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bookList</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">(),</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2016-06-07T10:53:23+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/php/'>php</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2016/06/07/php-design-7/" itemprop="url">PHP设计模式(七)-装饰器模式</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h1>1、模式定义</h1>

<p>装饰器模式能够从一个对象的外部动态地给对象添加功能。</p>

<p>通常给对象添加功能，要么直接修改对象添加相应的功能，要么派生对应的子类来扩展，抑或是使用对象组合的方式。显然，直接修改对应的类这种方式并不可取。在面向对象的设计中，我们也应该尽量使用对象组合，而不是对象继承来扩展和复用功能。装饰器模式就是基于对象组合的方式，可以很灵活的给对象添加所需要的功能。装饰器模式的本质就是动态组合。动态是手段，组合才是目的。</p>

<p>常见的使用示例：Web服务层 —— 为 REST 服务提供 JSON 和 XML 装饰器。</p>

<h1>2、UML类图</h1>

<p><img src="http://laravelacademy.org/wp-content/uploads/2015/12/decorator-design-pattern.png" alt="" /></p>

<h1>3、实例代码</h1>

<p>定义接口：</p>

<figure class='code'><figcaption><span>RendererInterface.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Decorator</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * RendererInterface接口</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">interface</span> <span class="nx">RendererInterface</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * render data</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return mixed</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">renderData</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Webservice.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Decorator</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Webservice类</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Webservice</span> <span class="k">implements</span> <span class="nx">RendererInterface</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var mixed</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$data</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @param mixed $data</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @return string</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">renderData</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">个人感觉在这里没有必要实现RendererInterface接口，</span>
</span><span class='line'><span class="nx">实现这个接口过后就必须实现renderData方法，而这个方法仅仅是用来返回数据。</span>
</span><span class='line'><span class="nx">但是这个名字和后面装饰器的实现方法重名，很容易混乱。</span>
</span><span class='line'><span class="nx">这里如果不实现RendererInterface接口，将renderData</span><span class="p">()</span><span class="nx">改为getData（）应该会好一些，至少程序没那么容易搞混。</span>
</span></code></pre></td></tr></table></div></figure>


<p>装饰器抽象类：</p>

<figure class='code'><figcaption><span>Decorator.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Decorator</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * 装饰器必须实现 RendererInterface 接口, 这是装饰器模式的主要特点，</span>
</span><span class='line'><span class="sd"> * 否则的话就不是装饰器而只是个包裹类</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Decorator类</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">abstract</span> <span class="k">class</span> <span class="nc">Decorator</span> <span class="k">implements</span> <span class="nx">RendererInterface</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var RendererInterface</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$wrapped</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 必须类型声明装饰组件以便在子类中可以调用renderData()方法</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param RendererInterface $wrappable</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">RendererInterface</span> <span class="nv">$wrappable</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wrapped</span> <span class="o">=</span> <span class="nv">$wrappable</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>RenderInXml.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Decorator</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * RenderInXml类</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">RenderInXml</span> <span class="k">extends</span> <span class="nx">Decorator</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * render data as XML</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return mixed|string</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">renderData</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$output</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wrapped</span><span class="o">-&gt;</span><span class="na">renderData</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// do some fancy conversion to xml from array ...</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$doc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\DOMDocument</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$output</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$val</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$doc</span><span class="o">-&gt;</span><span class="na">appendChild</span><span class="p">(</span><span class="nv">$doc</span><span class="o">-&gt;</span><span class="na">createElement</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$val</span><span class="p">));</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$doc</span><span class="o">-&gt;</span><span class="na">saveXML</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>RenderInJson.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Decorator</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * RenderInJson类</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">RenderInJson</span> <span class="k">extends</span> <span class="nx">Decorator</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * render data as JSON</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return mixed|string</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">renderData</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$output</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wrapped</span><span class="o">-&gt;</span><span class="na">renderData</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$output</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>4、测试代码</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">DesignPatterns\Structural\Decorator\Tests</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">DesignPatterns\Structural\Decorator</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * DecoratorTest 用于测试装饰器模式</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">DecoratorTest</span> <span class="k">extends</span> <span class="nx">\PHPUnit_Framework_TestCase</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$service</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">protected</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">service</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Decorator\Webservice</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">));</span><span class="c1">//实例化 Webservice 类</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testJsonDecorator</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Wrap service with a JSON decorator for renderers</span>
</span><span class='line'>        <span class="nv">$service</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Decorator\RenderInJson</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">service</span><span class="p">);</span><span class="c1">//给实例化的类添加装饰器</span>
</span><span class='line'>        <span class="c1">// Our Renderer will now output JSON instead of an array</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;{&quot;foo&quot;:&quot;bar&quot;}&#39;</span><span class="p">,</span> <span class="nv">$service</span><span class="o">-&gt;</span><span class="na">renderData</span><span class="p">());</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testXmlDecorator</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Wrap service with a XML decorator for renderers</span>
</span><span class='line'>        <span class="nv">$service</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Decorator\RenderInXml</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">service</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">// Our Renderer will now output XML instead of an array</span>
</span><span class='line'>        <span class="nv">$xml</span> <span class="o">=</span> <span class="s1">&#39;&lt;?xml version=&quot;1.0&quot;?&gt;&lt;foo&gt;bar&lt;/foo&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertXmlStringEqualsXmlString</span><span class="p">(</span><span class="nv">$xml</span><span class="p">,</span> <span class="nv">$service</span><span class="o">-&gt;</span><span class="na">renderData</span><span class="p">());</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * The first key-point of this pattern :</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testDecoratorMustImplementsRenderer</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$className</span> <span class="o">=</span> <span class="s1">&#39;DesignPatterns\Structural\Decorator\Decorator&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$interfaceName</span> <span class="o">=</span> <span class="s1">&#39;DesignPatterns\Structural\Decorator\RendererInterface&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nb">is_subclass_of</span><span class="p">(</span><span class="nv">$className</span><span class="p">,</span> <span class="nv">$interfaceName</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Second key-point of this pattern : the decorator is type-hinted</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @expectedException \PHPUnit_Framework_Error</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testDecoratorTypeHinted</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nb">version_compare</span><span class="p">(</span><span class="k">PHP_VERSION</span><span class="p">,</span> <span class="s1">&#39;7&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">throw</span> <span class="k">new</span> <span class="nx">\PHPUnit_Framework_Error</span><span class="p">(</span><span class="s1">&#39;Skip test for PHP 7&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">__FILE__</span><span class="p">,</span> <span class="k">__LINE__</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockForAbstractClass</span><span class="p">(</span><span class="s1">&#39;DesignPatterns\Structural\Decorator\Decorator&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="k">new</span> <span class="nx">\stdClass</span><span class="p">()));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Second key-point of this pattern : the decorator is type-hinted</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @requires PHP 7</span>
</span><span class='line'><span class="sd">     * @expectedException TypeError</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testDecoratorTypeHintedForPhp7</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockForAbstractClass</span><span class="p">(</span><span class="s1">&#39;DesignPatterns\Structural\Decorator\Decorator&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="k">new</span> <span class="nx">\stdClass</span><span class="p">()));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * The decorator implements and wraps the same interface</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testDecoratorOnlyAcceptRenderer</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$mock</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMock</span><span class="p">(</span><span class="s1">&#39;DesignPatterns\Structural\Decorator\RendererInterface&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$dec</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockForAbstractClass</span><span class="p">(</span><span class="s1">&#39;DesignPatterns\Structural\Decorator\Decorator&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="nv">$mock</span><span class="p">));</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertNotNull</span><span class="p">(</span><span class="nv">$dec</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2016-06-07T10:22:51+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/php/'>php</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2016/06/07/php-design-6/" itemprop="url">PHP设计模式(六)-原型模式</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h1>1、模式定义</h1>

<p>通过创建原型使用克隆方法实现对象创建而不是使用标准的<code>new</code> 方式。</p>

<h1>2、UML类图</h1>

<p><img src="http://laravelacademy.org/wp-content/uploads/2015/12/120b8c2b-9cad-44e8-a286-3347d32d57dd.png" alt="" /></p>

<h1>3、示例代码</h1>

<figure class='code'><figcaption><span>BookPrototype.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Prototype</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="sd">/**</span>
</span><span class='line'><span class="sd">  * BookPrototype类</span>
</span><span class='line'><span class="sd">  */</span>
</span><span class='line'>  <span class="k">abstract</span> <span class="k">class</span> <span class="nc">BookPrototype</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="sd">/**</span>
</span><span class='line'><span class="sd">      * @var string</span>
</span><span class='line'><span class="sd">      */</span>
</span><span class='line'>      <span class="k">protected</span> <span class="nv">$title</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>      <span class="sd">/**</span>
</span><span class='line'><span class="sd">      * @var string</span>
</span><span class='line'><span class="sd">      */</span>
</span><span class='line'>      <span class="k">protected</span> <span class="nv">$category</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>      <span class="sd">/**</span>
</span><span class='line'><span class="sd">      * @abstract</span>
</span><span class='line'><span class="sd">      * @return void</span>
</span><span class='line'><span class="sd">      */</span>
</span><span class='line'>      <span class="k">abstract</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">__clone</span><span class="p">();</span>
</span><span class='line'>  
</span><span class='line'>      <span class="sd">/**</span>
</span><span class='line'><span class="sd">      * @return string</span>
</span><span class='line'><span class="sd">      */</span>
</span><span class='line'>      <span class="k">public</span> <span class="k">function</span> <span class="nf">getTitle</span><span class="p">()</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>      <span class="sd">/**</span>
</span><span class='line'><span class="sd">      * @param string $title</span>
</span><span class='line'><span class="sd">      */</span>
</span><span class='line'>      <span class="k">public</span> <span class="k">function</span> <span class="nf">setTitle</span><span class="p">(</span><span class="nv">$title</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="nv">$title</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>BarBookPrototype.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Prototype</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * BarBookPrototype类</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">BarBookPrototype</span> <span class="k">extends</span> <span class="nx">BookPrototype</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var string</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$category</span> <span class="o">=</span> <span class="s1">&#39;Bar&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * empty clone</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__clone</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>FooBookPrototype.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Prototype</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * FooBookPrototype类</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">FooBookPrototype</span> <span class="k">extends</span> <span class="nx">BookPrototype</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$category</span> <span class="o">=</span> <span class="s1">&#39;Foo&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * empty clone</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__clone</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>4、测试代码</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">DesignPatterns\Creational\Prototype\Tests</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">DesignPatterns\Creational\Prototype\BookPrototype</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">DesignPatterns\Creational\Prototype\FooBookPrototype</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">DesignPatterns\Creational\Prototype\BarBookPrototype</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * PrototypeTest tests the prototype pattern</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">PrototypeTest</span> <span class="k">extends</span> <span class="nx">\PHPUnit_Framework_TestCase</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="c1">//实例化得到类的原型</span>
</span><span class='line'>     <span class="k">public</span> <span class="k">function</span> <span class="nf">getPrototype</span><span class="p">(){</span>
</span><span class='line'>         <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>             <span class="k">array</span><span class="p">(</span><span class="k">new</span> <span class="nx">FooBookPrototype</span><span class="p">()),</span>
</span><span class='line'>             <span class="k">array</span><span class="p">(</span><span class="k">new</span> <span class="nx">BarBookPrototype</span><span class="p">())</span>
</span><span class='line'>         <span class="p">);</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>     <span class="sd">/**</span>
</span><span class='line'><span class="sd">   * 克隆类</span>
</span><span class='line'><span class="sd">      * @dataProvider getPrototype</span>
</span><span class='line'><span class="sd">      */</span>
</span><span class='line'>     <span class="k">public</span> <span class="k">function</span> <span class="nf">testCreation</span><span class="p">(</span><span class="nx">BookPrototype</span> <span class="nv">$prototype</span><span class="p">)</span>
</span><span class='line'>     <span class="p">{</span>
</span><span class='line'>         <span class="nv">$book</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$prototype</span><span class="p">;</span>
</span><span class='line'>         <span class="nv">$book</span><span class="o">-&gt;</span><span class="na">setTitle</span><span class="p">(</span><span class="nv">$book</span><span class="o">-&gt;</span><span class="na">getCategory</span><span class="p">()</span><span class="o">.</span><span class="s1">&#39; Book&#39;</span><span class="p">);</span>
</span><span class='line'>         <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="s1">&#39;DesignPatterns\Creational\Prototype\BookPrototype&#39;</span><span class="p">,</span> <span class="nv">$book</span><span class="p">);</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>5、总结</h1>

<p>原型模式的主要思想是基于现有的对象克隆一个新的对象出来，一般是用对象内部提供的克隆方法，通过该方法返回一个对象的副本，这种创建对象的方式，相比我们之前说的几类创建型模式还是有区别的，之前的讲述的工厂方法模式与抽象工厂都是通过工厂封装具体的 new 操作的过程，返回一个新的对象，有的时候我们通过这样的创建工厂创建对象不值得，特别是以下的几个场景，可能使用原型模式更简单、效率更高：</p>

<ul>
<li>如果说我们的对象类型不是刚开始就能确定，而是在运行时确定的话，那么我们通过这个类型的对象克隆出一个新的类型更容易。</li>
<li>有的时候我们可能在实际的项目中需要一个对象在某个状态下的副本，这个前提很重要，这点怎么理解呢，例如有的时候我们需要对比一个对象经过处理后的状态和处理前的状态是否发生过改变，可能我们就需要在执行某段处理之前，克隆这个对象此时状态的副本，然后等执行后的状态进行相应的对比，这样的应用在项目中也是经常会出现的。</li>
<li>当我们处理的对象比较简单，并且对象之间的区别很小，可能只是很固定的几个属性不同的时候，使用原型模式更合适。</li>
</ul>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2016-06-06T23:06:22+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">

</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2016/06/06/php-design-5/" itemprop="url">PHP设计模式(5)-观察者模式</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h1>1、模式定义</h1>

<p>观察者模式有时也被称作发布/订阅模式，该模式用于为对象实现发布/订阅功能：一旦主体对象状态发生改变，与之关联的观察者对象会收到通知，并进行相应操作。</p>

<p>将一个系统分割成一个一些类相互协作的类有一个不好的副作用，那就是需要维护相关对象间的一致性。我们不希望为了维持一致性而使各类紧密耦合，这样会给维护、扩展和重用都带来不便。观察者就是解决这类的耦合关系的。</p>

<p>消息队列系统、事件都使用了观察者模式。</p>

<p>PHP 为观察者模式定义了两个接口：<code>SplSubject</code> 和 <code>SplObserver</code>。<code>SplSubject</code> 可以看做主体对象的抽象，<code>SplObserver</code> 可以看做观察者对象的抽象，要实现观察者模式，只需让主体对象实现 <code>SplSubject</code> ，观察者对象实现 <code>SplObserver</code>，并实现相应方法即可。</p>

<h1>2、UML类图</h1>

<p><img src="http://laravelacademy.org/wp-content/uploads/2016/01/Observer-Design-Pattern-Uml.png" alt="" /></p>

<h1>3、示例代码</h1>

<figure class='code'><figcaption><span>User.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Observer</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * 观察者模式 : 被观察对象 (主体对象)</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> * 主体对象维护观察者列表并发送通知</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="k">implements</span> <span class="nx">\SplSubject</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * user data</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var array</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * observers</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var \SplObjectStorage</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$observers</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">observers</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\SplObjectStorage</span><span class="p">();</span><span class="c1">//PHP SPL标准库之数据结构对象容器</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 附加观察者</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param \SplObserver $observer</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">attach</span><span class="p">(</span><span class="nx">\SplObserver</span> <span class="nv">$observer</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">observers</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nv">$observer</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 取消观察者</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param \SplObserver $observer</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">detach</span><span class="p">(</span><span class="nx">\SplObserver</span> <span class="nv">$observer</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">observers</span><span class="o">-&gt;</span><span class="na">detach</span><span class="p">(</span><span class="nv">$observer</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 通知观察者方法</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">notify</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="sd">/** @var \SplObserver $observer */</span>
</span><span class='line'>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">observers</span> <span class="k">as</span> <span class="nv">$observer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$observer</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param string $name</span>
</span><span class='line'><span class="sd">     * @param mixed  $value</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__set</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">[</span><span class="nv">$name</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// 通知观察者用户被改变</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">notify</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>UserObserver.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Observer</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * UserObserver 类（观察者对象）</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">UserObserver</span> <span class="k">implements</span> <span class="nx">\SplObserver</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 观察者要实现的唯一方法</span>
</span><span class='line'><span class="sd">     * 也是被 Subject 调用的方法</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param \SplSubject $subject</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">\SplSubject</span> <span class="nv">$subject</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">echo</span> <span class="nb">get_class</span><span class="p">(</span><span class="nv">$subject</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39; has been updated&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Tests/ObserverTest.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">DesignPatterns\Behavioral\Observer\Tests</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Observer\UserObserver</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">DesignPatterns\Behavioral\Observer\User</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * ObserverTest 测试观察者模式</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">ObserverTest</span> <span class="k">extends</span> <span class="nx">\PHPUnit_Framework_TestCase</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$observer</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">protected</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserObserver</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 测试通知</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testNotify</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectOutputString</span><span class="p">(</span><span class="s1">&#39;DesignPatterns\Behavioral\Observer\User has been updated&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">observer</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">property</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span><span class="c1">//访问不存在的属性自动调用__set方法</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 测试订阅</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAttachDetach</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$reflection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\ReflectionProperty</span><span class="p">(</span><span class="nv">$subject</span><span class="p">,</span> <span class="s1">&#39;observers&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$reflection</span><span class="o">-&gt;</span><span class="na">setAccessible</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
</span><span class='line'>        <span class="sd">/** @var \SplObjectStorage $observers */</span>
</span><span class='line'>        <span class="nv">$observers</span> <span class="o">=</span> <span class="nv">$reflection</span><span class="o">-&gt;</span><span class="na">getValue</span><span class="p">(</span><span class="nv">$subject</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="s1">&#39;SplObjectStorage&#39;</span><span class="p">,</span> <span class="nv">$observers</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="nv">$observers</span><span class="o">-&gt;</span><span class="na">contains</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">observer</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">observer</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$observers</span><span class="o">-&gt;</span><span class="na">contains</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">observer</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">detach</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">observer</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertFalse</span><span class="p">(</span><span class="nv">$observers</span><span class="o">-&gt;</span><span class="na">contains</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">observer</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 测试 update() 调用</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testUpdateCalling</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$observer</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMock</span><span class="p">(</span><span class="s1">&#39;SplObserver&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nv">$observer</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$observer</span><span class="o">-&gt;</span><span class="na">expects</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">once</span><span class="p">())</span>
</span><span class='line'>            <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">)</span>
</span><span class='line'>            <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="nv">$subject</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">notify</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>4、总结</h1>

<p>观察者模式解除了主体和具体观察者的耦合，让耦合的双方都依赖于抽象，而不是依赖具体。从而使得各自的变化都不会影响另一边的变化。</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2016-06-06T11:24:26+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/php/'>php</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2016/06/06/php-design-4/" itemprop="url">PHP设计模式(四)-数据库对象映射模式</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h1>1、模式定义</h1>

<p>在了解数据映射模式之前，先了解下数据映射，它是在持久化数据存储层（通常是关系型数据库）和驻于内存的数据表现层之间进行双向数据传输的数据访问层。</p>


		
		<a href="/blog/2016/06/06/php-design-4/" class="more-link">阅读全文&rarr;</a>
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2016-06-06T10:32:22+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/php/'>php</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2016/06/06/php-design-3/" itemprop="url">PHP设计模式(三)-策略模式</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<blockquote><p>在之前学习了PHP设计模式中的工厂模式，单例模式，注册树模式，适配器模式。今天来学习一下策略模式。</p></blockquote>


		
		<a href="/blog/2016/06/06/php-design-3/" class="more-link">阅读全文&rarr;</a>
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2016-06-04T12:21:09+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/php/'>php</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2016/06/04/php-design-2/" itemprop="url">PHP设计模式(二)-适配器模式</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h1>适配器模式</h1>

<ol>
<li>适配器模式，可将一个类的接口转换成客户希望的另外一个接口，使得原本不兼容的接口能够一起工作。通俗的理解就是将不同接口适配成统一的API接口。</li>
</ol>



		
		<a href="/blog/2016/06/04/php-design-2/" class="more-link">阅读全文&rarr;</a>
	</div>

</article>

</div>
<nav id="pagenavi">
    
    
        <a href="/posts/2" class="next">Next</a>
		
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav>
</div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2016

    Ewan Reton


Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
		</div>
	</div>
	






<!--
-->


</body>
</html>
