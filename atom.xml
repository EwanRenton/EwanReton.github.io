<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Ewan Reton]]></title>
  <link href="http://ewanreton.github.io/atom.xml" rel="self"/>
  <link href="http://ewanreton.github.io/"/>
  <updated>2016-05-17T20:34:47+08:00</updated>
  <id>http://ewanreton.github.io/</id>
  <author>
    <name><![CDATA[Ewan Reton]]></name>
    <email><![CDATA[liukedi001@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Nginx下ThinkPHP应用Url重写]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/16/nginx-url-rewrite/"/>
    <updated>2016-05-16T23:36:12+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/16/nginx-url-rewrite</id>
    <content type="html"><![CDATA[<blockquote><p>在调Nginx的虚拟主机时发现，我之前的TP改写的商城没放过来（之前挂载BAE上），把BAE上的项目移植过来过后发现，只能访问主页其他页面全部都报404错误</p></blockquote>

<p>到处查资料过后发现，是因为nginx下ThinkPHP应用的url重写和Apache有点不一样。</p>

<p><a href="http://www.kancloud.cn/manual/thinkphp/1866">官方手册</a>说在Nginx低版本中，是不支持PATHINFO的，但是可以通过在Nginx.conf中配置转发规则实现：</p>

<pre class="prettyprint linenums">
 location / { // …..省略部分代码
   if (!-e $request_filename) {
   rewrite  ^(.*)$  /index.php?s=$1  last;
   break;
    }
 }
</pre>


<p>但是好像对我并不适用，在网上找到一篇博文成功解决了问题。</p>

<p><a href="http://blog.jjonline.cn/linux/159.html">原文链接</a></p>

<p>按照博文的方法在我的虚拟主机配置中（/etc/nginx/conf.d/shop.ewanreton.cn.conf）添加了如下代码：</p>

<pre class="prettyprint linenums">
location / {
 root /usr/share/nginx/html/shop;
 index index.html index.htm index.php;
 if (!-e $request_filename) {
 rewrite ^/index.php(.*)$ /index.php?s=$1 last;
 rewrite ^(.*)$ /index.php?s=$1 last;
 break;
 }
}
</pre>


<p>这里我仅仅对我用ThinkPHP框架写的应用进行了配置，如果需要所有都配置的话，推荐直接写在Nginx的配置文件中。</p>

<p>虽然解决了这个问题，但是对这个问题的核心还是没有搞太懂，以后深入学习过后再回来补充这篇文章。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Nginx虚拟主机配置]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/16/nginx-virtualhost/"/>
    <updated>2016-05-16T23:36:00+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/16/nginx-virtualhost</id>
    <content type="html"><![CDATA[<blockquote><p>今天闲下来决定把腾讯云服务器上的网站弄成虚拟主机。毕竟通过 /xx/xx访问也不成样子 0.0</p></blockquote>

<!--more-->


<h1>增加虚拟主机</h1>

<ol>
<li>进入 <code>/etc/nginx/conf.d</code> 目录, 创建虚拟主机配置文件 demo.neoease.com.conf ({域名}.conf) 这个目录每个人都是不同的，进到你的配置目录就好了</li>
<li>打开配置文件, 添加服务如下:</li>
</ol>


<pre class="prettyprint linenums">
server {
    listen       80;
    server_name demo.neoease.com;
    index index.html index.htm index.php;
    root  /var/www/demo_neoease_com;
 
    log_format demo.neoease.com '$remote_addr - $remote_user [$time_local] $request'
    '$status $body_bytes_sent $http_referer '
    '$http_user_agent $http_x_forwarded_for';
    access_log  /var/log/demo.neoease.com.log demo.neoease.com;
}
</pre>


<ol>
<li>打开 Nginx 配置文件 /usr/local/nginx/conf/nginx.conf, 在 http 范围引入虚拟主机配置文件如下:</li>
</ol>


<pre class="prettyprint">
include vhost/*.conf;
这个一般来说都是有的。
</pre>


<p></p>

<h1>让 Nginx 虚拟主机支持 PHP</h1>

<p>在前面第 2 步的虚拟主机服务对应的目录加入对 PHP 的支持, 这里使用的是 FastCGI, 修改如下.</p>

<pre class="prettyprint linenums">
server {
        listen       80;
        server_name class.ewanreton.cn;
        index index.html index.htm index.php;
        root  /usr/share/nginx/html/class;

            location ~ \.php$ {
        root           /usr/share/nginx/html/class;
        fastcgi_pass   127.0.0.1:9000;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
        include        fastcgi_params;
    }

        log_format class.ewanreton.cn '$remote_addr - $remote_user [$time_local] $request'
        '$status $body_bytes_sent $http_referer '
        '$http_user_agent $http_x_forwarded_for';
        access_log  /var/log/class.ewanreton.cn.log class.ewanreton.cn;
}
这个是我腾讯云服务器上的版本。中间配置PHP支持与原博文有所不一样。
</pre>


<p></p>

<p>重启 Nginx 服务, 执行以下语句.</p>

<pre class="prettyprint linenums">
service nginx restart
</pre>


<p><a href="http://www.neoease.com/nginx-virtual-host/">参考博客</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[QQ登录Demo]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/15/qq-login/"/>
    <updated>2016-05-15T16:12:15+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/15/qq-login</id>
    <content type="html"><![CDATA[<blockquote><p>今天完成了一个QQ登录的小Deom</p></blockquote>

<h1>前置条件</h1>

<ul>
<li>一个QQ号</li>
<li>一台公网通过域名可访问的web服务器</li>
</ul>


<!--more-->


<h1>申请AppID和AppKey</h1>

<p><a href="http://connect.qq.com/">QQ开放平台</a></p>

<p>如果是第一次登录，会跳转到管理中心，应用开发者注册
<img src="http://d.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=b43ea01c0d46f21fcd345e56c61f1a5d/7acb0a46f21fbe0908972df36c600c338644ad08.jpg?referer=6f234af490dda144831e58820b06&amp;x=.jpg" alt="开发者注册" />
注册后悔跳转到管理中心，点击创建应用</p>

<p><img src="http://c.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=7ab420c84634970a4373102aa5f1a0f5/fc1f4134970a304ef778481dd6c8a786c8175cfb.jpg?referer=ebbc6b2a5566d016270eaa189c99&amp;x=.jpg" alt="创建应用" />
回调地址，可以和上面一样，在开发的时候再修改。
<img src="http://f.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=f47f75cf902bd40746c7d3f84bb2ef6c/aa18972bd40735fa1b96a55e99510fb30e2408f7.jpg?referer=8ed677a03e12b31b9e7bf91968ae&amp;x=.jpg" alt="验证" />
将下面这段代码，复制到服务器首页<code>&lt;head&gt;</code>标签中。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">&quot;qc:admins&quot;</span> <span class="na">content=</span><span class="s">&quot;43216566776571625476636&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>添加测试回调地址</h1>

<p>在QQ开放平台应用详情中，选择信息管理，</p>

<p>在回调地址中添加</p>

<p><img src="http://g.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=2bafae5c4010b912bbc1f6fbf3c68d3e/738b4710b912c8fc25701f2afb039245d7882152.jpg?referer=37adaf2785025aaf8a254afb8f30&amp;x=.jpg" alt="添加回调地址" />
其中的callback.php可以自定义。</p>

<p>记得保存之前需要验证。</p>

<h1>引入官方SDK</h1>

<p><a href="http://wiki.connect.qq.com/">官方SDK</a></p>

<p>找到PHP下载（有能力可以自己手工开发，造车轮。）</p>

<p>放到站点根目录</p>

<h1>SDK参数配置</h1>

<p>访问<code>http://localhost/Connect2.1/install.php</code>
<img src="http://a.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=b155c91931d3d539c53d0fc60abc986d/14ce36d3d539b600424ce650ee50352ac75cb753.jpg?referer=0353883031d12f2e97129a50f131&amp;x=.jpg" alt="参数配置" />
配置成功后,保留API下的文件，其他的都可删除。</p>

<h1>SDK解读</h1>

<p><img src="http://g.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=440c3587322ac65c63056676cbc9c32c/e850352ac65c10382dc82725b5119313b17e89a7.jpg?referer=314909b58235e5ddc93b91eff77d&amp;x=.jpg" alt="" />
<img src="http://b.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=4c5e0d1fa086c9170c03523cf90601f2/d0c8a786c9177f3ebe9d15ea77cf3bc79e3d56a8.jpg?referer=4ebf08d032fae6cd55a39f519266&amp;x=.jpg" alt="" />
<img src="http://h.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=327017c44e540923ae69637ba263a034/ca1349540923dd54e98f4e8fd609b3de9d82485d.jpg?referer=cd4a9bc7be12c8fcede4c2fda833&amp;x=.jpg" alt="" />
<img src="http://a.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=22750c750bf431adb8d2433c7b0ddd92/d1a20cf431adcbefe6cb97e1abaf2edda2cc9f5e.jpg?referer=bd373c299e25bc31724a35a8d934&amp;x=.jpg" alt="" />
<img src="http://f.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=3ede9315d262853596e0d224a0d407fb/4ec2d5628535e5dd429f4c3871c6a7efcf1b62a2.jpg?referer=bc5660e9b63533faaca1a71ece60&amp;x=.jpg" alt="" />
<img src="http://b.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=9a446d86ff1986184547ef817ad65f4e/b151f8198618367af3eb973a29738bd4b21ce5f3.jpg?referer=7862fb405eee3d6d7bd1b3fb4391&amp;x=.jpg" alt="" />
<img src="http://g.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=f77b76cf902bd40746c7d3f84bb2ef6c/aa18972bd40735fa1892a65e99510fb30e2408f3.jpg?referer=8dd274a03e12b31b9e7bf9196892&amp;x=.jpg" alt="" />
<img src="http://a.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=4d470c1fa086c9170c03523cf90601f2/d0c8a786c9177f3ebf8414ea77cf3bc79e3d56a1.jpg?referer=4fa609d032fae6cd55a39f51927f&amp;x=.jpg" alt="" /></p>

<h1>将SDK整合到web中</h1>

<p>Connect2.1
放在同级目录下</p>

<figure class='code'><figcaption><span>index.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="k">require_once</span> <span class="s2">&quot;Connect2.1/qqConnectAPI.php&quot;</span><span class="p">;</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="x">&lt;html&gt;</span>
</span><span class='line'><span class="x">  &lt;head&gt;</span>
</span><span class='line'><span class="x">      &lt;meta charset=&quot;utf-8&quot;&gt;</span>
</span><span class='line'><span class="x">      &lt;title&gt;&lt;/title&gt;</span>
</span><span class='line'><span class="x">  &lt;/heda&gt;</span>
</span><span class='line'><span class="x">    &lt;body&gt;</span>
</span><span class='line'><span class="x">        </span><span class="cp">&lt;?php</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;qq_accesstokebn&#39;</span><span class="p">])</span><span class="o">||!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;qq_openid&#39;</span><span class="p">])){</span><span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">        &lt;a href=&quot;qqlogin.php&quot;&gt;登录QQ&lt;/a&gt;</span>
</span><span class='line'><span class="x">        </span><span class="cp">&lt;?php</span> <span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">          &lt;a href=&quot;qqlogout.php&quot;&gt;退出QQ&lt;/a&gt;</span>
</span><span class='line'><span class="x">          </span><span class="cp">&lt;?php</span>
</span><span class='line'>            <span class="nv">$qc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">QC</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;qq_accesstokebn&#39;</span><span class="p">],</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;qq_openid&#39;</span><span class="p">]);</span>
</span><span class='line'>            <span class="nv">$userinfo</span> <span class="o">=</span><span class="nv">$qc</span><span class="o">-&gt;</span><span class="na">get_user_info</span><span class="p">();</span>
</span><span class='line'>            <span class="nb">print_r</span><span class="p">(</span><span class="nv">$userinfo</span><span class="p">);</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>          <span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">    &lt;/body&gt;</span>
</span><span class='line'><span class="x">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>qqlogin.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="k">require_once</span> <span class="s1">&#39;Connect2.1/qqConnectAPI.php&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">//访问QQ页面</span>
</span><span class='line'>  <span class="nv">$oauth</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Oauth</span><span class="p">();</span>
</span><span class='line'>  <span class="nv">$oauth</span><span class="o">-&gt;</span><span class="na">qq_login</span><span class="p">();</span>
</span><span class='line'> <span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>qqlogout.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="nb">setcookie</span><span class="p">(</span><span class="s1">&#39;qq_accesstokebn&#39;</span><span class="p">,</span><span class="k">null</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">setcookie</span><span class="p">(</span><span class="s1">&#39;qq_openid&#39;</span><span class="p">,</span><span class="k">null</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Location:index.php&quot;</span><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>callback.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="k">require_once</span> <span class="s1">&#39;Connect2.1/qqConnectAPI.php&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">//echo $_GET[&#39;code&#39;];</span>
</span><span class='line'>  <span class="c1">//请求accesstoken</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$oauth</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Oauth</span><span class="p">();</span>
</span><span class='line'><span class="nv">$accesstoken</span> <span class="o">=</span> <span class="nv">$oauth</span><span class="o">-&gt;</span><span class="na">qq_callback</span><span class="p">();</span>
</span><span class='line'><span class="nv">$openid</span> <span class="o">=</span> <span class="nv">$oauth</span><span class="o">-&gt;</span><span class="na">get_openid</span><span class="p">();</span>
</span><span class='line'><span class="nb">setcookie</span><span class="p">(</span><span class="s2">&quot;qq_accesstokebn&quot;</span><span class="p">,</span><span class="nv">$accesstoken</span><span class="p">,</span><span class="nb">time</span><span class="p">()</span><span class="o">+</span><span class="mi">86400</span><span class="p">);</span>
</span><span class='line'><span class="nb">setcookie</span><span class="p">(</span><span class="s2">&quot;qq_openid&quot;</span><span class="p">,</span><span class="nv">$openid</span><span class="p">,</span><span class="nb">time</span><span class="p">()</span><span class="o">+</span><span class="mi">86400</span><span class="p">);</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Location:index.php&quot;</span><span class="p">)</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PHP-Memcache]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/14/memcache/"/>
    <updated>2016-05-14T20:08:26+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/14/memcache</id>
    <content type="html"><![CDATA[<h1>什么是Memcache</h1>

<blockquote><p>Memcache通过缓存服务器信息的方式来加速服务器处理能力的系统。Memcache分配一块服务器上的内存来缓存一段特定时间之内的最近的查询数据。一旦某个数据被再次请求，那么Memcache就直接从内存中返回这个数据，而不是从数据库中，所以这将会加速查询速度。</p></blockquote>

<!--more-->


<h1>Memcache使用场景</h1>

<ul>
<li>非持久化存储：对数据存储要求不高</li>
<li>分布式存储：不适合单机（对内存消耗很大）</li>
<li>ke/value存储：格式简单，不支持List，Array数据格式

<h1>Memcache服务端的安装</h1></li>
<li>编译安装 Libevent Memcache</li>
<li>依赖管理工具 yum apt-get</li>
<li>Memcache 和Memcached

<ul>
<li>Memcached 是Memcache的升级版本 推荐使用</li>
</ul>
</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$sudo apt-get install memcached</span></code></pre></td></tr></table></div></figure>


<p>安装完Memcache服务端以后，我们需要启动该服务：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>memcached -d -m 128 -p 11211 -u root</span></code></pre></td></tr></table></div></figure>


<p>使用</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ps -ef |grep memcach</span></code></pre></td></tr></table></div></figure>


<p>查看是否启动
这里需要说明一下memcached服务的启动参数：</p>

<ul>
<li>-p 监听的端口</li>
<li>-l 连接的IP地址, 默认是本机</li>
<li>-d start 启动memcached服务

<ul>
<li>-d restart 重起memcached服务</li>
<li>-d stop|shutdown 关闭正在运行的memcached服务</li>
<li>-d install 安装memcached服务</li>
<li>-d uninstall 卸载memcached服务</li>
</ul>
</li>
<li>-u 以的身份运行 (仅在以root运行的时候有效)</li>
<li>-m 最大内存使用，单位MB。默认64MB</li>
<li>-M 内存耗尽时返回错误，而不是删除项</li>
<li>-c 最大同时连接数，默认是1024</li>
<li>-f 块大小增长因子，默认是1.25-n 最小分配空间，key+value+flags默认是48</li>
<li>-h 显示帮助

<h1>Memcache客户端的安装</h1></li>
<li>安装Libmemcached</li>
<li>为PHP安装memcached扩展</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$sudo apt-get install php5-memcache</span></code></pre></td></tr></table></div></figure>


<p>安装完以后我们需要在php.ini里进行简单的配置,打开/etc/php5/apache2/php.ini文件在末尾添加如下内容：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="p">[</span><span class="nx">Memcache</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="p">;</span> <span class="nx">一个高性能的分布式的内存对象缓存系统，通过在内存里维护一个统一的巨大的hash表，</span>
</span><span class='line'><span class="p">;</span> <span class="nx">它能够用来存储各种格式的数据，包括图像、视频、文件以及数据库检索的结果等。</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="p">;</span> <span class="nx">是否在遇到错误时透明地向其他服务器进行故障转移。</span>
</span><span class='line'><span class="nx">memcache</span><span class="o">.</span><span class="nx">allow_failover</span> <span class="o">=</span> <span class="nx">On</span>
</span><span class='line'>
</span><span class='line'><span class="p">;</span> <span class="nx">接受和发送数据时最多尝试多少个服务器，只在打开memcache</span><span class="o">.</span><span class="nx">allow_failover时有效。memcache</span><span class="o">.</span><span class="nx">max_failover_attempts</span> <span class="o">=</span> <span class="mi">20</span>
</span><span class='line'>
</span><span class='line'><span class="p">;</span> <span class="nx">数据将按照此值设定的块大小进行转移。此值越小所需的额外网络传输越多。</span>
</span><span class='line'><span class="p">;</span> <span class="nx">如果发现无法解释的速度降低，可以尝试将此值增加到32768。</span>
</span><span class='line'><span class="nx">memcache</span><span class="o">.</span><span class="nx">chunk_size</span> <span class="o">=</span> <span class="mi">8192</span>
</span><span class='line'>
</span><span class='line'><span class="p">;</span> <span class="nx">连接到memcached服务器时使用的默认TCP端口。</span>
</span><span class='line'><span class="nx">memcache</span><span class="o">.</span><span class="nx">default_port</span> <span class="o">=</span> <span class="mi">11211</span>
</span><span class='line'>
</span><span class='line'><span class="p">;</span> <span class="nx">控制将key映射到server的策略。默认值”standard”表示使用先前版本的老hash策略。</span>
</span><span class='line'><span class="p">;</span> <span class="nx">设为”consistent”可以允许在连接池中添加</span><span class="o">/</span><span class="nx">删除服务器时不必重新计算key与server之间的映射关系。</span>
</span><span class='line'><span class="p">;</span><span class="nx">memcache</span><span class="o">.</span><span class="nx">hash_strategy</span> <span class="o">=</span> <span class="nx">“standard”</span><span class="p">;</span> <span class="nx">控制将key映射到server的散列函数。默认值”crc32″使用CRC32算法，而”fnv”则表示使用FNV</span><span class="o">-</span><span class="mi">1</span><span class="nx">a算法。</span>
</span><span class='line'><span class="p">;</span> <span class="nx">FNV</span><span class="o">-</span><span class="mi">1</span><span class="nx">a比CRC32速度稍低，但是散列效果更好。</span>
</span><span class='line'><span class="p">;</span><span class="nx">memcache</span><span class="o">.</span><span class="nx">hash_function</span> <span class="o">=</span> <span class="nx">“crc32″</span>
</span></code></pre></td></tr></table></div></figure>


<p>保存<code>php.ini</code>,执行<code>service apache2 restart</code>重启Apache。使用<code>php -m |grep memchched</code>查看是否安装成功</p>

<h1>Memcached 常见操作</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nv">$m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Memcached</span><span class="p">();</span>
</span><span class='line'><span class="nv">$array</span><span class="o">=</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>  <span class="k">array</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span><span class="mi">11211</span><span class="p">),</span>
</span><span class='line'>
</span><span class='line'><span class="p">);</span>
</span><span class='line'><span class="nv">$m</span><span class="o">-&gt;</span><span class="na">addServers</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span> <span class="c1">//添加服务器 添加多条为addServers 一条为 addServer（“127.0.0.1”，11211）；</span>
</span><span class='line'><span class="c1">// // echo &quot;11&quot;;</span>
</span><span class='line'><span class="c1">// $info=$m-&gt;getStats();</span>
</span><span class='line'><span class="c1">// print_r($info);</span>
</span><span class='line'><span class="c1">//数据类操作</span>
</span><span class='line'><span class="c1">//add</span>
</span><span class='line'><span class="nv">$m</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s2">&quot;mkey&quot;</span><span class="p">,</span><span class="s2">&quot;mvalue&quot;</span><span class="p">,</span><span class="mi">600</span><span class="p">);</span><span class="c1">//key value time</span>
</span><span class='line'><span class="nv">$m</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s2">&quot;mkey&quot;</span><span class="p">,</span><span class="s2">&quot;mvalue2&quot;</span><span class="p">,</span><span class="mi">600</span><span class="p">);</span><span class="c1">//两次赋值不会改变它的值</span>
</span><span class='line'><span class="nv">$m</span><span class="o">-&gt;</span><span class="na">replace</span><span class="p">(</span><span class="s2">&quot;mkey&quot;</span><span class="p">,</span><span class="s2">&quot;mvalue3&quot;</span><span class="p">,</span><span class="mi">600</span><span class="p">);</span><span class="c1">//替换</span>
</span><span class='line'><span class="k">echo</span> <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;mkey&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$m</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s2">&quot;mkey&quot;</span><span class="p">,</span><span class="s2">&quot;mvalue&quot;</span><span class="p">,</span><span class="mi">600</span><span class="p">);</span><span class="c1">//常用，如果不存在mkey则创建，如果存在则覆盖</span>
</span><span class='line'><span class="nv">$m</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="s2">&quot;mkey&quot;</span><span class="p">);</span><span class="c1">//删除</span>
</span><span class='line'><span class="nv">$m</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span><span class="c1">//清空memcache中的所有缓存</span>
</span><span class='line'><span class="nv">$m</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="nv">$m</span><span class="o">-&gt;</span><span class="na">increment</span><span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span><span class="c1">//每次刷新num+5</span>
</span><span class='line'><span class="nv">$m</span><span class="o">-&gt;</span><span class="na">decrement</span><span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span><span class="c1">//每次刷新num-5</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="nv">$m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Memcached</span><span class="p">();</span>
</span><span class='line'>  <span class="nv">$array</span><span class="o">=</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>    <span class="k">array</span><span class="p">(</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span><span class="mi">11211</span><span class="p">),</span>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'>  <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">addServers</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$data</span><span class="o">=</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>    <span class="s2">&quot;key&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;key2&quot;</span> <span class="o">=&gt;</span><span class="s2">&quot;value2&quot;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'>  <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">setMulti</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span> <span class="c1">//一次设置多个值</span>
</span><span class='line'> <span class="nv">$result</span><span class="o">=</span>  <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">getMulti</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">,</span><span class="s2">&quot;key2&quot;</span><span class="p">));</span><span class="c1">//一次获取多个值</span>
</span><span class='line'> <span class="nb">print_r</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
</span><span class='line'> <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">deleteMulti</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">,</span><span class="s2">&quot;key2&quot;</span><span class="p">));</span><span class="c1">//一次删除多个值</span>
</span><span class='line'> <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">getResultCode</span><span class="p">();</span><span class="c1">//获取上次操作返回值</span>
</span><span class='line'> <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">getResultMessage</span><span class="p">();</span><span class="c1">//获取上次操作的信息</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://php.net/manual/zh/book.memcached.php">官方说明文档</a></p>

<h1>项目中使用Memcached</h1>

<ul>
<li>即时生成缓存　

<ul>
<li>类似于新闻详情页，第一个人来了生成缓存，第二个人再来直接读缓存</li>
</ul>
</li>
<li>提前生成缓存

<ul>
<li>适合高访问量</li>
</ul>
</li>
<li>永久缓存

<ul>
<li>关于我们 这种基本不变的网页</li>
</ul>
</li>
</ul>


<h1>注意事项</h1>

<ul>
<li>不要在单机模式中使用Memcached</li>
<li>不要在Memcached保存重要数据。掉电会丢失。</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[spl初识]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/13/spl/"/>
    <updated>2016-05-13T20:26:58+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/13/spl</id>
    <content type="html"><![CDATA[<h1>什么是SPL</h1>

<blockquote><p>SPL是Standard PHP Library（PHP标准库）的缩写。
根据官方定义，它是"a collection of interfaces and classes that are meant to solve standard problems"。但是，目前在使用中，SPL更多地被看作是一种使object（物体）模仿array（数组）行为的interfaces和classes。</p></blockquote>

<!--more-->


<h1>SPL的常用数据结构</h1>

<h2>双向链表</h2>

<ul>
<li>SplDoublyLinkedList类</li>
<li>操作

<ul>
<li>当前节点操作：

<ul>
<li>rewind:使当前节点指向Buttom（头部）</li>
<li>next：指向下一个节点</li>
<li>prev：指向上一个节点</li>
<li>current：指向链表当前节点的指针，调用前需调用rewind，指向的节点被删除后会指向一个空节点</li>
</ul>
</li>
<li>增加节点操作：

<ul>
<li>push：向链表的顶部（尾部）插入一个节点</li>
<li>unshift：向链表的底部插入一个节点（头部）</li>
</ul>
</li>
<li>删除节点操作：

<ul>
<li>pop：获取链表中顶部（尾部）的节点并删除，不改变当前指针的位置</li>
<li>shift：删除连边底部（头部）的节点</li>
</ul>
</li>
<li>定位操作

<ul>
<li>bottom：获得链表底部（头部）的元素，指针位置不变</li>
<li>top：获得链表顶部（尾部）的元素，指针位置不变</li>
</ul>
</li>
<li>特定节点操作

<ul>
<li>offsetExists</li>
<li>offsetGet</li>
<li>offsetSet</li>
<li>offsetUnset</li>
</ul>
</li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">=</span><span class="k">new</span> <span class="nx">SplDoublyLinkedList</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">push</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="c1">//把节点添加到顶部</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">push</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">push</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">unshift</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="c1">//将新的节点添加到底部（bottom）</span>
</span><span class='line'>    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$obj</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">rewind</span><span class="p">();</span><span class="c1">//rewind操作用于把节点指针指向bottom所在的节点</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;current:&quot;</span><span class="o">.</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> <span class="c1">//获取节点指针指向的节点（当前）</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span><span class="c1">//指向下一节点</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">prev</span><span class="p">();</span><span class="c1">//指向上一节点</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;next:&quot;</span><span class="o">.</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span><span class="c1">//指向下一节点</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span><span class="c1">//指向下一节点</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span><span class="c1">//指向下一节点</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span><span class="c1">//指向下一节点</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()){</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s2">&quot;Current node valid</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s2">&quot;Current node invalid</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">valid</span><span class="p">()){</span><span class="c1">//如果当前节点有效，valid返回true</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s2">&quot;valid list&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s2">&quot;invalid list&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;pop value&quot;</span><span class="o">.</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">pop</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span><span class="c1">//把TOP位置的节点从链表中弹出。pop不影响指针指向的节点。如果pop指向的是top，调用POP后会指向NULL</span>
</span><span class='line'>    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$obj</span><span class="p">);</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;current:&quot;</span><span class="o">.</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">shift</span><span class="p">();</span><span class="c1">//把bottom位置的节点从链表中删除。并返回</span>
</span><span class='line'>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h2>堆栈</h2>

<ul>
<li>继承自SplDoublyLinkedList类的SplStack类</li>
<li>先进后出</li>
<li>操作

<ul>
<li>push：压入堆栈</li>
<li>pop：弹出堆栈</li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>    <span class="nv">$stack</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SplStack</span><span class="p">();</span>
</span><span class='line'>    <span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">push</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">push</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">push</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$stack</span><span class="p">);</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;Bottom:&quot;</span><span class="o">.</span><span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">bottom</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;Top:&quot;</span><span class="o">.</span><span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">top</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">offsetSet</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;C&quot;</span><span class="p">);</span><span class="c1">//在Stack里面offset=0是TOP所在的位置，offset=1是top位置节点靠近bottom位置的相邻节点</span>
</span><span class='line'>    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$stack</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">rewind</span><span class="p">();</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;Current:&quot;</span><span class="o">.</span><span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span><span class="c1">//双向链表的rewind和堆栈的rewind相反，堆栈的rewind使得当前指针指向TOP所在的位置，而双向链表的rewind指向bottom所在的位置</span>
</span><span class='line'>    <span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;Current:&quot;</span><span class="o">.</span><span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">//遍历堆栈</span>
</span><span class='line'>    <span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">rewind</span><span class="p">();</span>
</span><span class='line'>    <span class="k">while</span><span class="p">(</span><span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">valid</span><span class="p">()){</span>
</span><span class='line'>      <span class="k">echo</span> <span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">key</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;=&gt;&quot;</span><span class="o">.</span><span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//删除堆栈</span>
</span><span class='line'>    <span class="nv">$popObj</span> <span class="o">=</span> <span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">pop</span><span class="p">();</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;PopED object:&quot;</span><span class="o">.</span><span class="nv">$popObj</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$stack</span><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h2>队列</h2>

<ul>
<li>继承自SplDoublyLinkedList类的SplQueue类</li>
<li>先进先出</li>
<li>操作

<ul>
<li>enqueue：进入队里</li>
<li>duqueue：退出对列</li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="nv">$obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SplQueue</span><span class="p">();</span>
</span><span class='line'>  <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">enqueue</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">);</span><span class="c1">//插入一个节点到TOP位置</span>
</span><span class='line'>  <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">enqueue</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">enqueue</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">print_r</span><span class="p">(</span><span class="nv">$obj</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;bottom:&quot;</span><span class="o">.</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">bottom</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;top:&quot;</span><span class="o">.</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">top</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">offsetSet</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;A&quot;</span><span class="p">);</span><span class="c1">//队列里面的offset=0是bottom所在的位置</span>
</span><span class='line'>  <span class="nb">print_r</span><span class="p">(</span><span class="nv">$obj</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">rewind</span><span class="p">();</span><span class="c1">//队列的rewind指向bottom所在的位置</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;current:&quot;</span><span class="o">.</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">valid</span><span class="p">()){</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">key</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;=&gt;&quot;</span><span class="o">.</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;dequeue obj:&quot;</span><span class="o">.</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">dequeue</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span><span class="c1">//从队列中提取bottom位置的节点并删除</span>
</span><span class='line'>  <span class="nb">print_r</span><span class="p">(</span><span class="nv">$obj</span><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h1>迭代器</h1>

<h2>什么是迭代器</h2>

<blockquote><p>通过某种同意的方式遍历链表或数组中的元素的过程叫做迭代遍历，而这种统一的遍历工具我们叫做迭代器</p></blockquote>

<p>在PHP中迭代器是通过Iterator接口定义的。</p>

<h2>常用的迭代器 ArrayIterator</h2>

<ul>
<li>熟悉使用foreach和while语句通过ArrayIterator遍历数组的方法</li>
<li>熟悉使用seek跳过某些元素的方法</li>
<li>熟悉使用ArrayIerator进行排序的方法</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>    <span class="nv">$fruits</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>      <span class="s2">&quot;apple&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;appale value&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;orange&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;orange value&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;grape&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;grape value&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;plum&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;plum value&quot;</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'>    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$fruits</span><span class="p">);</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;use fruits directly </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$fruits</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">echo</span> <span class="nv">$key</span><span class="o">.</span><span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="nv">$value</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//使用ArrayIterator 遍历数组</span>
</span><span class='line'>    <span class="nv">$obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayObject</span><span class="p">(</span><span class="nv">$fruits</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$it</span> <span class="o">=</span> <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">getIterator</span><span class="p">();</span><span class="c1">//获取迭代器</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;use ArrayIterator in foreach </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$it</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">echo</span> <span class="nv">$key</span><span class="o">.</span><span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="nv">$value</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;use ArrayIterator in while </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">rewind</span><span class="p">();</span><span class="c1">//ccurretn前需要rewind</span>
</span><span class='line'>    <span class="k">while</span> <span class="p">(</span><span class="nv">$it</span><span class="o">-&gt;</span><span class="na">valid</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">echo</span> <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">key</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">();</span>
</span><span class='line'>      <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//跳过某些元素进行打印</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s2">&quot;use seek befor while </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">rewind</span><span class="p">();</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="nv">$it</span><span class="o">-&gt;</span><span class="na">valid</span><span class="p">()){</span>
</span><span class='line'>      <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">seek</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>      <span class="k">while</span> <span class="p">(</span><span class="nv">$it</span><span class="o">-&gt;</span><span class="na">valid</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">echo</span> <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">key</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//实现排序</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;use ksort </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">ksort</span><span class="p">();</span><span class="c1">//对key字典序排序</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$it</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">echo</span> <span class="nv">$key</span><span class="o">.</span><span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="nv">$value</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;use asort </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">ksort</span><span class="p">();</span><span class="c1">//对value字典序排序</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$it</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">echo</span> <span class="nv">$key</span><span class="o">.</span><span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="nv">$value</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h2>常用的迭代器 AppendIterator</h2>

<ul>
<li>AppendIterator能陆续遍历几个迭代器

<ul>
<li>按顺序迭代访问几个不同的迭代器。 例如，希望在一些循环中迭代访问两个或多个组合。</li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="nv">$array_a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayIterator</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="s2">&quot;b&quot;</span><span class="p">,</span><span class="s2">&quot;c&quot;</span><span class="p">,</span><span class="s2">&quot;d&quot;</span><span class="p">));</span>
</span><span class='line'>  <span class="nv">$array_b</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayIterator</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,</span><span class="s2">&quot;f&quot;</span><span class="p">,</span><span class="s2">&quot;g&quot;</span><span class="p">,</span><span class="s2">&quot;h&quot;</span><span class="p">));</span>
</span><span class='line'>  <span class="nv">$it</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AppendIterator</span><span class="p">();</span>
</span><span class='line'>  <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">append</span><span class="p">(</span><span class="nv">$array_a</span><span class="p">);</span><span class="c1">//通过append方法把迭代器对象添加到AppendIterator对象中</span>
</span><span class='line'>  <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">append</span><span class="p">(</span><span class="nv">$array_b</span><span class="p">);</span>
</span><span class='line'>  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$it</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nv">$value</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h2>常用的迭代器 MultipleIterator</h2>

<ul>
<li>MultipleIterator用于把多个Iterator里面的数据组合为一个整体来访问</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="nv">$idIter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayIterator</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">&quot;01&quot;</span><span class="p">,</span><span class="s2">&quot;02&quot;</span><span class="p">,</span><span class="s2">&quot;03&quot;</span><span class="p">));</span>
</span><span class='line'>  <span class="nv">$nameIter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayIterator</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">&quot;张三&quot;</span><span class="p">,</span><span class="s2">&quot;李四&quot;</span><span class="p">,</span><span class="s2">&quot;王五&quot;</span><span class="p">));</span>
</span><span class='line'>  <span class="nv">$ageIter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayIterator</span><span class="p">(</span> <span class="k">array</span><span class="p">(</span><span class="s2">&quot;22&quot;</span><span class="p">,</span><span class="s2">&quot;23&quot;</span><span class="p">,</span><span class="s2">&quot;24&quot;</span><span class="p">));</span>
</span><span class='line'>  <span class="nv">$mit</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MultipleIterator</span><span class="p">(</span><span class="nx">MultipleIterator</span><span class="o">::</span><span class="na">MIT_KEYS_ASSOC</span><span class="p">);</span><span class="c1">//知明当你拼凑起来过后Key也是一个Array</span>
</span><span class='line'>  <span class="nv">$mit</span><span class="o">-&gt;</span><span class="na">attachIterator</span><span class="p">(</span><span class="nv">$idIter</span><span class="p">,</span><span class="s2">&quot;ID&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$mit</span><span class="o">-&gt;</span><span class="na">attachIterator</span><span class="p">(</span><span class="nv">$nameIter</span><span class="p">,</span><span class="s2">&quot;NAME&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$mit</span><span class="o">-&gt;</span><span class="na">attachIterator</span><span class="p">(</span><span class="nv">$ageIter</span><span class="p">,</span><span class="s2">&quot;AGE&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$mit</span> <span class="k">as</span>  <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h2>常用的迭代器 FilesystemIterator</h2>

<ul>
<li>FilesystemIterator能遍历文件系统</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>    <span class="nb">date_default_timezone_set</span><span class="p">(</span><span class="s2">&quot;PRC&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$it</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FilesystemIterator</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$it</span> <span class="k">as</span>  <span class="nv">$finfo</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%s</span><span class="se">\t</span><span class="s2">%s</span><span class="se">\t</span><span class="s2">%8s</span><span class="se">\t</span><span class="s2">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nb">date</span><span class="p">(</span><span class="s2">&quot;Y-m-d H:i:s&quot;</span><span class="p">,</span><span class="nv">$finfo</span><span class="o">-&gt;</span><span class="na">getMTime</span><span class="p">()),</span>
</span><span class='line'>      <span class="nv">$finfo</span><span class="o">-&gt;</span><span class="na">isDir</span><span class="p">()</span><span class="o">?</span><span class="s2">&quot;&lt;DIR&gt;&quot;</span><span class="o">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nb">number_format</span><span class="p">(</span><span class="nv">$finfo</span><span class="o">-&gt;</span><span class="na">getSize</span><span class="p">()),</span>
</span><span class='line'>      <span class="nv">$finfo</span><span class="o">-&gt;</span><span class="na">getFileName</span><span class="p">()</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'>    <span class="c1">// echo $finfo-&gt;isDir()?&quot;&lt;DIR&gt;&quot;:&quot;&quot;,</span>
</span><span class='line'>      <span class="c1">// echo date(&quot;Y-m-d H:i:s&quot;,$finfo-&gt;getMTime()).&quot;\n&quot;;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h1>SPL基础接口</h1>

<h2>Countable</h2>

<ul>
<li>继承了该接口的类可以直接调用count（）得到元素个数。</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">date_default_timezone_set</span><span class="p">(</span><span class="s2">&quot;PRC&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>      <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;张三&#39;</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;5&#39;</span><span class="p">),</span>
</span><span class='line'>      <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;李四&#39;</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;6&#39;</span><span class="p">),</span>
</span><span class='line'>      <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;王五&#39;</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;7&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$array</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$array</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">CountMe</span> <span class="k">implements</span> <span class="nx">Countable</span><span class="p">{</span> <span class="c1">//实现Countable接口，</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$_myCount</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">count</span><span class="p">(){</span>
</span><span class='line'>      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_myCount</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nv">$obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CountMe</span><span class="p">();</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$obj</span><span class="p">);</span><span class="c1">//实现了Countable接口就能通过cout函数直接调用到之前定义好的Count方法</span>
</span><span class='line'> <span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h2>OuterIterator</h2>

<ul>
<li>如果想对迭代器进行一定的处理之后再返回，可以用这个接口</li>
<li>继承自IteratorIterator这个类</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>    <span class="nb">date_default_timezone_set</span><span class="p">(</span><span class="s2">&quot;PRC&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">&quot;value1&quot;</span><span class="p">,</span><span class="s2">&quot;value2&quot;</span><span class="p">,</span><span class="s2">&quot;value3&quot;</span><span class="p">,</span><span class="s2">&quot;value4&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$outerObj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OuterImpl</span><span class="p">(</span> <span class="k">new</span> <span class="nx">ArrayIterator</span><span class="p">(</span><span class="nv">$array</span><span class="p">));</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$outerObj</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1"># code...</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s2">&quot;++&quot;</span><span class="o">.</span><span class="nv">$key</span><span class="o">.</span><span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="nv">$value</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">OuterImpl</span> <span class="k">extends</span> <span class="nx">IteratorIterator</span><span class="p">{</span>
</span><span class='line'>      <span class="k">public</span> <span class="k">function</span> <span class="nf">current</span><span class="p">(){</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="na">current</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;_tail&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">public</span> <span class="k">function</span> <span class="nf">key</span><span class="p">(){</span>
</span><span class='line'>        <span class="k">return</span> <span class="s2">&quot;pre_&quot;</span><span class="o">.</span><span class="k">parent</span><span class="o">::</span><span class="na">key</span><span class="p">();</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'> <span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h2>RecursiveTterator</h2>

<ul>
<li>可以对多次结构的迭代器进行迭代，比如遍历一棵树</li>
<li>所有具有层次结构特点的数据都可以用这个接口遍历

<ul>
<li>如文件夹</li>
</ul>
</li>
<li>关键方法

<ul>
<li>hasChildren :用于判断当前节点是否存在子节点</li>
<li>getChileren :用于得到当前节点子节点的迭代器</li>
</ul>
</li>
<li>SPL中实现该接口的类

<ul>
<li>RecursiveArrayIterator，RecursiveCachingIterator等以 Recursive开头的类都能进行多层次结构化的遍历

<h2>SeekableIterator</h2></li>
</ul>
</li>
<li>可以通过seek方法定位到集合里面的某个元素</li>
<li>seek方法的参数是元素的位置，从0开始</li>
</ul>


<h1>SPL基础函数的使用</h1>

<h2>Autoload</h2>

<ul>
<li>为了初始化PHP中的类对象，需要通过一定的方法寻找到类的定义。通常情况下，类会定义在一个单独的文件中。</li>
<li>Autoload就是PHP找到这些文件的方法。</li>
</ul>


<figure class='code'><figcaption><span>libs/test.class.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="sd">/**</span>
</span><span class='line'><span class="sd">   *</span>
</span><span class='line'><span class="sd">   */</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">test</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s2">&quot;Loading Class Libs/test.class.php</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>libs/test.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Test</span><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(){</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s2">&quot;Loading Class Libs/test.php</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'> <span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>Autoload01.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="nb">spl_autoload_extensions</span><span class="p">(</span><span class="s2">&quot;.class.php,.php&quot;</span><span class="p">);</span><span class="c1">//设置autoload寻找php定义的类文件的扩展名，多个扩展名用逗号分开,前面的扩招名优先匹配</span>
</span><span class='line'>  <span class="nb">set_include_path</span><span class="p">(</span><span class="nb">get_include_path</span><span class="p">()</span><span class="o">.</span><span class="nx">PATH_SEPARATOR</span><span class="o">.</span><span class="s2">&quot;libs/&quot;</span><span class="p">);</span><span class="c1">//设置autoload寻找php定义的类文件的目录，多个目录用PATH_SEPARATOR分隔</span>
</span><span class='line'>  <span class="nb">spl_autoload_register</span><span class="p">();</span><span class="c1">//提示PHP使用autoload机制查找类定义</span>
</span><span class='line'>  <span class="k">new</span> <span class="nx">test</span><span class="p">();</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>Autoload02.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="k">function</span> <span class="nf">__autoload</span><span class="p">(</span><span class="nv">$class_name</span><span class="p">){</span><span class="c1">//定义__autoload函数，可以不调用spl_autoload_register函数的情况下完成类的装载</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;__autoload class:&quot;</span><span class="o">.</span><span class="nv">$class_name</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">require_once</span><span class="p">(</span><span class="s2">&quot;libs/&quot;</span><span class="o">.</span><span class="nv">$class_name</span><span class="o">.</span><span class="s2">&quot;.php&quot;</span><span class="p">);</span><span class="c1">//装载类</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">function</span> <span class="nf">classLoader</span><span class="p">(</span><span class="nv">$class_name</span><span class="p">){</span><span class="c1">//定义一个替换__autoload函数的类文件装载函数</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;classLoader() load class:&quot;</span><span class="o">.</span><span class="nv">$class_name</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">require_once</span><span class="p">(</span><span class="s2">&quot;libs/&quot;</span><span class="o">.</span><span class="nv">$class_name</span><span class="o">.</span><span class="s2">&quot;.php&quot;</span><span class="p">);</span><span class="c1">//装载类</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nb">spl_autoload_register</span><span class="p">(</span><span class="s2">&quot;classLoader&quot;</span><span class="p">);</span><span class="c1">//传入定义好的装载类的函数的名称替换__autoload函数</span>
</span><span class='line'>  <span class="k">new</span> <span class="nx">test</span><span class="p">();</span>
</span><span class='line'> <span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>Autoload03.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="k">function</span> <span class="nf">classLoader</span><span class="p">(</span><span class="nv">$class_name</span><span class="p">){</span><span class="c1">//定义一个替换__autoload函数的类文件装载函数</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;classLoader() load class:&quot;</span><span class="o">.</span><span class="nv">$class_name</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nb">set_include_path</span><span class="p">(</span><span class="s2">&quot;lib/&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nb">spl_autoload</span><span class="p">(</span><span class="nv">$class_name</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nb">spl_autoload_register</span><span class="p">(</span><span class="s2">&quot;classLoader&quot;</span><span class="p">);</span><span class="c1">//传入定义好的装载类的函数的名称替换__autoload函数</span>
</span><span class='line'><span class="k">new</span> <span class="nx">test</span><span class="p">();</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h1>SPL其他函数</h1>

<ul>
<li><p>迭代器相关</p>

<ul>
<li>iterator_apply :为迭代器中的每个元素调用一个用户自定义函数</li>
<li>iterator_count ：计算迭代器元素个数</li>
<li>iterator_to_array ：将迭代器的元素拷贝到数组</li>
</ul>
</li>
<li><p>类信息相关函数</p>

<ul>
<li>class_implements 返回指定类实现的所有接口

<ul>
<li>可以用instanceof判断某个对象时候实现某个接口或者某个类的实例</li>
</ul>
</li>
<li>class_parents 返回指定类的父类

<ul>
<li>如果继承了多次，会把所有父类都打印出来</li>
</ul>
</li>
</ul>
</li>
</ul>


<h1>文件处理类库</h1>

<ul>
<li>SPLFileInfo 用于获得文件的基本信息，比如修改时间，大小，目录等</li>
<li>SplFileObject用于操作文件的内容，比如读写</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="nv">$file</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SplFileInfo</span><span class="p">(</span><span class="s2">&quot;temp.txt&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;File is cerated at &quot;</span><span class="o">.</span><span class="nb">date</span><span class="p">(</span><span class="s2">&quot;Y-m-d H:i:s&quot;</span><span class="p">,</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getCTime</span><span class="p">())</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;File is modified at &quot;</span><span class="o">.</span><span class="nb">date</span><span class="p">(</span><span class="s2">&quot;Y-m-d H:i:s&quot;</span><span class="p">,</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getMTime</span><span class="p">())</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;File is size is&quot;</span><span class="o">.</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getSize</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">//读取文件里面的内容</span>
</span><span class='line'>  <span class="nv">$fileObj</span> <span class="o">=</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">openFile</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">while</span> <span class="p">(</span><span class="nv">$fileObj</span><span class="o">-&gt;</span><span class="na">valid</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nv">$fileObj</span><span class="o">-&gt;</span><span class="na">fgets</span><span class="p">();</span><span class="c1">//获取文件里慢的一行数据</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nv">$fileObj</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$file</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">;</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[cURL]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/12/php-curl/"/>
    <updated>2016-05-12T20:52:24+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/12/php-curl</id>
    <content type="html"><![CDATA[<h1>cURl的概念</h1>

<blockquote><p>cURL（Client URL Library Functions）使用URL语法传输数据的命令行工具</p></blockquote>

<!--more-->


<h1>使用场景</h1>

<ul>
<li>网页资源

<ul>
<li>网页爬虫</li>
</ul>
</li>
<li><p>WebService数据接口资源</p>

<ul>
<li>动态获取接口数据，如天气 号码归属地等</li>
</ul>
</li>
<li><p>FTP服务器里面的文件资源</p>

<ul>
<li>下载Ftp里面的文件</li>
</ul>
</li>
<li><p>其他资源</p>

<ul>
<li>所有网络上的资源都可以用cURL访问和下载</li>
</ul>
</li>
</ul>


<p>确定是否支持cURL<code>php -i |grep cURL</code></p>

<h1>cURL操作步骤</h1>

<ul>
<li>初始化

<ul>
<li>curl_init()</li>
</ul>
</li>
<li>执行

<ul>
<li>curl_exec()</li>
</ul>
</li>
<li><p>关闭</p>

<ul>
<li>curl_close()

<h1>实例</h1></li>
</ul>
</li>
<li><p>简单的网页爬虫</p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nv">$curl</span><span class="o">=</span><span class="nb">curl_init</span><span class="p">(</span><span class="s1">&#39;http://www.baidu.com&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curl</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_close</span><span class="p">(</span><span class="nv">$curl</span><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>抓取网页并替换部分内容</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * 在网络上下载一个网页并把内容中的“百度”替换为“GOOD”之后输出</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="nv">$curlobj</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>         <span class="c1">// 初始化</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="s2">&quot;http://www.baidu.com&quot;</span><span class="p">);</span>     <span class="c1">// 设置访问网页的URL</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>           <span class="c1">// 执行之后不直接打印出来</span>
</span><span class='line'><span class="nv">$output</span><span class="o">=</span><span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span> <span class="c1">// 执行</span>
</span><span class='line'><span class="nb">curl_close</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>           <span class="c1">// 关闭cURL</span>
</span><span class='line'><span class="k">echo</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">&quot;百度&quot;</span><span class="p">,</span><span class="s2">&quot;GOOD&quot;</span><span class="p">,</span><span class="nv">$output</span><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>调用WebService获取天气信息
代码需要修改</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nv">$data</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
</span><span class='line'><span class="s1">&lt;soap:Envelope </span>
</span><span class='line'><span class="s1">xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; </span>
</span><span class='line'><span class="s1">xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; </span>
</span><span class='line'><span class="s1">xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;</span>
</span><span class='line'><span class="s1">  &lt;soap:Body&gt;</span>
</span><span class='line'><span class="s1">    &lt;getWeatherbyCityName xmlns=&quot;http://WebXml.com.cn/&quot;&gt;</span>
</span><span class='line'><span class="s1">      &lt;theCityName&gt;%s&lt;/theCityName&gt;</span>
</span><span class='line'><span class="s1">    &lt;/getWeatherbyCityName&gt;</span>
</span><span class='line'><span class="s1">  &lt;/soap:Body&gt;</span>
</span><span class='line'><span class="s1">&lt;/soap:Envelope&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;北京&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$curlobj</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span> 
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="s2">&quot;http://www.webxml.com.cn/WebServices/WeatherWebService.asmx&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s2">&quot;Content-Type: application/soap+xml; charset=utf-8&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;Content-length: &quot;</span><span class="o">.</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$data</span><span class="p">),</span>
</span><span class='line'>  <span class="s2">&quot;SOAPAction:</span><span class="se">\&quot;</span><span class="s2">http://WebXml.com.cn/getWeatherbyCityName</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">));</span>
</span><span class='line'><span class="nv">$rtn</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">curl_errno</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">)){</span>
</span><span class='line'>  <span class="nv">$info</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">print_r</span><span class="p">(</span><span class="nv">$info</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;RETURN: &quot;</span> <span class="o">.</span> <span class="nv">$rtn</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;Curl error: &#39;</span> <span class="o">.</span> <span class="nb">curl_error</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nb">curl_close</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>登录网站并下载个人空间页面</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * 登录慕课网并下载个人空间页面</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="nv">$data</span><span class="o">=</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;promonkey&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1q2w3e&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;remember&#39;</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="nv">$data</span><span class="o">=</span><span class="s1">&#39;username=xxx&amp;password=xxx&amp;remember=1&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$curlobj</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>         <span class="c1">// 初始化</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="s2">&quot;http://www.imooc.com/user/login&quot;</span><span class="p">);</span>      <span class="c1">// 设置访问网页的URL</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>           <span class="c1">// 执行之后不直接打印出来</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Cookie相关设置，这部分设置需要在所有会话开始之前设置</span>
</span><span class='line'><span class="nb">date_default_timezone_set</span><span class="p">(</span><span class="s1">&#39;PRC&#39;</span><span class="p">);</span> <span class="c1">// 使用Cookie时，必须先设置时区</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_COOKIESESSION</span><span class="p">,</span> <span class="k">TRUE</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_FOLLOWLOCATION</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// 这样能够让cURL支持页面链接跳转</span>
</span><span class='line'>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s2">&quot;application/x-www-form-urlencoded; charset=utf-8&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;Content-length: &quot;</span><span class="o">.</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span>
</span><span class='line'>  <span class="p">));</span>
</span><span class='line'><span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>    <span class="c1">// 执行</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="s2">&quot;http://www.imooc.com/space/index&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s2">&quot;Content-type: text/xml&quot;</span>
</span><span class='line'>  <span class="p">));</span>
</span><span class='line'><span class="nv">$output</span><span class="o">=</span><span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span> <span class="c1">// 执行</span>
</span><span class='line'><span class="nb">curl_close</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>           <span class="c1">// 关闭cURL</span>
</span><span class='line'><span class="k">echo</span> <span class="nv">$output</span><span class="p">;</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>FTP服务器下载文件</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * 从FTP服务器下载一个文件到本地</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="nv">$curlobj</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span> 
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="s2">&quot;ftp://xxx(ip)/downloaddemo.txt&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_TIMEOUT</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span> <span class="c1">// times out after 300s</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">&quot;xxx:xxx&quot;</span><span class="p">);</span><span class="c1">//FTP用户名：密码</span>
</span><span class='line'><span class="c1">// Sets up the output file</span>
</span><span class='line'><span class="nv">$outfile</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;dest.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">);</span><span class="c1">//保存到本地的文件名</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_FILE</span><span class="p">,</span> <span class="nv">$outfile</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$rtn</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>
</span><span class='line'><span class="nb">fclose</span><span class="p">(</span><span class="nv">$outfile</span><span class="p">);</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">curl_errno</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">)){</span>
</span><span class='line'>  <span class="c1">// $info = curl_getinfo($curlobj); </span>
</span><span class='line'>  <span class="c1">// print_r($info);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;RETURN: &quot;</span> <span class="o">.</span> <span class="nv">$rtn</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;Curl error: &#39;</span> <span class="o">.</span> <span class="nb">curl_error</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nb">curl_close</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>上传文件到FTP</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * 把本地文件上传到FTP服务器上</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="nv">$curlobj</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span> 
</span><span class='line'><span class="nv">$localfile</span> <span class="o">=</span> <span class="s1">&#39;ftp01.php&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$fp</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$localfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="s2">&quot;ftp://xxx/ftp01_uploaded.php&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_TIMEOUT</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span> <span class="c1">// times out after 300s</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">&quot;xxx:xxx&quot;</span><span class="p">);</span><span class="c1">//FTP用户名：密码</span>
</span><span class='line'>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_UPLOAD</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_INFILE</span><span class="p">,</span> <span class="nv">$fp</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_INFILESIZE</span><span class="p">,</span> <span class="nb">filesize</span><span class="p">(</span><span class="nv">$localfile</span><span class="p">));</span>
</span><span class='line'><span class="nv">$rtn</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>
</span><span class='line'><span class="nb">fclose</span><span class="p">(</span><span class="nv">$fp</span><span class="p">);</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">curl_errno</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">)){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;Uploaded successfully.&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;Curl error: &#39;</span> <span class="o">.</span> <span class="nb">curl_error</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nb">curl_close</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>访问HTTPS资源</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * 下载网络上面的一个HTTPS的资源</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="nv">$curlobj</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>         <span class="c1">// 初始化</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="s2">&quot;https://ajax.aspnetcdn.com/ajax/jquery.validate/1.12.0/jquery.validate.js&quot;</span><span class="p">);</span>        <span class="c1">// 设置访问网页的URL</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>           <span class="c1">// 执行之后不直接打印出来</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 设置HTTPS支持</span>
</span><span class='line'><span class="nb">date_default_timezone_set</span><span class="p">(</span><span class="s1">&#39;PRC&#39;</span><span class="p">);</span> <span class="c1">// 使用Cookie时，必须先设置时区</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_SSL_VERIFYPEER</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// 对认证证书来源的检查从证书中检查SSL加密算法是否存在</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_SSL_VERIFYHOST</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// </span>
</span><span class='line'>
</span><span class='line'><span class="nv">$output</span><span class="o">=</span><span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span> <span class="c1">// 执行</span>
</span><span class='line'><span class="nb">curl_close</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>           <span class="c1">// 关闭cURL</span>
</span><span class='line'><span class="k">echo</span> <span class="nv">$output</span><span class="p">;</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ubuntu环境搭建]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/12/ubuntu-huan-jing-da-jian/"/>
    <updated>2016-05-12T14:58:33+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/12/ubuntu-huan-jing-da-jian</id>
    <content type="html"><![CDATA[<blockquote><p>在经历上次把Centos玩坏的经历过后，我还是回到Ubuntu吧。毕竟这个环境配置，软件安装都要简单得多0 0.</p></blockquote>

<!--more-->


<p>重新下了一个Ubuntu 12.04.5 LTS 。</p>

<p>在虚拟机中装好了系统过后出现了一个问题，在登录界面输入密码登录过后一直黑屏。当时人都懵逼了，用了这么久Ubuntu从来没出过这种问题啊，重装了很多次系统都不行。百度了很多过后发现他们的情况和我的都不太一样。到是看到有一个看起来很不靠谱的回答解决了问题。</p>

<pre class="prettyprint linenums">
    在登录时点击登录框右上角那个Ubuntu图标选择 ubuntu 2D
</pre>


<p>5/12/2016 7:18:20 PM
找到了上述问题的原因<a href="http://tieba.baidu.com/p/2535671580">传送门</a></p>

<pre class="prettyprint linenums>
1.双显卡问题 
双显卡的普遍组合为intel集成到其CPU上的显卡（称为核显）+Nvidia独立显卡或AMD显卡。在linux系统下，双显卡因驱动原因不能很好协调工作，N卡和A卡会一直处于高负荷运行状态，导致电脑发热严重,或是X-org罢工，开机无画面，等常见问题。
linux下是以工具Bumlebee（大黄蜂）来调度显卡工作来解决，运行模式为：通常关闭非核卡，让核卡来负责图形工作，但可在终端输入命令“optirun xxx"用非核卡运行程序xxx。
2.安装Bumblebee
2.1 卸载N卡驱动
如果有安装N卡驱动（不管是开源还是闭源），必须先卸载；没有则跳过此步。
打开终端（ctrl+alt+t），输入下面的命令（复制也可）：
————————————复制————————————————————————
sudo apt-get remove --purge nvidia*
————————————复制————————————————————————
完成后，重启。
2.2 安装Bumblebee
打开终端（ctrl+alt+t），分次按序输入下面的命令（红字部分，复制也可）：
————————————复制————————————————————————
1. sudo add-apt-repository ppa:bumblebee/stable
2. sudo apt-get update
3. sudo apt-get install bumblebee virtualgl linux-headers-generic
————————————复制————————————————————————
每步的时间较长，请耐心等待；完成后，重启。
2.3 验证效果
打开终端（ctrl+alt+t），输入下面的的命令（红字部分，复制也可）：
————————————复制————————————————————————
lspci |grep VGA
————————————复制————————————————————————
终端返回类似如下两条信息：
A、00:02.0 VGA compatible controller: Intel Corporation 3rd Gen Core processor Graphics Controller (rev 09)
B、01:00.0 VGA compatible controller: NVIDIA Corporation GK104M [GeForce GTX 670MX] (rev ff)"
其中，A条信息关于I卡，"rev 09“表示I卡运作；B条信息关于N卡，”rev ff“表示N卡被关闭，若未被关闭，显示为“rev a1”。

3、调用N卡工作
命令“optirun xxx"可用来调用N卡运作处理程序xxx（程序名）的图形计算 ，不过图形渲染仍由I卡负责。
</pre>


<p>抱着试一试的心态结果成功登录了。
下面是Ubuntu的环境搭建，以前都是看别人的博客，现在既然自己有了博客就整理了一下。</p>

<hr />

<p>安装Gnome <code>apt-get install gnome-session-fallback</code></p>

<h1>一、安装LAMP环境</h1>

<p>两种方式</p>

<ol>
<li>分步安装</li>
</ol>


<pre class="prettyprint linenums">
sudo apt-get update //获取最新列表
Apache:
sudo apt-get install apache2
apache2 -v //查看是否安装好
浏览器访问服务器IP
php：
sudo apt-get install php5
php5 -v
cat /etc/apache2/mod-enabled/php5.load //查看阿帕奇是否加载PHP
mysql：
sudo apt-get install mysql-server
输入root密码 //注意这里的密码不是你root用户的密码，是设置mysql-root用户的密码
cat /etc/php5/conf.d/mysql.ini
提示没有文件 说明mysql还没有被php加载 需要安装mysql扩展
sudo apt-get install php5-mysql
cat /etc/php5/conf.d/mysql.ini
extension=mysql.so //说明正确加载
</pre>


<p>2.tasksel</p>

<pre class="prettyprint linenums">
sudo tasksel install lamp-server
tasksel 提供多种软件套装
</pre>


<hr />

<p><strong>安装PHP常用扩展</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">apt</span><span class="o">-</span><span class="nx">get</span> <span class="nx">install</span>  <span class="nx">php5</span><span class="o">-</span><span class="nx">curl</span> <span class="nx">php5</span><span class="o">-</span><span class="nx">gd</span>  <span class="nx">libcurl3</span> <span class="nx">libcurl3</span><span class="o">-</span><span class="nx">dev</span> <span class="nx">php5</span><span class="o">-</span><span class="nx">curl</span>
</span><span class='line'><span class="nx">可以先用sudo</span> <span class="nx">apt</span><span class="o">-</span><span class="nx">cache</span> <span class="nx">search</span> <span class="nx">php5</span> <span class="nx">查看关于PHP5的组件</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>安装mysqladmin</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">phpmyadmin</span>
</span><span class='line'><span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">phpmyadmin</span><span class="o">/</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">pma</span>
</span><span class='line'><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">php5</span><span class="o">-</span><span class="n">mcrypt</span> <span class="n">libmcrypt</span><span class="o">-</span><span class="n">dev</span>
</span><span class='line'><span class="n">service</span> <span class="n">apache2</span> <span class="n">restart</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>开启mysql remote access</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">my</span><span class="o">.</span><span class="na">cnf</span>
</span><span class='line'><span class="n">找到bind</span><span class="o">-</span><span class="n">address</span>  <span class="n">将这行注释掉</span> <span class="n">这是允许访问的白名单</span>
</span><span class='line'><span class="n">在mysqladmin中添加一个用户</span> <span class="n">主机选择任意主机</span> <span class="n">输入</span><span class="o">%</span><span class="n">其他的按个人设置即可</span><span class="err">。</span>
</span></code></pre></td></tr></table></div></figure>


<h1>二、SSH配置</h1>

<blockquote><p>习惯了用Xshell，今天直接用Xshell连接新安装的ubuntu连接失败，好一会才反应过来还没安装ssh</p></blockquote>

<pre class="prettyprint linenums">
sudo apt-get install openssh-server
</pre>


<p>其他配置就不多写了。可以参考<a href="http://jingyan.baidu.com/article/9c69d48fb9fd7b13c8024e6b.html">传送门</a></p>

<h1>三、 ubuntu终端su认证失败：允许su到root</h1>

<blockquote><p>Ubuntu 安装后，root用户默认被锁定，不允许登录，也不允许“su”到 root。对于桌面用户来说，这样安全性更高一些，但对于服务器可以设置成“允许 su 到root，但不允许root用户直接登录”。为了开发时的方便，我们常希望都采用这种方式。</p></blockquote>

<p>1.允许 su 到 root</p>

<pre class="prettyprint linenums">
sudo passwd 
Password: <--- 输入安装时那个用户的密码 
Enter new UNIX password: <--- 新的Root用户密码 
Retype new UNIX password: <--- 重复新的Root用户密码 
passwd：已成功更新密码  
</pre>


<p>2.允许root登录</p>

<pre class="prettyprint linenums">
gksu /usr/sbin/gdmsetup  
</pre>


<p>（或者使用桌面菜单：系统＞系统管理＞登录窗口）
点“安全”选项页，选择“允许本地管理员登录”。
注：这一步依赖上一步</p>

<p>3.不输入密码直接登录
    在上一步的“安全”选项页中，勾选：“启用自动登录”，“用户”选择（如：“me”）</p>

<p>参考<a href="http://blog.csdn.net/ccrong/article/details/8133736">传送门</a></p>

<h1>四、Git</h1>

<p>Git的安装就非常简单了。</p>

<pre class="prettyprint linenums">
sudo apt-get install git
</pre>


<p>配置请看<a href="http://blog.ewanreton.cn/blog/2016/04/18/git-plus-octopressda-jian-ge-ren-bo-ke/">这里</a></p>

<p>五、Atom</p>

<blockquote><p>对的，还是它，这是一种信仰0 0</p></blockquote>

<p><strong>Requirements</strong></p>

<ul>
<li>OS with 64-bit or 32-bit architecture</li>
<li>C++ toolchain</li>
<li>Git</li>
<li>Node.js (0.10.x or above)</li>
<li>npm v1.4.x or above (automatically bundled with Node.js)

<ul>
<li><code>npm -v</code> to check the version.</li>
<li><code>npm config set python /usr/bin/python2 -g</code> to ensure that gyp uses python2.

<ul>
<li>You might need to run this command as <code>sudo</code>, depending on how you have set up npm.</li>
</ul>
</li>
</ul>
</li>
<li>development headers for GNOME Keyring</li>
</ul>


<hr />

<p><strong>Ubuntu / Debian</strong></p>

<ul>
<li><code>sudo apt-get install build-essential git libgnome-keyring-dev fakeroot</code></li>
<li>Instructions for Node.js.

<ul>
<li>Make sure the command node is available after Node.js installation (some systems install it as nodejs).</li>
<li>Use <code>which node</code> to check if it is available.</li>
<li>Use <code>sudo update-alternatives --install /usr/bin/node node /usr/bin/nodejs 10 to</code> update it.</li>
</ul>
</li>
</ul>


<p>这里我用了其他的方法更新我的node和npm</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'> <span class="nx">apt</span><span class="o">-</span><span class="nx">get</span> <span class="nx">update</span>
</span><span class='line'> <span class="nx">apt</span><span class="o">-</span><span class="nx">get</span> <span class="nx">install</span> <span class="o">-</span><span class="nx">y</span> <span class="nx">python</span><span class="o">-</span><span class="nx">software</span><span class="o">-</span><span class="nx">properties</span> <span class="nx">software</span><span class="o">-</span><span class="nx">properties</span><span class="o">-</span><span class="nx">common</span>
</span><span class='line'> <span class="nx">add</span><span class="o">-</span><span class="nx">apt</span><span class="o">-</span><span class="nx">repository</span> <span class="nx">ppa</span><span class="o">:</span><span class="nx">chris</span><span class="o">-</span><span class="nx">lea</span><span class="o">/</span><span class="nx">node</span><span class="o">.</span><span class="nx">js</span>
</span><span class='line'> <span class="nx">apt</span><span class="o">-</span><span class="nx">get</span> <span class="nx">update</span>
</span><span class='line'> <span class="nx">apt</span><span class="o">-</span><span class="nx">get</span> <span class="nx">install</span> <span class="nx">nodejs</span>
</span></code></pre></td></tr></table></div></figure>


<p>这样环境就好了，就可以开始安装了。</p>

<p><strong>Debian Linux (Ubuntu)</strong></p>

<p>Currently only a 64-bit version is available.</p>

<ol>
<li>Download <code>atom-amd64.deb</code> from the <a href="https://github.com/atom/atom/releases/latest">Atom releases page.</a></li>
<li>Run <code>sudo dpkg --install atom-amd64.deb</code> on the downloaded package.</li>
<li>Launch Atom using the installed <code>atom</code> command.</li>
</ol>


<p>The Linux version does not currently automatically update so you will need to repeat these steps to upgrade to future releases.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[做死的Centos-Atom]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/10/linux-atom-error/"/>
    <updated>2016-05-10T20:37:45+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/10/linux-atom-error</id>
    <content type="html"><![CDATA[<blockquote><p>昨天晚上突然冒出一个念头在我的Centos6.5的虚拟机上装Atom并且装上那个炫酷的插件来装波大逼。然后很悲催，软件没装上不说，系统也被搞坏了。</p></blockquote>

<!--more-->


<h1>兴高采烈的去下Atom</h1>

<p>在github上找到了Atom的<a href="https://github.com/atom/atom">开源项目</a>，根据指引下载好了rpm包。</p>

<p>然后<code>sudo yum localinstall atom.x86_64.rpm</code></p>

<p>不出意外出现了问题。</p>

<p>当时忘了截图，不过我大概都还记得出了哪些问题。</p>

<blockquote><p>这里有个极度懵逼的事情</p></blockquote>

<pre><code>我最开始在Centos中下Atom由于网络不好，时断时续就没管，后来切过去看。
咦~为什么这么快就下好了，开心的安装。恩，问题来了 libnode.so 找不到。
恩，有问题嘛很正常。度娘之。

度娘好像并不能告诉我什么，是时候翻墙了。翻出去过后的答案也是牛头不对马嘴。

忧郁了好一会，突然发现尼玛，这个包只有20+MB啊！！！！
</code></pre>

<p><strong>这次包下好了完全没问题</strong></p>

<p>安装中也出了一些问题。</p>

<p>但是我记不太清楚了0。0</p>

<pre><code>其实是因为出的问题太多了，本来想安装成功过后做一个总结，之前查得解决方案的网页也都存了书签。

可是，后来软件没装好，系统被玩坏了。。书签和历史记录全部丢失了，，我就有点懵逼了。。。
</code></pre>

<p>解决了一些问题过后，安装完成了。</p>

<p><strong>开心的atom想打开atom</strong></p>

<p>恩，提莫的。</p>

<p>error！ error！！</p>

<p><strong>version GLIBCXX_3.4.9 not found</strong></p>

<p>因为我解决问题的博文已经搞丢了，刚刚重新找了一篇大概差不多
<a href="http://blog.csdn.net/officercat/article/details/39520227">传送门</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">ll</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libc</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">6</span>
</span><span class='line'><span class="nx">lrwxrwxrwx</span> <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">19</span> <span class="nx">Sep</span> <span class="mi">23</span> <span class="mi">08</span><span class="o">:</span><span class="mi">29</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libc</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">6</span> <span class="o">-&gt;</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libc</span><span class="o">-</span><span class="mf">2.12</span><span class="o">.</span><span class="nx">so</span>
</span></code></pre></td></tr></table></div></figure>


<p>libc.so.6是一个软连接，当前的glibc是2.12版本,我遇到的事GLIBC_2.15找不到的问题，所以需至少升级到2.15
首先，从网上下载glibc 2.15的rpm安装包，但这个不容易，因为.rpm针对的是centOS和redhat，高版本安装包很少见。也可以直接从其他系统上好一个编译好的文件
libc.so.6（对应glibc 2.15或者更高的），不过最保险的方式就是下载源代码在本地编译一次（有的人实在编译不成功，那也只能从别的地方找一份了）
各个版本的glibc可以从<a href="http://ftp.gnu.org/gnu/glibc/">下载地址</a>找，包括其插件glibc-port
最新到2.20，我保守的选择2.15
对于低版本glibc，还有glibc-linuxthreads-2.x需要编译，可参考很多网上文档，但2.15没有，所以不用了</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">wget</span> <span class="nx">http</span><span class="o">://</span><span class="nx">ftp</span><span class="o">.</span><span class="nx">gnu</span><span class="o">.</span><span class="nx">org</span><span class="o">/</span><span class="nx">gnu</span><span class="o">/</span><span class="nx">glibc</span><span class="o">/</span><span class="nx">glibc</span><span class="o">-</span><span class="mf">2.15</span><span class="o">.</span><span class="nx">tar</span><span class="o">.</span><span class="nx">gz</span>
</span><span class='line'><span class="nx">wget</span> <span class="nx">http</span><span class="o">://</span><span class="nx">ftp</span><span class="o">.</span><span class="nx">gnu</span><span class="o">.</span><span class="nx">org</span><span class="o">/</span><span class="nx">gnu</span><span class="o">/</span><span class="nx">glibc</span><span class="o">/</span><span class="nx">glibc</span><span class="o">-</span><span class="nx">ports</span><span class="o">-</span><span class="mf">2.15</span><span class="o">.</span><span class="nx">tar</span><span class="o">.</span><span class="nx">gz</span>
</span><span class='line'><span class="nx">tar</span> <span class="o">-</span><span class="nx">xvf</span>  <span class="nx">glibc</span><span class="o">-</span><span class="mf">2.15</span><span class="o">.</span><span class="nx">tar</span><span class="o">.</span><span class="nx">gz</span>
</span><span class='line'><span class="nx">tar</span> <span class="o">-</span><span class="nx">xvf</span>  <span class="nx">glibc</span><span class="o">-</span><span class="nx">ports</span><span class="o">-</span><span class="mf">2.15</span><span class="o">.</span><span class="nx">tar</span><span class="o">.</span><span class="nx">gz</span>
</span><span class='line'><span class="nx">mv</span> <span class="nx">glibc</span><span class="o">-</span><span class="nx">ports</span><span class="o">-</span><span class="mf">2.15</span> <span class="nx">glibc</span><span class="o">-</span><span class="mf">2.15</span><span class="o">/</span><span class="nx">ports</span>
</span><span class='line'><span class="nb">mkdir</span> <span class="nx">glibc</span><span class="o">-</span><span class="nx">build</span><span class="o">-</span><span class="mf">2.15</span>
</span><span class='line'><span class="nx">cd</span> <span class="nx">glibc</span><span class="o">-</span><span class="nx">build</span><span class="o">-</span><span class="mf">2.15</span>
</span><span class='line'><span class="o">../</span><span class="nx">glibc</span><span class="o">-</span><span class="mf">2.15</span><span class="o">/</span><span class="nx">configure</span>  <span class="o">--</span><span class="nx">prefix</span><span class="o">=/</span><span class="nx">usr</span> <span class="o">--</span><span class="nx">disable</span><span class="o">-</span><span class="nx">profile</span> <span class="o">--</span><span class="nx">enable</span><span class="o">-</span><span class="nx">add</span><span class="o">-</span><span class="nx">ons</span> <span class="o">--</span><span class="nx">with</span><span class="o">-</span><span class="nx">headers</span><span class="o">=/</span><span class="nx">usr</span><span class="o">/</span><span class="k">include</span> <span class="o">--</span><span class="nx">with</span><span class="o">-</span><span class="nx">binutils</span><span class="o">=/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">bin</span>
</span><span class='line'><span class="nx">make</span>
</span><span class='line'><span class="nx">make</span> <span class="nx">install</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果提示install成功，去看glibc所在的共享库：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">ll</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libc</span><span class="o">*</span>
</span><span class='line'> <span class="sb">``</span><span class="err">`</span>
</span><span class='line'><span class="nx">可以看到2</span><span class="o">.</span><span class="mi">12</span><span class="nx">的旧库文件还在，多了2</span><span class="o">.</span><span class="mi">15</span><span class="nx">版本的库文件，而且软链接文件全部指向了2</span><span class="o">.</span><span class="mi">15</span><span class="nx">版本。</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;prettyprint linenums&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">1921096</span> <span class="nx">Aug</span> <span class="mi">30</span> <span class="mo">02</span><span class="o">:</span><span class="mi">16</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libc</span><span class="o">-</span><span class="mf">2.12</span><span class="o">.</span><span class="nx">so</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">9801632</span> <span class="nx">Sep</span> <span class="mi">25</span> <span class="mi">13</span><span class="o">:</span><span class="mi">46</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libc</span><span class="o">-</span><span class="mf">2.15</span><span class="o">.</span><span class="nx">so</span>
</span><span class='line'><span class="nx">lrwxrwxrwx</span><span class="o">.</span> <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>      <span class="mi">18</span> <span class="nx">May</span> <span class="mi">19</span> <span class="mi">18</span><span class="o">:</span><span class="mi">51</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcap</span><span class="o">-</span><span class="nx">ng</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">0</span> <span class="o">-&gt;</span> <span class="na">libcap</span><span class="o">-</span><span class="nx">ng</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mf">0.0</span><span class="o">.</span><span class="mi">0</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span><span class="o">.</span> <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>   <span class="mi">18672</span> <span class="nx">Jun</span> <span class="mi">25</span>  <span class="mi">2011</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcap</span><span class="o">-</span><span class="nx">ng</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mf">0.0</span><span class="o">.</span><span class="mi">0</span>
</span><span class='line'><span class="nx">lrwxrwxrwx</span><span class="o">.</span> <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>      <span class="mi">14</span> <span class="nx">May</span> <span class="mi">19</span> <span class="mi">18</span><span class="o">:</span><span class="mi">51</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcap</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">2</span> <span class="o">-&gt;</span> <span class="na">libcap</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mf">2.16</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>   <span class="mi">19016</span> <span class="nx">Dec</span>  <span class="mi">8</span>  <span class="mi">2011</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcap</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mf">2.16</span>
</span><span class='line'><span class="nx">lrwxrwxrwx</span><span class="o">.</span> <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>      <span class="mi">19</span> <span class="nx">May</span> <span class="mi">19</span> <span class="mi">18</span><span class="o">:</span><span class="mi">57</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcgroup</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="na">libcgroup</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mf">1.0</span><span class="o">.</span><span class="mi">40</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>   <span class="mi">97016</span> <span class="nx">Dec</span>  <span class="mi">9</span>  <span class="mi">2013</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcgroup</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mf">1.0</span><span class="o">.</span><span class="mi">40</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>  <span class="mi">197064</span> <span class="nx">Aug</span> <span class="mi">30</span> <span class="mo">02</span><span class="o">:</span><span class="mi">16</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcidn</span><span class="o">-</span><span class="mf">2.12</span><span class="o">.</span><span class="nx">so</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>  <span class="mi">267972</span> <span class="nx">Sep</span> <span class="mi">25</span> <span class="mi">13</span><span class="o">:</span><span class="mi">46</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcidn</span><span class="o">-</span><span class="mf">2.15</span><span class="o">.</span><span class="nx">so</span>
</span><span class='line'><span class="nx">lrwxrwxrwx</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>      <span class="mi">15</span> <span class="nx">Sep</span> <span class="mi">25</span> <span class="mi">13</span><span class="o">:</span><span class="mi">52</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcidn</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="na">libcidn</span><span class="o">-</span><span class="mf">2.15</span><span class="o">.</span><span class="nx">so</span>
</span><span class='line'><span class="nx">lrwxrwxrwx</span><span class="o">.</span> <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>      <span class="mi">17</span> <span class="nx">May</span> <span class="mi">19</span> <span class="mi">18</span><span class="o">:</span><span class="mi">51</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcom_err</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">2</span> <span class="o">-&gt;</span> <span class="na">libcom_err</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mf">2.1</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>   <span class="mi">17256</span> <span class="nx">Nov</span> <span class="mi">22</span>  <span class="mi">2013</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcom_err</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mf">2.1</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>   <span class="mi">40400</span> <span class="nx">Aug</span> <span class="mi">30</span> <span class="mo">02</span><span class="o">:</span><span class="mi">16</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcrypt</span><span class="o">-</span><span class="mf">2.12</span><span class="o">.</span><span class="nx">so</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>  <span class="mi">142947</span> <span class="nx">Sep</span> <span class="mi">25</span> <span class="mi">13</span><span class="o">:</span><span class="mi">46</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcrypt</span><span class="o">-</span><span class="mf">2.15</span><span class="o">.</span><span class="nx">so</span>
</span><span class='line'><span class="nx">lrwxrwxrwx</span><span class="o">.</span> <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>      <span class="mi">22</span> <span class="nx">May</span> <span class="mi">19</span> <span class="mi">18</span><span class="o">:</span><span class="mi">57</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcryptsetup</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="na">libcryptsetup</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mf">1.1</span><span class="o">.</span><span class="mi">0</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>   <span class="mi">97072</span> <span class="nx">Jun</span> <span class="mi">22</span>  <span class="mi">2012</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcryptsetup</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mf">1.1</span><span class="o">.</span><span class="mi">0</span>
</span><span class='line'><span class="nx">lrwxrwxrwx</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>      <span class="mi">16</span> <span class="nx">Sep</span> <span class="mi">25</span> <span class="mi">13</span><span class="o">:</span><span class="mi">52</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcrypt</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="na">libcrypt</span><span class="o">-</span><span class="mf">2.15</span><span class="o">.</span><span class="nx">so</span>
</span><span class='line'><span class="nx">lrwxrwxrwx</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>      <span class="mi">12</span> <span class="nx">Sep</span> <span class="mi">25</span> <span class="mi">13</span><span class="o">:</span><span class="mi">52</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libc</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">6</span> <span class="o">-&gt;</span> <span class="na">libc</span><span class="o">-</span><span class="mf">2.15</span><span class="o">.</span><span class="nx">so</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">有些人会在make</span> <span class="nx">install后出现error。这儿error我没去细究</span><span class="p">,</span><span class="nx">经过网友提醒，可能是因为没有sudo造成的，因为make</span> <span class="nx">install就是把文件拷贝到几个受保护的系统目录下。</span>
</span><span class='line'>
</span><span class='line'><span class="nx">如果还是不行，可以查看一下系统此时的GLIBC版本，参考一开始的做法。如果版本未升级，我们只能手动安装一下：</span>
</span><span class='line'>
</span><span class='line'><span class="nx">首先make是成功了，那么我们会发现build目录下编译出了一个新的libc</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">6</span> <span class="nx">（</span><span class="o">/</span><span class="nx">glibc</span><span class="o">-</span><span class="nx">build</span><span class="o">-</span><span class="mf">2.15</span><span class="o">/</span><span class="nx">libc</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">6</span><span class="nx">，</span> <span class="nx">我们会发现这实际上也是一个软连接，真实的lib文件时libc</span><span class="o">.</span><span class="nx">so，</span> <span class="nx">输出</span>
</span></code></pre></td></tr></table></div></figure>


<p>php</p>

<p>$ ll  libc.so.6<br/>
lrwxrwxrwx 1 root root 7 Sep 23 07:41 libc.so.6 -> libc.so<br/>
$ strings libc.so | grep GLIBC<br/>
GLIBC_2.2.5<br/>
GLIBC_2.2.6<br/>
GLIBC_2.3<br/>
GLIBC_2.3.2<br/>
GLIBC_2.3.3<br/>
GLIBC_2.3.4<br/>
GLIBC_2.4<br/>
GLIBC_2.5<br/>
GLIBC_2.6<br/>
GLIBC_2.7<br/>
GLIBC_2.8<br/>
GLIBC_2.9<br/>
GLIBC_2.10<br/>
GLIBC_2.11<br/>
GLIBC_2.12<br/>
GLIBC_2.13<br/>
GLIBC_2.14<br/>
GLIBC_2.15<br/>
GLIBC_PRIVATE</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">这是我们需要的lib了，然后去更新系统的库。</span>
</span><span class='line'>
</span><span class='line'><span class="nx">这里要注意，更新系统里的链接（我的是</span><span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libc</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">6</span><span class="p">)</span> <span class="nx">很容易出错，我不清楚有没有更好的办法，一般都是删除旧链接，建立新链接</span>
</span><span class='line'>
</span><span class='line'><span class="nx">但删除旧链接后，很多命令直接不能用了，因为此时中不到glibc的库了。这个时候就需要临时指定一个glibc库，方法如下（libc</span><span class="o">.</span><span class="nx">so改个名以便好以后更新的其他版本区分）</span>
</span></code></pre></td></tr></table></div></figure>


<p>php
 cp /****/glibc-build-2.15/libc.so /lib64/libc-2.15.so</p>

<p>rm -rf /lib64/libc.so.6<br/>
LD_PRELOAD=/lib64/libc-2.15.so ln -s/lib64/libc-2.15.so  lib64/libc.so.6</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">连接更新成功，再编译的话，GLIBC_2</span><span class="o">.</span><span class="mi">15</span><span class="nx">及以下版本的依赖问题就不会出现了。</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;</span><span class="nx">恩，到这里我也有话要说，我当时也是耿直，在这一步我重复了两三次！！！我耿直到从低版本一个一个往高版本安装啊。我真傻，真的。。。</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="o">***</span>
</span><span class='line'>
</span><span class='line'><span class="o">**</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">libstdc</span><span class="o">++.</span><span class="nx">so</span><span class="o">.</span><span class="mi">6</span><span class="o">:</span> <span class="nx">version</span> <span class="sb">`GLIBCXX_3.4.14&#39; not found**</span>
</span><span class='line'>
</span><span class='line'><span class="sb">[传送门](http://blog.csdn.net/xiaolong2w/article/details/23915171)</span>
</span><span class='line'>
</span><span class='line'><span class="sb">出现这种问题就是因为编译库的编译器和编译当前程序的编译器版本是不一样的，在具体一点就是因为，当前程序的编译器的版本是比较低的，只要升级一下就可以了。可以用如下命令查看一下当前GCC版本：</span>
</span><span class='line'>
</span><span class='line'><span class="sb">&lt;pre class=&quot;prettyprint linenums&quot;&gt;</span>
</span><span class='line'><span class="sb">strings /usr/lib/libstdc++.so.6 | grep GLIBCXX  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.1  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.2  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.3  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.4  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.5  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.6  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.7  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.8  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.9  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.10  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.11  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.12  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.13  </span>
</span><span class='line'><span class="sb">GLIBCXX_FORCE_NEW  </span>
</span><span class='line'><span class="sb">GLIBCXX_DEBUG_MESSAGE_LENGTH  </span>
</span><span class='line'><span class="sb">&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sb">并没有动态库中要求的GCC版本 “GLIBCXX_3.4.14”，所以需要进行升级一下我们的GCC版本，升级过程如下：</span>
</span><span class='line'>
</span><span class='line'><span class="sb">下载新版本的GCC，地址为[点击打开链接](http://ftp.de.debian.org/debian/pool/main/g/gcc-4.7/libstdc++6_4.7.2-5_i386.deb) （这里也有一个坑，今天真的是傻！！！）</span>
</span><span class='line'>
</span><span class='line'><span class="sb">下载下来之后，用如下命令开始解压</span>
</span><span class='line'><span class="sb">&lt;pre class=&quot;prettyprint linenums&quot;&gt;</span>
</span><span class='line'><span class="sb">ar -x libstdc++6_4.7.2-5_i386.deb &amp;&amp; tar xvf data.tar.gz  </span>
</span><span class='line'><span class="sb">如果你的文件目录为GCC（如果不是，把GCC改为相应的目录即可），依次执行下面命令：</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="sb">cd GCC/usr/lib/i380-linux-gun </span>
</span><span class='line'><span class="sb">su root  </span>
</span><span class='line'><span class="sb">cp libstdc++.so.6.0.17 /usr/lib </span>
</span><span class='line'><span class="sb">cd /usr/lib   </span>
</span><span class='line'><span class="sb">rm libstdc++.so.6  </span>
</span><span class='line'><span class="sb">ln -s libstdc++.so.6.0.17 libstdc++.so.6 </span>
</span><span class='line'><span class="sb">strings /usr/lib/libstdc++.so.6 | grep GLIBCXX  </span>
</span><span class='line'>
</span><span class='line'><span class="sb">GLIBCXX_3.4  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.1  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.2  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.3  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.4  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.5  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.6  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.7  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.8  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.9  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.10  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.11  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.12  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.13  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.14  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.15  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.16  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.17  </span>
</span><span class='line'><span class="sb">GLIBCXX_DEBUG_MESSAGE_LENGTH  </span>
</span><span class='line'><span class="sb">&lt;/pre&gt;</span>
</span><span class='line'><span class="sb">到这里其实就改结束了。可是回去atom </span>
</span><span class='line'>
</span><span class='line'><span class="sb">恩。不错，不是原来的错误了，重新报了一个错误。（具体的错误我忘了）</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="sb">后来在解决的时候才发现这个错误是因为我之前下载安装的libstdc是32位的，但是我的Atom是64位的就出错了。然后再这个过程中，我之前以为是我创建软链接的时候创建错误，我把lib和lib64里面的```</span><span class="nx">libstdc</span><span class="o">++.</span><span class="nx">so</span><span class="o">.</span><span class="mi">6</span><span class="sb">``` 都删了重新创建了一次。然后就GG了，这个时候连firefox浏览器都跟着崩溃了。后来意识到这个问题过后重新安装了64位的```</span><span class="nx">libstdc</span><span class="o">++.</span><span class="nx">so</span><span class="o">.</span><span class="mi">6</span><span class="sb">``</span><span class="err">`</span><span class="nx">解决了这个问题。</span>
</span><span class='line'>
</span><span class='line'><span class="o">**</span><span class="nx">undefined</span> <span class="nx">symbol</span> <span class="nx">g_bytes_unref</span><span class="o">**</span>
</span><span class='line'>
</span><span class='line'><span class="nx">这是遇到的最后的问题，也是彻底解决我的问题。。</span>
</span><span class='line'>
</span><span class='line'><span class="nx">在国内的网站上很少有这个问题的解决方法，后来找到一个论坛说是因为</span>
</span></code></pre></td></tr></table></div></figure>


<p>GBytes is relatively new, only since glib-2.32``` 准备更新glib库</p>

<p><a href="http://blog.chinaunix.net/uid-26000296-id-5159364.html">博文</a></p>

<p>检查系统当前的版本</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'> <span class="nx">rpm</span> <span class="o">-</span><span class="nx">qi</span> <span class="nx">glibc</span>
</span></code></pre></td></tr></table></div></figure>


<p>在CentOS中用更新命令到2.5已经是最新版本了，只好手动下载 glibc的源码包编译安装更新。
可以在 <a href="http://ftp.gnu.org/pub/gnu/glibc/%E7%9C%8B%E5%88%B0%E5%BD%93%E5%89%8D%E7%9A%84%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%EF%BC%8C">http://ftp.gnu.org/pub/gnu/glibc/%E7%9C%8B%E5%88%B0%E5%BD%93%E5%89%8D%E7%9A%84%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%EF%BC%8C</a>
我看到的最新版本是glibc-2.22。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'> <span class="nx">cd</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">src</span>
</span><span class='line'> <span class="nb">mkdir</span> <span class="nx">glibc</span><span class="o">-</span><span class="mf">2.22</span><span class="o">-</span><span class="nx">build</span>
</span><span class='line'> <span class="nx">wget</span> <span class="nx">http</span><span class="o">://</span><span class="nx">ftp</span><span class="o">.</span><span class="nx">gnu</span><span class="o">.</span><span class="nx">org</span><span class="o">/</span><span class="nx">pub</span><span class="o">/</span><span class="nx">gnu</span><span class="o">/</span><span class="nx">glibc</span><span class="o">/</span><span class="nx">glibc</span><span class="o">-</span><span class="mf">2.22</span><span class="o">.</span><span class="nx">tar</span><span class="o">.</span><span class="nx">gz</span>
</span><span class='line'> <span class="nx">tar</span> <span class="nx">zxvf</span> <span class="nx">glibc</span><span class="o">-</span><span class="mf">2.22</span><span class="o">.</span><span class="nx">tar</span><span class="o">.</span><span class="nx">gz</span>
</span><span class='line'> <span class="nx">cd</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">src</span><span class="o">/</span><span class="nx">glibc</span><span class="o">-</span><span class="mf">2.22</span><span class="o">-</span><span class="nx">build</span><span class="o">/</span>
</span><span class='line'> <span class="nx">export</span> <span class="nx">CFLAGS</span><span class="o">=</span><span class="s2">&quot;-g -O2 -march=i686&quot;</span>
</span><span class='line'>  <span class="nx">网上有些地方加优化开关</span> <span class="o">-</span><span class="nx">O2</span>  <span class="nx">时（大写字母O），写的是</span> <span class="o">-</span><span class="mo">02</span> <span class="nx">（数字零），</span>
</span><span class='line'>  <span class="nx">所以拷贝过来仍然出现3中的错误，所以请注意。</span>
</span><span class='line'> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">src</span><span class="o">/</span><span class="nx">glibc</span><span class="o">-</span><span class="mf">2.22</span><span class="o">-</span><span class="nx">build</span><span class="o">/</span><span class="nx">glibc</span><span class="o">-</span><span class="mf">2.22</span><span class="o">/</span><span class="nx">configure</span> <span class="o">--</span><span class="nx">prefix</span><span class="o">=/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">src</span><span class="o">/</span><span class="nx">glibc</span><span class="o">-</span><span class="mf">2.22</span><span class="o">-</span><span class="nx">build</span><span class="o">/</span> <span class="o">--</span><span class="nx">with</span><span class="o">-</span><span class="nx">headers</span><span class="o">=/</span><span class="nx">usr</span><span class="o">/</span><span class="k">include</span>
</span><span class='line'> <span class="nx">make</span>
</span><span class='line'> <span class="nx">make</span> <span class="nx">install</span>
</span></code></pre></td></tr></table></div></figure>


<p>报错</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">***</span> <span class="nx">These</span> <span class="nx">critical</span> <span class="nx">programs</span> <span class="nx">are</span> <span class="nx">missing</span> <span class="k">or</span> <span class="nx">too</span> <span class="nx">old</span><span class="o">:</span> <span class="k">as</span> <span class="nx">ld</span> <span class="nx">compiler</span>
</span><span class='line'><span class="o">***</span> <span class="nx">Check</span> <span class="nx">the</span> <span class="nx">INSTALL</span> <span class="nb">file</span> <span class="k">for</span> <span class="nx">required</span> <span class="nx">versions</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="nx">解决办法</span><span class="o">:</span>
</span><span class='line'><span class="nx">问题原因：</span>
</span><span class='line'><span class="nx">缺少autoconf或版本太低</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nx">下载安装新版本</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'> <span class="nx">wget</span> <span class="nx">ftp</span><span class="o">://</span><span class="nx">ftp</span><span class="o">.</span><span class="nx">gnu</span><span class="o">.</span><span class="nx">org</span><span class="o">/</span><span class="nx">gnu</span><span class="o">/</span><span class="nx">autoconf</span><span class="o">/</span><span class="nx">autoconf</span><span class="o">-</span><span class="mf">2.68</span><span class="o">.</span><span class="nx">tar</span><span class="o">.</span><span class="nx">gz</span>
</span><span class='line'> <span class="nx">tar</span> <span class="nx">zxvf</span> <span class="nx">autoconf</span><span class="o">-</span><span class="mf">2.68</span><span class="o">.</span><span class="nx">tar</span><span class="o">.</span><span class="nx">gz</span>
</span><span class='line'> <span class="nx">cd</span> <span class="nx">autoconf</span><span class="o">-</span><span class="mf">2.68</span>
</span><span class='line'> <span class="o">./</span><span class="nx">configure</span> <span class="o">--</span><span class="nx">prefix</span><span class="o">=/</span><span class="nx">usr</span><span class="o">/</span>
</span><span class='line'> <span class="nx">make</span> <span class="o">&amp;&amp;</span> <span class="nx">make</span> <span class="nx">install</span>
</span></code></pre></td></tr></table></div></figure>


<p>我进行到了这一步，然后虚拟机卡住了，卡了好久。。</p>

<p>然后我干出了今天干过最蠢的事<strong>我直接用VM重启了它</strong>（我的Windows卡住就是这样干的(尴尬脸)）</p>

<p>然后再开机我就懵逼了，我firefox的书签没了，历史记录没有，系统还报错。运行几分钟就一直卡住。。</p>

<p>然后我就决定果断弃坑！！！！！</p>

<p>PS：</p>

<p><strong>这篇博文还很不完整，以后有机会再在Centos上装Atom成功的话在回来补充</strong></p>

<pre class="prettyprint linenums">
多么痛的领悟
绝对不要随便强制重启！！！！
用浏览器一定要登录，书签和历史记录才能同步啊！！！
下次更新东西别再一个版本一个版本的往上装了，耿直过头啊！！！
</pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Linx下安装Git]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/09/linux-git/"/>
    <updated>2016-05-09T23:25:34+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/09/linux-git</id>
    <content type="html"><![CDATA[<blockquote><p>考试季过去了，准备开始将日常使用迁移到Linux下，今天想在Linux下装Git，开始觉得这应该是个很简单的事，谁知道这个花了好多时间。</p></blockquote>

<!--more-->


<p>首先在网上找了一个博文作为参考，<a href="http://blog.csdn.net/naola2001/article/details/43228769">传送门</a></p>

<p>服务器端：</p>

<pre class="prettyprint linenums">
yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel perl-devel
wget https://github.com/git/git/archive/v2.2.0.tar.gz
tar zxvf git-2.2.0.tar.gz
cd git-2.2.0
make prefix=/usr/local all
make prefix=/usr/local install  root用户运行
</pre>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">如果编译时提示错误：</span>
</span><span class='line'><span class="nx">LINK</span> <span class="nx">git</span><span class="o">-</span><span class="nx">credential</span><span class="o">-</span><span class="nx">store</span>
</span><span class='line'><span class="nx">libgit</span><span class="o">.</span><span class="nx">a</span><span class="p">(</span><span class="nx">utf8</span><span class="o">.</span><span class="nx">o</span><span class="p">)</span><span class="o">:</span> <span class="nx">In</span> <span class="k">function</span> <span class="err">`</span><span class="nf">reencode_string_iconv’</span><span class="o">:</span>
</span><span class='line'><span class="o">/</span><span class="nx">opt</span><span class="o">/</span><span class="nx">git</span><span class="o">-</span><span class="nx">master</span><span class="o">/</span><span class="nx">utf8</span><span class="o">.</span><span class="nx">c</span><span class="o">:</span><span class="mi">530</span><span class="o">:</span> <span class="nx">undefined</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="sb">`libiconv’</span>
</span><span class='line'><span class="sb">libgit.a(utf8.o): In function `</span><span class="nx">reencode_string_len’</span><span class="o">:</span>
</span><span class='line'><span class="o">/</span><span class="nx">opt</span><span class="o">/</span><span class="nx">git</span><span class="o">-</span><span class="nx">master</span><span class="o">/</span><span class="nx">utf8</span><span class="o">.</span><span class="nx">c</span><span class="o">:</span><span class="mi">569</span><span class="o">:</span> <span class="nx">undefined</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="sb">`libiconv_open’</span>
</span><span class='line'><span class="sb">/opt/git-master/utf8.c:588: undefined reference to `</span><span class="nx">libiconv_close’</span>
</span><span class='line'><span class="o">/</span><span class="nx">opt</span><span class="o">/</span><span class="nx">git</span><span class="o">-</span><span class="nx">master</span><span class="o">/</span><span class="nx">utf8</span><span class="o">.</span><span class="nx">c</span><span class="o">:</span><span class="mi">582</span><span class="o">:</span> <span class="nx">undefined</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="err">`</span><span class="nx">libiconv_open’</span>
</span><span class='line'><span class="nx">collect2</span><span class="o">:</span> <span class="nx">ld</span> <span class="nx">返回</span> <span class="mi">1</span>
</span><span class='line'><span class="nx">make</span><span class="o">:</span> <span class="o">***</span> <span class="p">[</span><span class="nx">git</span><span class="o">-</span><span class="nx">credential</span><span class="o">-</span><span class="nx">store</span><span class="p">]</span> <span class="nx">错误</span> <span class="mi">1</span>
</span><span class='line'><span class="nx">解决办法：</span>
</span><span class='line'>
</span><span class='line'><span class="nx">cd</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">local</span><span class="o">/</span><span class="nx">src</span><span class="o">/</span>
</span><span class='line'><span class="nx">wget</span> <span class="nx">http</span><span class="o">://</span><span class="nx">ftp</span><span class="o">.</span><span class="nx">gnu</span><span class="o">.</span><span class="nx">org</span><span class="o">/</span><span class="nx">pub</span><span class="o">/</span><span class="nx">gnu</span><span class="o">/</span><span class="nx">libiconv</span><span class="o">/</span><span class="nx">libiconv</span><span class="o">-</span><span class="mf">1.14</span><span class="o">.</span><span class="nx">tar</span><span class="o">.</span><span class="nx">gz</span>
</span><span class='line'><span class="nx">tar</span> <span class="o">-</span><span class="nx">zxvf</span> <span class="nx">libiconv</span><span class="o">-</span><span class="mf">1.14</span><span class="o">.</span><span class="nx">tar</span><span class="o">.</span><span class="nx">gz</span>
</span><span class='line'><span class="nx">cd</span> <span class="nx">libiconv</span><span class="o">-</span><span class="mf">1.14</span>
</span><span class='line'><span class="o">./</span><span class="nx">configure</span> <span class="o">-</span><span class="nx">prefix</span><span class="o">=/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">local</span><span class="o">/</span><span class="nx">libiconv</span>  <span class="o">&amp;&amp;</span>  <span class="nx">make</span>  <span class="o">&amp;&amp;</span> <span class="nx">sudo</span>  <span class="nx">make</span> <span class="nx">install</span>
</span><span class='line'><span class="nx">然后回到git继续编译：</span>
</span><span class='line'>
</span><span class='line'><span class="nx">cd</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">local</span><span class="o">/</span><span class="nx">src</span><span class="o">/</span><span class="nx">git</span><span class="o">-</span><span class="mf">1.8</span><span class="o">.</span><span class="mi">5</span>
</span><span class='line'><span class="nx">make</span> <span class="nx">configure</span>
</span><span class='line'><span class="o">./</span><span class="nx">configure</span> <span class="o">--</span><span class="nx">prefix</span><span class="o">=/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">local</span> <span class="o">-</span><span class="nx">with</span><span class="o">-</span><span class="nb">iconv</span><span class="o">=/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">local</span><span class="o">/</span><span class="nx">libiconv</span>
</span><span class='line'><span class="nx">make</span>
</span><span class='line'><span class="nx">make</span> <span class="nx">install</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1"># git --version</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">version</span> <span class="mf">2.2</span><span class="o">.</span><span class="mi">0</span>
</span></code></pre></td></tr></table></div></figure>


<p>按照教程，到这里应该就成功了。
但是在解决了lib的错误后在回来执行 make 时遇到了错误</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">In</span> <span class="k">function</span> <span class="err">`</span><span class="nf">init_gettext_charset</span><span class="s1">&#39;: </span>
</span><span class='line'><span class="s1">/root/soft/git-2012-01-19/gettext.c:115: undefined reference to `locale_charset&#39;</span>
</span><span class='line'><span class="nx">collect2</span><span class="o">:</span> <span class="nx">ld</span> <span class="nx">returned</span> <span class="mi">1</span> <span class="k">exit</span> <span class="nx">status</span>
</span></code></pre></td></tr></table></div></figure>


<p>解决方法：<a href="http://mono.1490590.n4.nabble.com/Can-t-compile-git-for-a-long-time-td3336232.html#a4312244">传送门</a>
其中一个corey_yan的回答成功解决了问题</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">I</span> <span class="nx">encounter</span> <span class="nx">the</span> <span class="nx">same</span> <span class="nx">problem</span> <span class="nx">in</span> <span class="nx">centos</span> <span class="mf">5.2</span> <span class="k">and</span> <span class="k">try</span> <span class="nx">to</span> <span class="nx">solve</span> <span class="nx">it</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">long</span> <span class="nb">time</span>
</span><span class='line'>
</span><span class='line'><span class="nx">libgit</span><span class="o">.</span><span class="nx">a</span><span class="p">(</span><span class="nb">gettext</span><span class="o">.</span><span class="nx">o</span><span class="p">)</span><span class="o">:</span> <span class="nx">In</span> <span class="k">function</span> <span class="err">`</span><span class="nf">init_gettext_charset</span><span class="s1">&#39;: </span>
</span><span class='line'><span class="s1">/root/soft/git-2012-01-19/gettext.c:115: undefined reference to `locale_charset&#39;</span>
</span><span class='line'><span class="nx">collect2</span><span class="o">:</span> <span class="nx">ld</span> <span class="nx">returned</span> <span class="mi">1</span> <span class="k">exit</span> <span class="nx">status</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nx">After</span> <span class="nx">checking</span> <span class="nx">the</span> <span class="nx">detail</span> <span class="nx">Link</span> <span class="nx">command</span>
</span><span class='line'><span class="nx">make</span> <span class="o">-</span><span class="nx">n</span> <span class="o">|</span> <span class="nx">grep</span> <span class="s2">&quot;git-daemon&quot;</span>
</span><span class='line'><span class="k">echo</span> <span class="s1">&#39;   &#39;</span> <span class="nx">LINK</span> <span class="nx">git</span><span class="o">-</span><span class="nx">daemon</span><span class="p">;</span>
</span><span class='line'><span class="nx">cc</span>  <span class="o">-</span><span class="nx">g</span> <span class="o">-</span><span class="nx">O2</span> <span class="o">-</span><span class="nx">I</span><span class="o">.</span> <span class="o">-</span><span class="nx">pthread</span> <span class="o">-</span><span class="nx">DHAVE_PATHS_H</span> <span class="o">-</span><span class="nx">DHAVE_LIBCHARSET_H</span> <span class="o">-</span><span class="nx">DHAVE_DEV_TTY</span> <span class="o">-</span><span class="nx">DSHA1_HEADER</span><span class="o">=</span><span class="s1">&#39;&lt;openssl/sha.h&gt;&#39;</span>  <span class="o">-</span><span class="nx">DNO_STRLCPY</span> <span class="o">-</span><span class="nx">DNO_MKSTEMPS</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">git</span><span class="o">-</span><span class="nx">daemon</span>   <span class="nx">daemon</span><span class="o">.</span><span class="nx">o</span> <span class="nx">libgit</span><span class="o">.</span><span class="nx">a</span> <span class="nx">xdiff</span><span class="o">/</span><span class="nx">lib</span><span class="o">.</span><span class="nx">a</span>  <span class="o">-</span><span class="nx">lz</span>  <span class="o">-</span><span class="nx">liconv</span>  <span class="o">-</span><span class="nx">lcrypto</span> <span class="o">-</span><span class="nx">pthread</span>
</span><span class='line'>
</span><span class='line'><span class="nx">I</span> <span class="k">try</span> <span class="nx">to</span> <span class="nx">change</span> <span class="nx">to</span>
</span><span class='line'><span class="nx">cc</span>  <span class="o">-</span><span class="nx">g</span> <span class="o">-</span><span class="nx">O2</span> <span class="o">-</span><span class="nx">I</span><span class="o">.</span> <span class="o">-</span><span class="nx">pthread</span> <span class="o">-</span><span class="nx">DHAVE_PATHS_H</span> <span class="o">-</span><span class="nx">DHAVE_LIBCHARSET_H</span> <span class="o">-</span><span class="nx">DHAVE_DEV_TTY</span> <span class="o">-</span><span class="nx">DSHA1_HEADER</span><span class="o">=</span><span class="s1">&#39;&lt;openssl/sha.h&gt;&#39;</span>  <span class="o">-</span><span class="nx">DNO_STRLCPY</span> <span class="o">-</span><span class="nx">DNO_MKSTEMPS</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">git</span><span class="o">-</span><span class="nx">daemon</span>   <span class="nx">daemon</span><span class="o">.</span><span class="nx">o</span> <span class="nx">libgit</span><span class="o">.</span><span class="nx">a</span> <span class="nx">xdiff</span><span class="o">/</span><span class="nx">lib</span><span class="o">.</span><span class="nx">a</span>  <span class="o">-</span><span class="nx">lz</span>  <span class="o">-</span><span class="nx">liconv</span>  <span class="o">-</span><span class="nx">lcharset</span> <span class="o">-</span><span class="nx">lcrypto</span> <span class="o">-</span><span class="nx">pthread</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Link</span> <span class="nx">error</span> <span class="nx">is</span> <span class="nx">missing</span><span class="o">:</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nx">I</span> <span class="k">try</span> <span class="nx">to</span> <span class="nx">modify</span> <span class="nx">Makefile</span>
</span><span class='line'>        <span class="nx">EXTLIBS</span> <span class="o">+=</span> <span class="err">$</span><span class="p">(</span><span class="nx">ICONV_LINK</span><span class="p">)</span> <span class="o">-</span><span class="nx">liconv</span> <span class="o">-</span><span class="nx">lcharset</span>
</span><span class='line'>
</span><span class='line'><span class="nx">then</span>
</span><span class='line'><span class="nx">make</span> <span class="nx">successfully</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Hope</span> <span class="nx">it</span> <span class="nx">can</span> <span class="nx">help</span> <span class="nx">you</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>步骤为:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">make</span> <span class="o">-</span><span class="nx">n</span> <span class="o">|</span> <span class="nx">grep</span> <span class="s2">&quot;git-daemon&quot;</span>
</span><span class='line'><span class="k">echo</span> <span class="s1">&#39;   &#39;</span> <span class="nx">LINK</span> <span class="nx">git</span><span class="o">-</span><span class="nx">daemon</span><span class="p">;</span>
</span><span class='line'><span class="nx">cc</span>  <span class="o">-</span><span class="nx">g</span> <span class="o">-</span><span class="nx">O2</span> <span class="o">-</span><span class="nx">I</span><span class="o">.</span> <span class="o">-</span><span class="nx">pthread</span> <span class="o">-</span><span class="nx">DHAVE_PATHS_H</span> <span class="o">-</span><span class="nx">DHAVE_LIBCHARSET_H</span> <span class="o">-</span><span class="nx">DHAVE_DEV_TTY</span> <span class="o">-</span><span class="nx">DSHA1_HEADER</span><span class="o">=</span><span class="s1">&#39;&lt;openssl/sha.h&gt;&#39;</span>  <span class="o">-</span><span class="nx">DNO_STRLCPY</span> <span class="o">-</span><span class="nx">DNO_MKSTEMPS</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">git</span><span class="o">-</span><span class="nx">daemon</span>   <span class="nx">daemon</span><span class="o">.</span><span class="nx">o</span> <span class="nx">libgit</span><span class="o">.</span><span class="nx">a</span> <span class="nx">xdiff</span><span class="o">/</span><span class="nx">lib</span><span class="o">.</span><span class="nx">a</span>  <span class="o">-</span><span class="nx">lz</span>  <span class="o">-</span><span class="nx">liconv</span>  <span class="o">-</span><span class="nx">lcrypto</span> <span class="o">-</span><span class="nx">pthread</span>
</span><span class='line'><span class="c1">//会报一个link错误</span>
</span><span class='line'><span class="nx">cc</span>  <span class="o">-</span><span class="nx">g</span> <span class="o">-</span><span class="nx">O2</span> <span class="o">-</span><span class="nx">I</span><span class="o">.</span> <span class="o">-</span><span class="nx">pthread</span> <span class="o">-</span><span class="nx">DHAVE_PATHS_H</span> <span class="o">-</span><span class="nx">DHAVE_LIBCHARSET_H</span> <span class="o">-</span><span class="nx">DHAVE_DEV_TTY</span> <span class="o">-</span><span class="nx">DSHA1_HEADER</span><span class="o">=</span><span class="s1">&#39;&lt;openssl/sha.h&gt;&#39;</span>  <span class="o">-</span><span class="nx">DNO_STRLCPY</span> <span class="o">-</span><span class="nx">DNO_MKSTEMPS</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">git</span><span class="o">-</span><span class="nx">daemon</span>   <span class="nx">daemon</span><span class="o">.</span><span class="nx">o</span> <span class="nx">libgit</span><span class="o">.</span><span class="nx">a</span> <span class="nx">xdiff</span><span class="o">/</span><span class="nx">lib</span><span class="o">.</span><span class="nx">a</span>  <span class="o">-</span><span class="nx">lz</span>  <span class="o">-</span><span class="nx">liconv</span>  <span class="o">-</span><span class="nx">lcharset</span> <span class="o">-</span><span class="nx">lcrypto</span> <span class="o">-</span><span class="nx">pthread</span>
</span><span class='line'><span class="c1">//Link error is missing:) </span>
</span><span class='line'><span class="nx">vim</span> <span class="nx">Makefile</span>
</span><span class='line'><span class="nx">找到</span> <span class="nx">EXTLIBS</span> <span class="o">+=</span> <span class="err">$</span><span class="p">(</span><span class="nx">ICONV_LINK</span><span class="p">)</span> <span class="o">-</span><span class="nx">liconv</span>
</span><span class='line'><span class="nx">改为</span> <span class="nx">EXTLIBS</span> <span class="o">+=</span> <span class="err">$</span><span class="p">(</span><span class="nx">ICONV_LINK</span><span class="p">)</span> <span class="o">-</span><span class="nx">liconv</span> <span class="o">-</span><span class="nx">lcharset</span>  <span class="c1">//保存退出</span>
</span><span class='line'><span class="nx">重新make</span>
</span><span class='line'><span class="nx">make</span> <span class="nx">install</span>
</span></code></pre></td></tr></table></div></figure>


<p>成功解决问题。</p>

<hr />

<h1>在原博文下面还有一些功能的安装，现在还没设计到，不过也先贴出来</h1>

<p><strong>下面来安装 gitosis</strong></p>

<blockquote><p>gitosis为Git用户权限管理系统,通过管理服务端的authorized_key文件来执行对用户权限的管理，是一个Python模块包</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">yum</span> <span class="nx">install</span> <span class="nx">python</span> <span class="nx">python</span><span class="o">-</span><span class="nx">setuptools</span>
</span><span class='line'><span class="nx">cd</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">local</span><span class="o">/</span><span class="nx">src</span>
</span><span class='line'><span class="nx">git</span> <span class="k">clone</span> <span class="nx">git</span><span class="o">://</span><span class="nx">github</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">res0nat0r</span><span class="o">/</span><span class="nx">gitosis</span><span class="o">.</span><span class="nx">git</span>
</span><span class='line'><span class="nx">cd</span> <span class="nx">gitosis</span>
</span><span class='line'><span class="nx">python</span> <span class="nx">setup</span><span class="o">.</span><span class="nx">py</span> <span class="nx">install</span>
</span><span class='line'>
</span><span class='line'><span class="nx">OK</span> <span class="nx">gitosis</span> <span class="nx">安装成功！</span>
</span><span class='line'>
</span><span class='line'> <span class="nx">配置服务器git：</span>
</span><span class='line'><span class="mf">0.1</span> <span class="nx">输入以下两条命令</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">config</span> <span class="o">--</span><span class="k">global</span> <span class="nx">user</span><span class="o">.</span><span class="nx">name</span> <span class="s2">&quot;Your Name Here&quot;</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">config</span> <span class="o">--</span><span class="k">global</span> <span class="nx">user</span><span class="o">.</span><span class="nx">email</span> <span class="s2">&quot;your_email@example.com&quot;</span>
</span><span class='line'><span class="nx">可以再输入git</span> <span class="nx">config</span> <span class="o">-</span><span class="nx">l查看上面两个是否设置</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>在开发机上生成密钥并上传到服务器上</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">ssh</span><span class="o">-</span><span class="nx">keygen</span> <span class="o">-</span><span class="nx">t</span> <span class="nx">rsa</span>   <span class="c1">#一路回车，不需要设置密码</span>
</span><span class='line'><span class="nx">scp</span> <span class="o">~/.</span><span class="nx">ssh</span><span class="o">/</span><span class="nx">id_rsa</span><span class="o">.</span><span class="nx">pub</span> <span class="nx">root</span><span class="o">@</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">103.10</span><span class="o">:/</span><span class="nx">tmp</span>   <span class="c1">#上传公钥到服务器(默认SSH端口22)</span>
</span><span class='line'><span class="nx">或</span>
</span><span class='line'><span class="nx">scp</span> <span class="o">-</span><span class="nx">P</span> <span class="mi">3600</span>  <span class="o">~/.</span><span class="nx">ssh</span><span class="o">/</span><span class="nx">id_rsa</span><span class="o">.</span><span class="nx">pub</span> <span class="nx">root</span><span class="o">@</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">103.10</span><span class="o">:/</span><span class="nx">tmp</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="mi">5</span><span class="nx">、服务器上生成git用户，使用git用户并初始化gitosis</span>
</span><span class='line'><span class="nx">adduser</span> <span class="o">-</span><span class="nx">m</span> <span class="nx">git</span>
</span><span class='line'><span class="nx">su</span> <span class="nx">–</span> <span class="nx">git</span>
</span><span class='line'><span class="nx">gitosis</span><span class="o">-</span><span class="nx">init</span> <span class="o">&lt;</span> <span class="o">/</span><span class="nx">tmp</span><span class="o">/</span><span class="nx">id_rsa</span><span class="o">.</span><span class="nx">pub</span>
</span><span class='line'><span class="c1">#显示以下信息即表示成功</span>
</span><span class='line'><span class="c1">#Initialized empty Git repository in /home/git/repositories/gitosis-admin.git/</span>
</span><span class='line'><span class="c1">#Reinitialized existing Git repository in /home/git/repositories/gitosis-admin.git/</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">#删除密钥</span>
</span><span class='line'><span class="nx">su</span> <span class="nx">–</span> <span class="nx">root</span>
</span><span class='line'><span class="nx">rm</span> <span class="o">-</span><span class="nx">rf</span> <span class="o">/</span><span class="nx">tmp</span><span class="o">/</span><span class="nx">id_rsa</span><span class="o">.</span><span class="nx">pub</span>
</span><span class='line'><span class="nx">禁用shell登录</span>
</span><span class='line'><span class="nx">注，出于安全考虑，第二步创建的git用户不允许登录shell，这可以通过编辑</span><span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">passwd文件完成。找到类似下面的一行：</span>
</span><span class='line'><span class="nx">\</span><span class="p">[</span><span class="nx">root</span><span class="o">@</span><span class="nx">git</span> <span class="o">~</span><span class="nx">\</span><span class="p">]</span><span class="c1"># cat /etc/passwd | grep git</span>
</span><span class='line'><span class="nx">git</span><span class="o">:</span><span class="nx">x</span><span class="o">:</span><span class="mi">1001</span><span class="o">:</span><span class="mi">1001</span><span class="o">:</span><span class="nx">git</span> <span class="nx">version</span> <span class="nx">control</span><span class="o">:/</span><span class="nx">home</span><span class="o">/</span><span class="nx">git</span><span class="o">:/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">bash</span>
</span><span class='line'>
</span><span class='line'><span class="nx">改为：</span>
</span><span class='line'><span class="nx">\</span><span class="p">[</span><span class="nx">root</span><span class="o">@</span><span class="nx">git</span> <span class="o">~</span><span class="nx">\</span><span class="p">]</span><span class="c1"># vim /etc/passwd</span>
</span><span class='line'><span class="nx">git</span><span class="o">:</span><span class="nx">x</span><span class="o">:</span><span class="mi">1001</span><span class="o">:</span><span class="mi">1001</span><span class="o">:</span><span class="nx">git</span> <span class="nx">version</span> <span class="nx">control</span><span class="o">:/</span><span class="nx">home</span><span class="o">/</span><span class="nx">git</span><span class="o">:/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">git</span><span class="o">-</span><span class="nx">shell</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nx">这样，git用户可以正常通过ssh使用git，但无法登录shell，因为我们为git用户指定的git</span><span class="o">-</span><span class="nx">shell每次一登录就自动退出。</span>
</span><span class='line'>
</span><span class='line'><span class="mi">2</span><span class="nx">，在git用户下，生成私钥和公钥。</span>
</span><span class='line'><span class="nv">$ssh</span><span class="o">-</span><span class="nx">keygen</span> <span class="nx">–t</span> <span class="nx">rsa</span>
</span><span class='line'><span class="mi">3</span><span class="nx">，在git用户下，拷入id_rsa</span><span class="o">.</span><span class="nx">pub文件。</span>
</span><span class='line'><span class="nv">$gitosis</span><span class="o">-</span><span class="nx">init</span> <span class="o">&lt;</span> <span class="nx">id_rsa</span><span class="o">.</span><span class="nx">pub</span>
</span><span class='line'><span class="nx">这样在git用户目录下生成了一些目录，gitosis，repositories。</span>
</span><span class='line'><span class="nx">至此，安装工作完成。</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>添加开发者</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">git服务器管理人员需要把所有的开发者公钥保存到authorized_keys文件中。</span>
</span><span class='line'><span class="nv">$cat</span> <span class="o">/</span><span class="nx">tmp</span><span class="o">/</span><span class="nx">id_rsa</span><span class="o">.</span><span class="nx">pub</span><span class="o">.</span><span class="nx">ubuntu</span> <span class="o">&gt;&gt;</span> <span class="nx">authorized_keys</span>
</span><span class='line'><span class="nx">创建项目仓库</span>
</span><span class='line'><span class="nx">git管理人员操作：</span>
</span><span class='line'><span class="nv">$mkdir</span> <span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">git</span><span class="o">/</span><span class="nx">gitproject</span>
</span><span class='line'><span class="nv">$cd</span> <span class="nx">gitproject</span>
</span><span class='line'><span class="nv">$git</span> <span class="o">--</span><span class="nx">bare</span> <span class="nx">init</span> <span class="nx">（创建一个空项目）</span>
</span><span class='line'><span class="nx">开发者提交项目</span>
</span><span class='line'><span class="nx">ubuntu开发者操作：</span>
</span><span class='line'><span class="nv">$git</span> <span class="nx">remote</span> <span class="nx">add</span> <span class="nx">origin</span> <span class="nx">git</span><span class="o">@</span><span class="nx">gitserver</span><span class="o">:/</span><span class="nx">opt</span><span class="o">/</span><span class="nx">git</span><span class="o">/</span><span class="nx">project</span><span class="o">.</span><span class="nx">git</span>
</span><span class='line'><span class="nv">$git</span> <span class="nx">push</span> <span class="nx">origin</span> <span class="nx">master</span>
</span><span class='line'><span class="nx">这样其他开发者的工作也比较简单了：</span>
</span><span class='line'><span class="nv">$git</span> <span class="k">clone</span> <span class="nx">…</span>
</span><span class='line'><span class="nv">$git</span> <span class="nx">push</span> <span class="nx">origin</span> <span class="nx">master</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nx">cd</span> <span class="o">/</span><span class="nx">repo</span><span class="o">/</span><span class="nx">gitosis</span><span class="o">-</span><span class="nx">admin</span>
</span><span class='line'><span class="nx">vim</span> <span class="nx">gitosis</span><span class="o">.</span><span class="nx">conf</span>
</span><span class='line'><span class="nx">在文件尾增加以下内容</span>
</span><span class='line'><span class="nx">\</span><span class="p">[</span><span class="nx">group</span> <span class="nx">test\</span><span class="p">]</span>  <span class="nx">组名称</span>
</span><span class='line'><span class="nx">writable</span> <span class="o">=</span> <span class="nx">test</span>  <span class="nx">项目名称</span>
</span><span class='line'><span class="nx">members</span> <span class="o">=</span> <span class="nx">jankerli</span> <span class="nx">密钥用户名</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#提交修改</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">add</span> <span class="o">.</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">commit</span> <span class="o">-</span><span class="nx">a</span> <span class="o">-</span><span class="nx">m</span> <span class="nx">“add</span> <span class="nx">test</span> <span class="nx">repo”</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">push</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>初始，增加及使用项目test-git</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">cd</span> <span class="o">/</span><span class="nx">repo</span>
</span><span class='line'><span class="nb">mkdir</span> <span class="nx">test</span><span class="o">-</span><span class="nx">git</span>
</span><span class='line'><span class="nx">cd</span> <span class="nx">test</span><span class="o">-</span><span class="nx">git</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">inti</span>
</span><span class='line'><span class="nb">touch</span> <span class="nx">readme</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">add</span> <span class="o">.</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">commit</span> <span class="o">-</span><span class="nx">a</span> <span class="o">-</span><span class="nx">m</span> <span class="nx">“init</span> <span class="nx">test</span><span class="o">-</span><span class="nx">git”</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">remote</span> <span class="nx">add</span> <span class="nx">origin</span> <span class="nx">git</span><span class="o">@</span><span class="nx">xxx</span><span class="o">:</span><span class="nx">test</span><span class="o">.</span><span class="nx">git</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">push</span> <span class="nx">origin</span> <span class="nx">master</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>在 test 项目新增用户</strong>
①在新增用户的本机输入ssh-keygen -t rsa生成私钥公钥；
②把生成的公钥id_rsa.pub上传或复制到 gitosis-admin/keydir文件夹下，并重名，如：jankerli.pub；
③vim gitosis.conf</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">在文件尾增加以下内容</span>
</span><span class='line'><span class="nx">\</span><span class="p">[</span><span class="nx">group</span> <span class="nx">test\</span><span class="p">]</span>
</span><span class='line'><span class="nx">writable</span> <span class="o">=</span> <span class="nx">test</span>
</span><span class='line'><span class="nx">members</span> <span class="o">=</span> <span class="nx">jankerli</span> <span class="nx">（此处增加新用户的名称，名称必须与上面重名的jankerli</span><span class="o">.</span><span class="nx">pub一致，去掉</span><span class="o">.</span><span class="nx">pub）</span>
</span><span class='line'><span class="nx">④提交修改</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">add</span> <span class="o">.</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">commit</span> <span class="o">-</span><span class="nx">a</span> <span class="o">-</span><span class="nx">m</span> <span class="nx">“add</span> <span class="nx">test</span> <span class="nx">repo”</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">push</span>
</span></code></pre></td></tr></table></div></figure>


<p>⑤新用户便可通过 git clone git@xxx:test.git 克隆代码到本机了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PHP性能优化初识]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/04/php-xing-neng-you-hua/"/>
    <updated>2016-05-04T22:46:21+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/04/php-xing-neng-you-hua</id>
    <content type="html"><![CDATA[<blockquote><p>PHP性能优化</p></blockquote>

<!--more-->


<h1>一、PHP性能优化问题解析</h1>

<p>PHP的性能问题，占整体项目性能问题的比例不足50%，所以在考虑性能优化项目的时候，不要局限于仅优化PHP。</p>

<p>PHP的性能优化问题的解决方向（困难度从容易到简单）</p>

<pre><code>PHP语言级的性能优化
PHP周边问题的性能优化（开发环境等）
PHP语言自身分析、优化（底层C）
</code></pre>

<h2>压力测试工具简介</h2>

<p><strong>Apache Benchmark（ab）</strong></p>

<p>简介</p>

<pre><code>ab是由Apache提供的压力测试软件。安装Apache服务器时会自带该压测软件。
</code></pre>

<p>如何使用</p>

<pre><code>./ab -n1000 -c100 http://www.baidu.com （目标网址）
-n 请求数
-c 并发数
url 目标压测地址
</code></pre>

<p>结果分析</p>

<pre><code>主要看
Request per second 每秒接受的请求数
Time per request   一个请求的耗时
</code></pre>

<h1>二、PHP语言级的优化</h1>

<p><strong>优化点：少写代码，多用PHP自身能力,多使用PHP内置的函数，变量，常量</strong></p>

<p><strong>性能问题：自写代码冗余较多，可读性不佳，并且性能低</strong></p>

<p>为什么性能低？</p>

<pre><code>我们自己写的代码每次需要编译解析成底层语言，每一次请求都会处理一遍开销很大。
</code></pre>

<hr />

<p><strong>PHP内置函数的性能优劣</strong></p>

<p>情况描述：</p>

<pre><code>PHP内置函数之间依然存在着快慢差异
</code></pre>

<p>多去了解PHP内置函数的时间复杂度</p>

<p>举例</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="nv">$start</span><span class="o">=</span><span class="nx">current_time</span><span class="p">();</span>
</span><span class='line'>  <span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$arr</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">200000</span><span class="p">);</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="nv">$i</span><span class="o">&lt;</span><span class="mi">200000</span><span class="p">){</span>
</span><span class='line'>      <span class="o">++</span><span class="nv">$i</span><span class="p">;</span>
</span><span class='line'>      <span class="c1">//isset($arr[$i]); //测试结果50多ms</span>
</span><span class='line'>      <span class="nb">array_key_exists</span><span class="p">(</span><span class="nv">$i</span><span class="p">,</span><span class="nv">$arr</span><span class="p">);</span> <span class="c1">//测试结果80多ms</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nv">$end</span><span class="o">=</span><span class="nx">current_time</span><span class="p">();</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;Lost Time:&quot;</span><span class="o">.</span><span class="nb">number_format</span><span class="p">(</span><span class="nv">$end</span><span class="o">-</span><span class="nv">$start</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">;</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="sd">/**</span>
</span><span class='line'><span class="sd">  *返回一个微秒级别的时间戳</span>
</span><span class='line'><span class="sd">  */</span>
</span><span class='line'>  <span class="k">function</span> <span class="nf">current_time</span><span class="p">(){</span>
</span><span class='line'>      <span class="k">list</span><span class="p">(</span><span class="nv">$usec</span><span class="p">,</span><span class="nv">$sec</span><span class="p">)</span><span class="o">=</span><span class="nb">explode</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nb">microtime</span><span class="p">());</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">((</span><span class="nx">float</span><span class="p">)</span><span class="nv">$usce</span><span class="o">+</span><span class="p">(</span><span class="nx">float</span><span class="p">)</span><span class="nv">$sec</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"> </span>
</span></code></pre></td></tr></table></div></figure>


<p>测试结果说明isset比array_key_exists函数更优化。</p>

<hr />

<p><strong>减少PHP魔法函数的使用</strong></p>

<p>情况描述：</p>

<pre><code>PHP提供的魔法函数性能不佳
</code></pre>

<p>举例</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="k">class</span> <span class="nc">test</span><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="nv">$var</span><span class="o">=</span><span class="s2">&quot;123&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">function</span> <span class="nf">__get</span><span class="p">(</span><span class="nv">$varname</span><span class="p">){</span>
</span><span class='line'>      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">var</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="k">while</span><span class="p">(</span><span class="nv">$i</span><span class="o">&lt;</span><span class="mi">10000</span><span class="o">-</span><span class="p">){</span>
</span><span class='line'>  <span class="nv">$i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$test</span><span class="o">=</span><span class="k">new</span> <span class="nx">test</span><span class="p">();</span>
</span><span class='line'>  <span class="nv">$test</span><span class="o">-&gt;</span><span class="na">var</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span><span class="c1">//大概80ms</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="k">class</span> <span class="nc">test</span><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="nv">$var</span><span class="o">=</span><span class="s2">&quot;123&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">//public function __get($varname){</span>
</span><span class='line'>      <span class="c1">//return $this-&gt;var;</span>
</span><span class='line'>  <span class="c1">//}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="k">while</span><span class="p">(</span><span class="nv">$i</span><span class="o">&lt;</span><span class="mi">100000</span><span class="p">){</span>
</span><span class='line'>  <span class="nv">$i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$test</span><span class="o">=</span><span class="k">new</span> <span class="nx">test</span><span class="p">();</span>
</span><span class='line'>  <span class="nv">$test</span><span class="o">-&gt;</span><span class="na">var</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span><span class="c1">//大概50ms</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>不使用魔法函数，性能更优化。</p>

<p>PS：</p>

<pre><code>在Linux中可以使用 time php test.php
会输出三个时间，主要关注user为执行时间
</code></pre>

<hr />

<p><strong>产生额外开销的错误抑制符@</strong></p>

<p>情况描述：</p>

<pre><code>@的实际逻辑是在代码开始前结束后增加Opcode 忽略报错。
在@这行前加入Opcode忽略报错，又在这行结束后再加入Opcode，恢复报错。
</code></pre>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="nb">file_get_contents</span><span class="p">(</span><span class="s2">&quot;XXX&quot;</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>用VLD扩展看Opcode代码：</p>

<pre><code>php -dvld.active=1 -dvld.execute=0 at.php //我们只看代码不执行

有三行代码
加上@符号后
有五行代码
</code></pre>

<p>建议不要使用错误抑制符@，
多使用try catch</p>

<hr />

<p><strong>合理使用内存</strong></p>

<p>情况描述：</p>

<pre><code>PHP有内存回收机制保底，但也要小心使用内存。
</code></pre>

<p>利用unset（）及时释放不适用的内存（注：unset（）出现注销不掉的情况）</p>

<hr />

<p><strong>尽量少的使用正则表达式</strong></p>

<p>情况描述：</p>

<pre><code>正则表达式的回溯开销较大。
</code></pre>

<hr />

<p><strong>避免在循环内做运算</strong></p>

<p>情况描述:</p>

<pre><code>循环内的计算式将会被重复计算
</code></pre>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="nv">$str</span><span class="o">=</span><span class="s2">&quot;Hello World!&quot;</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$i</span><span class="o">&lt;</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$str</span><span class="p">);</span><span class="nv">$i</span><span class="o">++</span><span class="p">){</span><span class="c1">//每次循环都会计算这个字符串的长度</span>
</span><span class='line'>      <span class="c1">//do something</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>改进：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="nv">$str</span><span class="o">=</span><span class="s2">&quot;Hello World!&quot;</span>
</span><span class='line'>  <span class="nv">$strlen</span><span class="o">=</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$i</span><span class="o">&lt;</span><span class="nv">$strlen</span><span class="p">;</span><span class="nv">$i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>      <span class="c1">//do something</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<p><strong>减少计算密集型业务</strong></p>

<p>情况描述：</p>

<pre><code>PHP的语言特性决定了PHP不适合密集型运算的场景。
因为PHP是基于C语言的，所以在处理大型运算的时候开销是比C大很多的。
</code></pre>

<p>适合的场景：</p>

<pre><code>衔接Webserver与后端服务，UI呈现。
</code></pre>

<hr />

<p><strong>务必使用带引号字符串做键值</strong></p>

<p>情况描述：</p>

<pre><code>PHP会将没有引号的键值当做常量，产生查找常量的开销。
</code></pre>

<hr />

<h1>三、PHP周边问题的性能优化</h1>

<p><strong>Linux 运行环境</strong></p>

<p><strong>减少文件类的操作</strong></p>

<p>常见PHP场景的开销次序：</p>

<pre><code>读写内存&lt;&lt;读写数据库（数据库有内存缓存）&lt;读写磁盘&lt;读写网络数据（网络延迟）
</code></pre>

<hr />

<p><strong>优化网络请求</strong></p>

<p>可能的问题：
    1. 对方接口的不确定因素
    2. 网络稳定性</p>

<p>优化：</p>

<pre><code>1. 设置超时时间
    连接超时（２００ｍｓ）
    读超时（８００ｍｓ）
    写超时（５００ｍｓ）
２.　串行请求并行化
    使用curl_multi_*() //取决于最长的连接时间所以不推荐
    使用swoole扩展　　
</code></pre>

<hr />

<p><strong>压缩PHP接口输出</strong></p>

<p>使用Gzip压缩即可</p>

<p>优点：</p>

<pre><code>利于我们的数据输出，Client能更快获取数据
</code></pre>

<p>缺点：</p>

<pre><code>产生cpu额外开销
</code></pre>

<p>可以考虑当数据大于多少时再使用压缩来优化。</p>

<hr />

<p><strong>缓存重复计算的内容</strong></p>

<p>什么情况下：</p>

<pre><code>多次请求，内容不变 //使用模板渲染缓存 如smarty 开启caching
</code></pre>

<hr />

<p><strong>重叠时间窗口思想和旁路方案</strong></p>

<pre><code>在几个任务不强依赖前一个任务的输出或者返回时。可以在上一个任务没完成时就执行下一个任务
</code></pre>

<hr />

<h1>四、PHP性能分析</h1>

<p><strong>用XHPorf进行PHP性能问题的具体分析</strong></p>

<p>XHPorf：源自Facebook的PHP性能优化工具
其他工具：</p>

<pre><code>ab -压力测试
vld -opcode 代码分析
</code></pre>

<p><a href="http://www.imooc.com/video/4275">here</a></p>

<h1>五、PHP性能瓶颈究极办法</h1>

<p>Opcode Cache ： PHP扩展APC，memcache</p>

<p>通过PHP扩展代替原PHP代码中高频逻辑</p>

<p>Runtime优化： HHVM</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octpress自定义配置和主题安装]]></title>
    <link href="http://ewanreton.github.io/blog/2016/04/30/config-themes-octpress/"/>
    <updated>2016-04-30T20:57:43+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/04/30/config-themes-octpress</id>
    <content type="html"><![CDATA[<blockquote><p>Octpress 基本配置</p></blockquote>

<!--more-->


<p>在_config.yml文件中。可以直接修改title，author等基本信息。</p>

<pre class="prettyprint linenums">
# ----------------------- #
#      Main Configs       #
# ----------------------- #

url: http://ewanreton.github.io
title: Ewan Reton 
subtitle: Never be touched by yourself
author: Ewan Reton
simple_search: https://www.baidu.com
description: 

# Default date format is "ordinal" (resulting in "July 22nd 2007")
# You can customize the format as defined in
# http://www.ruby-doc.org/core-1.9.2/Time.html#method-i-strftime
# Additionally, %o will give you the ordinal representation of the day
date_format: "ordinal"

# RSS / Email (optional) subscription links (change if using something like Feedburner)
subscribe_rss: /atom.xml
subscribe_email:
# RSS feeds can list your email address if you like
email: liukedi001@gmail.com
</pre>


<p>下一部分的Jekyll &amp; Plugins 在没有对Octpress进行深入了解时不介意修改。
在下一部分的3rd Party Settings   就是一些部件的配置，我们今天主要的内容就是涉及这一块的配置。</p>

<blockquote><p>使用第三方插件</p></blockquote>

<ul>
<li>增加评论功能</li>
<li>增加社会化分享</li>
<li>自定义404页面</li>
<li>自定义导航</li>
<li>安装使用主题</li>
<li>设置链接在新窗口打开</li>
<li>首页文章以摘要形式展示</li>
<li>添加侧边栏文章分类（category）</li>
<li>自动为图片添加url前缀</li>
<li>添加访客统计</li>
</ul>


<blockquote><p>增加评论</p></blockquote>

<pre><code>默认使用discuss，但是由于discuss在国内使用效果不好所以用国内多说来替代
</code></pre>

<ol>
<li>在多说网站注册过后，在工具->获取代码 将这块代码复制。</li>
<li>在配置文件中添加</li>
</ol>


<pre class="prettyprint linenums">
    #duoshuo
    duoshuo_comment = true //开启多说
    在sourse 中 找到_layout post.html
</pre>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="nx">site</span><span class="o">.</span><span class="nx">disqus_short_name</span> <span class="k">and</span> <span class="nx">page</span><span class="o">.</span><span class="nx">comments</span> <span class="o">==</span> <span class="k">true</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">section</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;comment&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">h1</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;title&quot;</span><span class="o">&gt;</span><span class="nx">Comments</span><span class="o">&lt;/</span><span class="nx">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;disqus_thread&quot;</span> <span class="nx">aria</span><span class="o">-</span><span class="nx">live</span><span class="o">=</span><span class="s2">&quot;polite&quot;</span><span class="o">&gt;</span><span class="p">{</span><span class="o">%</span> <span class="k">include</span> <span class="nx">post</span><span class="o">/</span><span class="nx">disqus_thread</span><span class="o">.</span><span class="nx">html</span> <span class="o">%</span><span class="p">}</span><span class="o">&lt;/</span><span class="nx">div</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">section</span><span class="o">&gt;</span>
</span><span class='line'><span class="p">{</span><span class="o">%</span> <span class="k">endif</span> <span class="o">%</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<pre class="prettyprint text">
    将其中的site.disqus_short_name and page.comments改为我们刚刚配置的duoshuo_comment
    并将其中引用的文件disqus_thread.html改为duoshuo_comment.html
    如下：
</pre>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="nx">duoshuo_comment</span> <span class="o">==</span> <span class="k">true</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">section</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;comment&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">h1</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;title&quot;</span><span class="o">&gt;</span><span class="nx">Comments</span><span class="o">&lt;/</span><span class="nx">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;disqus_thread&quot;</span> <span class="nx">aria</span><span class="o">-</span><span class="nx">live</span><span class="o">=</span><span class="s2">&quot;polite&quot;</span><span class="o">&gt;</span><span class="p">{</span><span class="o">%</span> <span class="k">include</span> <span class="nx">post</span><span class="o">/</span><span class="nx">duoshuo_comment</span><span class="o">.</span><span class="nx">html</span> <span class="o">%</span><span class="p">}</span><span class="o">&lt;/</span><span class="nx">div</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">section</span><span class="o">&gt;</span>
</span><span class='line'><span class="p">{</span><span class="o">%</span> <span class="k">endif</span> <span class="o">%</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>并修改duoshuo_comment.html的内容</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- 多说评论框 start --&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;ds-thread&quot;</span> <span class="na">data-thread-key=</span><span class="s">&quot;/blog/2016/04/30/config-themes-octpress&quot;</span> <span class="na">data-title=</span><span class="s">&quot;Octpress自定义配置和主题安装&quot;</span> <span class="na">data-url=</span><span class="s">&quot;http://ewanreton.github.io/blog/2016/04/30/config-themes-octpress/&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class='line'><span class="c">&lt;!-- 多说评论框 end --&gt;</span>
</span><span class='line'><span class="c">&lt;!-- 多说公共JS代码 start (一个网页只需插入一次) --&gt;</span>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">duoshuoQuery</span> <span class="o">=</span> <span class="p">{</span><span class="nx">short_name</span><span class="o">:</span><span class="s2">&quot;ewanreton&quot;</span><span class="p">};</span>
</span><span class='line'>  <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">ds</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">ds</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;text/javascript&#39;</span><span class="p">;</span><span class="nx">ds</span><span class="p">.</span><span class="nx">async</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">ds</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">==</span> <span class="s1">&#39;https:&#39;</span> <span class="o">?</span> <span class="s1">&#39;https:&#39;</span> <span class="o">:</span> <span class="s1">&#39;http:&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;//static.duoshuo.com/embed.js&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">ds</span><span class="p">.</span><span class="nx">charset</span> <span class="o">=</span> <span class="s1">&#39;UTF-8&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>       <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]).</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">ds</span><span class="p">);</span>
</span><span class='line'>  <span class="p">})();</span>
</span><span class='line'>  <span class="nt">&lt;/script&gt;</span>
</span><span class='line'><span class="c">&lt;!-- 多说公共JS代码 end --&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>社会化分享</p></blockquote>

<p>同上一样，先在_config.yml中添加</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1">#jiashare</span>
</span><span class='line'><span class="nx">jia_share</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>打开source->_include->post->sharing.html</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;</span><span class="nx">div</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;sharing&quot;</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="nx">site</span><span class="o">.</span><span class="nx">facebook_like</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;addthis_button_facebook_like&quot;</span> <span class="nx">fb</span><span class="o">:</span><span class="nx">like</span><span class="o">:</span><span class="nx">layout</span><span class="o">=</span><span class="s2">&quot;button_count&quot;</span><span class="o">&gt;&lt;/</span><span class="nx">a</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="p">{</span><span class="o">%</span> <span class="k">endif</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'>  <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="nx">site</span><span class="o">.</span><span class="nx">twitter_tweet_button</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;addthis_button_tweet&quot;</span><span class="o">&gt;&lt;/</span><span class="nx">a</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="p">{</span><span class="o">%</span> <span class="k">endif</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'>  <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="nx">site</span><span class="o">.</span><span class="nx">google_plus_one</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;addthis_button_google_plusone&quot;</span> <span class="nx">g</span><span class="o">:</span><span class="nx">plusone</span><span class="o">:</span><span class="nx">size</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="o">&gt;&lt;/</span><span class="nx">a</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="p">{</span><span class="o">%</span> <span class="k">endif</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'>  
</span><span class='line'><span class="o">&lt;/</span><span class="nx">div</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>添加代码。如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;</span><span class="nx">div</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;sharing&quot;</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="nx">site</span><span class="o">.</span><span class="nx">facebook_like</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;addthis_button_facebook_like&quot;</span> <span class="nx">fb</span><span class="o">:</span><span class="nx">like</span><span class="o">:</span><span class="nx">layout</span><span class="o">=</span><span class="s2">&quot;button_count&quot;</span><span class="o">&gt;&lt;/</span><span class="nx">a</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="p">{</span><span class="o">%</span> <span class="k">endif</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'>  <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="nx">site</span><span class="o">.</span><span class="nx">twitter_tweet_button</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;addthis_button_tweet&quot;</span><span class="o">&gt;&lt;/</span><span class="nx">a</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="p">{</span><span class="o">%</span> <span class="k">endif</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'>  <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="nx">site</span><span class="o">.</span><span class="nx">google_plus_one</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;addthis_button_google_plusone&quot;</span> <span class="nx">g</span><span class="o">:</span><span class="nx">plusone</span><span class="o">:</span><span class="nx">size</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="o">&gt;&lt;/</span><span class="nx">a</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="p">{</span><span class="o">%</span> <span class="k">endif</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'>  <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="nx">site</span><span class="o">.</span><span class="nx">jia_share</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'>  <span class="p">{</span><span class="o">%</span> <span class="k">include</span> <span class="nx">post</span><span class="o">/</span><span class="nx">jia_share</span><span class="o">.</span><span class="nx">html</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'>  <span class="p">{</span><span class="o">%</span> <span class="k">endif</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">div</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>并创建jia_share.html</p>

<figure class='code'><figcaption><span>这段代码在jiathis网站获取</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- JiaThis Button BEGIN --&gt;</span>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;jiathis_style_32x32&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;jiathis_button_qzone&quot;</span><span class="nt">&gt;&lt;/a&gt;</span>
</span><span class='line'><span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;jiathis_button_tsina&quot;</span><span class="nt">&gt;&lt;/a&gt;</span>
</span><span class='line'><span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;jiathis_button_tqq&quot;</span><span class="nt">&gt;&lt;/a&gt;</span>
</span><span class='line'><span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;jiathis_button_weixin&quot;</span><span class="nt">&gt;&lt;/a&gt;</span>
</span><span class='line'><span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;jiathis_button_renren&quot;</span><span class="nt">&gt;&lt;/a&gt;</span>
</span><span class='line'><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://www.jiathis.com/share&quot;</span> <span class="na">class=</span><span class="s">&quot;jiathis jiathis_txt jtico jtico_jiathis&quot;</span> <span class="na">target=</span><span class="s">&quot;_blank&quot;</span><span class="nt">&gt;&lt;/a&gt;</span>
</span><span class='line'><span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;jiathis_counter_style&quot;</span><span class="nt">&gt;&lt;/a&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;http://v3.jiathis.com/code/jia.js&quot;</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="c">&lt;!-- JiaThis Button END --&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>自定义404页面</p></blockquote>

<p>直接打开source下的404.markdown进行编辑即可</p>

<blockquote><p>自定义导航</p></blockquote>

<p>新建一个页面 rake new_page[&lsquo;about me&rsquo;];</p>

<p>在source->_inlcude->custom->navigation.html</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="o">&gt;</span><span class="nx">Blog</span><span class="o">&lt;/</span><span class="nx">a</span><span class="o">&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;/blog/archives&quot;</span><span class="o">&gt;</span><span class="nx">Archives</span><span class="o">&lt;/</span><span class="nx">a</span><span class="o">&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">ul</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>添加代码如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="o">&gt;</span><span class="nx">Blog</span><span class="o">&lt;/</span><span class="nx">a</span><span class="o">&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;/blog/archives&quot;</span><span class="o">&gt;</span><span class="nx">Archives</span><span class="o">&lt;/</span><span class="nx">a</span><span class="o">&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;/aboutme&quot;</span><span class="o">&gt;</span><span class="nx">About</span> <span class="nx">Me</span><span class="o">&lt;/</span><span class="nx">a</span><span class="o">&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">ul</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>安装使用主题</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'> <span class="nx">到GitHub上找主题文件</span>
</span><span class='line'> <span class="nx">git</span> <span class="k">clone</span> <span class="nx">git：</span><span class="c1">//github.com/tommy351/Octopress-Theme-Slash.git .themes/slash //会在theme主题下生成对应名称的文件夹</span>
</span><span class='line'> <span class="nx">rake</span> <span class="nx">install</span> <span class="p">[</span><span class="s1">&#39;主题名称&#39;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>注意：</strong>
    在上面安装主题前记得备份，因为安装主题过后你之前配置的信息都会被重置（如评论和分享）</p>

<hr />

<blockquote><p>设置链接在新窗口打开</p></blockquote>

<p>在博文中，如果点击链接直接在本窗口打开了，那么用户体验就不是很好。而markdown的标准语法是不支持链接在新窗口打开的，虽然可以通过在markdown中直接写html标签来解决这个问题，但是这与markdown的简洁书写特性不符。但是我们可以通过设置Octopress来达到这种效果，即在 \source_includes\custom\head.html 文件中添加如下一段代码</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="n">function</span> <span class="nf">addBlankTargetForLinks</span> <span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">$</span><span class="o">(</span><span class="err">&#39;</span><span class="n">a</span><span class="o">[</span><span class="n">href</span><span class="o">^=</span><span class="s">&quot;http&quot;</span><span class="o">]</span><span class="err">&#39;</span><span class="o">).</span><span class="na">each</span><span class="o">(</span><span class="n">function</span><span class="o">(){</span>
</span><span class='line'>      <span class="n">$</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">attr</span><span class="o">(</span><span class="err">&#39;</span><span class="n">target</span><span class="err">&#39;</span><span class="o">,</span> <span class="err">&#39;</span><span class="n">_blank</span><span class="err">&#39;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">});</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="n">$</span><span class="o">(</span><span class="n">document</span><span class="o">).</span><span class="na">bind</span><span class="o">(</span><span class="err">&#39;</span><span class="n">DOMNodeInserted</span><span class="err">&#39;</span><span class="o">,</span> <span class="n">function</span><span class="o">(</span><span class="n">event</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">addBlankTargetForLinks</span><span class="o">();</span>
</span><span class='line'>  <span class="o">});</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>首页文章以摘要形式展示</p></blockquote>

<ol>
<li><p>在文章对应的markdown文件中，在需要显示在首页的文字后面添加 <!--more--> ，执行<code>rake generate</code>后在首页上会看到只显示&lt;!—more—>前面的文字，文字后面会显示 <code>Read on</code> 链接，点击后进入文字的详细页面;</p></li>
<li><p>如果想将Read on修改为中文，可以修改_config.yml文件</p></li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">excerpt_link</span><span class="o">:</span> <span class="s2">&quot;Read on →&quot;</span>  <span class="c1"># &quot;Continue reading&quot; link text at the bottom of excerpted articles</span>
</span><span class='line'><span class="nx">修改为：</span>
</span><span class='line'><span class="nx">excerpt_link</span><span class="o">:</span> <span class="s2">&quot;阅读全文→&quot;</span>  <span class="c1"># &quot;Continue reading&quot; link text at the bottom of excerpted articles</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>添加侧边栏文章分类（category）</p></blockquote>

<ol>
<li>在 plugins 目录下创建 category_list_tag.rb 文件，内容如下：</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">module</span> <span class="nx">Jekyll</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">CategoryListTag</span> <span class="o">&lt;</span> <span class="nx">Liquid</span><span class="o">::</span><span class="na">Tag</span>
</span><span class='line'>    <span class="nx">def</span> <span class="nx">render</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span>
</span><span class='line'>      <span class="nx">html</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>      <span class="nx">categories</span> <span class="o">=</span> <span class="nx">context</span><span class="o">.</span><span class="nx">registers</span><span class="p">[</span><span class="o">:</span><span class="nx">site</span><span class="p">]</span><span class="o">.</span><span class="nx">categories</span><span class="o">.</span><span class="nx">keys</span>
</span><span class='line'>      <span class="nx">categories</span><span class="o">.</span><span class="nb">sort</span><span class="o">.</span><span class="nb">each</span> <span class="k">do</span> <span class="o">|</span><span class="nx">category</span><span class="o">|</span>
</span><span class='line'>        <span class="nx">posts_in_category</span> <span class="o">=</span> <span class="nx">context</span><span class="o">.</span><span class="nx">registers</span><span class="p">[</span><span class="o">:</span><span class="nx">site</span><span class="p">]</span><span class="o">.</span><span class="nx">categories</span><span class="p">[</span><span class="nx">category</span><span class="p">]</span><span class="o">.</span><span class="nx">size</span>
</span><span class='line'>        <span class="nx">category_dir</span> <span class="o">=</span> <span class="nx">context</span><span class="o">.</span><span class="nx">registers</span><span class="p">[</span><span class="o">:</span><span class="nx">site</span><span class="p">]</span><span class="o">.</span><span class="nx">config</span><span class="p">[</span><span class="s1">&#39;category_dir&#39;</span><span class="p">]</span>
</span><span class='line'>        <span class="nx">category_url</span> <span class="o">=</span> <span class="nx">File</span><span class="o">.</span><span class="nb">join</span><span class="p">(</span><span class="nx">category_dir</span><span class="p">,</span> <span class="nx">category</span><span class="o">.</span><span class="nx">gsub</span><span class="p">(</span><span class="o">/</span><span class="nx">_</span><span class="o">|</span><span class="nx">\P</span><span class="p">{</span><span class="nx">Word</span><span class="p">}</span><span class="o">/</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="nx">gsub</span><span class="p">(</span><span class="o">/-</span><span class="p">{</span><span class="mi">2</span><span class="p">,}</span><span class="o">/</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="nx">downcase</span><span class="p">)</span>
</span><span class='line'>        <span class="nx">html</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;&lt;li class=&#39;category&#39;&gt;&lt;a href=&#39;/#{category_url}/&#39;&gt;#{category} (#{posts_in_category})&lt;/a&gt;&lt;/li&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span class='line'>      <span class="nb">end</span>
</span><span class='line'>      <span class="nx">html</span>
</span><span class='line'>    <span class="nb">end</span>
</span><span class='line'>  <span class="nb">end</span>
</span><span class='line'><span class="nb">end</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Liquid</span><span class="o">::</span><span class="na">Template</span><span class="o">.</span><span class="nx">register_tag</span><span class="p">(</span><span class="s1">&#39;category_list&#39;</span><span class="p">,</span> <span class="nx">Jekyll</span><span class="o">::</span><span class="na">CategoryListTag</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>添加 source/_includes/asides/category_list.html 文件，内容如下：</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;</span><span class="n">section</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">文章分类</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">ul</span> <span class="n">id</span><span class="o">=</span><span class="s">&quot;categories&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="err">\</span><span class="o">{</span><span class="err">\</span><span class="o">%</span> <span class="n">category_list</span> <span class="err">\</span><span class="o">%</span><span class="err">\</span><span class="o">}</span> <span class="c1">//去掉\</span>
</span><span class='line'>  <span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">section</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>修改 _config.yml 文件，在 default_asides 项中添加 asides/category_list.html ，值之间以逗号隔开，值的先后顺序代表了侧边栏展现的先后顺序。</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nl">default_asides:</span> <span class="o">[</span><span class="n">asides</span><span class="o">/</span><span class="n">category_list</span><span class="o">.</span><span class="na">html</span><span class="o">,</span> <span class="n">asides</span><span class="o">/</span><span class="n">recent_posts</span><span class="o">.</span><span class="na">html</span><span class="o">,</span> <span class="n">asides</span><span class="o">/</span><span class="n">github</span><span class="o">.</span><span class="na">html</span><span class="o">,</span> <span class="n">asides</span><span class="o">/</span><span class="n">delicious</span><span class="o">.</span><span class="na">html</span><span class="o">,</span> <span class="n">asides</span><span class="o">/</span><span class="n">pinboard</span><span class="o">.</span><span class="na">html</span><span class="o">,</span> <span class="n">asides</span><span class="o">/</span><span class="n">googleplus</span><span class="o">.</span><span class="na">html</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>自动为图片添加url前缀</p></blockquote>

<p>把图片资源放在了七牛云存储 上，写博客时候就是用七牛的外链。但是这样有几个问题：</p>

<ul>
<li>每次写博客插入图片外链地址时候都很麻烦，需要给每张图片都添加七牛外链地址url前缀；</li>
<li>如果以后更换了存储，那就麻烦了，需要依次编辑替换每个图片的url前缀
现在我们就使用一种灵活的方式来配置并自动生成图片的URL前缀：</li>
</ul>


<p>首先修改 /plugins/image_tag.rb 文件，在 @img[&lsquo;class&rsquo;].gsub!(/&ldquo;/, &lsquo;&rsquo;) if @img[&lsquo;class&rsquo;] 后添加下面一行代码：</p>

<figure class='code'><figcaption><span>./plugins/image_tag.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">@</span><span class="nx">img</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Jekyll</span><span class="o">.</span><span class="nx">configuration</span><span class="p">({})[</span><span class="s1">&#39;static_file_prefix&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="o">@</span><span class="nx">img</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="o">@</span><span class="nx">img</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后再修改根目录下的 <code>_config.yml</code> 文件，添加如下配置：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1"># Add url prefix for image automatically</span>
</span><span class='line'><span class="nx">static_file_prefix</span><span class="o">:</span> <span class="nx">http</span><span class="o">://</span><span class="mi">7</span><span class="nx">u2i08</span><span class="o">.</span><span class="nx">com1</span><span class="o">.</span><span class="nx">z0</span><span class="o">.</span><span class="nx">glb</span><span class="o">.</span><span class="nx">clouddn</span><span class="o">.</span><span class="nx">com</span>
</span></code></pre></td></tr></table></div></figure>


<p>最后我们在插入图片的时候要记住不能再使用Markdown语法来写了，要使用Ocotpress自定义的IMG标签来插入图片 。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="p">{</span><span class="o">%</span> <span class="nx">img</span> <span class="nx">http</span><span class="o">://</span><span class="nx">placekitten</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="mi">890</span><span class="o">/</span><span class="mi">280</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'><span class="p">{</span><span class="o">%</span> <span class="nx">img</span> <span class="nx">left</span> <span class="nx">http</span><span class="o">://</span><span class="nx">placekitten</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="mi">320</span><span class="o">/</span><span class="mi">250</span> <span class="nx">Place</span> <span class="nx">Kitten</span> <span class="c1">#2 %}</span>
</span><span class='line'><span class="p">{</span><span class="o">%</span> <span class="nx">img</span> <span class="nx">right</span> <span class="nx">http</span><span class="o">://</span><span class="nx">placekitten</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="mi">300</span><span class="o">/</span><span class="mi">500</span> <span class="mi">150</span> <span class="mi">250</span> <span class="nx">Place</span> <span class="nx">Kitten</span> <span class="c1">#3 %}</span>
</span><span class='line'><span class="p">{</span><span class="o">%</span> <span class="nx">img</span> <span class="nx">right</span> <span class="nx">http</span><span class="o">://</span><span class="nx">placekitten</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="mi">300</span><span class="o">/</span><span class="mi">500</span> <span class="mi">150</span> <span class="mi">250</span> <span class="s1">&#39;Place Kitten #4&#39;</span> <span class="s1">&#39;An image of a very cute kitten&#39;</span> <span class="o">%</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>本地预览先generate后preview，这样一来插入图片就灵活方便多了。</p>

<blockquote><p>添加访客统计</p></blockquote>

<p>本博客的访客统计系统使用的是Flag Counter，所以要 先去Flag Counter获取代码 。</p>

<p>拿到代码后添加<code>.\source\_includes\custom\asides\flag_counter.html</code> 文件：</p>

<figure class='code'><figcaption><span>flag_counter.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;</span><span class="n">section</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">访客统计</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">br</span><span class="o">/&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">&quot;http://s07.flagcounter.com/more/2SH&quot;</span><span class="o">&gt;&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="s">&quot;http://s07.flagcounter.com/count/2SH/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_1/flags_0/&quot;</span> <span class="n">alt</span><span class="o">=</span><span class="s">&quot;Flag Counter&quot;</span> <span class="n">border</span><span class="o">=</span><span class="s">&quot;0&quot;</span><span class="o">&gt;&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">section</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>将页面添加到侧边栏，在 ./_config.yml 配置文件中添加下面一行配置：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">default_asides</span><span class="o">:</span> <span class="p">[</span><span class="nx">……</span><span class="p">,</span> <span class="nx">custom</span><span class="o">/</span><span class="nx">asides</span><span class="o">/</span><span class="nx">flag_counter</span><span class="o">.</span><span class="nx">html</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>最后添加控制开关，在 ./_config.yml 配置文件中添加下面一行配置：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1"># Flag Counter</span>
</span><span class='line'><span class="nx">flag_counter</span><span class="o">:</span> <span class="k">true</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octopress代码高亮问题（Windows10）]]></title>
    <link href="http://ewanreton.github.io/blog/2016/04/30/octopress-code-highlight/"/>
    <updated>2016-04-30T00:57:01+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/04/30/octopress-code-highlight</id>
    <content type="html"><![CDATA[<blockquote><p>首先我要用祭出一段代码。。</p></blockquote>

<!--more-->


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;Octopress 的代码高亮真的真的有坑！！！&quot;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>之前在写博客的时候就有发现，我的用markdown语法写出来的代码好像是和别人的不一样。后来发现是我的代码没有用高亮。人家也是一个有追求的PHPer（尴尬脸）。我就查markdown语法啊。
语法是这样给我说的</p>

<p><strong>markdown 语法实现代码高亮有两种方法</strong></p>

<pre><code>1  ```[language] [title] [url] [link text]
     code snippet
   ```
2 {\% codeblock [title] [lang:language] [url] [link text] \%}
    code snippet
{\% endcodeblock \%}
</code></pre>

<p>唉，原来这么简单。改代码走起->rake generate ->reke deploy</p>

<p>去看看我可爱的带颜色的代码呢。</p>

<p>！！！！！
为什么我的博客一片空白了！！！</p>

<p>然后我去度娘，去google。。</p>

<p>终于找到跟我一样懵逼的小伙伴<a href="http://www.tuicool.com/articles/myqIba">戳过去同情他</a></p>

<hr />

<blockquote><p>按照这个小伙伴的思路我开始装Python</p></blockquote>

<p>我装的是<a href="https://www.python.org/downloads/release/python-2711/">Python2.7.11</a> 选择 Windows x86-64 MSI installer下载。然后一直下一步安装。</p>

<blockquote><p>安装完成后添加环境变量
<a href="http://www.blogjava.net/lishunli/archive/2012/03/18/372115.html">这个博客可以参考</a>
鼠标右击我的电脑，选择属性，再选择高级系统设置，右下角有一个环境变量，点进去</p></blockquote>

<p><img src="https://pic1.zhimg.com/6afe9ded178646e6c71e0c3fd908bdb8_b.jpg" alt="1" /></p>

<p>找到path项，选择编辑，把你的Python安装路径(如：C:\Python27)输入进去，注意要用一个 ; 符号与前面的路径分开，再点确定就可以了。完事后可以运行cmd，输入python，如下显示就是成功了
<img src="https://pic4.zhimg.com/7c56fca865253473857066067a0c053b_b.jpg" alt="2" /></p>

<blockquote><p>这个时候突然发现了另一篇博文</p></blockquote>

<p>这个博文看起来要简单点<a href="http://www.cnblogs.com/oec2003/archive/2013/05/27/3100896.html">传送门</a></p>

<blockquote><p>按照下一篇博文的方法</p></blockquote>

<pre class="prettyprint linenums">
安装Python
安装Python,也是一路next就可以，博客的代码高亮用到了Python的Pygments模块，在Python中安装第三方库需要使用easy_install，在下面地址下载跟Python相对应的安装程序安装后就可以使用easy_install了。

https://pypi.python.org/pypi/setuptools
easy_install会安装在Python安装目录的Scripts目录中，例如我的Python目录是C:\Python27，所以需要将C:\Python27\Scripts目录加入到环境变量中才能在命令提示符中使用easy_install命令。

在命令提示符中输入如下命令就可以安装Pygments了。

easy_install pygments
</pre>


<p><a href="https://pypi.python.org/pypi/setuptools">https://pypi.python.org/pypi/setuptools</a>去找到Windows (simplified)又懵逼了。它给了一段代码需要自己编译运行<a href="https://bootstrap.pypa.io/ez_setup.py">ez_setup.py</a>新建文本文档将网页上的代码全部粘贴下来，保存重命名为ez_setup.py</p>

<pre class="prettyprint linenums">
 Win+R
 cmd
 进到你刚刚保存的那文件的路径
 python ez_setup.py //安装easy_install
 等到安装完成过后
 将C:\Python27\Scripts目录加入到环境变量中前面的C:\Python27\和你之前添加的Python的环境变量一样
 easy_install pygments
 等到这一步完成后，基本就算大工告成了
</pre>


<p> 如果你还是出现相同问题的话，那请找网管重启机器。</p>

<hr />

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="k">echo</span><span class="s2">&quot;不出意外的话你的问题也应该解决了。</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="k">echo</span><span class="s2">&quot;你看我是不是一段有颜色的代码啊！&quot;</span><span class="p">;</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h1>后记</h1>

<blockquote><p>在解决上述问题的过程中，了解到另一种代码高亮的方法</p></blockquote>

<p><a href="http://jingyan.baidu.com/article/67508eb4e660ed9cca1ce4ec.html">请戳这里</a></p>

<p>使用google-code-prettify可以用来很方便地对网页中的程序代码进行高亮显示,从而在视觉上使得网页上的代码看得比较舒服,这对网站站长来说是很重要的。</p>

<p>有两种方法来启用google-code-prettify,下面简要介绍一下步骤。</p>

<blockquote><p>方法一</p></blockquote>

<p>(1) 从<a href="https://code.google.com/p/google-code-prettify/downloads/list%E4%B8%AD%E4%B8%8B%E8%BD%BD%E6%88%96%E8%80%85%E4%BB%8Ehttp://www.colafile.com/file/145953">https://code.google.com/p/google-code-prettify/downloads/list%E4%B8%AD%E4%B8%8B%E8%BD%BD%E6%88%96%E8%80%85%E4%BB%8Ehttp://www.colafile.com/file/145953</a> 中打包下载pretty.css以及pretty.js,并保存到本地服务器的相应目录中来引用</p>

<p>(2) 引用pretty.css以及pretty.js,然后在网页中引用,引用方法为</p>

<pre><code>&lt;link href="你保存的目录/prettify.css" type="text/css" rel="stylesheet" /&gt;

&lt;script type="text/javascript" src="你保存的目录/prettify.js"&gt;&lt;/script&gt;
</code></pre>

<p>(3)</p>

<pre><code>&lt;body&gt;标签改为&lt;body onload="prettyPrint()"&gt;
</code></pre>

<p>(4) 将源代码用标签</p>

<pre><code>&lt;pre class="prettyprint linenums"&gt;这是你的代码&lt;/pre&gt;
</code></pre>

<p>包含起来,例如</p>

<pre><code>&lt;pre class="prettyprint linenums"&gt;

#include "x.h"

main(){

 print("hello world!");

}

&lt;/pre&gt;
</code></pre>

<p>相应的显示效果为:</p>

<h2><img src="http://hiphotos.baidu.com/exp/pic/item/0fb505d5ad6eddc4ef4d78d73bdbb6fd52663331.jpg" alt="3" /></h2>

<blockquote><p>方法二</p></blockquote>

<p>(1) 到网址 <a href="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js">https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js</a> 中或者从<a href="http://www.colafile.com/file/145957">http://www.colafile.com/file/145957</a> 下载run_prettify.js文件</p>

<p>(2) 引用run_prettify.js文件,方法为</p>

<pre><code>&lt;script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"&gt;&lt;/script&gt;
</code></pre>

<p>或者</p>

<pre><code>&lt;script src="你保存的目录/run_prettify.js"&gt;&lt;/script&gt;
</code></pre>

<p>(3) 将源代码用标签</p>

<pre><code>&lt;pre class="prettyprint"&gt;这是你的代码&lt;/pre&gt;
</code></pre>

<p>包含起来,例如</p>

<pre><code>&lt;pre class="prettyprint"&gt;

#include "x.h"

main(){

    print("hello world!");

}

&lt;/pre&gt;
</code></pre>

<p>相应的显示效果为:</p>

<p><img src="http://hiphotos.baidu.com/exp/pic/item/72ccb7773912b31b40ea01058418367adbb4e1de.jpg" alt="4" /></p>

<p>如果你有更高的使用要求，可以到<a href="https://code.google.com/p/google-code-prettify/wiki/GettingStarted">https://code.google.com/p/google-code-prettify/wiki/GettingStarted</a>这个网页中看更高级的使用方法</p>

<hr />

<p>5/17/2016 8:28:40 PM  更新</p>

<blockquote><p>设置显示行号</p></blockquote>

<p><pre class="prettyprint linenums">
1、删掉prettify里的这两个样式。<br/>
li.L0,li.L1,li.L2,li.L3,li.L5,li.L6,li.L7,li.L8{list-style-type:none}li.L1,li.L3,li.L5,li.L7,li.L9{background:#eee}</p>

<p>2、替换以下内容，已经存在的替换，不存在的新增。<br/>
pre.prettyprint {<br/>
 padding: 8px;<br/>
 background-color: #f7f7f9;<br/>
 border: 1px solid #e1e1e8;<br/>
}<br/>
.prettyprint.linenums {<br/>
 -webkit-box-shadow: inset 40px 0 0 #fbfbfc, inset 41px 0 0 #ececf0;<br/>
 -moz-box-shadow: inset 40px 0 0 #fbfbfc, inset 41px 0 0 #ececf0;<br/>
 box-shadow: inset 40px 0 0 #fbfbfc, inset 41px 0 0 #ececf0;<br/>
}</p>

<p>/<em> Specify class=linenums on a pre to get line numbering </em>/<br/>
ol.linenums {<br/>
 margin: 0 0 0 33px; /<em> IE indents via margin-left </em>/<br/>
} <br/>
ol.linenums li {<br/>
 padding-left: 12px;<br/>
 color: #bebec5;<br/>
 line-height: 18px;<br/>
 text-shadow: 0 1px 0 #fff;<br/>
}<br/>
3、在<pre>标签里面一定不能有<br/>标签,要换行直接回车.<br/>
</pre></p>

<hr />

<h1>但是</h1>

<p>这种方法在使用过程中，当是PHP代码时：如</p>

<pre><code>&lt;pre class="prettyprint php"&gt;
    &lt;?php
        echo "test!";
    ?&gt;
&lt;/pre&gt;
</code></pre>

<p>这样在实际的显示过程中只有块黑色的代码块，代码并没解析出来。</p>

<p>改成如下格式就能正常实现代码高亮效果。</p>

<pre><code>    &lt;pre class="prettyprint php"&gt;
        //去掉了PHP的开始和结束符
        echo "test!";

    &lt;/pre&gt;
</code></pre>

<p>我没有去具体研究这个原理，不过我推测是因为PHP的开始副 &lt;?  和pre的开始结束符产生了混乱不能正确匹配，从而导致解析失败。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[解决 Octopress 警告 Layout Nil Requested]]></title>
    <link href="http://ewanreton.github.io/blog/2016/04/29/fix-octopress-build-warning-layout-nil-requested/"/>
    <updated>2016-04-29T23:08:07+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/04/29/fix-octopress-build-warning-layout-nil-requested</id>
    <content type="html"><![CDATA[<blockquote><p>给Octopress换了主题过后重新generate会出警告Layout Nil Requested。</p></blockquote>

<!--more-->


<p>主要原因是对于 nill 值无法判断导致的问题，只要将有出现错误的档案將 nill 改成 null 即可</p>

<p>Fix this error by replacing from file:</p>

<blockquote><p>layout: nil</p></blockquote>

<p>with:</p>

<blockquote><p>layout: null</p></blockquote>

<p>in files:</p>

<ul>
<li>source/atom.xml</li>
<li>source/_includes/custom/category_feed.xml</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PHP高性能日志SeasLog]]></title>
    <link href="http://ewanreton.github.io/blog/2016/04/29/php-seaslog/"/>
    <updated>2016-04-29T09:59:55+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/04/29/php-seaslog</id>
    <content type="html"><![CDATA[<blockquote><p>PHP高性能日志SeasLog</p></blockquote>

<h1>一、什么是SeasLog</h1>

<p>SeasLog是一个C语言编写的PHP扩展，提供一组规范标准的功能函数，在PHP项目中方便、规范、高效地写日志，以及快速地读取和查询日志。</p>

<!--more-->


<h1>二、为什么需要日志系统</h1>

<ol>
<li>了解系统运行情况</li>
<li>记录用户操作信息</li>
<li>收集需要</li>
</ol>


<h1>三、为什么选择SeasLog</h1>

<ol>
<li>高性能 带有缓冲池功能。</li>
<li>无需配置</li>
<li>功能完善，使用简单

<h1>四、SeasLog安装</h1>

<p> 到<a href="http://pecl.php.net/">pecl</a>搜索seaslog并下载
 解压后
 可自行编译。</p></li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd seaslog //进到解压目录
</span><span class='line'>$ phpize
</span><span class='line'>$ ./configure --with-php-config=/path/to/php-config //path to 为你的PHP安装目录
</span><span class='line'>$ make && make install
</span><span class='line'>当然，使用PECL管理工具会更方便：
</span><span class='line'>$ pecl install seaslog</span></code></pre></td></tr></table></div></figure>


<h2>seaslog.ini的配置</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>; configuration for php SeasLog module 
</span><span class='line'>extension = seaslog.so 
</span><span class='line'>seaslog.default_basepath = /log/seaslog-test    ;默认log根目录 
</span><span class='line'>seaslog.default_logger = default                ;默认logger目录 
</span><span class='line'>seaslog.disting_type = 1                            ;是否以type分文件 1是 0否(默认) 
</span><span class='line'>seaslog.disting_by_hour = 1                      ;是否每小时划分一个文件 1是 0否(默认) 
</span><span class='line'>seaslog.use_buffer = 1                              ;是否启用buffer 1是 0否(默认) 
</span><span class='line'>seaslog.buffer_size = 100                         ;buffer中缓冲数量 默认0(不使用buffer_size) 
</span><span class='line'>seaslog.level = 0                                       ;记录日志级别 默认0(所有日志)</span></code></pre></td></tr></table></div></figure>


<p><strong>需要将这里面的数据写到php.ini中去</strong></p>

<pre><code>seaslog.disting_type = 1 开启以type分文件，即log文件区分info\warn\erro
seaslog.disting_by_hour = 1 开启每小时划分一个文件
seaslog.use_buffer = 1 开启buffer。默认关闭。当开启此项时，日志预存于内存，当请求结束时(或异常退出时)一次写入文件。
seaslog.buffer_size = 100 设置缓冲数量为100. 默认为0,即无缓冲数量限制.当buffer_size大于0时,缓冲量达到该值则写一次文件.
seaslog.level = 3 记录的日志级别.默认为0,即所有日志均记录。当level为1时,关注debug以上级别(包括debug)，以此类推。level大于8时，所有日志均不记录。
</code></pre>

<h2>默认常量有哪些</h2>

<p>遵循PSR-3标准，SeasLog 共将日志分成8个级别</p>

<pre><code>SEASLOG_DEBUG "debug"
SEASLOG_INFO "info"
SEASLOG_NOTICE "notice"
SEASLOG_WARNING "warning"
SEASLOG_ERROR "error"
SEASLOG_CRITICAL "critical"
SEASLOG_ALERT "alert"
SEASLOG_EMERGENCY "emergency"
</code></pre>

<h2>都提供哪些方法</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>&lt;?php 
</span><span class='line'>/** 
</span><span class='line'> * @author neeke@php.net 云智慧 
</span><span class='line'> */ 
</span><span class='line'> 
</span><span class='line'>class SeasLog 
</span><span class='line'>{ 
</span><span class='line'>    public function __construct() 
</span><span class='line'>    { 
</span><span class='line'>        #SeasLog init 
</span><span class='line'>    } 
</span><span class='line'> 
</span><span class='line'>    public function __destruct() 
</span><span class='line'>    { 
</span><span class='line'>        #SeasLog distroy 
</span><span class='line'>    } 
</span><span class='line'> 
</span><span class='line'>    /** 
</span><span class='line'>     * 设置basePath 
</span><span class='line'>     * @param $basePath 
</span><span class='line'>     * @return bool 
</span><span class='line'>     */ 
</span><span class='line'>    static public function setBasePath($basePath) 
</span><span class='line'>    { 
</span><span class='line'>        return TRUE; 
</span><span class='line'>    } 
</span><span class='line'> 
</span><span class='line'>    /** 
</span><span class='line'>     * 获取basePath 
</span><span class='line'>     * @return string 
</span><span class='line'>     */ 
</span><span class='line'>    static public function getBasePath() 
</span><span class='line'>    { 
</span><span class='line'>        return 'the base_path'; 
</span><span class='line'>    } 
</span><span class='line'> 
</span><span class='line'>    /** 
</span><span class='line'>     * 设置模块目录 
</span><span class='line'>     * @param $module 
</span><span class='line'>     * @return bool 
</span><span class='line'>     */ 
</span><span class='line'>    static public function setLogger($module) 
</span><span class='line'>    { 
</span><span class='line'>        return TRUE; 
</span><span class='line'>    } 
</span><span class='line'> 
</span><span class='line'>    /** 
</span><span class='line'>     * 获取最后一次设置的模块目录 
</span><span class='line'>     * @return string 
</span><span class='line'>     */ 
</span><span class='line'>    static public function getLastLogger() 
</span><span class='line'>    { 
</span><span class='line'>        return 'the lastLogger'; 
</span><span class='line'>    } 
</span><span class='line'> 
</span><span class='line'>    /** 
</span><span class='line'>     * 统计所有类型（或单个类型）行数 
</span><span class='line'>     * @param string $level 
</span><span class='line'>     * @param string $log_path 
</span><span class='line'>     * @param null $key_word 
</span><span class='line'>     * @return array | long 
</span><span class='line'>     */ 
</span><span class='line'>    static public function analyzerCount($level = 'all',$log_path = '*',$key_word = NULL) 
</span><span class='line'>    { 
</span><span class='line'>        return array(); 
</span><span class='line'>    } 
</span><span class='line'> 
</span><span class='line'>    /** 
</span><span class='line'>     * 以数组形式，快速取出某类型log的各行详情 
</span><span class='line'>     * @param $level 
</span><span class='line'>     * @param string $log_path 
</span><span class='line'>     * @param null $key_word 
</span><span class='line'>     * @param int $start 
</span><span class='line'>     * @param int $limit 
</span><span class='line'>     * @return array 
</span><span class='line'>     */ 
</span><span class='line'>    static public function analyzerDetail($level = SEASLOG_INFO,$log_path = '*',$key_word = NULL, $start = 1,$limit = 20) 
</span><span class='line'>    { 
</span><span class='line'>        return array(); 
</span><span class='line'>    } 
</span><span class='line'> 
</span><span class='line'>    /** 
</span><span class='line'>     * 获得当前日志buffer中的内容 
</span><span class='line'>     * @return array 
</span><span class='line'>     */ 
</span><span class='line'>    static public function getBuffer() 
</span><span class='line'>    { 
</span><span class='line'>        return array(); 
</span><span class='line'>    } 
</span><span class='line'> 
</span><span class='line'>    /** 
</span><span class='line'>     * 记录debug日志 
</span><span class='line'>     * @param $message 
</span><span class='line'>     * @param array $content 
</span><span class='line'>     * @param string $module 
</span><span class='line'>     */ 
</span><span class='line'>    static public function debug($message,array $content = array(),$module = '') 
</span><span class='line'>    { 
</span><span class='line'>        #$level = SEASLOG_DEBUG 
</span><span class='line'>    } 
</span><span class='line'> 
</span><span class='line'>    /** 
</span><span class='line'>     * 记录info日志 
</span><span class='line'>     * @param $message 
</span><span class='line'>     * @param array $content 
</span><span class='line'>     * @param string $module 
</span><span class='line'>     */ 
</span><span class='line'>    static public function info($message,array $content = array(),$module = '') 
</span><span class='line'>    { 
</span><span class='line'>        #$level = SEASLOG_INFO 
</span><span class='line'>    } 
</span><span class='line'> 
</span><span class='line'>    /** 
</span><span class='line'>     * 记录notice日志 
</span><span class='line'>     * @param $message 
</span><span class='line'>     * @param array $content 
</span><span class='line'>     * @param string $module 
</span><span class='line'>     */ 
</span><span class='line'>    static public function notice($message,array $content = array(),$module = '') 
</span><span class='line'>    { 
</span><span class='line'>        #$level = SEASLOG_NOTICE 
</span><span class='line'>    } 
</span><span class='line'> 
</span><span class='line'>    /** 
</span><span class='line'>     * 记录warning日志 
</span><span class='line'>     * @param $message 
</span><span class='line'>     * @param array $content 
</span><span class='line'>     * @param string $module 
</span><span class='line'>     */ 
</span><span class='line'>    static public function warning($message,array $content = array(),$module = '') 
</span><span class='line'>    { 
</span><span class='line'>        #$level = SEASLOG_WARNING 
</span><span class='line'>    } 
</span><span class='line'> 
</span><span class='line'>    /** 
</span><span class='line'>     * 记录error日志 
</span><span class='line'>     * @param $message 
</span><span class='line'>     * @param array $content 
</span><span class='line'>     * @param string $module 
</span><span class='line'>     */ 
</span><span class='line'>    static public function error($message,array $content = array(),$module = '') 
</span><span class='line'>    { 
</span><span class='line'>        #$level = SEASLOG_ERROR 
</span><span class='line'>    } 
</span><span class='line'> 
</span><span class='line'>    /** 
</span><span class='line'>     * 记录critical日志 
</span><span class='line'>     * @param $message 
</span><span class='line'>     * @param array $content 
</span><span class='line'>     * @param string $module 
</span><span class='line'>     */ 
</span><span class='line'>    static public function critical($message,array $content = array(),$module = '') 
</span><span class='line'>    { 
</span><span class='line'>        #$level = SEASLOG_CRITICAL 
</span><span class='line'>    } 
</span><span class='line'> 
</span><span class='line'>    /** 
</span><span class='line'>     * 记录alert日志 
</span><span class='line'>     * @param $message 
</span><span class='line'>     * @param array $content 
</span><span class='line'>     * @param string $module 
</span><span class='line'>     */ 
</span><span class='line'>    static public function alert($message,array $content = array(),$module = '') 
</span><span class='line'>    { 
</span><span class='line'>        #$level = SEASLOG_ALERT 
</span><span class='line'>    } 
</span><span class='line'> 
</span><span class='line'>    /** 
</span><span class='line'>     * 记录emergency日志 
</span><span class='line'>     * @param $message 
</span><span class='line'>     * @param array $content 
</span><span class='line'>     * @param string $module 
</span><span class='line'>     */ 
</span><span class='line'>    static public function emergency($message,array $content = array(),$module = '') 
</span><span class='line'>    { 
</span><span class='line'>        #$level = SEASLOG_EMERGENCY 
</span><span class='line'>    } 
</span><span class='line'> 
</span><span class='line'>    /** 
</span><span class='line'>     * 通用日志方法 
</span><span class='line'>     * @param $level 
</span><span class='line'>     * @param $message 
</span><span class='line'>     * @param array $content 
</span><span class='line'>     * @param string $module 
</span><span class='line'>     */ 
</span><span class='line'>    static public function log($level,$message,array $content = array(),$module = '') 
</span><span class='line'>    { 
</span><span class='line'> 
</span><span class='line'>    } 
</span><span class='line'>} </span></code></pre></td></tr></table></div></figure>


<h2>在项目中如何使用</h2>

<blockquote><p>获取与设置basePatn</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/**
</span><span class='line'> *静态方法可以不实例化直接使用
</span><span class='line'> *
</span><span class='line'> */
</span><span class='line'>$basePath_1 = SeasLog::getBasePath(); 
</span><span class='line'> 
</span><span class='line'>SeasLog::setBasePath('/log/base_test'); 
</span><span class='line'>$basePath_2 = SeasLog::getBasePath(); 
</span><span class='line'> 
</span><span class='line'>var_dump($basePath_1,$basePath_2); 
</span><span class='line'> 
</span><span class='line'>/* 
</span><span class='line'>string(19) "/log/seaslog-ciogao" 
</span><span class='line'>string(14) "/log/base_test" 
</span><span class='line'>*/ </span></code></pre></td></tr></table></div></figure>


<p>直接使用 SeasLog::getBasePath()，将获取php.ini(seaslog.ini)中设置的seaslog.default_basepath 的值。</p>

<p>使用 SeasLog::getBasePath() 函数，将改变 seaslog_get_basepath() 的取值。</p>

<blockquote><p>设置logger与获取lastLogger</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$lastLogger_1 = SeasLog::getLastLogger(); 
</span><span class='line'> 
</span><span class='line'>SeasLog::setLogger('testModule/app1'); 
</span><span class='line'>$lastLogger_2 = SeasLog::getLastLogger(); 
</span><span class='line'> 
</span><span class='line'>var_dump($lastLogger_1,$lastLogger_2); 
</span><span class='line'>/* 
</span><span class='line'>string(7) "default" 
</span><span class='line'>string(15) "testModule/app1" 
</span><span class='line'>*/ </span></code></pre></td></tr></table></div></figure>


<p>与basePath相类似的，
直接使用 SeasLog::getLastLogger()，将获取php.ini(seaslog.ini)中设置的seaslog.default_logger 的值。</p>

<p>使用 SeasLog::setLogger() 函数，将改变 SeasLog::getLastLogger() 的取值。</p>

<h2>SeasLog Logger的使用</h2>

<blockquote><p>获取与设置basePath</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$basePath_1 = SeasLog::getBasePath();
</span><span class='line'>
</span><span class='line'>SeasLog::setBasePath('/log/base_test');
</span><span class='line'>$basePath_2 = SeasLog::getBasePath();
</span><span class='line'>
</span><span class='line'>var_dump($basePath_1,$basePath_2);
</span><span class='line'>
</span><span class='line'>/*
</span><span class='line'>string(19) "/log/seaslog-ciogao"
</span><span class='line'>string(14) "/log/base_test"
</span><span class='line'>*/</span></code></pre></td></tr></table></div></figure>


<p>直接使用 SeasLog::getBasePath()，将获取php.ini(seaslog.ini)中设置的 seaslog.default_basepath 的值。</p>

<p>使用 SeasLog::setBasePath() 函数，将改变 SeasLog::getBasePath() 的取值。</p>

<blockquote><p>设置logger与获取lastLogger</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$lastLogger_1 = SeasLog::getLastLogger();
</span><span class='line'>
</span><span class='line'>SeasLog::setLogger('testModule/app1');
</span><span class='line'>$lastLogger_2 = SeasLog::getLastLogger();
</span><span class='line'>
</span><span class='line'>var_dump($lastLogger_1,$lastLogger_2);
</span><span class='line'>/*
</span><span class='line'>string(7) "default"
</span><span class='line'>string(15) "testModule/app1"
</span><span class='line'>*/</span></code></pre></td></tr></table></div></figure>


<p>与basePath相类似的，</p>

<p>直接使用 SeasLog::getLastLogger()，将获取php.ini(seaslog.ini)中设置的 seaslog.default_logger 的值。</p>

<p>使用 SeasLog::setLogger() 函数，将改变 SeasLog::getLastLogger() 的取值。
快速写入log</p>

<p>上面已经设置过了basePath与logger，于是log记录的目录已经产生了，</p>

<p>log记录目录 = basePath / logger / {fileName}.log log文件名，以 年月日 分文件，如今天是2014年02月18日期，那么 {fileName} = 20140218;
还记得 php.ini 中设置的 seaslog.disting_type 吗？</p>

<p>默认的 seaslog.disting_type = 0，如果今天我使用了 SeasLog ，那么将产生最终的log文件：</p>

<p>*　LogFile = basePath / logger / 20140218.log
如果 seaslog.disting_type = 1，则最终的log文件将是这样的三个文件</p>

<ul>
<li><p>infoLogFile = basePath / logger / INFO.20140218.log</p></li>
<li><p>warnLogFile = basePath / logger / WARN.20140218.log</p></li>
<li><p>erroLogFile = basePath / logger / ERRO.20140218.log</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SeasLog::log(SEASLOG_ERROR,'this is a error test by ::log');
</span><span class='line'>
</span><span class='line'>SeasLog::debug('this is a {userName} debug',array('{userName}' =&gt; 'neeke'));
</span><span class='line'>
</span><span class='line'>SeasLog::info('this is a info log');
</span><span class='line'>
</span><span class='line'>SeasLog::notice('this is a notice log');
</span><span class='line'>
</span><span class='line'>SeasLog::warning('your {website} was down,please {action} it ASAP!',array('{website}' =&gt; 'github.com','{action}' =&gt; 'rboot'));
</span><span class='line'>
</span><span class='line'>SeasLog::error('a error log');
</span><span class='line'>
</span><span class='line'>SeasLog::critical('some thing was critical');
</span><span class='line'>
</span><span class='line'>SeasLog::alert('yes this is a {messageName}',array('{messageName}' =&gt; 'alertMSG'));
</span><span class='line'>
</span><span class='line'>SeasLog::emergency('Just now, the house next door was completely burnt out! {note}',array('{note}' =&gt; 'it`s a joke'));
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>/*
</span><span class='line'>这些函数同时也接受第3个参数为logger的设置项
</span><span class='line'>注意，当last_logger == 'default'时等同于:
</span><span class='line'>SeasLog::setLogger('test/new/path');
</span><span class='line'>SeasLog::error('test error 3');
</span><span class='line'>如果已经在前文使用过SeasLog::setLogger()函数，第3个参数的log只在此处临时使用，不影响下文。
</span><span class='line'>*/</span></code></pre></td></tr></table></div></figure>


<blockquote><p>log格式统一为： {type} | {pid} | {timeStamp} |{dateTime} | {logInfo}</p></blockquote>

<pre><code>error | 23625 | 1406422432.786 | 2014:07:27 08:53:52 | this is a error test by log
debug | 23625 | 1406422432.786 | 2014:07:27 08:53:52 | this is a neeke debug
info | 23625 | 1406422432.787 | 2014:07:27 08:53:52 | this is a info log
notice | 23625 | 1406422432.787 | 2014:07:27 08:53:52 | this is a notice log
warning | 23625 | 1406422432.787 | 2014:07:27 08:53:52 | your github.com was down,please rboot it ASAP!
error | 23625 | 1406422432.787 | 2014:07:27 08:53:52 | a error log
critical | 23625 | 1406422432.787 | 2014:07:27 08:53:52 | some thing was critical
emergency | 23625 | 1406422432.787 | 2014:07:27 08:53:52 | Just now, the house next door was completely burnt out! it is a joke
</code></pre>

<h2>SeasLog Analyzer的使用</h2>

<blockquote><p>快速统计某类型log的count值</p></blockquote>

<p>SeasLog在扩展中使用管道调用shell命令 grep -wc快速地取得count值，并返回值(array || int)给PHP。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$countResult_1 = SeasLog::analyzerCount();
</span><span class='line'>$countResult_2 = SeasLog::analyzerCount(SEASLOG_WARNING);
</span><span class='line'>$countResult_3 = SeasLog::analyzerCount(SEASLOG_ERROR,date('Ymd',time()));
</span><span class='line'>
</span><span class='line'>var_dump($countResult_1,$countResult_2,$countResult_3);
</span><span class='line'>/*
</span><span class='line'>array(8) {
</span><span class='line'>  ["debug"]=&gt;
</span><span class='line'>  int(3)
</span><span class='line'>  ["info"]=&gt;
</span><span class='line'>  int(3)
</span><span class='line'>  ["notice"]=&gt;
</span><span class='line'>  int(3)
</span><span class='line'>  ["warning"]=&gt;
</span><span class='line'>  int(3)
</span><span class='line'>  ["error"]=&gt;
</span><span class='line'>  int(6)
</span><span class='line'>  ["critical"]=&gt;
</span><span class='line'>  int(3)
</span><span class='line'>  ["alert"]=&gt;
</span><span class='line'>  int(3)
</span><span class='line'>  ["emergency"]=&gt;
</span><span class='line'>  int(3)
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>int(7)
</span><span class='line'>
</span><span class='line'>int(1)
</span><span class='line'>
</span><span class='line'>*/</span></code></pre></td></tr></table></div></figure>


<blockquote><p>获取某类型log列表</p></blockquote>

<p>SeasLog在扩展中使用管道调用shell命令 grep -w快速地取得列表，并返回array给PHP。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$detailErrorArray_inAll   = SeasLog::analyzerDetail(SEASLOG_ERROR);
</span><span class='line'>$detailErrorArray_today   = SeasLog::analyzerDetail(SEASLOG_ERROR,date('Ymd',time()));
</span><span class='line'>
</span><span class='line'>var_dump($detailErrorArray_inAll,$detailErrorArray_today);
</span><span class='line'>
</span><span class='line'>/*
</span><span class='line'>SeasLog::analyzerDetail(SEASLOG_ERROR) == SeasLog::analyzerDetail(SEASLOG_ERROR,'*');
</span><span class='line'>取当前模块下所有level为 SEASLOG_ERROR 的信息列表:
</span><span class='line'>array(6) {
</span><span class='line'> [0] =&gt;
</span><span class='line'>  string(66) "error | 8568 | 1393172042.717 | 2014:02:24 00:14:02 | test error 3 "
</span><span class='line'>  [1] =&gt;
</span><span class='line'>  string(66) "error | 8594 | 1393172044.104 | 2014:02:24 00:14:04 | test error 3 "
</span><span class='line'>  [2] =&gt;
</span><span class='line'>  string(66) "error | 8620 | 1393172044.862 | 2014:02:24 00:14:04 | test error 3 "
</span><span class='line'>  [3] =&gt;
</span><span class='line'>  string(66) "error | 8646 | 1393172045.989 | 2014:02:24 00:14:05 | test error 3 "
</span><span class='line'>  [4] =&gt;
</span><span class='line'>  string(66) "error | 8672 | 1393172047.882 | 2014:02:24 00:14:07 | test error 3 "
</span><span class='line'>  [5] =&gt;
</span><span class='line'>  string(66) "error | 8698 | 1393172048.736 | 2014:02:24 00:14:08 | test error 3 "
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>SeasLog::analyzerDetail(SEASLOG_ERROR,date('Ymd',time()));
</span><span class='line'>只取得当前模块下，当前一天内,level为SEASLOG_ERROR 的信息列表:
</span><span class='line'>array(2) {
</span><span class='line'>  [0] =&gt;
</span><span class='line'>  string(66) "error | 8568 | 1393172042.717 | 2014:02:24 00:14:02 | test error 3 "
</span><span class='line'>  [1] =&gt;
</span><span class='line'>  string(66) "error | 8594 | 1393172044.104 | 2014:02:24 00:14:04 | test error 3 "
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>同理，取当月
</span><span class='line'>$detailErrorArray_mouth = SeasLog::analyzerDetail(SEASLOG_ERROR,date('Ym',time()));
</span><span class='line'>
</span><span class='line'>*/</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PHP无限级分类]]></title>
    <link href="http://ewanreton.github.io/blog/2016/04/29/wu-xian-ji-fen-lei/"/>
    <updated>2016-04-29T09:36:19+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/04/29/wu-xian-ji-fen-lei</id>
    <content type="html"><![CDATA[<blockquote><p>PHP无限级分类主要有两种实现方式，通过递归和全路径实现</p></blockquote>

<!--more-->


<h1>一、递归实现</h1>

<pre><code>在数据库中存储如下格式的表：
</code></pre>

<table>
<thead>
<tr>
<th>ID</th>
<th style="text-align:center;">pid</th>
<th style="text-align:center;">catename</th>
<th style="text-align:center;">cateorder</th>
<th style="text-align:right;">createtime</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td style="text-align:center;">0</td>
<td style="text-align:center;">新闻</td>
<td style="text-align:center;">0</td>
<td style="text-align:right;">0</td>
</tr>
<tr>
<td>2</td>
<td style="text-align:center;">0</td>
<td style="text-align:center;">图片</td>
<td style="text-align:center;">0</td>
<td style="text-align:right;">0</td>
</tr>
<tr>
<td>3</td>
<td style="text-align:center;">1</td>
<td style="text-align:center;">国内新闻</td>
<td style="text-align:center;">0</td>
<td style="text-align:right;">0</td>
</tr>
<tr>
<td>4</td>
<td style="text-align:center;">1</td>
<td style="text-align:center;">国际新闻</td>
<td style="text-align:center;">0</td>
<td style="text-align:right;">0</td>
</tr>
<tr>
<td>5</td>
<td style="text-align:center;">3</td>
<td style="text-align:center;">北京新闻</td>
<td style="text-align:center;">0</td>
<td style="text-align:right;">0</td>
</tr>
<tr>
<td>6</td>
<td style="text-align:center;">4</td>
<td style="text-align:center;">美国新闻</td>
<td style="text-align:center;">0</td>
<td style="text-align:right;">0</td>
</tr>
<tr>
<td>7</td>
<td style="text-align:center;">2</td>
<td style="text-align:center;">美女图片</td>
<td style="text-align:center;">0</td>
<td style="text-align:right;">0</td>
</tr>
<tr>
<td>8</td>
<td style="text-align:center;">2</td>
<td style="text-align:center;">风景图片</td>
<td style="text-align:center;">0</td>
<td style="text-align:right;">0</td>
</tr>
</tbody>
</table>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>create table deepcate
</span><span class='line'>(
</span><span class='line'>id int(10) unsigned   not null  auto_increment primary key,
</span><span class='line'>pid   int(11) unsigned    not null,
</span><span class='line'>catename  varchar(30) not null,
</span><span class='line'>cateorder int(11) unsigned    default 0,
</span><span class='line'>createtime    int(10) not null
</span><span class='line'>);
</span><span class='line'>
</span><span class='line'>insert into deepcate(pid,catename,cateorder,createtime)values(0,'新闻',0,0);
</span><span class='line'>insert into deepcate(pid,catename,cateorder,createtime)values(0,'图片',0,0);
</span><span class='line'>insert into deepcate(pid,catename,cateorder,createtime)values(1,'国内新闻',0,0);
</span><span class='line'>insert into deepcate(pid,catename,cateorder,createtime)values(1,'国际新闻',0,0);
</span><span class='line'>insert into deepcate(pid,catename,cateorder,createtime)values(3,'北京新闻',0,0);
</span><span class='line'>insert into deepcate(pid,catename,cateorder,createtime)values(4,'美国新闻',0,0);
</span><span class='line'>insert into deepcate(pid,catename,cateorder,createtime)values(2,'美女图片',0,0);
</span><span class='line'>insert into deepcate(pid,catename,cateorder,createtime)values(2,'风景图片',0,0);
</span><span class='line'>insert into deepcate(pid,catename,cateorder,createtime)values(7,'日韩明星',0,0);
</span><span class='line'>insert into deepcate(pid,catename,cateorder,createtime)values(9,'日本AV',0,0);
</span><span class='line'>
</span><span class='line'>select * from deepcate;</span></code></pre></td></tr></table></div></figure>


<blockquote><p>php 代码实现</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?php
</span><span class='line'>header("Content-Type:text/html;Charset=UTF-8");
</span><span class='line'>// php无限分类下拉列表的代码实现
</span><span class='line'>include_once('db.inc.php') ;
</span><span class='line'>
</span><span class='line'>function getList($pid=0,&$result=array(),$spac=0)
</span><span class='line'>{
</span><span class='line'>    $spac=$spac+2;
</span><span class='line'>    $sql=" SELECT * FROM deepcate WHERE pid=$pid ";
</span><span class='line'>    $res=mysql_query($sql);
</span><span class='line'>   
</span><span class='line'>    while($row=mysql_fetch_assoc($res)){
</span><span class='line'>        $row['catename']=str_repeat('&nbsp;&nbsp;',$spac).'|--'.$row['catename'];
</span><span class='line'>        $result[]=$row;
</span><span class='line'>        getList($row['id'],$result,$spac);
</span><span class='line'>    }
</span><span class='line'>    return $result;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>function displayCate($pid=0,$selected=0){
</span><span class='line'>     $rs=getList($pid);
</span><span class='line'>     $str="";
</span><span class='line'>     $str.="&lt;select name='cate'&gt;";
</span><span class='line'>    foreach($rs as $v){
</span><span class='line'>        if($v['id']==$selected){
</span><span class='line'>            $selected="selected";
</span><span class='line'>        }
</span><span class='line'>       $str.="&lt;option {$selected}&gt;";
</span><span class='line'>       $str.= $v['catename'];
</span><span class='line'>       $str.= "&lt;/option&gt;";
</span><span class='line'>    }
</span><span class='line'>    return $str.= "&lt;/select&gt;";
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>echo displayCate();
</span><span class='line'>
</span><span class='line'>echo "&lt;hr/&gt;&lt;hr/&gt;";
</span><span class='line'>function getCatePath($cid,&$result){
</span><span class='line'>    $sql="SELECT * FROM deepcate WHERE id=$cid ";
</span><span class='line'>    $rs=mysql_query($sql);
</span><span class='line'>    $row=mysql_fetch_assoc($rs);
</span><span class='line'>    if($row){
</span><span class='line'>        $result[]=$row;
</span><span class='line'>        getCatePath($row['pid'],$result);
</span><span class='line'>    }
</span><span class='line'>    krsort($result);
</span><span class='line'>    return $result;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>function displayCatePath($cid,$url="deepcate.php?cid="){
</span><span class='line'>    $res=getCatePath($cid,$result);
</span><span class='line'>    $str="";
</span><span class='line'>    foreach($res as $v){
</span><span class='line'>        $str.= "&lt;a href='{$url}{$v['id']}'&gt;{$v['catename']}&lt;/a&gt;&gt;&gt;";
</span><span class='line'>    }return $str;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>echo displayCatePath(10);</span></code></pre></td></tr></table></div></figure>


<h1>二、全路径实现</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>use imooc;
</span><span class='line'>create table  likecate
</span><span class='line'>(
</span><span class='line'>id    int(11) not null  auto_increment primary key,
</span><span class='line'>path  varchar(200)    not null,
</span><span class='line'>catename  varchar(30) not null,
</span><span class='line'>cateorder int(11) not null    default 0,
</span><span class='line'>createtime    int(11) not null
</span><span class='line'>);
</span><span class='line'>
</span><span class='line'>insert into likecate(path,catename,cateorder,createtime)values('','手机',0,0);
</span><span class='line'>insert into likecate(path,catename,cateorder,createtime)values('1','功能手机',0,0);
</span><span class='line'>insert into likecate(path,catename,cateorder,createtime)values('1,2','老人手机',0,0);
</span><span class='line'>insert into likecate(path,catename,cateorder,createtime)values('1,2','儿童手机',0,0);
</span><span class='line'>insert into likecate(path,catename,cateorder,createtime)values('1','智能手机',0,0);
</span><span class='line'>insert into likecate(path,catename,cateorder,createtime)values('1,5','andriod手机',0,0);
</span><span class='line'>insert into likecate(path,catename,cateorder,createtime)values('1,5','ios手机',0,0);
</span><span class='line'>insert into likecate(path,catename,cateorder,createtime)values('1,5','winphoto手机',0,0);
</span><span class='line'>insert into likecate(path,catename,cateorder,createtime)values('1,2,4','色盲手机',0,0);
</span><span class='line'>insert into likecate(path,catename,cateorder,createtime)values('1,2,3','大字手机',0,0);
</span><span class='line'>
</span><span class='line'>select * from likecate;
</span><span class='line'>
</span><span class='line'>select id,catename,path,concat(path,',',id) as fullpath from likecate where 1 order by fullpath asc;
</span><span class='line'>
</span><span class='line'>#结果显示如图
</span><span class='line'>+----+--------------+-------+----------+
</span><span class='line'>| id | catename     | path  | fullpath |
</span><span class='line'>+----+--------------+-------+----------+
</span><span class='line'>|  1 | 手机         |       | ,1       |
</span><span class='line'>|  2 | 功能手机     | 1     | 1,2      |
</span><span class='line'>|  3 | 老人手机     | 1,2   | 1,2,3    |
</span><span class='line'>| 10 | 大字手机     | 1,2,3 | 1,2,3,10 |
</span><span class='line'>|  4 | 儿童手机     | 1,2   | 1,2,4    |
</span><span class='line'>|  9 | 色盲手机     | 1,2,4 | 1,2,4,9  |
</span><span class='line'>|  5 | 智能手机     | 1     | 1,5      |
</span><span class='line'>|  6 | andriod手机  | 1,5   | 1,5,6    |
</span><span class='line'>|  7 | ios手机      | 1,5   | 1,5,7    |
</span><span class='line'>|  8 | winphoto手机 | 1,5   | 1,5,8    |
</span><span class='line'>+----+--------------+-------+----------+</span></code></pre></td></tr></table></div></figure>


<blockquote><p>php代码实现</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?php
</span><span class='line'>header("Content-Type:text/html;Charset=UTF-8");
</span><span class='line'>//递归无限分类原理
</span><span class='line'>include_once ('db.inc.php');
</span><span class='line'> 
</span><span class='line'>function likecate(){
</span><span class='line'>    $sql="select id,catename,path,concat(path,',',id) as fullpath from likecate where 1 order by fullpath asc";
</span><span class='line'>    $res=mysql_query($sql);
</span><span class='line'>    $result=array();
</span><span class='line'>    while($row=mysql_fetch_assoc($res)){
</span><span class='line'>        $deep=count(explode(',',trim($row['fullpath'],',')));
</span><span class='line'>         
</span><span class='line'>        $row['catename']=str_repeat('&nbsp;&nbsp;',$deep*4).'|--'.$row['catename'];
</span><span class='line'>        $result[]=$row;
</span><span class='line'>    }
</span><span class='line'>    return $result;
</span><span class='line'>}
</span><span class='line'> 
</span><span class='line'> 
</span><span class='line'>$res=likecate();
</span><span class='line'>echo "&lt;select name='cate'&gt;";
</span><span class='line'>foreach($res as $v){
</span><span class='line'>    echo "&lt;option&gt;{$v['catename']}&lt;/option&gt;";
</span><span class='line'>}
</span><span class='line'>echo "&lt;/select&gt;";
</span><span class='line'> 
</span><span class='line'>echo "&lt;hr/&gt;&lt;hr/&gt;";
</span><span class='line'>function getPathCate($cateid){
</span><span class='line'>    $sql="select *,concat(path,',',id)fullpath from likecate where id=$cateid";
</span><span class='line'>    $res=mysql_query($sql);
</span><span class='line'>    $row=mysql_fetch_assoc($res);
</span><span class='line'>    $ids=$row['fullpath'];
</span><span class='line'>    $sql="select * from likecate where id in($ids) order by id asc";
</span><span class='line'>    $res=mysql_query($sql);
</span><span class='line'>    $result=array();
</span><span class='line'>    while($row=mysql_fetch_assoc($res)){
</span><span class='line'>        $result[]=$row;
</span><span class='line'>    }
</span><span class='line'>    return $result;
</span><span class='line'>}
</span><span class='line'> 
</span><span class='line'>function displayCatePath($cateid,$link='likecate.php?cid='){
</span><span class='line'>    $res=getPathCate($cateid);
</span><span class='line'>    $str="";
</span><span class='line'>    foreach($res as $v){
</span><span class='line'>        $str.="&lt;a href='{$link}'&gt;{$v['catename']}&lt;/a&gt;&gt;";
</span><span class='line'>    }
</span><span class='line'>    return $str;
</span><span class='line'>}  
</span><span class='line'> 
</span><span class='line'>echo displayCatePath(4,'likecate.php?p=1&cid=');</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Linux-MYSQL-常用命令]]></title>
    <link href="http://ewanreton.github.io/blog/2016/04/28/linux-mysql-code/"/>
    <updated>2016-04-28T01:24:16+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/04/28/linux-mysql-code</id>
    <content type="html"><![CDATA[<blockquote><p>Linux 下Mysql 常用命令总结</p></blockquote>

<!--more-->


<h1>一、linux下mysql的基本命令：</h1>

<pre><code>1. linux下启动mysql的命令：
mysqladmin start
/ect/init.d/mysql start (前面为mysql的安装路径)
/usr/local/mysql/bin/mysqld_safe --user=mysql &amp;      启动
2. linux下重启mysql的命令：
mysqladmin restart
/ect/init.d/mysql restart (前面为mysql的安装路径)
3. linux下关闭mysql的命令：
mysqladmin shutdown
/ect/init.d/mysql shutdown (前面为mysql的安装路径)

4. 连接本机上的mysql：
进入目录mysql\bin，再键入命令mysql -uroot -p， 回车后提示输入密码。
退出mysql命令：exit（回车）

5. 修改mysql密码：
mysqladmin -u用户名 -p旧密码 password 新密码
或进入mysql命令行SET PASSWORD FOR root=PASSWORD("root");

6. 增加新用户。（注意：mysql环境中的命令后面都带一个分号作为命令结束符）
grant select on 数据库.* to 用户名@登录主机 identified by "密码"
如增加一个用户test密码为123，让他可以在任何主机上登录， 并对所有数据库有查询、插入、修改、删除的权限。首先用以root用户连入mysql，然后键入以下命令：
grant select,insert,update,delete on *.* to " Identified by "123";
</code></pre>

<h1>二、有关mysql数据库方面的操作</h1>

<blockquote><p>必须首先登录到mysql中，有关操作都是在mysql的提示符下进行，而且每个命令以分号结束</p></blockquote>

<pre><code>1. 显示数据库列表。
    show databases;
2. 显示库中的数据表：
    use mysql； ／／打开库
    show tables;
3. 显示数据表的结构：
    describe 表名;
4. 建库：
    create database 库名;

    GBK: create database test2 DEFAULT CHARACTER SET gbk COLLATE gbk_chinese_ci;
    UTF8: CREATE DATABASE `test2` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;
5. 建表：
    use 库名；
    create table 表名(字段设定列表)；
6. 删库和删表:
    drop database 库名;
    drop table 表名；
7. 将表中记录清空：
    delete from 表名;
    truncate table  表名;
8. 显示表中的记录：
    select * from 表名;
9. 编码的修改
    如果要改变整个mysql的编码格式：  
    启动mysql的时候，mysqld_safe命令行加入  
    --default-character-set=gbk 
    如果要改变某个库的编码格式：在mysql提示符后输入命令  
    alter database db_name default character set gbk;

10. 重命名表
    alter table t1 rename t2;
11. 查看sql语句的效率
    explain &lt; table_name &gt;
    例如：explain select * from t3 where id=3952602;
12. 用文本方式将数据装入数据库表中(例如D:/mysql.txt)

    mysql&gt; LOAD DATA LOCAL INFILE "D:/mysql.txt" INTO TABLE MYTABLE;
</code></pre>

<h1>三、数据的导入导出(1)</h1>

<pre><code>1. 文本数据转到数据库中
    文本数据应符合的格式：字段数据之间用tab键隔开，null值用来代替。
    例：1 name duty 2006-11-23
    数据传入命令 load data local infile "文件名" into table 表名;

2. 导出数据库和表
    mysqldump --opt news &gt; news.sql（将数据库news中的所有表备份到news.sql文件，news.sql是一个文本文件，文件名任取。）
    mysqldump --opt news author article &gt; author.article.sql（将数据库news中的author表和article表备份到author.article.sql文件， author.article.sql是一个文本文件，文件名任取。）
    mysqldump --databases db1 db2 &gt; news.sql（将数据库dbl和db2备份到news.sql文件，news.sql是一个文本文件，文件名任取。）
    mysqldump -h host -u user -p pass --databases dbname &gt; file.dump
    就是把host上的以名字user，口令pass的数据库dbname导入到文件file.dump中
    mysqldump --all-databases &gt; all-databases.sql（将所有数据库备份到all-databases.sql文件，all-databases.sql是一个文本文件，文件名任取。）

3. 导入数据
    mysql &lt; all-databases.sql（导入数据库）
    mysql&gt;source news.sql;（在mysql命令下执行，可导入表）
</code></pre>

<h1>四、数据的导入导出(2)</h1>

<pre><code>一、导出数据库用mysqldump命令（注意mysql的安装路径，即此命令的路径）：
    1、导出数据和表结构：
    mysqldump -u用户名 -p密码 数据库名 &gt; 数据库名.sql
    #/usr/local/mysql/bin/   mysqldump -uroot -p abc &gt; abc.sql
</code></pre>

<p>敲回车后会提示输入密码</p>

<pre><code>    2、只导出表结构
    mysqldump -u用户名 -p密码 -d 数据库名 &gt; 数据库名.sql
    #/usr/local/mysql/bin/   mysqldump -uroot -p -d abc &gt; abc.sql
</code></pre>

<p>注：/usr/local/mysql/bin/  &mdash;>  mysql的data目录</p>

<pre><code>二、导入数据库
    1、首先建空数据库
    mysql&gt;create database abc;

    2、导入数据库
    方法一：
        （1）选择数据库
        mysql&gt;use abc;
        （2）设置数据库编码
        mysql&gt;set names utf8;
        （3）导入数据（注意sql文件的路径）
        mysql&gt;source /home/abc/abc.sql;
    方法二：
        mysql -u用户名 -p密码 数据库名 &lt; 数据库名.sql
        #mysql -uabc_f -p abc &lt; abc.sql

        建议使用第二种方法导入。
</code></pre>

<p>注意：有命令行模式，有sql命令</p>

<h1>五、常用操作</h1>

<h2>连接MySQL</h2>

<pre><code>格式： mysql -h主机地址 -u用户名 －p用户密码

1、例1：连接到本机上的MYSQL。

首先在打开DOS窗口，然后进入目录 mysqlbin，再键入命令mysql -uroot -p，
回车后提示你输密码，如果刚安装好MYSQL，超级用户root是没有密码的，
故直接回车即可进入到MYSQL中了，MYSQL的提示符是： mysql&gt;。

2、例2：连接到远程主机上的MYSQL。假设远程主机的IP为：110.110.110.110，
用户名为root,密码为abcd123。则键入以下命令：

mysql -h110.110.110.110 -uroot -pabcd123

（注:u与root可以不用加空格，其它也一样）

3、退出MYSQL命令： exit （回车）。
</code></pre>

<h2>修改密码</h2>

<pre><code>格式：mysqladmin -u用户名 -p旧密码 password 新密码

1、例1：给root加个密码ab12。首先在DOS下进入目录mysqlbin，然后键入以下命令：

mysqladmin -uroot -password ab12

注：因为开始时root没有密码，所以-p旧密码一项就可以省略了。

2、例2：再将root的密码改为djg345。

mysqladmin -uroot -pab12 password djg345
</code></pre>

<h2>增加新用户。</h2>

<blockquote><p>（注意：和上面不同，下面的因为是MySQL环境中的命令，所以后面都带一个分号作为命令结束符）</p></blockquote>

<pre><code>格式：grant select on 数据库.* to 用户名@登录主机 identified by \"密码\"

例1、增加一个用户test1密码为abc，让他可以在任何主机上登录，
并对所有数据库有查询、插入、修改、删除的权限。首先用以root用户连入MySQL，然后键入以下命令：
grant select,insert,update,
delete on *.* to test1@\"%\" Identified by \"abc\";

但例1增加的用户是十分危险的，你想如某个人知道test1的密码，那么他就可以
在internet上的任何一台电脑上登录你的MySQL数据库并对你的数据可以为所欲为了，
解决办法见例2。

例2、增加一个用户test2密码为abc,让他只可以在localhost上登录，
并可以对数据库mydb进行查询、插入、修改、删除的操作 
（localhost指本地主机，即MySQL数据库所在的那台主机），
这样用户即使用知道test2的密码，他也无法从internet上直接访问数据 库，
只能通过MySQL主机上的web页来访问。

grant select,insert,update,
delete on mydb.* to test2@localhost identified by \"abc\";

如果你不想test2有密码，可以再打一个命令将密码消掉。

grant select,insert,update,delete on mydb
.* to test2@localhost identified by \"\";
</code></pre>

<h2>整理</h2>

<pre><code>启动：net start mySql;
进入：mysql -u root -p/mysql -h localhost -u root -p databaseName;
列出数据库：show databases;
选择数据库：use databaseName;
列出表格：show tables；
显示表格列的属性：show columns from tableName；
建立数据库：source fileName.txt;
匹配字符：可以用通配符_代表任何一个字符，％代表任何字符串;
增加一个字段：alter table tabelName add column fieldName dateType;
增加多个字段：alter table tabelName add column fieldName1 dateType,add columns fieldName2 dateType;
多行命令输入:注意不能将单词断开;当插入或更改数据时，不能将字段的字符串展开到多行里，否则硬回车将被储存到数据中;
增加一个管理员帐户：grant all on *.* to user@localhost identified by "password";
每条语句输入完毕后要在末尾填加分号';'，或者填加'\g'也可以；
查询时间：select now();
查询当前用户：select user();
查询数据库版本：select version();
查询当前使用的数据库：select database();
</code></pre>

<p>1、删除student_course数据库中的students数据表：</p>

<pre><code>rm -f student_course/students.*
</code></pre>

<p>2、备份数据库：(将数据库test备份)</p>

<pre><code>mysqldump -u root -p test&gt;c:\test.txt
备份表格：(备份test数据库下的mytable表格)
mysqldump -u root -p test mytable&gt;c:\test.txt
将备份数据导入到数据库：(导回test数据库)
mysql -u root -p test
</code></pre>

<p>3、创建临时表：(建立临时表zengchao)</p>

<pre><code>create temporary table zengchao(name varchar(10));
</code></pre>

<p>4、创建表是先判断表是否存在</p>

<pre><code>create table if not exists students(……);
</code></pre>

<p>5、从已经有的表中复制表的结构</p>

<pre><code>create table table2 select * from table1 where 1&lt;&gt;1;
</code></pre>

<p>6、复制表</p>

<pre><code>create table table2 select * from table1;
</code></pre>

<p>7、对表重新命名</p>

<pre><code>alter table table1 rename as table2;
</code></pre>

<p>8、修改列的类型</p>

<pre><code>alter table table1 modify id int unsigned;//修改列id的类型为int unsigned
alter table table1 change id sid int unsigned;//修改列id的名字为sid，而且把属性修改为int unsigned
</code></pre>

<p>9、创建索引</p>

<pre><code>alter table table1 add index ind_id (id);
create index ind_id on table1 (id);
create unique index ind_id on table1 (id);//建立唯一性索引
</code></pre>

<p>10、删除索引</p>

<pre><code>drop index idx_id on table1;
alter table table1 drop index ind_id;
</code></pre>

<p>11、联合字符或者多个列(将列id与":&ldquo;和列name和&rdquo;=&ldquo;连接)</p>

<pre><code>select concat(id,':',name,'=') from students;
</code></pre>

<p>12、limit(选出10到20条)&lt;第一个记录集的编号是0></p>

<pre><code>select * from students order by id limit 9,10;
</code></pre>

<p>13、MySQL不支持的功能</p>

<pre><code>事务，视图，外键和引用完整性，存储过程和触发器
</code></pre>

<p>14、MySQL会使用索引的操作符号</p>

<pre><code>&lt;,&lt;=,&gt;=,&gt;,=,between,in,不带%或者_开头的like
</code></pre>

<p>15、使用索引的缺点</p>

<pre><code>1)减慢增删改数据的速度；
2）占用磁盘空间；
3）增加查询优化器的负担；
当查询优化器生成执行计划时，会考虑索引，太多的索引会给查询优化器增加工作量，导致无法选择最优的查询方案；
</code></pre>

<p>16、分析索引效率</p>

<pre><code>方法：在一般的SQL语句前加上explain；
分析结果的含义：
1）table：表名；
2）type：连接的类型，(ALL/Range/Ref)。其中ref是最理想的；
3）possible_keys：查询可以利用的索引名；
4）key：实际使用的索引；
5）key_len：索引中被使用部分的长度（字节）；
6）ref：显示列名字或者"const"（不明白什么意思）；
7）rows：显示MySQL认为在找到正确结果之前必须扫描的行数；
8）extra：MySQL的建议；
</code></pre>

<p>17、使用较短的定长列</p>

<pre><code>1）尽可能使用较短的数据类型；
2）尽可能使用定长数据类型；
a）用char代替varchar，固定长度的数据处理比变长的快些；
b）对于频繁修改的表，磁盘容易形成碎片，从而影响数据库的整体性能；
c）万一出现数据表崩溃，使用固定长度数据行的表更容易重新构造。使用固定长度的数据行，每个记录的开始位置都是固定记录长度的倍数，可以很容易被检测到，但是使用可变长度的数据行就不一定了；
d）对于MyISAM类型的数据表，虽然转换成固定长度的数据列可以提高性能，但是占据的空间也大；
</code></pre>

<p>18、使用not null和enum</p>

<pre><code>尽量将列定义为not null，这样可使数据的出来更快，所需的空间更少，而且在查询时，MySQL不需要检查是否存在特例，即null值，从而优化查询；
如果一列只含有有限数目的特定值，如性别，是否有效或者入学年份等，在这种情况下应该考虑将其转换为enum列的值，MySQL处理的更快，因为所有的enum值在系统内都是以标识数值来表示的；
</code></pre>

<p>19、使用optimize table</p>

<pre><code>对于经常修改的表，容易产生碎片，使在查询数据库时必须读取更多的磁盘块，降低查询性能。具有可变长的表都存在磁盘碎片问题，这个问题对blob数据类型更为突出，因为其尺寸变化非常大。可以通过使用optimize table来整理碎片，保证数据库性能不下降，优化那些受碎片影响的数据表。 optimize table可以用于MyISAM和BDB类型的数据表。实际上任何碎片整理方法都是用mysqldump来转存数据表，然后使用转存后的文件并重新建数据表；
</code></pre>

<p>20、使用procedure analyse()</p>

<pre><code>可以使用procedure analyse()显示最佳类型的建议，使用很简单，在select语句后面加上procedure analyse()就可以了；例如：
select * from students procedure analyse();
select * from students procedure analyse(16,256);
第二条语句要求procedure analyse()不要建议含有多于16个值，或者含有多于256字节的enum类型，如果没有限制，输出可能会很长；
</code></pre>

<p>21、使用查询缓存</p>

<pre><code>1）查询缓存的工作方式：
第一次执行某条select语句时，服务器记住该查询的文本内容和查询结果，存储在缓存中，下次碰到这个语句时，直接从缓存中返回结果；当更新数据表后，该数据表的任何缓存查询都变成无效的，并且会被丢弃。
2）配置缓存参数：
变量：query_cache _type，查询缓存的操作模式。有3中模式，0：不缓存；1：缓存查询，除非与 select sql_no_cache开头；2：根据需要只缓存那些以select sql_cache开头的查询； query_cache_size：设置查询缓存的最大结果集的大小，比这个值大的不会被缓存。
</code></pre>

<p>22、调整硬件</p>

<pre><code>1）在机器上装更多的内存；
2）增加更快的硬盘以减少I/O等待时间；
寻道时间是决定性能的主要因素，逐字地移动磁头是最慢的，一旦磁头定位，从磁道读则很快；
3）在不同的物理硬盘设备上重新分配磁盘活动；
如果可能，应将最繁忙的数据库存放在不同的物理设备上，这跟使用同一物理设备的不同分区是不同的，因为它们将争用相同的物理资源（磁头）。
</code></pre>

<h2>删除MySQL数据库</h2>

<p>1、创建数据库</p>

<pre><code>mysql&gt; create database drop_database;
Query OK, 1 row affected (0.00 sec)
</code></pre>

<p>2、删除一个已经确定存在的数据库</p>

<pre><code>mysql&gt; drop database drop_database;
Query OK, 0 rows affected (0.00 sec)
</code></pre>

<p>3、删除一个不确定存在的数据库</p>

<pre><code>mysql&gt; drop database drop_database;
ERROR 1008 (HY000): Can't drop database 'drop_database'; database doesn't exist
//发生错误，不能删除'drop_database'数据库，该数据库不存在。
mysql&gt; drop database if exists drop_database;
Query OK, 0 rows affected, 1 warning (0.00 sec)//产生一个警告说明此数据库不存在
mysql&gt; create database drop_database;
Query OK, 1 row affected (0.00 sec)
mysql&gt; drop database if exists drop_database;//if exists 判断数据库是否存在，不存在也不产生错误
Query OK, 0 rows affected (0.00 sec)
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[腾讯云服务器Centos6.5 LNMP环境搭建]]></title>
    <link href="http://ewanreton.github.io/blog/2016/04/28/qqyuncontos-huan-jing-da-jian/"/>
    <updated>2016-04-28T01:01:35+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/04/28/qqyuncontos-huan-jing-da-jian</id>
    <content type="html"><![CDATA[<blockquote><p>今天开始搭建前几天买的腾讯云服务器的LNMP环境</p></blockquote>

<!--more-->


<h1>一、通过putty.exe连接到云服务器</h1>

<pre><code>下载并打开这个软件后只需要输入云服务器的外网IP其他默认即可
然后用你的用户名和密码登录云服务器。
</code></pre>

<h1>二、CentOS环境下通过YUM安装软件</h1>

<pre><code>1. 切换到root权限
2. yum install [nginx][php][php-fpm][mariadb][mariadb-server][mysql][mysql-server] 或者yum -y mysql mysql-server nginx php php-fpm
3. 系统会自动搜索相关的软件包和依赖关系，并且在界面中提示用户确认搜索到的软件包是否合适，如下图所示：
</code></pre>

<p><img src="http://qzonestyle.gtimg.cn/qzone/vas/opensns/res/img/Yum_2.png" alt="sd" /></p>

<pre><code>4. 输入“Y”确认后，开始安装软件，安装完成后会提示“Complete”.
5. 软件安装完成后，可通过命令 rpm -ql 查看软件包具体的安装目录。以查看nginx的安装目录为例：
#rpm -ql nginx
6.可通过命令 rpm -q 查看软件包的版本信息。以查看nginx的版本为例：
#rpm -q nginx
</code></pre>

<p><img src="http://qzonestyle.gtimg.cn/qzone/vas/opensns/res/img/YaST_6.png" alt="sd" />
<img src="http://qzonestyle.gtimg.cn/qzone/vas/opensns/res/img/YaST_5.png" alt="sd" /></p>

<h1>三、CentOS环境下通过YUM安装软件</h1>

<h2>1. 配置nginx</h2>

<pre><code>1. 启动nginx服务。
    命令如下：
    [root@VM_185_51 /]# service nginx restart

2. 测试nginx服务是否正常运行。
如果最后显示：`index.html' saved ，说明nginx服务正常。
[root@VM_185_51 /]# wget http://127.0.0.1
--2013-02-20 17:07:26-- http://127.0.0.1/
Connecting to 127.0.0.1:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 151 [text/html]
Saving to: `index.html'
100%[==========================================================================================&gt;] 151 --.-K/s in 0s 
2013-02-20 17:07:26 (37.9 MB/s) - `index.html' saved [151/151]

3. 在浏览器中，通过CentOS云服务器公网IP查看nginx服务是否正常运行。
如果显示如下，说明nginx安装配置成功。
</code></pre>

<p><img src="http://qzonestyle.gtimg.cn/qzone/vas/opensns/res/img/Q_lnmp_1.png" alt="sd" /></p>

<h2>2. 配置PHP</h2>

<pre><code>1. 启动php-fpm。
    [root@VM_185_51 /]# service php-fpm start

2. 修改php-fpm和nginx的配置，实现nginx和php联动。
    （1）查看php-fpm默认配置。
    [root@VM_185_51 /]# cat /etc/php-fpm.d/www.conf |grep -i 'listen ='
    listen = 127.0.0.1:9000
    （2）php-fpm的默认配置的监听端口为9000，现在只用修改配置，将php解析的请求转发到127.0.0.0:9000处理即可。
    修改nginx配置，修改命令如下：
[root@VM_185_51 /]# vim /etc/nginx/conf.d/default.conf
修改完成后实际配置如下，红色文字为修改过的部分：
server {
 listen       80;
 root   /usr/share/nginx/html;
 server_name  localhost;
 #charset koi8-r;
 #access_log  /var/log/nginx/log/host.access.log  main;
 location / {
     index  index.html index.htm;
  }
 #error_page  404              /404.html;
 # redirect server error pages to the static page /50x.html
 #
 error_page   500 502 503 504  /50x.html;
  location = /50x.html {
     root   /usr/share/nginx/html;
  }
# proxy the PHP scripts to Apache listening on 127.0.0.1:80
#
#location ~ \.php$ {
#    proxy_pass   http://127.0.0.1;
#}
# pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
#
  location ~ \.php$ {
  fastcgi_pass   127.0.0.1:9000;
  fastcgi_index   index.php;
  fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
  include        fastcgi_params;
 }
# deny access to .htaccess files, if Apache's document root
# concurs with nginx's one
#
#location ~ /\.ht {
#    deny  all;
#}
}
修改完成后，按“Esc”键，输入“:wq”，保存文件并返回。
通过下面的命令，查看配置是否正确：
[root@VM_185_51 /]# cat /etc/nginx/conf.d/default.conf
3. 配置生效
    重启nginx，使配置生效。
    命令如下：
    [root@VM_185_51 /]# service nginx restart
    Stopping nginx: [ OK ]
    Starting nginx: [ OK ]
4. 环境配置验证
    1. 在web目录下创建index.php。
    命令如下：
    [root@VM_185_51 /]# vim /usr/share/nginx/html/index.php
    index.php文件的内容如下：
    &lt;?php
    echo "&lt;title&gt;Test Page&lt;/title&gt;";
    echo "hello world";
    ?&gt;
2. 在浏览器中，通过CentOS云服务器公网IP查看环境配置是否成功。
如果页面可以显示“hello world”，说明配置成功。
</code></pre>

<p><img src="http://qzonestyle.gtimg.cn/qzone/vas/opensns/res/img/Q_lnmp_2.png" alt="sd" /></p>

<h1>四、Windows机器通过WinSCP上传文件</h1>

<blockquote><p>WinSCP是一个Windows环境下使用SSH的开源图形化SFTP客户端，同时支持SCP协议。它的主要功能就是在本地与远程计算机间安全的复制文件。与使用FTP上传代码相比，通过WinSCP可以直接使用服务器账户密码访问服务器，无需在服务器端做任何配置。下载地址：<a href="http://winscp.net/eng/docs/lang:chs">官方下载</a> <a href="http://dl.pconline.com.cn/html_2/1/86/id=7244&amp;pn=0.html">太平洋下载中心下载</a></p></blockquote>

<p>安装完成后启动WinSCP，界面如下。按图示填写信息并登录。
<img src="http://mccdn.qcloud.com/img56b024e2768ad.png" alt="sd" /></p>

<blockquote><p>字段填写说明：</p></blockquote>

<ul>
<li>协议：SFTP或者SCP均可</li>
<li>主机名：云服务器的公网IP（登录云服务器控制台可查看云服务器的公网IP）</li>
<li>用户名：云服务器的系统用户名（SUSE/CentOS/Debian：root，Windows：Administrator，Ubuntu：ubuntu）</li>
<li>密码：云服务器的用户名对应的密码</li>
<li>端口：默认22</li>
</ul>


<p> 信息填写完毕之后点击登录，界面如下:</p>

<p><img src="http://mccdn.qcloud.com/img56b0272d4ed3a.png" alt="sd" /></p>

<p>登录成功之后，鼠标选中本地文件，拖拽到右侧的远程站点，即可将文件上传到Linux云服务器
<img src="http://mccdn.qcloud.com/img56b027728e1ec.png" alt="sd" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Nginx下PHP环境搭建1]]></title>
    <link href="http://ewanreton.github.io/blog/2016/04/26/nginx-php-huan-jing/"/>
    <updated>2016-04-26T22:53:05+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/04/26/nginx-php-huan-jing</id>
    <content type="html"><![CDATA[<blockquote><p>Nginx下PHP环境搭建1</p></blockquote>

<!--more-->


<h1>一、需要准备的包</h1>

<ul>
<li>libiconv-1.7.tar.gz</li>
<li>libmcrypt-2.5.7.tar.gz</li>
<li>mcrypt-2.6.8.tar.gz</li>
<li>mhash-0.9.3.tar.gz</li>
<li>php-5.5.34.tar.bz2</li>
</ul>


<h1>二、具体安装</h1>

<hr />

<ol>
<li><p>libiconv</p>

<ol>
<li>tar -zvxf libiconv-1.7.tar.gz</li>
<li>cd libiconv-1.7</li>
<li>./configure &ndash;prefix=/usr/local</li>
<li>make</li>
<li>make install</li>
</ol>
</li>
<li><p>libmcrypt</p>

<ol>
<li>tar -zvxf libmcrypt-2.5.7.tar.gz</li>
<li>cd libmcrypt-2.5.7</li>
<li>./configure</li>
<li>make</li>
<li>make install</li>
<li>/sbin/ldconfig   //共享链接库</li>
<li>./configure &ndash;enable-ltdl-install //内键指令</li>
<li>make</li>
<li>make install</li>
</ol>
</li>
<li><p>mhash</p>

<ol>
<li>tar -zvxf mhash-0.9.3.tar.gz</li>
<li>cd mhash-0.9.3</li>
<li>./configure</li>
<li>make</li>
<li>make install</li>
<li>ln -s /usr/local/lib/libmcrypt.la /usr/lib/ibmcrypt.la</li>
<li>ln -s /usr/local/lib/libmcrypt.la.so.4 /usr/lib/libmcrypt.la.so.4</li>
<li>ln -s /usr/local/lib/libmcrypt.la.so.4.4.8 /usr/lib/libmcrypt.la.so.4.4.8</li>
<li>ln -s /usr/local/lib/libmhash.a /usr/lib/libmhash.a</li>
<li>ln -s /usr/local/lib/libmhash.la /usr/lib/libmhash.la</li>
<li>ln -s /usr/local/lib/libmhash.so /usr/lib/libmhash.so</li>
<li>ln -s /usr/local/lib/libmhash.so.2 /usr/lib/libmhash.so.2</li>
<li>ln -s /usr/local/lib/libmhash.so.2.0.1 /usr/lib/libmhash.so.2.0.1</li>
</ol>
</li>
<li><p>mcrypt</p>

<ol>
<li>tar -zxvf mcrypt-2.6.8.tar.gz</li>
<li>cd mcrypt-2.6.8</li>
<li>/sbin/ldconfig</li>
<li>./configure</li>
<li>若报错则找不到LIBMCRYPT则

<ol>
<li>export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH</li>
<li>./configure -with-libmcryp-prefix=/usr/local</li>
</ol>
</li>
<li>make

<ol>
<li>报错打开报错的文件 vi /usr/local/include/mutils.h</li>
<li>找到报错的那行看是哪个文件引入失败(mhash_config.h)</li>
<li>find / -name mhash_config.h 在系统中找到该文件</li>
<li>cp /home/Ewan/下载/mhash-0.9.3/mhash_config.h /usr/local/include 拷贝到include文件下</li>
<li>make</li>
</ol>
</li>
<li>make install</li>
</ol>
</li>
<li><p>php-5.5.34.tar.bz2</p>

<ol>
<li>tar -jxvf php-5.5.34.tar.bz2</li>
<li>cd php-5.5.34</li>
<li>./configure &ndash;prefix=/usr/local/php &ndash;enable-fastcgi &ndash;enable-fpm

<ol>
<li>报错 yum install libxml2 libxml2-devel</li>
<li>./configure &ndash;prefix=/usr/local/php &ndash;enable-fastcgi &ndash;enable-fpm</li>
</ol>
</li>
<li>make ZEND_EXTRA_LIBS=&lsquo;-liconv&rsquo;</li>
<li>make install

<ol>
<li>报错 vi /etc/ld.so.conf</li>
<li>输入 /usr/local/lib</li>
<li>make install</li>
<li>如果还是出错 /sbin/ldconfig -v</li>
<li>make install</li>
<li>cp php.ini-dist /usr/local/php/etc/php.ini</li>
</ol>
</li>
</ol>
</li>
<li><p>mysql (5.5版本以下)</p>

<ol>
<li>groupadd mysql //添加组</li>
<li>useradd mysql -g mysql //添加用户</li>
<li>tar -zxvf mysql-x.x.x</li>
<li>cd mysql-x.x.x</li>
<li>./configure &ndash;prefix=/usr/local/mysql &ndash;with-mysqld-ldflags=-all-static &ndash;with-client-ldflags=-all-static &ndash;with-readline &ndash;with-ssl</li>
<li>/usr/local/mysql/bin/mysql_install_db &ndash;user//初始化数据库</li>
<li>cp ./support-files/mysql.server /etc/init.d/mysql //复制启动项到系统中</li>
<li>cp ./support-files/my-medium.cnf /etc/my.cnf</li>
<li>chmod 755 /etc/init.d/mysql(755 分别代表文件拥有者，同组者，其他人的权限 rwx 7为111 可读可写可执行)</li>
<li>cd /usr/local/mysql</li>
<li>chown -R mysql . //将拥有者更改为mysql用户</li>
<li>chgrp -R mysql . //归到mysql组</li>
<li>/usr/local/mysql/bin/mysqladmin -u root password &lsquo;abc123&rsquo; //设置数据库密码</li>
<li>报错 不能连接到local mysql</li>
<li>ps -ef|grep mysql //找到mysql对应的进程号</li>
<li>kill -9 xxxx //杀死进程</li>
<li>/usr/local/mysql/bin/mysql_install_db &ndash;user//初始化数据库</li>
<li>service mysql start //启动MYSQL</li>
<li>/usr/local/mysql/bin/mysqladmin -u root password &lsquo;abc123&rsquo; //设置数据库密码</li>
<li>/usr/local/mysql/bin/mysql -u root -p //测试输入的密码</li>
<li>进入到mysql 后可以\q退出</li>
</ol>
</li>
<li>安装mysql（5.5版本）
  <a href="http://www.mysql.com/">下载Mysql5.5.4</a></li>
</ol>


<p><img src="http://shp.qpic.cn/txdiscuz_pic/0/_bbs_qcloud_com_forum_201503_10_171832lw4gbxwhq9z9vmho.png/0" alt="1" /></p>

<p><img src="http://shp.qpic.cn/txdiscuz_pic/0/_bbs_qcloud_com_forum_201503_10_171836mubv0eb5010ewbjv.png/0" alt="1" /></p>

<pre><code>1. tar zxvf mysql-5.5.40.tar.gz
2. cd mysql-5.5.4
3. yum install ncurses-devel cmake bison-devel libaio-devel gcc-c++ bison -y 
    *  mysql5.5 版本之后，预编译的 configure命令改为了 cmake, 需要手动安装一下 cmake命令
5.  cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql -DMYSQL_DATADIR=/usr/local/mysql/data -DSYSCONFDIR=/etc -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci-- Library mysqlclient depends on OSLIBS -lpthread;m;rt;dl-- Configuring done-- Generating done-- Build files have been written to: /root/mysql-5.5.40 ————预编译无报错，成功。
*  make 
    *  [100%] Building CXX object mysql-test/lib/My/SafeProcess/CMakeFiles/my_safe_process.dir/safe_process.cc.oLinking CXX executable my_safe_process[100%] Built target my_safe_process————无报错，make正常。
*   make install -- Installing: /usr/local/mysql/man/man1/mysql_fix_extensions.1 -- Installing: /usr/local/mysql/man/man1/mysqldumpslow.1 -- Installing: /usr/local/mysql/man/man1/mysql_secure_installation.1 -- Installing: /usr/local/mysql/man/man8/mysqld.8 ————无报错，make install正常。
*    groupadd mysql ————创建mysql组
*     useradd -g mysql mysql ————在mysql组中创建mysql用户
* cp /usr/local/mysql/support-files/my-medium.cnf /etc/my.cnf ————默认没有mysql的配置文件，将源码包中的配置文件拷贝到etc下的配置文件中。
*  /usr/local/mysql/scripts/mysql_install_db --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data ————初始化数据库，指定用户为mysql，家目录为/usr/local/mysql，数据库目录为/usr/local/mysql/data
* chown -R root /usr/local/mysql/ ————改变目录的所有者
* chown -R mysql /usr/local/mysql/data ————改变目录的所有者
* chgrp -R mysql /usr/local/mysql/ ————改变目录的所属组
*  export PATH=$PATH:/usr/local/mysql/bin ————将/usr/local/mysql/bin下的命令放到环境变量中
*   /usr/local/mysql/bin/mysqld_safe --user=mysql &amp; ————启动mysql
* mysql 
    *  Welcome to the MySQL monitor.  Commands end with ; or \g.
         Your MySQL connection id is 1
</code></pre>

<blockquote><p>ps:在实际的操作过程中上面在10步初始化数据库时有可能会error这时可以考虑用</p></blockquote>

<pre><code> ps -ef|grep mysql //找到mysql对应的进程号
 kill -9 xxxx //杀死进程
</code></pre>

<blockquote><p>然后执行</p></blockquote>

<pre><code> chown -R root /usr/local/mysql/ ————改变目录的所有者
 chown -R mysql /usr/local/mysql/data ————改变目录的所有者
 chgrp -R mysql /usr/local/mysql/ ————改变目录的所属组
 export PATH=$PATH:/usr/local/mysql/bin ————将/usr/local/mysql/bin下的命令放到环境变量中
 /usr/local/mysql/scripts/mysql_install_db --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data ————初始化数据库，指定用户为mysql，家目录为/usr/local/mysql，数据库目录为/usr/local/mysql/data
 /usr/local/mysql/bin/mysqld_safe &amp; 启动Mysql 或者
 /usr/local/mysql/bin/mysqld_safe --user=mysql &amp; ————启动mysql
 在执行以下操作
</code></pre>

<h2>Mysql启动、停止的方法</h2>

<pre><code>/usr/local/mysql/bin/mysqld_safe --user=mysql &amp;      启动
mysqladmin –uroot –pxxx  shutdown                  停止
tail -f /var/log/mysqld.log                        查看mysql的错误日志
</code></pre>

<h3>修改 mysql监听地址为127.0.0.1</h3>

<pre><code>netstat -ntulp
tcp        0      0 0.0.0.0:3306                0.0.0.0:*                   LISTEN      28253/mysqld       
tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      1889/sshd    
</code></pre>

<p>默认是监听的0.0.0.0</p>

<pre><code>vi /etc/my.cnf
添加一列
[mysqld]
port            = 3306
socket          = /tmp/mysql.socK
bind-address=127.0.0.1
# mysqladmin -uroot -p shutdow
# /usr/local/mysql/bin/mysqld_safe --user=mysql &amp;
保存并退出
 netstat -ntulp
tcp        0      0 127.0.0.1:3306              0.0.0.0:*                   LISTEN      29103/mysqld   
</code></pre>

<p>————修改成功</p>

<h2>修改 mysql的root密码</h2>

<pre><code>use mysql
update user set Password=PASSWORD('新密码') where User='root' and Host='localhost';
flush privileges;flush privileges;
# mysql -uroot -p
Enter password:
mysql&gt;
</code></pre>

<p>————修改新密码成功</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[linux常用命令]]></title>
    <link href="http://ewanreton.github.io/blog/2016/04/26/linux-chang-yong-min-ling/"/>
    <updated>2016-04-26T18:55:40+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/04/26/linux-chang-yong-min-ling</id>
    <content type="html"><![CDATA[<blockquote><p>Linux 命令总结</p></blockquote>

<!--more-->


<h1>一、常用目录作用</h1>

<ul>
<li>/ 根目录</li>
<li>/bin 命令保存目录（普通用户可以读取的命令）</li>
<li>/boot 启动目录，启动相关文件</li>
<li>/dev  设备文件保存目录</li>
<li>/etc  配置文件目录</li>
<li>/home 普通用户家目录</li>
<li>/lib  系统库保存目录</li>
<li>/mnt  系统挂载目录</li>
<li>/media    挂载目录</li>
<li>/root 超级用户的家目录</li>
<li>/tmp  临时目录</li>
<li>/sbin 命令保存目录（超级用户才能使用）</li>
<li>/proc 直接写入内存</li>
<li>/sys  ~</li>
<li><p>/usr  系统软件资源目录</p>

<ul>
<li>/usr/bin  系统命令（普通用户）</li>
<li>/usr/sbin 系统命令（超级用户）</li>
</ul>
</li>
<li><p>/var  系统相关文档</p></li>
</ul>


<hr />

<h1>二、常用基本命令</h1>

<h2>2.1 目录和文件处理命令</h2>

<ul>
<li><p>mkdir [选项] [目录名] 创建目录</p>

<ul>
<li>-p 递归创建</li>
</ul>
</li>
<li><p>rm [选项] [目录名] 删除</p>

<ul>
<li>-r 删除目录</li>
<li>-f 强制</li>
</ul>
</li>
<li><p>mv [原文件或目录] [目标目录] 剪切或改名</p>

<ul>
<li>没有选项 剪切文件和目录使用相同命令</li>
</ul>
</li>
<li>cp [选项] [原文件或目录] [目标目录]

<ul>
<li>-r 复制目录</li>
<li>-p 连带文件属性复制</li>
<li>-d 若源文件是连接文件，则赋值连接属性</li>
<li>-a 相当于-pdr</li>
</ul>
</li>
<li><p>cd</p>

<ul>
<li>~ 进入家目录</li>
<li><ul>
<li>进入上次目录</li>
</ul>
</li>
<li>.. 进入上级目录</li>
<li>. 进入当前目录</li>
</ul>
</li>
<li><p>pwd 显示当前所在位置</p></li>
<li><p>ls [选项] [目录]</p>

<ul>
<li>-l 长格式 详细信息</li>
<li>-h 人性化显示大小 如-lh 会把大小变成能看懂的格式如128k</li>
<li>-a 显示所有文件</li>
<li>-d 查看目录属性</li>
<li>-i 显示inode id号</li>
</ul>
</li>
</ul>


<h2>2.2链接命令</h2>

<ul>
<li><p>硬链接 不推荐 ln  [原文件] [目标文件]</p>

<ul>
<li>拥有相同的i节点和存储block块，可以看做是同一个文件。相当于一个文件的两个接入。</li>
<li>可以通过i节点识别</li>
<li>不能跨分区</li>
<li>不能针对目录使用</li>
</ul>
</li>
<li><p>软链接</p>

<ul>
<li>类似Windows快捷方式</li>
<li>软链接拥有自己的I节点和Block块，但是数据中只保存原文件的文件名和节点号，并没有实际文件数据</li>
<li>lrwxrwxrwx l 软链接 软链接的权限都为 rwxrwxrwx、</li>
<li>修改任意文件，另一个都改变</li>
<li>删除原文件，软链接不能使用</li>
</ul>
</li>
<li>ln -s [原文件] [目标文件] 软链接 （原文件一定要写绝对路径）</li>
</ul>


<h2>2.3 文件搜索命令</h2>

<ul>
<li>配置文件 /etc/updatedb.conf

<ul>
<li>PRUNE_BIND_MOUNTS=&ldquo;yes&rdquo; #开启器搜索限制</li>
<li>PRUNEFS = #搜索时不搜索的文件系统</li>
<li>PRUNENAMES = #搜索时不搜索的文件系统</li>
<li>PRUNEPATHS = # 搜索时不搜多的路径</li>
</ul>
</li>
<li><p>locate [文件名] 在后台数据库按文件名搜索，搜索速度较快</p>

<ul>
<li>/var/lib/mlocate #locate命令搜索的数据库</li>
<li>updatadb 强制更新数据库（默认一天一更新）</li>
</ul>
</li>
<li><p>whereis [选项] [命令] 搜索命令的命令 输出命令位置和帮助文档位置  只能查系统命令</p>

<ul>
<li>-b 只看命令所在位置</li>
<li>-m 只看帮助文档所在位置</li>
</ul>
</li>
<li><p>which [命令] 找到命令和别命</p></li>
<li><p>find [搜索范围] [搜索文件]</p>

<ul>
<li>find / -name install.log</li>
<li>避免大范围搜索，非常消耗系统资源</li>
<li>*匹配任意内容</li>
<li>？匹配任意一个字符</li>
<li>[]任意中括号之内的一个内容</li>
<li>find / -iname install.log 不区分大小写</li>
<li>find / -user root 按所有者搜索</li>
<li>find / -user -nouser 搜索没有所有者的文件</li>
<li><p>find /var/log -mtime +10 查找十天前修改的文件</p>

<ul>
<li>atime 文件访问时间 -10 十天内</li>
<li>ctime 改变文件属性  10 十天当天</li>
<li>mtime 修改文件内容 +10 十天前</li>
</ul>
</li>
<li><p>find . -size 25k 查找当前目录25k的文件</p>

<ul>
<li>-25 小于25k</li>
<li>+25 大于25k</li>
</ul>
</li>
<li><p>find . -inum xxx 查找当前目录i节点为XX的文件</p></li>
<li>find /etc -size +20k -a -50k  ect下大于20k小于50k的问价

<ul>
<li>-a  and 逻辑与</li>
<li>-o  or  逻辑或</li>
</ul>
</li>
<li>find /etc -size +20k -a -50k -exec ls -lh {} \;将查找到的文件LS出来

<ul>
<li>-exec/-ok 命令 {} \ ; 对搜索结果执行操作、</li>
</ul>
</li>
</ul>
</li>
<li><p>grep [选项] 字符串 文件名 在文件中匹配符合条件的字符串</p>

<ul>
<li>-i 忽略大小写</li>
<li>-v 排除指定字符串</li>
</ul>
</li>
</ul>


<h2>2.4帮助命令</h2>

<ul>
<li><p>man  命令</p>

<ul>
<li>man一共有1-9级 man -f 命令 查看命令有几个帮助级别</li>
<li>man [1-9] 命令 查看现有级别的帮助</li>
</ul>
</li>
<li><p>&ndash;help    或许选项帮助</p>

<ul>
<li>ls &ndash;help 获取选项</li>
</ul>
</li>
<li>help shell内部命令 获取shell内部命令帮助

<ul>
<li>用 whereis cd 来看是否为内部命令，没有执行文件则为内部命令</li>
<li>如 help cd</li>
</ul>
</li>
<li>info 详细命令帮助 太复杂 不常用

<h1>2.5压缩与解压缩命令</h1></li>
<li>常用压缩格式：.zip .gz .bz2 .tar.gz .tar.bz2</li>
<li>zip [目标文件] [源文件]

<ul>
<li>zip -r [压缩目录名] [源目录]</li>
<li>unzip [压缩文件] 解压缩</li>
</ul>
</li>
<li>gzip [源文件] 生成.gz文件 #源文件消失

<ul>
<li>gzip -c 源文件 > 压缩文件 #压缩为.gz 源文件不消失</li>
<li>gzip -r 压缩目录下所有子文件 但是不能压缩目录</li>
<li>gzip -d 压缩包 #解压缩</li>
<li>gunzip 压缩包 #解压缩</li>
</ul>
</li>
<li>bz2 不能压缩目录

<ul>
<li>bzip2 源文件  #不保留源文件</li>
<li>bzip2 -k 源文件  #保留源文件</li>
<li>bzip2 -d 压缩包  #-k保留源文件</li>
<li>bunzip2  压缩包  #-k保留源文件</li>
</ul>
</li>
<li><p>tar -jcvf 压缩包名.tar.bz2 源文件</p>

<ul>
<li>-z 压缩为.tar.gz</li>
<li>-c 打包</li>
<li>-v 显示打包过程</li>
<li>-f 指定打包后的文件名</li>
</ul>
</li>
<li><p>tar -jxvf 压缩包名.tar.bz2 加 -C 指定解压缩位置</p>

<ul>
<li>-z 解压缩.tar.gz

<h1>2.6关机重启命令</h1></li>
</ul>
</li>
<li><p>shutdown [选项] [时间] &amp; #加&amp;表示在后台运行</p>

<ul>
<li>-c 取消前一个关机命令</li>
<li>-h 关机</li>
<li>-r 重启</li>
</ul>
</li>
<li><p>poweroff</p></li>
<li><p>reboot</p></li>
<li><p>init 【0-6】</p>

<ul>
<li>0 关机</li>
<li>1 单用户</li>
<li>2 不完全多用户，不含NFS</li>
<li>3 完全多用户</li>
<li>4 未分配</li>
<li>5 图形界面</li>
<li>6 重启</li>
</ul>
</li>
</ul>


<h1>2.7挂载命令</h1>

<ul>
<li>mount #查看系统已挂载的设备</li>
<li>mount -a #根据配置文件/etc/fstab 的内容 下的设备自动挂载</li>
<li><p>mount [-t 文件系统] [-o 特殊选项] 设备文件名 挂载点</p>

<ul>
<li>-t ext3 ext4 iso9660（光盘）</li>
</ul>
</li>
<li><p>挂载光盘</p>

<ol>
<li>mkdir /mnt/cdroom</li>
<li>mount -t iso9660 /dev/sr0 /mnt/cdrom/ 其中-t在这里可省略因为系统知道sr0为光盘，知道它的文件系统。</li>
<li>umount 设备文件名或挂载点 #卸载 必须卸载！！！</li>
</ol>
</li>
<li><p>挂载U盘</p>

<ol>
<li>fdisk -l 查看系统中已经识别的硬盘</li>
<li>mount -t vfat /dec/sdbx/mnt/usb/ #sdbX通过上一条命令查看可知</li>
<li>Linux默认不支持NTFS文件系统，需要下载ntfs-3g安装可以挂载ntfs但是也只能读。</li>
</ol>
</li>
</ul>


<h1>2.8其他常用命令</h1>

<ul>
<li>用户登录查看

<ul>
<li>w  #查看登录登录用户的信息 输出一些信息 包括占用cpu等</li>
<li>who</li>
<li>输出 用户名 登录登录终端 登录时间和IP</li>
<li>last 查询登录日志 /var/log/wtmp</li>
<li>lastlog 查看每个用户的最后登录信息/var/log/lastlog</li>
</ul>
</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[OAuth]]></title>
    <link href="http://ewanreton.github.io/blog/2016/04/25/oauth/"/>
    <updated>2016-04-25T22:42:34+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/04/25/oauth</id>
    <content type="html"><![CDATA[<blockquote><p>开放式授权OAuth -Open Authorization</p></blockquote>

<h1>一、什么是OAuth</h1>

<p>OAUTH协议为用户资源的授权提供了一个安全的、开放而又简易的标准。与以往的授权方式不同之处是OAUTH的授权不会使第三方触及到用户的帐号信息（如用户名与密码），即第三方无需使用用户的用户名与密码就可以申请获得该用户资源的授权，因此OAUTH是安全的。oAuth是Open Authorization的简写。</p>

<!--more-->


<h1>二、OAuth协议简介</h1>

<ul>
<li>OAuth 1.0 2007年年末 有漏洞</li>
<li>OAuth 2.0 2010年年初</li>
</ul>


<h1>三、三个重要步骤</h1>

<ol>
<li><p>请求OAuth登录页面</p>

<ul>
<li>Request Token URL -未授权的令牌请求服务器 XX网请求QQ登录页面时使用的带有特定参数的URL</li>
<li><a href="http://graph.qq.com/oauth/...?...&amp;client_id=*100490398&amp;...&amp;redirect_url=http://www.xxx.com/...">http://graph.qq.com/oauth/...?...&amp;client_id=*100490398&amp;...&amp;redirect_url=http://www.xxx.com/...</a></li>
<li>client_id APPID</li>
<li>client_secret APPKEY</li>
</ul>
</li>
<li><p>用户使用QQ号登录并授权</p>

<ul>
<li>验证用户密码成功后重定向到指定的url，此时可以通过$_GET[&lsquo;code&rsquo;]来获取</li>
</ul>
</li>
<li>返回登录结果

<ul>
<li>拿到加了密的code过后还需要请求 User Authorization URL -用户授权的令牌请求服务地址 用户QQ登录授权之后请求的一个带有特定参数的URL</li>
<li>用来提高安全性。</li>
<li>请求过后会得到一个响应数据，包含一些基本的账号信息。</li>
<li>code有生命周期（一般为几秒钟）并且只能使用一次。</li>
<li>请求成功过后可以拿到Access Token</li>
</ul>
</li>
</ol>


<h1>四、Access Token</h1>

<p>Access Token -用户通过第三方应用访问OAuth接口的令牌</p>

<ul>
<li>在请求API时会动态生成URL 并且都离不开 Access Token</li>
<li>Access Token具有较长生命周期（十天半个月）</li>
<li>Access Token过期过后可以选择重新登录或者在请求API时使用need_refresh_token（各个平台不同）=true 来刷新Access Token</li>
</ul>

]]></content>
  </entry>
  
</feed>
