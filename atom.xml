<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Ewan Reton]]></title>
  <link href="http://ewanreton.github.io/atom.xml" rel="self"/>
  <link href="http://ewanreton.github.io/"/>
  <updated>2016-06-01T23:51:41+08:00</updated>
  <id>http://ewanreton.github.io/</id>
  <author>
    <name><![CDATA[Ewan Reton]]></name>
    <email><![CDATA[liukedi001@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[JS-DOM-操作]]></title>
    <link href="http://ewanreton.github.io/blog/2016/06/01/js-dom-ying-yong/"/>
    <updated>2016-06-01T23:45:06+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/06/01/js-dom-ying-yong</id>
    <content type="html"><![CDATA[<blockquote><p>DOM操作HTML用起来感觉总有点没理解透。希望借这个机会好好深入一下</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[JS进阶之DOM]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/31/js-jin-jie/"/>
    <updated>2016-05-31T13:28:27+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/31/js-jin-jie</id>
    <content type="html"><![CDATA[<blockquote><p>这段时间开始实习，拿到手一个项目。都没什么时间写博客了，在写这个项目的实际过程中，发现对JS还是很陌生了。所以决定在空余时间提升下JS。在过了一遍基本的之后看到DOM的时候发现这个东西不太好懂，就觉得写个博文。</p></blockquote>

<!--more-->


<h1>认识DOM</h1>

<p>文档对象模型DOM（Document Object Model）定义访问和处理HTML文档的标准方法。DOM 将HTML文档呈现为带有元素、属性和文本的树结构（节点树）。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'><span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=utf-8&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;title&gt;</span>style样式<span class="nt">&lt;/title&gt;</span>
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">&quot;con&quot;</span><span class="nt">&gt;</span>I love JavaScript<span class="nt">&lt;/H2&gt;</span>
</span><span class='line'>  <span class="nt">&lt;p&gt;</span> JavaScript使网页显示动态效果并实现与用户交互功能。<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>   <span class="kd">var</span> <span class="nx">myh2</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;con&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">myh2</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">myh2</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span><span class="o">=</span><span class="s2">&quot;#CCC&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">myh2</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nt">&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>将HTML代码分解为DOM节点层次图：
<img src="http://img.mukewang.com/5375ca7e0001dd8d04830279.jpg" alt="" /></p>

<p><strong>HTML文档可以说由节点构成的集合，DOM节点有:</strong></p>

<ol>
<li><em>元素节点：</em> 上图中<code>&lt;html&gt;、&lt;body&gt;、&lt;p&gt;</code>等都是元素节点，即标签。</li>
<li><em>文本节点:</em>向用户展示的内容，如<code>&lt;li&gt;...&lt;/li&gt;</code>中的JavaScript、DOM、CSS等文本。</li>
<li><em>属性节点:</em>元素属性，如<code>&lt;a&gt;</code>标签的链接属性<code>href="http://www.imooc.com"</code>。</li>
</ol>


<p><strong>节点属性:</strong></p>

<p><img src="http://img.mukewang.com/5375c953000117ee05240129.jpg" alt="" /></p>

<p><strong>遍历节点树：</strong></p>

<p><img src="http://img.mukewang.com/53f17a6400017d2905230219.jpg" alt="" /></p>

<p>以上图ul为例，它的父级节点body,它的子节点3个li,它的兄弟结点h2、P。</p>

<p><strong>DOM操作:</strong></p>

<p><img src="http://img.mukewang.com/538d29da000152db05360278.jpg" alt="" /></p>

<h1>节点属性</h1>

<p>在文档对象模型 (DOM) 中，每个节点都是一个对象。DOM 节点有三个重要的属性 ：</p>

<ol>
<li>nodeName : 节点的名称</li>
<li>nodeValue ：节点的值</li>
<li>nodeType ：节点的类型</li>
</ol>


<p><strong>nodeName 属性: </strong>节点的名称，是只读的。</p>

<ul>
<li>元素节点的 nodeName 与标签名相同</li>
<li>属性节点的 nodeName 是属性的名称</li>
<li>文本节点的 nodeName 永远是 #text</li>
<li>文档节点的 nodeName 永远是 #document</li>
</ul>


<p><strong>nodeValue 属性：</strong>节点的值</p>

<ul>
<li>元素节点的 nodeValue 是 undefined 或 null</li>
<li>文本节点的 nodeValue 是文本自身</li>
<li>属性节点的 nodeValue 是属性的值</li>
</ul>


<p><strong>nodeType 属性:</strong>节点的类型，是只读的。以下常用的几种结点类型:</p>

<table>
<thead>
<tr>
<th> 元素类型  </th>
<th style="text-align:center;"> 节点类型      </th>
</tr>
</thead>
<tbody>
<tr>
<td> 元素      </td>
<td style="text-align:center;"> 1       </td>
</tr>
<tr>
<td> 属性      </td>
<td style="text-align:center;"> 2      </td>
</tr>
<tr>
<td> 文本      </td>
<td style="text-align:center;"> 3      </td>
</tr>
<tr>
<td> 注释      </td>
<td style="text-align:center;"> 8     </td>
</tr>
<tr>
<td> 文档      </td>
<td style="text-align:center;"> 9      </td>
</tr>
</tbody>
</table>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[php加密]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/24/php-jia-mi/"/>
    <updated>2016-05-24T10:38:59+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/24/php-jia-mi</id>
    <content type="html"><![CDATA[<h1>PHP中几种常见的加密方式</h1>

<ul>
<li>Md5()加密算法</li>
<li>Crypt()加密算法</li>
<li>Sha1()加密算法</li>
<li>URL编码加密</li>
<li>Base64编码加密</li>
</ul>


<hr />

<!--more-->


<p><strong>MD5()</strong></p>

<ul>
<li>单向加密算法，不可逆</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">string</span> <span class="nb">md5</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$str</span><span class="p">[,</span><span class="nx">bool</span> <span class="nv">$raw</span><span class="o">=</span><span class="nx">output</span> <span class="o">=</span> <span class="k">false</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p>单向加密，不可逆</p>

<p>$str:原始字符串</p>

<p>$raw_output：一般不用，如果被设置为true，那么md5报文摘要将以16字节长度的原始二进制格式返回。否则返回以32为字符十六进制数字形式返回散列值。
使用过程中最好使用多次md5</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$str</span><span class="o">=</span><span class="s1">&#39;EwanReton&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$code</span><span class="o">=</span><span class="nb">md5</span><span class="p">(</span><span class="nb">md5</span><span class="p">(</span><span class="nv">$str</span><span class="p">,</span><span class="k">true</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Crypt()</strong></p>

<ul>
<li>单向加密算法，不可逆</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">string</span> <span class="nb">crypt</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$str</span><span class="p">[,</span><span class="nx">string</span> <span class="nv">$salt</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p>$str:需要加密的字符串</p>

<p>$salt：盐值。加密时的干扰串，使编码更安全 DES算法标准长度为2 MD5为12
若没有传$salt 将随机生成 否则每次刷新密文不变</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nb">crypt</span><span class="p">(</span><span class="s1">&#39;EwanReton&#39;</span><span class="p">,</span><span class="s1">&#39;ly&#39;</span><span class="p">);</span><span class="c1">//EDS根据盐值的长度自动选用</span>
</span><span class='line'><span class="nx">输出</span><span class="o">:</span><span class="nx">lyxxxxxxxxx</span>
</span><span class='line'><span class="nb">crypt</span><span class="p">(</span><span class="s1">&#39;EwanReton&#39;</span><span class="p">,</span><span class="s1">&#39;$1$ly6661$&#39;</span><span class="p">);</span><span class="c1">//MD5盐值的格式 最多12位</span>
</span><span class='line'><span class="nx">输出：</span><span class="err">$</span><span class="mi">1</span><span class="nv">$ly6661$xxxxxxx</span>
</span></code></pre></td></tr></table></div></figure>


<p>当盐值超过了长度限制会截取相应长度，如EDS中<code>test</code>
会截取成<code>te</code></p>

<p><strong>Sha1()</strong></p>

<ul>
<li>单向加密算法，不可逆</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">string</span> <span class="nb">sha1</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$str</span><span class="p">[,</span><span class="nx">bool</span> <span class="nv">$raw</span><span class="o">=</span><span class="nx">output</span> <span class="o">=</span> <span class="k">false</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p>和md5类似使用也和md5类似多次sha1</p>

<p>$str:原始字符串</p>

<p>$raw_output：一般不用，如果被设置为true，那么sha1摘要将以20字节长度的原始二进制格式返回。否则返回以40为字符十六进制数字形式返回散列值。</p>

<p><strong>URL编码加密</strong></p>

<ul>
<li>urlencode(string $str) //编码字符串</li>
<li>urldecode(string $str) //解码</li>
<li>rawurlencode(string $str) //按照RFC1738进行编码

<ul>
<li>解码也可以用urldecode(string $str)</li>
</ul>
</li>
<li>rawurldecode(string $str)</li>
</ul>


<p>编码规范：除了<code>-_.</code>之外所有非字母数字字符都被替换成百分号（%）后跟两位十六进制数，空格则编码为加号（+）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$str</span><span class="o">=</span><span class="s1">&#39;Ewan Reton&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">echo</span> <span class="nb">urlencode</span><span class="p">(</span><span class="nv">$str</span><span class="p">);</span>
</span><span class='line'><span class="k">echo</span> <span class="s2">&quot;&lt;hr/&gt;&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$str</span><span class="o">=</span><span class="s2">&quot;Ewan Reton.php?act=test&quot;</span><span class="p">;</span>
</span><span class='line'><span class="k">echo</span> <span class="nb">urlencode</span><span class="p">(</span><span class="nv">$str</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>输出</p>

<pre claee="prettyprint linenums">
Ewan+Reton
Ewan+Reton.php%3Fact%3Dtest
</pre>


<p>常见的编码：</p>

<pre class="prettyprint linenums">
? %3F
= %3D
空格 + 按照RFC1738进行编码 为%20
% %25
& %26
\ %5C
+ %2B
</pre>


<p>应用：</p>

<hr />

<p>在使用<code>get</code>方式传值时格式为<code>?key1=vaule&amp;key2=value2</code></p>

<p>但是当我们<code>key1</code>的<code>value</code>为<code>Ewan&amp;Reton</code>在解析时会把Reton也解析成一个传的变量并且值为<code>null</code></p>

<p>为了解决这个问题可以这样处理:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$value</span><span class="o">=</span><span class="s2">&quot;Ewan&amp;Reton&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$str</span><span class="o">=</span><span class="s2">&quot;key1=&quot;</span><span class="o">.</span><span class="nx">urlcode</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;&amp;key2=value2&quot;</span><span class="p">;</span>
</span><span class='line'><span class="k">echo</span> <span class="s2">&quot;&lt;a href=&quot;</span><span class="nx">test</span><span class="o">.</span><span class="nx">php</span><span class="o">?</span><span class="s1">&#39;{$str}&#39;</span><span class="o">&gt;</span><span class="nx">test</span><span class="o">&lt;/</span><span class="nx">a</span><span class="o">&gt;</span><span class="s2">&quot;;</span>
</span></code></pre></td></tr></table></div></figure>


<p>注意：</p>

<p>这里不需要解码，在识别时会自动识别成<code>key1=Ewan&amp;Reton&amp;key2=value2</code></p>

<hr />

<p><strong>base64编码加密</strong></p>

<ul>
<li>base64_encode(string $data)</li>
<li>base64_decode(string $data[,bool $strict=false])

<ul>
<li>//如果输出的数据超出了base64字母表则返回false</li>
</ul>
</li>
</ul>


<p>将任何2进制字符编码到一个可打印的64字符中，中文和图片都可编码。解决早起邮件网关只能识别ASCII。</p>

<p>主要作用将非ASCII码的数据转换成ASCII，其实是一个数据编码并算不上加密算法。</p>

<h1>加密技术分类</h1>

<p><strong>单向散列加密</strong></p>

<p>通过对不同输入长度的信息进行散列计算，得到固定长度的输出，这个散列计算过程是单向的，即不能通过输出反推输入。</p>

<p><strong>对称加密技术</strong></p>

<p>加密和解密使用的密钥是同一个密钥或者可以相互推算。</p>

<p><strong>非对称加密技术</strong></p>

<p>加密和解密使用的密钥不是同一个，其中一个对外公开，被称为公钥，另一个只有拥有者知道。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[数据库优化]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/23/mysql-you-hua/"/>
    <updated>2016-05-23T12:57:08+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/23/mysql-you-hua</id>
    <content type="html"><![CDATA[<blockquote><p>在面试的时候被问到数据库优化问题，结果一下没反应过来理解为了PHP性能优化（懵逼脸）一顿BB，然后就GG了</p></blockquote>

<!--more-->


<h1>SQL及索引优化</h1>

<p><strong>如何发现有问题的SQL？</strong></p>

<p>使用MySQL慢查日志对有效率问题的SQL进行监控</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">show</span> <span class="nx">varilables</span> <span class="nx">like</span> <span class="s1">&#39;show_query_log&#39;</span> <span class="c1">//查看是否开启慢查日志</span>
</span><span class='line'><span class="nx">set</span> <span class="k">global</span> <span class="nx">slow_query_log</span><span class="o">=</span><span class="nx">on</span><span class="p">;</span><span class="c1">//开启慢查日志</span>
</span><span class='line'><span class="nx">set</span> <span class="k">global</span> <span class="nx">slow_query_log_file</span><span class="o">=</span><span class="s1">&#39;/home/mysql/sql_log/mysql-show.log&#39;</span> <span class="c1">//设置保存位置</span>
</span><span class='line'><span class="nx">set</span> <span class="k">global</span> <span class="nx">log_queries_not_using_indexes</span><span class="o">=</span><span class="nx">on</span><span class="p">;</span> <span class="c1">//记录没有索引的SQL</span>
</span><span class='line'><span class="nx">set</span> <span class="k">global</span> <span class="nx">long_query_time</span><span class="o">=</span><span class="mi">1</span> <span class="c1">//记录大于1s的SQL</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>慢查日志分析工具</strong></p>

<ul>
<li><p>mysqldumoslow mysql自带的分析工具</p></li>
<li><p>pt-query-digest 比上一种更详细</p></li>
</ul>


<p><img src="http://f.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=44ebfc52d7a20cf44290feda46323a0b/b3b7d0a20cf431add68638ec4c36acaf2fdd988a.jpg?referer=27406310e7fe9925921b5d60d888&amp;x=.jpg" alt="" /></p>

<p><strong>发现有问题的SQL</strong></p>

<p><img src="http://d.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=c1319fecb4de9c82a265f98a5cbaf137/d009b3de9c82d1589fd62264870a19d8bd3e428a.jpg?referer=af6adca0d188d43fa9bea5c2ae88&amp;x=.jpg" alt="" /></p>

<p><strong>如何分析SQL查询</strong></p>

<p>使用<code>explain</code>查询SQL的执行计划</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">explain</span> <span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">test</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://c.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=9f740fd1900a304e5622a0ffe1f3d6bb/4034970a304e251ff7a19f2da086c9177e3e5394.jpg?referer=d4961c83d71609248532962b9d8a&amp;x=.jpg" alt="" />
<img src="http://e.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=b640bc36502c11dfdad1bf26531c13ed/f3d3572c11dfa9ec5e8a2dc265d0f703908fc1bb.jpg?referer=8596971cd02a60590b07d52a2f59&amp;x=.jpg" alt="" />
<strong>Count()和Max()的优化</strong></p>

<pre class="prettyprint">
Max():添加索引
Count()：在使用时注意查询具体列和*，查询某一列的时候不会包含为NULL的项
</pre>


<p><strong>子查询优化</strong></p>

<pre class="prettyprint">
通常情况下需要把子查询优化为join查询，但在优化时要注意关联建是否有一对多的关系，要注意重复数据。
select * from t where t.id in (select t1.tid from t1);
select t.id from t join t1 on t.id=t1.tid;
当出现一对多的关系需要使用distinct去重
select  distinct t.id from t join t1 on t.id=t1.tid;
</pre>


<p><strong>group by 优化</strong></p>

<pre class="prettyprint linenums">
explain select actor.first_name,actor.last_name,COUNT(*) FROM sakila.file_actor 
INNER JOIN sakila.actor USING(actor_id) 
GROUP BY film_actor.actor.id;
优化后：
SELECT actor.first_name,actor.last_name,c.cnt
FROM sakila.actor INNER JOIN (
SELECT actor_id,COUNT(*) AS cnt FROM sakila.film_actor GROUP BY actor_id
)AS c USING(actor_id);
</pre>


<p><strong>limit 优化</strong></p>

<pre class="prettyprint">
limit 常用于分页处理，时常会伴随order by使用，因此大多时候会使用Filesorts这样会造成大量IO问题
SELECT  film_id,description FROM sakila.film ORDER BY title LIMIT 50,5;
优化1:使用有索引的列或主键进行Order by
SELECT film_id,description FROM sakila.film ORDER BY film_id LIMIT 50,5;
优化2:记录上次返回的主键，在下次查询时使用主键过滤
SELECT film_id,description FROM sakila.film WHERE film_id>55 and film_id<60 ORDER BY film_id LIMIT 1,5;
</pre>


<h1>索引优化</h1>

<ul>
<li>在离散度较大的列上建立联合索引</li>
<li>过多的索引会减小查询效率。</li>
<li>删除重复和多于的索引
<img src="http://a.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=3ebc9bdcb1003af349badc650511b761/d439b6003af33a87e13f7bcfc15c10385243b590.jpg?referer=3ebe61cbbe389b5061e8d462f38e&amp;x=.jpg" alt="" /></li>
</ul>


<p><strong>查找重复和冗余索引</strong></p>

<p><img src="http://e.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=5cde47c1ac18972ba73a00cfd6f60ab4/0824ab18972bd407b932a8287c899e510eb30969.jpg?referer=7acb3d68ae7739129d31b1517728&amp;x=.jpg" alt="" /></p>

<p>需要在 <code>information_schema</code>库下运行</p>

<ul>
<li>使用pt-duplicate-key-checker 工具检查重复及冗余索引</li>
<li>pt-duplicate-key-checker -uroot -p &lsquo;xxxx&rsquo; -h 127.0.0.1</li>
</ul>


<h1>数据库结构优化</h1>

<p><strong>选择合适的数据类型</strong></p>

<ul>
<li>使用可以存下你的数据的最小的数据类型</li>
<li>使用简单的数据类型，Int要比varchar类型在mysql处理上简单</li>
<li>尽可能使用not null 定义字段</li>
<li>尽量少使用text类型，非用不可以时最好考虑分表</li>
<li>使用bigint来存放ip</li>
</ul>


<p><strong>表的范式化和反范式化</strong></p>

<p>范式化一般是指第三设计范式，也就是要求数据表中不存在飞关键字段对任意候选关键字的传递函数依赖则符合第三范式。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PDO实例-发送邮件激活账户]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/22/pdo-shi-li/"/>
    <updated>2016-05-22T16:07:33+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/22/pdo-shi-li</id>
    <content type="html"><![CDATA[<blockquote><p>实现注册发送邮件激活账户</p>

<p>使用swiftmailer-master发送邮件</p></blockquote>

<!--more-->


<p>核心代码:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="c1">//1.包含所需文件</span>
</span><span class='line'><span class="k">require_once</span> <span class="s1">&#39;swiftmailer-master/lib/swift_required.php&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">require_once</span> <span class="s1">&#39;PdoMySQL.class.php&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">require_once</span> <span class="s1">&#39;config.php&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">require_once</span> <span class="s1">&#39;pwd.php&#39;</span><span class="p">;</span>
</span><span class='line'><span class="c1">//2.接收信息</span>
</span><span class='line'><span class="nv">$act</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;act&#39;</span><span class="p">];</span>
</span><span class='line'><span class="nv">$username</span><span class="o">=</span><span class="nb">addslashes</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]);</span>
</span><span class='line'><span class="nv">$password</span><span class="o">=</span><span class="nb">md5</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]);</span>
</span><span class='line'><span class="nv">$email</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">];</span>
</span><span class='line'><span class="nv">$table</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">;</span>
</span><span class='line'><span class="c1">//3.得到连接对象</span>
</span><span class='line'><span class="nv">$PdoMySQL</span><span class="o">=</span><span class="k">new</span> <span class="nx">PdoMySQL</span><span class="p">();</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="nv">$act</span><span class="o">===</span><span class="s1">&#39;reg&#39;</span><span class="p">){</span>
</span><span class='line'>  <span class="nv">$regtime</span><span class="o">=</span><span class="nb">time</span><span class="p">();</span>
</span><span class='line'>  <span class="c1">//完成注册的功能</span>
</span><span class='line'>  <span class="nv">$token</span><span class="o">=</span><span class="nb">md5</span><span class="p">(</span><span class="nv">$username</span><span class="o">.</span><span class="nv">$password</span><span class="o">.</span><span class="nv">$regtime</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$token_exptime</span><span class="o">=</span><span class="nv">$regtime</span><span class="o">+</span><span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="p">;</span><span class="c1">//过期时间</span>
</span><span class='line'>  <span class="nv">$data</span><span class="o">=</span><span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span><span class="s1">&#39;password&#39;</span><span class="p">,</span><span class="s1">&#39;email&#39;</span><span class="p">,</span><span class="s1">&#39;token&#39;</span><span class="p">,</span><span class="s1">&#39;token_exptime&#39;</span><span class="p">,</span><span class="s1">&#39;regtime&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$res</span><span class="o">=</span><span class="nv">$PdoMySQL</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$table</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$lastInsertId</span><span class="o">=</span><span class="nv">$PdoMySQL</span><span class="o">-&gt;</span><span class="na">getLastInsertId</span><span class="p">();</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nv">$res</span><span class="p">){</span>
</span><span class='line'>      <span class="c1">//发送邮件，以QQ邮箱为例</span>
</span><span class='line'>      <span class="c1">//配置邮件服务器，得到传输对象</span>
</span><span class='line'>      <span class="nv">$transport</span><span class="o">=</span><span class="nx">Swift_SmtpTransport</span><span class="o">::</span><span class="na">newInstance</span><span class="p">(</span><span class="s1">&#39;smtp.qq.com&#39;</span><span class="p">,</span><span class="mi">25</span><span class="p">);</span>
</span><span class='line'>      <span class="c1">//设置登陆帐号和密码</span>
</span><span class='line'>      <span class="nv">$transport</span><span class="o">-&gt;</span><span class="na">setUsername</span><span class="p">(</span><span class="s1">&#39;xxxxxxxxx@qq.com&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nv">$transport</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$emailPassword</span><span class="p">);</span>
</span><span class='line'>      <span class="c1">//得到发送邮件对象Swift_Mailer对象</span>
</span><span class='line'>      <span class="nv">$mailer</span><span class="o">=</span><span class="nx">Swift_Mailer</span><span class="o">::</span><span class="na">newInstance</span><span class="p">(</span><span class="nv">$transport</span><span class="p">);</span>
</span><span class='line'>      <span class="c1">//得到邮件信息对象</span>
</span><span class='line'>      <span class="nv">$message</span><span class="o">=</span><span class="nx">Swift_Message</span><span class="o">::</span><span class="na">newInstance</span><span class="p">();</span>
</span><span class='line'>      <span class="c1">//设置管理员的信息</span>
</span><span class='line'>      <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">setFrom</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;xxxxxxxxx@qq.com&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;Reton&#39;</span><span class="p">));</span>
</span><span class='line'>      <span class="c1">//将邮件发给谁</span>
</span><span class='line'>      <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">setTo</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$email</span><span class="o">=&gt;</span><span class="s1">&#39;reton&#39;</span><span class="p">));</span>
</span><span class='line'>      <span class="c1">//设置邮件主题</span>
</span><span class='line'>      <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">setSubject</span><span class="p">(</span><span class="s1">&#39;激活邮件&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nv">$url</span><span class="o">=</span><span class="s2">&quot;http://&quot;</span><span class="o">.</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_HOST&#39;</span><span class="p">]</span><span class="o">.</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;PHP_SELF&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;?act=active&amp;token=</span><span class="si">{</span><span class="nv">$token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="nv">$urlencode</span><span class="o">=</span><span class="nb">urlencode</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
</span><span class='line'>      <span class="nv">$str</span><span class="o">=&lt;&lt;&lt;</span><span class="nx">EOF</span>
</span><span class='line'>      <span class="nx">亲爱的</span><span class="p">{</span><span class="nv">$username</span><span class="p">}</span><span class="nx">您好</span><span class="o">~</span><span class="nx">！感谢您注册我们网站</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
</span><span class='line'>      <span class="nx">请点击此链接激活帐号即可登陆！</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{</span><span class="nv">$url</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">&gt;</span><span class="p">{</span><span class="nv">$urlencode</span><span class="p">}</span><span class="o">&lt;/</span><span class="nx">a</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
</span><span class='line'>      <span class="nx">如果点此链接无反映，可以将其复制到浏览器中来执行，链接的有效时间为24小时。</span>      
</span><span class='line'><span class="nx">EOF</span><span class="p">;</span>
</span><span class='line'>      <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">setBody</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{</span><span class="nv">$str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s1">&#39;text/html&#39;</span><span class="p">,</span><span class="s1">&#39;utf-8&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="k">try</span><span class="p">{</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$message</span><span class="p">)){</span>
</span><span class='line'>              <span class="k">echo</span> <span class="s2">&quot;恭喜您</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">注册成功，请到邮箱激活之后登陆&lt;br/&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>              <span class="k">echo</span> <span class="s1">&#39;3秒钟后跳转到登陆页面&#39;</span><span class="p">;</span>
</span><span class='line'>              <span class="k">echo</span> <span class="s1">&#39;&lt;meta http-equiv=&quot;refresh&quot; content=&quot;3;url=index.php#tologin&quot;/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>              <span class="nv">$PdoMySQL</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="nv">$table</span><span class="p">,</span><span class="s1">&#39;id=&#39;</span><span class="o">.</span><span class="nv">$lastInsertId</span><span class="p">);</span>
</span><span class='line'>              <span class="k">echo</span> <span class="s1">&#39;注册失败，请重新注册&#39;</span><span class="p">;</span>
</span><span class='line'>              <span class="k">echo</span> <span class="s1">&#39;3秒钟后跳转到注册页面&#39;</span><span class="p">;</span>
</span><span class='line'>              <span class="k">echo</span> <span class="s1">&#39;&lt;meta http-equiv=&quot;refresh&quot; content=&quot;3;url=index.php#toregister&quot;/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">Swift_ConnectionException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>          <span class="k">echo</span> <span class="s1">&#39;邮件发送错误&#39;</span><span class="o">.</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s1">&#39;用户注册失败,3秒钟后跳转到注册页面&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s1">&#39;&lt;meta http-equiv=&quot;refresh&quot; content=&quot;3;url=index.php#toregister&quot;/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span><span class="k">elseif</span><span class="p">(</span><span class="nv">$act</span><span class="o">===</span><span class="s1">&#39;login&#39;</span><span class="p">){</span>
</span><span class='line'>  <span class="c1">//完成登陆的功能</span>
</span><span class='line'>  <span class="nv">$row</span><span class="o">=</span><span class="nv">$PdoMySQL</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$table</span><span class="p">,</span><span class="s2">&quot;username=&#39;</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">&#39; AND password=&#39;</span><span class="si">{</span><span class="nv">$password</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span><span class="s1">&#39;status&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s1">&#39;请先激活在登陆&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s1">&#39;&lt;meta http-equiv=&quot;refresh&quot; content=&quot;3;url=index.php#tologin&quot;/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s1">&#39;登陆成功,3秒钟后跳转到首页&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s1">&#39;&lt;meta http-equiv=&quot;refresh&quot; content=&quot;3;url=http://www.imooc.com&quot;/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'><span class="p">}</span><span class="k">elseif</span><span class="p">(</span><span class="nv">$act</span><span class="o">===</span><span class="s1">&#39;active&#39;</span><span class="p">){</span>
</span><span class='line'>  <span class="nv">$token</span><span class="o">=</span><span class="nb">addslashes</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">]);</span>
</span><span class='line'>  <span class="nv">$row</span><span class="o">=</span><span class="nv">$PdoMySQL</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$table</span><span class="p">,</span><span class="s2">&quot;token=&#39;</span><span class="si">{</span><span class="nv">$token</span><span class="si">}</span><span class="s2">&#39; AND status=0&quot;</span><span class="p">,</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;token_exptime&#39;</span><span class="p">));</span>
</span><span class='line'>  <span class="nv">$now</span><span class="o">=</span><span class="nb">time</span><span class="p">();</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nv">$now</span><span class="o">&gt;</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;token_exptime&#39;</span><span class="p">]){</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s1">&#39;激活时间过期，请重新登陆激活&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="nv">$res</span><span class="o">=</span><span class="nv">$PdoMySQL</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">),</span><span class="nv">$table</span><span class="p">,</span><span class="s1">&#39;id=&#39;</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]);</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nv">$res</span><span class="p">){</span>
</span><span class='line'>          <span class="k">echo</span> <span class="s1">&#39;激活成功,3秒钟后跳转到登陆页面&#39;</span><span class="p">;</span>
</span><span class='line'>          <span class="k">echo</span> <span class="s1">&#39;&lt;meta http-equiv=&quot;refresh&quot; content=&quot;3;url=index.php#tologin&quot;/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>          <span class="k">echo</span> <span class="s1">&#39;激活失败，请重新激活&#39;</span><span class="p">;</span>
</span><span class='line'>          <span class="k">echo</span> <span class="s1">&#39;&lt;meta http-equiv=&quot;refresh&quot; content=&quot;3;url=index.php&quot;/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>index.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if lt IE 7 ]&gt; &lt;html lang=&quot;en&quot; class=&quot;no-js ie6 lt8&quot;&gt; &lt;![endif]--&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if IE 7 ]&gt;    &lt;html lang=&quot;en&quot; class=&quot;no-js ie7 lt8&quot;&gt; &lt;![endif]--&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if IE 8 ]&gt;    &lt;html lang=&quot;en&quot; class=&quot;no-js ie8 lt8&quot;&gt; &lt;![endif]--&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if IE 9 ]&gt;    &lt;html lang=&quot;en&quot; class=&quot;no-js ie9&quot;&gt; &lt;![endif]--&gt;</span>
</span><span class='line'><span class="c">&lt;!--[if (gt IE 9)|!(IE)]&gt;&lt;!--&gt;</span> <span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span> <span class="na">class=</span><span class="s">&quot;no-js&quot;</span><span class="nt">&gt;</span> <span class="c">&lt;!--&lt;![endif]--&gt;</span>
</span><span class='line'>    <span class="nt">&lt;head&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="c">&lt;!-- &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge,chrome=1&quot;&gt;  --&gt;</span>
</span><span class='line'>        <span class="nt">&lt;title&gt;</span>Login and Registration Form with HTML5 and CSS3<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">content=</span><span class="s">&quot;Login and Registration Form with HTML5 and CSS3&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;keywords&quot;</span> <span class="na">content=</span><span class="s">&quot;html5, css3, form, switch, animation, :target, pseudo-class&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;author&quot;</span> <span class="na">content=</span><span class="s">&quot;Codrops&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;shortcut icon&quot;</span> <span class="na">href=</span><span class="s">&quot;../favicon.ico&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">href=</span><span class="s">&quot;css/demo.css&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">href=</span><span class="s">&quot;css/style.css&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">href=</span><span class="s">&quot;css/animate-custom.css&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;body&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;header&gt;</span>
</span><span class='line'>                <span class="nt">&lt;h1&gt;</span>It&#39;s Reton<span class="nt">&lt;span&gt;</span>This Is Reton<span class="nt">&lt;/span&gt;&lt;/h1&gt;</span>
</span><span class='line'>              <span class="nt">&lt;nav</span> <span class="na">class=</span><span class="s">&quot;codrops-demos&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;span&gt;</span>Click <span class="nt">&lt;strong&gt;</span>&quot;Join us&quot;<span class="nt">&lt;/strong&gt;</span> to Register the reton<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>              <span class="nt">&lt;/nav&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/header&gt;</span>
</span><span class='line'>            <span class="nt">&lt;section&gt;</span>               
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;container_demo&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;hiddenanchor&quot;</span> <span class="na">id=</span><span class="s">&quot;toregister&quot;</span><span class="nt">&gt;&lt;/a&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;hiddenanchor&quot;</span> <span class="na">id=</span><span class="s">&quot;tologin&quot;</span><span class="nt">&gt;&lt;/a&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;wrapper&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;login&quot;</span> <span class="na">class=</span><span class="s">&quot;animate form&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                            <span class="nt">&lt;form</span>  <span class="na">action=</span><span class="s">&quot;doAction.php?act=login&quot;</span> <span class="na">autocomplete=</span><span class="s">&quot;on&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                                <span class="nt">&lt;h1&gt;</span>Log in<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>                                <span class="nt">&lt;p&gt;</span>
</span><span class='line'>                                    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;username&quot;</span> <span class="na">class=</span><span class="s">&quot;uname&quot;</span> <span class="na">data-icon=</span><span class="s">&quot;u&quot;</span> <span class="nt">&gt;</span> Your username <span class="nt">&lt;/label&gt;</span>
</span><span class='line'>                                    <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">&quot;username&quot;</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span> <span class="na">required=</span><span class="s">&quot;required&quot;</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;My Username&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>                                <span class="nt">&lt;/p&gt;</span>
</span><span class='line'>                                <span class="nt">&lt;p&gt;</span>
</span><span class='line'>                                    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;password&quot;</span> <span class="na">class=</span><span class="s">&quot;youpasswd&quot;</span> <span class="na">data-icon=</span><span class="s">&quot;p&quot;</span><span class="nt">&gt;</span> Your password <span class="nt">&lt;/label&gt;</span>
</span><span class='line'>                                    <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">&quot;password&quot;</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">required=</span><span class="s">&quot;required&quot;</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;*****&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>                                <span class="nt">&lt;/p&gt;</span>
</span><span class='line'>                                <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;keeplogin&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                                  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">name=</span><span class="s">&quot;loginkeeping&quot;</span> <span class="na">id=</span><span class="s">&quot;loginkeeping&quot;</span> <span class="na">value=</span><span class="s">&quot;loginkeeping&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>                                  <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;loginkeeping&quot;</span><span class="nt">&gt;</span>Keep me logged in<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>                              <span class="nt">&lt;/p&gt;</span>
</span><span class='line'>                                <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;login button&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                                    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Login&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>                              <span class="nt">&lt;/p&gt;</span>
</span><span class='line'>                                <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;change_link&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                                  Not a member yet ?
</span><span class='line'>                                  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#toregister&quot;</span> <span class="na">class=</span><span class="s">&quot;to_register&quot;</span><span class="nt">&gt;</span>Join us<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>                              <span class="nt">&lt;/p&gt;</span>
</span><span class='line'>                            <span class="nt">&lt;/form&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>                        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;register&quot;</span> <span class="na">class=</span><span class="s">&quot;animate form&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                            <span class="nt">&lt;form</span>  <span class="na">action=</span><span class="s">&quot;doAction.php?act=reg&quot;</span> <span class="na">autocomplete=</span><span class="s">&quot;on&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                                <span class="nt">&lt;h1&gt;</span> Sign up <span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>                                <span class="nt">&lt;p&gt;</span>
</span><span class='line'>                                    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;usernamesignup&quot;</span> <span class="na">class=</span><span class="s">&quot;uname&quot;</span> <span class="na">data-icon=</span><span class="s">&quot;u&quot;</span><span class="nt">&gt;</span>Your username<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>                                    <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">&quot;usernamesignup&quot;</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span> <span class="na">required=</span><span class="s">&quot;required&quot;</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;Mr.King&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>                                <span class="nt">&lt;/p&gt;</span>
</span><span class='line'>                                <span class="nt">&lt;p&gt;</span>
</span><span class='line'>                                    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;emailsignup&quot;</span> <span class="na">class=</span><span class="s">&quot;youmail&quot;</span> <span class="na">data-icon=</span><span class="s">&quot;e&quot;</span> <span class="nt">&gt;</span> Your email<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>                                    <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">&quot;emailsignup&quot;</span> <span class="na">name=</span><span class="s">&quot;email&quot;</span> <span class="na">required=</span><span class="s">&quot;required&quot;</span> <span class="na">type=</span><span class="s">&quot;email&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;xxxx@mail.com&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>                                <span class="nt">&lt;/p&gt;</span>
</span><span class='line'>                                <span class="nt">&lt;p&gt;</span>
</span><span class='line'>                                    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;passwordsignup&quot;</span> <span class="na">class=</span><span class="s">&quot;youpasswd&quot;</span> <span class="na">data-icon=</span><span class="s">&quot;p&quot;</span><span class="nt">&gt;</span>Your password <span class="nt">&lt;/label&gt;</span>
</span><span class='line'>                                    <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">&quot;passwordsignup&quot;</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">required=</span><span class="s">&quot;required&quot;</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;******&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>                                <span class="nt">&lt;/p&gt;</span>
</span><span class='line'>                                <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;signin button&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                                  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Sign up&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>                              <span class="nt">&lt;/p&gt;</span>
</span><span class='line'>                                <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;change_link&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                                  Already a member ?
</span><span class='line'>                                  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#tologin&quot;</span> <span class="na">class=</span><span class="s">&quot;to_register&quot;</span><span class="nt">&gt;</span> Go and log in <span class="nt">&lt;/a&gt;</span>
</span><span class='line'>                              <span class="nt">&lt;/p&gt;</span>
</span><span class='line'>                            <span class="nt">&lt;/form&gt;</span>
</span><span class='line'>                        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>                      
</span><span class='line'>                    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/section&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Learn-more-PDO]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/19/learn-more-pdo/"/>
    <updated>2016-05-19T18:47:27+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/19/learn-more-pdo</id>
    <content type="html"><![CDATA[<blockquote><p>前段时间在做手机归属地查询的Demo时突然发现自己对PDO还是太生疏，一直都是用的以前的代码。很多都不太了解，于是重新系统的学习了一下PDO类。</p></blockquote>

<!--more-->


<h1>什么是PDO</h1>

<p>PDO（PHP Data Object）数据库访问抽象层，统一各种数据库的访问接口。
<strong>特性</strong>
* 编码一致性
* 灵活性
* 高性能
* 面向对象特性</p>

<p>PDO的安装与配置，和PHP其他扩展的开启一样，只需要在<code>php.ini</code>里设置即可，这里就不多说了。</p>

<h1>PDO连接数据库</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="c1">//通过参数形式连接数据库</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$dsn</span><span class="o">=</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$username</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$passwd</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$passwd</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$pdo</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://b.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=d2ce6c87044f78f0840b9af6490a7b68/aa64034f78f0f73686e0bed20d55b319eac413c2.jpg?referer=c0077f7aae014c08402c1c955dc1&amp;x=.jpg" alt="" /></p>

<h1>PDO exec</h1>

<blockquote><p>增删改，返回得是受影响的行数</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">//exec():执行一条sql语句并返回其受影响的记录的条数,如果没有受影响的记录，他返回0</span>
</span><span class='line'>  <span class="c1">//exec对于select没有作用</span>
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=&lt;&lt;&lt;</span><span class="nx">EOF</span>
</span><span class='line'>      <span class="nx">CREATE</span> <span class="nx">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="nx">EXISTS</span> <span class="nx">user</span><span class="p">(</span>
</span><span class='line'>      <span class="nx">id</span> <span class="nx">INT</span> <span class="nx">UNSIGNED</span> <span class="nx">AUTO_INCREMENT</span> <span class="nx">KEY</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">username</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="nx">UNIQUE</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">password</span> <span class="nx">CHAR</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">email</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
</span><span class='line'>      <span class="p">);</span>
</span><span class='line'><span class="nx">EOF</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">//$sql=&#39;INSERT user(username,password,email) VALUES(&quot;reton&quot;,&quot;reton&quot;,&quot;reton@qq.com&quot;)&#39;;</span>
</span><span class='line'>  <span class="c1">//$res=$pdo-&gt;exec($sql);</span>
</span><span class='line'>  <span class="c1">//echo &#39;受影响的记录的条数为：&#39;.$res,&#39;&lt;br/&gt;&#39;;</span>
</span><span class='line'>  <span class="c1">//$pdo-&gt;lastInsertId():得到新插入记录的ID号</span>
</span><span class='line'>  <span class="c1">//echo &#39;最后插入的ID号为&#39;.$pdo-&gt;lastInsertId();</span>
</span><span class='line'>  <span class="nv">$res</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$res</span><span class="p">);</span>   
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s1">&#39;INSERT user(username,password,email) VALUES(&quot;reton&quot;,&quot;&#39;</span><span class="o">.</span><span class="nb">md5</span><span class="p">(</span><span class="s1">&#39;reton&#39;</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;&quot;,&quot;test@qq.com&quot;)&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//echo $sql;</span>
</span><span class='line'>  <span class="nv">$res</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$res</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>PDO error 获取错误信息</h1>

<blockquote><p>获取错误码和错误信息</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s1">&#39;delete from user12 where id=1&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$res</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">//echo $res.&#39;条记录被影响&#39;;</span>
</span><span class='line'>  <span class="c1">//var_dump($res);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nv">$res</span><span class="o">===</span><span class="k">false</span><span class="p">){</span>
</span><span class='line'>      <span class="c1">//$pdo-&gt;errorCode():SQLSTATE的值</span>
</span><span class='line'>      <span class="k">echo</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">errorCode</span><span class="p">();</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s1">&#39;&lt;hr/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="c1">//$pdo-&gt;errorInfo():返回的错误信息的数组，数组中包含3个单元</span>
</span><span class='line'>      <span class="c1">//0=&gt;SQLSTATE,1=&gt;CODE,2=&gt;INFO</span>
</span><span class='line'>      <span class="nv">$errInfo</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">errorInfo</span><span class="p">();</span>
</span><span class='line'>      <span class="nb">print_r</span><span class="p">(</span><span class="nv">$errInfo</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="c1">//   echo &#39;&lt;hr/&gt;&#39;;</span>
</span><span class='line'><span class="c1">//   echo $pdo-&gt;lastInsertId();</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>PDO query</h1>

<blockquote><p>执行查询，返回的是PDOStatement对象</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">//$sql=&#39;select * from user where id=2&#39;;</span>
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s1">&#39;select id,username,email from user&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">//$pdo-&gt;query($sql)，执行SQL语句，返回PDOStatement对象</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$stmt</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;&lt;hr/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">foreach</span><span class="p">(</span><span class="nv">$stmt</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">){</span>
</span><span class='line'>      <span class="c1">//print_r($row);</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s1">&#39;编号：&#39;</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span><span class="s1">&#39;&lt;br/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s1">&#39;用户名：&#39;</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">],</span><span class="s1">&#39;&lt;br/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s1">&#39;邮箱：&#39;</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">],</span><span class="s1">&#39;&lt;br/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s1">&#39;&lt;hr/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>PDO prepare</h1>

<blockquote><p>prepare 准备方法</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s1">&#39;select * from user where username=&quot;reton&quot;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">//prepare($sql):准备SQL语句</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">//execute():执行预处理语句</span>
</span><span class='line'>  <span class="nv">$res</span><span class="o">=</span><span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</span><span class='line'>  <span class="c1">//var_dump($res);</span>
</span><span class='line'>  <span class="c1">//fetch():得到结果集中的一条记录</span>
</span><span class='line'>  <span class="nv">$row</span><span class="o">=</span><span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">();</span>
</span><span class='line'>  <span class="nb">print_r</span><span class="p">(</span><span class="nv">$row</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">//var_dump($stmt);</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>fetch.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s1">&#39;select * from user&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$res</span><span class="o">=</span><span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</span><span class='line'><span class="c1">//   if($res){</span>
</span><span class='line'><span class="c1">//       while($row=$stmt-&gt;fetch()){</span>
</span><span class='line'><span class="c1">//           print_r($row);</span>
</span><span class='line'><span class="c1">//           echo &#39;&lt;hr/&gt;&#39;;</span>
</span><span class='line'><span class="c1">//       }</span>
</span><span class='line'><span class="c1">//   }</span>
</span><span class='line'>  <span class="nv">$rows</span><span class="o">=</span><span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">();</span>
</span><span class='line'>  <span class="nb">print_r</span><span class="p">(</span><span class="nv">$rows</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">//var_dump($stmt);</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>setFetchMode.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s1">&#39;select * from user&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$res</span><span class="o">=</span><span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</span><span class='line'><span class="c1">//   if($res){</span>
</span><span class='line'><span class="c1">//       while($row=$stmt-&gt;fetch(PDO::FETCH_OBJ)){//返回对象</span>
</span><span class='line'><span class="c1">//           print_r($row);</span>
</span><span class='line'><span class="c1">//           echo &#39;&lt;hr/&gt;&#39;;</span>
</span><span class='line'><span class="c1">//       }</span>
</span><span class='line'><span class="c1">//   }</span>
</span><span class='line'><span class="c1">//   $rows=$stmt-&gt;fetchAll(PDO::FETCH_ASSOC);//返回关联数组BOTH为数组加索引</span>
</span><span class='line'><span class="c1">//   print_r($rows);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;&lt;hr/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">setFetchMode</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">);</span><span class="c1">//set了就不用传参了    </span>
</span><span class='line'>  <span class="c1">//var_dump($stmt);</span>
</span><span class='line'>  <span class="nv">$rows</span><span class="o">=</span><span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">();</span>
</span><span class='line'>  <span class="nb">print_r</span><span class="p">(</span><span class="nv">$rows</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>PDO getAttribute</h1>

<blockquote><p>获得数据库连接属性</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$dsn</span><span class="o">=</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$username</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$passwd</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$passwd</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;自动提交：&#39;</span><span class="o">.</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">getAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_AUTOCOMMIT</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;&lt;br/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;PDO默认的错误处理模式：&#39;</span><span class="o">.</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">getAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_AUTOCOMMIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;&lt;br/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;自动提交：&#39;</span><span class="o">.</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">getAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_AUTOCOMMIT</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>获取常用属性 并不是所有环境都支持一下的属性</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$dsn</span><span class="o">=</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$username</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$passwd</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$passwd</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$attrArr</span><span class="o">=</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>      <span class="s1">&#39;AUTOCOMMIT&#39;</span><span class="p">,</span><span class="s1">&#39;ERRMODE&#39;</span><span class="p">,</span><span class="s1">&#39;CASE&#39;</span><span class="p">,</span><span class="s1">&#39;PERSISTENT&#39;</span><span class="p">,</span><span class="s1">&#39;TIMEOUT&#39;</span><span class="p">,</span><span class="s1">&#39;ORACLE_NULLS&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="s1">&#39;SERVER_INFO&#39;</span><span class="p">,</span><span class="s1">&#39;SERVER_VERSION&#39;</span><span class="p">,</span><span class="s1">&#39;CLIENT_VERSION&#39;</span><span class="p">,</span><span class="s1">&#39;CONNECTION_STATUS&#39;</span>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'>  <span class="k">foreach</span><span class="p">(</span><span class="nv">$attrArr</span> <span class="k">as</span> <span class="nv">$attr</span><span class="p">){</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s2">&quot;PDO::ATTR_</span><span class="si">$attr</span><span class="s2">: &quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">echo</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">getAttribute</span><span class="p">(</span><span class="nb">constant</span><span class="p">(</span><span class="s2">&quot;PDO::ATTR_</span><span class="si">$attr</span><span class="s2">&quot;</span><span class="p">)),</span><span class="s1">&#39;&lt;br/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>PDO setAttribute</h1>

<blockquote><p>设置数据库连接属性</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$dsn</span><span class="o">=</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$username</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$passwd</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$options</span><span class="o">=</span><span class="k">array</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_AUTOCOMMIT</span><span class="o">=&gt;</span><span class="mi">0</span><span class="p">,</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="o">=&gt;</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$passwd</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">getAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_AUTOCOMMIT</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;&lt;br/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">getAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>PDOStatement 对象的使用</h1>

<p><strong>quote防注入</strong></p>

<figure class='code'><figcaption><span>login.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'> <span class="cp">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
</span><span class='line'><span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'><span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;title&gt;</span>Insert title here<span class="nt">&lt;/title&gt;</span>
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&#39;doAction2.php&#39;</span> <span class="na">method=</span><span class="s">&#39;post&#39;</span><span class="nt">&gt;</span>
</span><span class='line'>用户名：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&#39;text&#39;</span> <span class="na">name=</span><span class="s">&#39;username&#39;</span> <span class="nt">/&gt;&lt;br/&gt;</span>
</span><span class='line'>密码：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&#39;password&#39;</span> <span class="na">name=</span><span class="s">&#39;password&#39;</span><span class="nt">/&gt;&lt;br/&gt;</span>
</span><span class='line'><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&#39;submit&#39;</span> <span class="na">value=</span><span class="s">&#39;登陆&#39;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/form&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>doAction2.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$username</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">];</span>
</span><span class='line'><span class="nv">$password</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">];</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>   
</span><span class='line'>  <span class="c1">//echo $pdo-&gt;quote($username);</span>
</span><span class='line'>  <span class="c1">//$sql=&quot;select * from user where username=&#39;{$username}&#39; and password=&#39;{$password}&#39;&quot;;</span>
</span><span class='line'>  <span class="c1">//echo $sql;</span>
</span><span class='line'>  <span class="c1">//通过quote():返回带引号的字符串，过滤字符串中的特殊字符</span>
</span><span class='line'>  <span class="nv">$username</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">quote</span><span class="p">(</span><span class="nv">$username</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;select * from user where username=</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2"> and password=&#39;</span><span class="si">{</span><span class="nv">$password</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$sql</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">//PDOStatement对象的方法：rouCount()：对于select操作返回的结果集中记录的条数，</span>
</span><span class='line'>  <span class="c1">//对于INSERT、UPDATE、DELETE返回受影响的记录的条数</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">rowCount</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>预处理语句的占位符</strong>
第一种用：xxx</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$username</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">];</span>
</span><span class='line'><span class="nv">$password</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">];</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>   
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;select * from user where username=:username and password=:password&quot;</span><span class="p">;</span> <span class="c1">//占位</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">&quot;:username&quot;</span><span class="o">=&gt;</span><span class="nv">$username</span><span class="p">,</span><span class="s2">&quot;:password&quot;</span><span class="o">=&gt;</span><span class="nv">$password</span><span class="p">));</span><span class="nx">赋值</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">rowCount</span><span class="p">();</span>
</span><span class='line'>  
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>第二种用？</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$username</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">];</span>
</span><span class='line'><span class="nv">$password</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">];</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>   
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;select * from user where username=? and password=?&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">));</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">rowCount</span><span class="p">();</span>
</span><span class='line'>  
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>bindParam()方法绑定参数到变量</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>   
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;INSERT user(username,password,email) VALUES(:username,:password,:email)&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>   
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="s2">&quot;:username&quot;</span><span class="p">,</span><span class="nv">$username</span><span class="p">,</span><span class="nx">PDO</span><span class="o">::</span><span class="na">PARAM_STR</span><span class="p">);</span><span class="c1">//绑定参数，被绑定的项，绑定的地址（不能直接写值），参数类型。如果是用的？第一个参数要写1,2,3。表示第几个占位符</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="s2">&quot;:password&quot;</span><span class="p">,</span><span class="nv">$password</span><span class="p">,</span><span class="nx">PDO</span><span class="o">::</span><span class="na">PARAM_STR</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="s2">&quot;:email&quot;</span><span class="p">,</span><span class="nv">$email</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$username</span><span class="o">=</span><span class="s1">&#39;imooc1&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$password</span><span class="o">=</span><span class="s1">&#39;imooc1&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$email</span><span class="o">=</span><span class="s1">&#39;imooc1@imooc.com&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</span><span class='line'>  <span class="nv">$username</span><span class="o">=</span><span class="s1">&#39;MR.KING1&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$password</span><span class="o">=</span><span class="s1">&#39;MR.KING1&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$email</span><span class="o">=</span><span class="s1">&#39;MR.KING1@imooc.com&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">rowCount</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>PDO错误处理模式</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> PDO::ERRMODE_SLIENT:默认模式，静默模式</span>
</span><span class='line'><span class="cm"> PDO::ERRMODE_WARNING:警告模式</span>
</span><span class='line'><span class="cm"> PDO::ERRMODE_EXCEPTION:异常模式</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s1">&#39;SELECT * FROM noneTable&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">errorCode</span><span class="p">();</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;&lt;br/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nb">print_r</span><span class="p">(</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">errorInfo</span><span class="p">());</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://d.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=d28d1e1ad02a60595610e11f180f45a6/d8f9d72a6059252d57a8efd7339b033b5ab5b9a2.jpg?referer=c8b46b4c29dda3cc52f38c100760&amp;x=.jpg" alt="" />
<strong>PDO事务处理模式</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$dsn</span><span class="o">=</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$username</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$passwd</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$options</span><span class="o">=</span><span class="k">array</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_AUTOCOMMIT</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$passwd</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">inTransaction</span><span class="p">());</span>
</span><span class='line'>  <span class="c1">//开启事务</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">beginTransaction</span><span class="p">();</span>
</span><span class='line'>  <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">inTransaction</span><span class="p">());</span>
</span><span class='line'>  <span class="c1">//$sql=&#39;UPDATE userAccount SET money=money-2000 WHERE username=&quot;imooc&quot;&#39;;</span>
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s1">&#39;UPDATE userAccount SET money=money-2000 WHERE username=&quot;imooc&quot;&#39;</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="nv">$res1</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nv">$res1</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="k">throw</span> <span class="k">new</span> <span class="nx">PDOException</span><span class="p">(</span><span class="s1">&#39;imooc 转账失败&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nv">$res2</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s1">&#39;UPDATE userAccount SET money=money+2000 WHERE username=&quot;king1&quot;&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nv">$res2</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="k">throw</span> <span class="k">new</span> <span class="nx">PDOException</span><span class="p">(</span><span class="s1">&#39;king 接收失败&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="c1">//提交事务</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">commit</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="c1">//回滚事务</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">rollBack</span><span class="p">();</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>PDO操作类封装</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
<span class='line-number'>310</span>
<span class='line-number'>311</span>
<span class='line-number'>312</span>
<span class='line-number'>313</span>
<span class='line-number'>314</span>
<span class='line-number'>315</span>
<span class='line-number'>316</span>
<span class='line-number'>317</span>
<span class='line-number'>318</span>
<span class='line-number'>319</span>
<span class='line-number'>320</span>
<span class='line-number'>321</span>
<span class='line-number'>322</span>
<span class='line-number'>323</span>
<span class='line-number'>324</span>
<span class='line-number'>325</span>
<span class='line-number'>326</span>
<span class='line-number'>327</span>
<span class='line-number'>328</span>
<span class='line-number'>329</span>
<span class='line-number'>330</span>
<span class='line-number'>331</span>
<span class='line-number'>332</span>
<span class='line-number'>333</span>
<span class='line-number'>334</span>
<span class='line-number'>335</span>
<span class='line-number'>336</span>
<span class='line-number'>337</span>
<span class='line-number'>338</span>
<span class='line-number'>339</span>
<span class='line-number'>340</span>
<span class='line-number'>341</span>
<span class='line-number'>342</span>
<span class='line-number'>343</span>
<span class='line-number'>344</span>
<span class='line-number'>345</span>
<span class='line-number'>346</span>
<span class='line-number'>347</span>
<span class='line-number'>348</span>
<span class='line-number'>349</span>
<span class='line-number'>350</span>
<span class='line-number'>351</span>
<span class='line-number'>352</span>
<span class='line-number'>353</span>
<span class='line-number'>354</span>
<span class='line-number'>355</span>
<span class='line-number'>356</span>
<span class='line-number'>357</span>
<span class='line-number'>358</span>
<span class='line-number'>359</span>
<span class='line-number'>360</span>
<span class='line-number'>361</span>
<span class='line-number'>362</span>
<span class='line-number'>363</span>
<span class='line-number'>364</span>
<span class='line-number'>365</span>
<span class='line-number'>366</span>
<span class='line-number'>367</span>
<span class='line-number'>368</span>
<span class='line-number'>369</span>
<span class='line-number'>370</span>
<span class='line-number'>371</span>
<span class='line-number'>372</span>
<span class='line-number'>373</span>
<span class='line-number'>374</span>
<span class='line-number'>375</span>
<span class='line-number'>376</span>
<span class='line-number'>377</span>
<span class='line-number'>378</span>
<span class='line-number'>379</span>
<span class='line-number'>380</span>
<span class='line-number'>381</span>
<span class='line-number'>382</span>
<span class='line-number'>383</span>
<span class='line-number'>384</span>
<span class='line-number'>385</span>
<span class='line-number'>386</span>
<span class='line-number'>387</span>
<span class='line-number'>388</span>
<span class='line-number'>389</span>
<span class='line-number'>390</span>
<span class='line-number'>391</span>
<span class='line-number'>392</span>
<span class='line-number'>393</span>
<span class='line-number'>394</span>
<span class='line-number'>395</span>
<span class='line-number'>396</span>
<span class='line-number'>397</span>
<span class='line-number'>398</span>
<span class='line-number'>399</span>
<span class='line-number'>400</span>
<span class='line-number'>401</span>
<span class='line-number'>402</span>
<span class='line-number'>403</span>
<span class='line-number'>404</span>
<span class='line-number'>405</span>
<span class='line-number'>406</span>
<span class='line-number'>407</span>
<span class='line-number'>408</span>
<span class='line-number'>409</span>
<span class='line-number'>410</span>
<span class='line-number'>411</span>
<span class='line-number'>412</span>
<span class='line-number'>413</span>
<span class='line-number'>414</span>
<span class='line-number'>415</span>
<span class='line-number'>416</span>
<span class='line-number'>417</span>
<span class='line-number'>418</span>
<span class='line-number'>419</span>
<span class='line-number'>420</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">PdoMySQL</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="nv">$config</span><span class="o">=</span><span class="k">array</span><span class="p">();</span><span class="c1">//设置链接参数，配置信息</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="nv">$link</span><span class="o">=</span><span class="k">null</span><span class="p">;</span><span class="c1">//保存链接标识符</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="nv">$pconnect</span><span class="o">=</span><span class="k">false</span><span class="p">;</span><span class="c1">//是否开启长链接</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="nv">$dbVersion</span><span class="o">=</span><span class="k">null</span><span class="p">;</span><span class="c1">//保存数据库版本</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="nv">$connected</span><span class="o">=</span><span class="k">false</span><span class="p">;</span><span class="c1">//是否链接成共</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="nv">$PDOStatement</span><span class="o">=</span><span class="k">null</span><span class="p">;</span><span class="c1">//保存ＰＤＯStatement对象</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="nv">$queryStr</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span><span class="c1">//保存最后执行的操作</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="nv">$error</span><span class="o">=</span><span class="k">null</span><span class="p">;</span><span class="c1">//保存错误信息</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="nv">$lastInsertId</span><span class="o">=</span><span class="k">null</span><span class="p">;</span><span class="c1">//最后插入记录的id</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="nv">$numRows</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="c1">//保存上一步影响的行数</span>
</span><span class='line'>        <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$dbConfig</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">class_exists</span><span class="p">(</span><span class="s2">&quot;PDO&quot;</span><span class="p">)){</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="na">throw_excption</span><span class="p">(</span><span class="s2">&quot;不支持ＰＤＯ，请先开启&quot;</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$dbConfig</span><span class="p">)){</span>
</span><span class='line'>                <span class="nv">$dbConfig</span><span class="o">=</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>                    <span class="s2">&quot;hostname&quot;</span> <span class="o">=&gt;</span> <span class="nx">DB_HOST</span><span class="p">,</span>
</span><span class='line'>                    <span class="s2">&quot;username&quot;</span> <span class="o">=&gt;</span> <span class="nx">DB_USER</span><span class="p">,</span>
</span><span class='line'>                    <span class="s2">&quot;password&quot;</span> <span class="o">=&gt;</span> <span class="nx">DB_PWD</span><span class="p">,</span>
</span><span class='line'>                    <span class="s2">&quot;database&quot;</span> <span class="o">=&gt;</span> <span class="nx">DB_NAME</span><span class="p">,</span>
</span><span class='line'>                    <span class="s2">&quot;hostport&quot;</span> <span class="o">=&gt;</span> <span class="nx">DB_PORT</span><span class="p">,</span>
</span><span class='line'>                    <span class="s2">&quot;dbms&quot;</span>     <span class="o">=&gt;</span> <span class="nx">DB_TYPE</span><span class="p">,</span>
</span><span class='line'>                    <span class="s2">&quot;dsn&quot;</span> <span class="o">=&gt;</span><span class="nx">DB_TYPE</span><span class="o">.</span><span class="s2">&quot;:host=&quot;</span><span class="o">.</span><span class="nx">DB_HOST</span><span class="o">.</span><span class="s2">&quot;;dbname=&quot;</span><span class="o">.</span><span class="nx">DB_NAME</span>
</span><span class='line'>                <span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$dbConfig</span><span class="p">[</span><span class="s1">&#39;hostname&#39;</span><span class="p">]))</span><span class="nx">self</span><span class="o">::</span><span class="na">throw_excption</span><span class="p">(</span><span class="s2">&quot;没有定义数据库配置，请先定义。&quot;</span><span class="p">);</span>
</span><span class='line'>            <span class="nx">self</span><span class="o">::</span><span class="nv">$config</span><span class="o">=</span><span class="nv">$dbConfig</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$config</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]))</span><span class="nx">self</span><span class="o">::</span><span class="nv">$config</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span><span class="o">=</span><span class="k">array</span><span class="p">();</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="p">)){</span>
</span><span class='line'>                <span class="nv">$configs</span><span class="o">=</span><span class="nx">self</span><span class="o">::</span><span class="nv">$config</span><span class="p">;</span>
</span><span class='line'>                <span class="k">if</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$pconnect</span><span class="p">){</span>
</span><span class='line'>                    <span class="c1">//开启长链接，添加到配置数组中</span>
</span><span class='line'>                    <span class="nv">$configs</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="nb">constant</span><span class="p">(</span><span class="s2">&quot;PDO::ATTR_PERSISTENT&quot;</span><span class="p">)]</span><span class="o">=</span><span class="k">true</span><span class="p">;</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>                <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nv">$configs</span><span class="p">[</span><span class="s1">&#39;dsn&#39;</span><span class="p">],</span><span class="nv">$configs</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span><span class="nv">$configs</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">],</span><span class="nv">$configs</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]);</span>
</span><span class='line'>                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nx">self</span><span class="o">::</span><span class="na">throw_excption</span><span class="p">(</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">());</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>                <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="p">){</span>
</span><span class='line'>                    <span class="nx">self</span><span class="o">::</span><span class="na">throw_excption</span><span class="p">(</span><span class="s2">&quot;PDO链接错误&quot;</span><span class="p">);</span>
</span><span class='line'>                    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s1">&#39;SET NAMES&#39;</span><span class="o">.</span><span class="nx">DB_CHARSET</span><span class="p">);</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="nv">$dbVersion</span><span class="o">=</span><span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="o">-&gt;</span><span class="na">getAttribute</span><span class="p">(</span><span class="nb">constant</span><span class="p">(</span><span class="s2">&quot;PDO::ATTR_SERVER_VERSION&quot;</span><span class="p">));</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="nv">$connected</span><span class="o">=</span><span class="k">true</span><span class="p">;</span>
</span><span class='line'>                <span class="nb">unset</span><span class="p">(</span><span class="nv">$configs</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 得到所有记录</span>
</span><span class='line'><span class="sd">         * @param  [type] $sql [description]</span>
</span><span class='line'><span class="sd">         * @return [type]      [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>         <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getAll</span><span class="p">(</span><span class="nv">$sql</span><span class="o">=</span><span class="k">null</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nv">$sql</span><span class="o">!=</span><span class="k">null</span><span class="p">){</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="nv">$result</span><span class="o">=</span><span class="nx">self</span><span class="o">::</span><span class="nv">$PDOStatement</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">(</span><span class="nb">constant</span><span class="p">(</span><span class="s2">&quot;PDO::FETCH_ASSOC&quot;</span><span class="p">));</span>
</span><span class='line'>            <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 得到结果集中的一条记录</span>
</span><span class='line'><span class="sd">         * @param  [type] $sql [description]</span>
</span><span class='line'><span class="sd">         * @return [type]      [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getRow</span><span class="p">(</span><span class="nv">$sql</span><span class="o">=</span><span class="k">null</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nv">$sql</span><span class="o">!=</span><span class="k">null</span><span class="p">){</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="nv">$result</span> <span class="o">=</span><span class="nx">self</span><span class="o">::</span><span class="nv">$PDOStatement</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">(</span><span class="nb">constant</span><span class="p">(</span><span class="s2">&quot;PDO::FETCH_ASSOC&quot;</span><span class="p">));</span>
</span><span class='line'>            <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 解析字段</span>
</span><span class='line'><span class="sd">         * @param  [type] $fields [description]</span>
</span><span class='line'><span class="sd">         * @return [type]         [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span>  <span class="k">static</span> <span class="k">function</span> <span class="nf">parseFields</span><span class="p">(</span><span class="nv">$fields</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$fields</span><span class="p">)){</span>
</span><span class='line'>                    <span class="nb">array_walk</span><span class="p">(</span><span class="nv">$fields</span><span class="p">,</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;PdoMySQL&#39;</span><span class="p">,</span><span class="s1">&#39;addSpecilChar&#39;</span><span class="p">));</span>
</span><span class='line'>                    <span class="nv">$fieldsStr</span><span class="o">=</span><span class="nb">implode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="nv">$fields</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span><span class="k">elseif</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$fields</span><span class="p">)</span><span class="o">&amp;&amp;!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$fields</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">if</span><span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$fields</span><span class="p">,</span><span class="s1">&#39;`&#39;</span><span class="p">)</span><span class="o">===</span><span class="k">false</span><span class="p">){</span>
</span><span class='line'>                    <span class="nv">$fields</span><span class="o">=</span><span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="nv">$fields</span><span class="p">);</span>
</span><span class='line'>                    <span class="nb">array_walk</span><span class="p">(</span><span class="nv">$fields</span><span class="p">,</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;PdoMySQL&#39;</span><span class="p">,</span><span class="s1">&#39;addSpecilChar&#39;</span><span class="p">));</span>
</span><span class='line'>                    <span class="nv">$fieldsStr</span><span class="o">=</span><span class="nb">implode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="nv">$fields</span><span class="p">);</span>
</span><span class='line'>                <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nv">$fieldsStr</span><span class="o">=</span><span class="nv">$fields</span><span class="p">;</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$fieldsStr</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="nv">$fieldsStr</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 通过反引号引用字段，</span>
</span><span class='line'><span class="sd">         * @param [type] $value [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">addSpecilChar</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$value</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nv">$value</span><span class="o">===</span><span class="s1">&#39;*&#39;</span><span class="o">||</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">!==</span><span class="k">false</span><span class="o">||</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span><span class="s1">&#39;`&#39;</span><span class="p">)</span><span class="o">!==</span><span class="k">false</span><span class="p">){</span>
</span><span class='line'>                <span class="c1">//不用做处理</span>
</span><span class='line'>            <span class="p">}</span><span class="k">elseif</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span><span class="s1">&#39;`&#39;</span><span class="p">)</span><span class="o">===</span><span class="k">false</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="c1"># code...</span>
</span><span class='line'>                <span class="nv">$value</span><span class="o">=</span><span class="s1">&#39;`&#39;</span><span class="o">.</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;`&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="nv">$value</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 根据主键查记录</span>
</span><span class='line'><span class="sd">         * @param  [type] $tabName [description]</span>
</span><span class='line'><span class="sd">         * @param  [type] $priId   [description]</span>
</span><span class='line'><span class="sd">         * @param  string $fields  [description]</span>
</span><span class='line'><span class="sd">         * @return [type]          [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span>  <span class="k">static</span> <span class="k">function</span> <span class="nf">findById</span><span class="p">(</span><span class="nv">$tabName</span><span class="p">,</span><span class="nv">$priId</span><span class="p">,</span><span class="nv">$fields</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;SELECT %s FROM %s WHERE id =%d&quot;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">getRow</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="nv">$sql</span><span class="p">,</span><span class="nx">self</span><span class="o">::</span><span class="na">parseFields</span><span class="p">(</span><span class="nv">$fields</span><span class="p">),</span><span class="nv">$tabName</span><span class="p">,</span><span class="nv">$priId</span><span class="p">));</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 执行普通查询，</span>
</span><span class='line'><span class="sd">         * @param  [type] $tables [description]</span>
</span><span class='line'><span class="sd">         * @param  [type] $where  [description]</span>
</span><span class='line'><span class="sd">         * @param  string $fields [description]</span>
</span><span class='line'><span class="sd">         * @param  [type] $group  [description]</span>
</span><span class='line'><span class="sd">         * @param  [type] $having [description]</span>
</span><span class='line'><span class="sd">         * @param  [type] $order  [description]</span>
</span><span class='line'><span class="sd">         * @param  [type] $limit  [description]</span>
</span><span class='line'><span class="sd">         * @return [type]         [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">find</span><span class="p">(</span><span class="nv">$tables</span><span class="p">,</span><span class="nv">$where</span><span class="o">=</span><span class="k">null</span><span class="p">,</span><span class="nv">$fields</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="nv">$group</span><span class="o">=</span><span class="k">null</span><span class="p">,</span><span class="nv">$having</span><span class="o">=</span><span class="k">null</span><span class="p">,</span><span class="nv">$order</span><span class="o">=</span><span class="k">null</span><span class="p">,</span><span class="nv">$limit</span><span class="o">=</span><span class="k">null</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$sql</span><span class="o">=</span><span class="s1">&#39;SELECT &#39;</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseFields</span><span class="p">(</span><span class="nv">$fields</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39; FROM &#39;</span><span class="o">.</span><span class="nv">$tables</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseWhere</span><span class="p">(</span><span class="nv">$where</span><span class="p">)</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseGroup</span><span class="p">(</span><span class="nv">$group</span><span class="p">)</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseHaving</span><span class="p">(</span><span class="nv">$having</span><span class="p">)</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseOrder</span><span class="p">(</span><span class="nv">$order</span><span class="p">)</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseLimit</span><span class="p">(</span><span class="nv">$limit</span><span class="p">);</span>
</span><span class='line'>            <span class="nv">$dataAll</span><span class="o">=</span><span class="nx">self</span><span class="o">::</span><span class="na">getAll</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>            <span class="c1">// if(count($dataAll)==1){</span>
</span><span class='line'>            <span class="c1">//     $rlt=$dataAll[0];</span>
</span><span class='line'>            <span class="c1">// }else {</span>
</span><span class='line'>            <span class="c1">//     $rlt=$dataAll;</span>
</span><span class='line'>            <span class="c1">// }</span>
</span><span class='line'>            <span class="c1">// return $rlt;</span>
</span><span class='line'>            <span class="k">return</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$dataAll</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="o">?</span><span class="nv">$dataAll</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">:</span><span class="nv">$dataAll</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 添加记录</span>
</span><span class='line'><span class="sd">         * array(</span>
</span><span class='line'><span class="sd">         *</span>
</span><span class='line'><span class="sd">         * )</span>
</span><span class='line'><span class="sd">         * @param string $value [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">add</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span><span class="nv">$table</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$keys</span><span class="o">=</span><span class="nb">array_keys</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span><span class='line'>            <span class="nb">array_walk</span><span class="p">(</span><span class="nv">$keys</span><span class="p">,</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;PdoMySQL&#39;</span><span class="p">,</span><span class="s1">&#39;addSpecilChar&#39;</span><span class="p">));</span>
</span><span class='line'>            <span class="nv">$fieldsStr</span><span class="o">=</span><span class="nb">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="nv">$keys</span><span class="p">);</span>
</span><span class='line'>            <span class="nv">$values</span><span class="o">=</span><span class="s2">&quot;&#39;&quot;</span><span class="o">.</span><span class="nb">join</span><span class="p">(</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="p">,</span><span class="nb">array_values</span><span class="p">(</span><span class="nv">$data</span><span class="p">))</span><span class="o">.</span><span class="s2">&quot;&#39;&quot;</span><span class="p">;</span>
</span><span class='line'>            <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;INSERT </span><span class="si">{</span><span class="nv">$table</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="nv">$fieldsStr</span><span class="si">}</span><span class="s2">) VALUES(</span><span class="si">{</span><span class="nv">$values</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">execute</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 更新记录</span>
</span><span class='line'><span class="sd">         * @param  [array] $data  [description]</span>
</span><span class='line'><span class="sd">         * @param  [string] $table [description]</span>
</span><span class='line'><span class="sd">         * @param  [string] $where [description]</span>
</span><span class='line'><span class="sd">         * @param  [string] $order [description]</span>
</span><span class='line'><span class="sd">         * @param  [string] $limit [description]</span>
</span><span class='line'><span class="sd">         * @return [type]        [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span>  <span class="k">static</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span><span class="nv">$table</span><span class="p">,</span><span class="nv">$where</span><span class="o">=</span><span class="k">null</span><span class="p">,</span><span class="nv">$order</span><span class="o">=</span><span class="k">null</span><span class="p">,</span><span class="nv">$limit</span><span class="o">=</span><span class="k">null</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$data</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$set</span><span class="o">.=</span><span class="nv">$key</span><span class="o">.</span><span class="s2">&quot;=&#39;&quot;</span><span class="o">.</span><span class="nv">$value</span><span class="o">.</span><span class="s2">&quot;&#39;,&quot;</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="nv">$sets</span><span class="o">=</span><span class="nb">rtrim</span><span class="p">(</span><span class="nv">$sets</span><span class="p">,</span><span class="s1">&#39;,&#39;</span><span class="p">);</span>
</span><span class='line'>            <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;UPDATE </span><span class="si">{</span><span class="nv">$table</span><span class="si">}</span><span class="s2"> SET </span><span class="si">{</span><span class="nv">$sets</span><span class="si">}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseWhere</span><span class="p">(</span><span class="nv">$where</span><span class="p">)</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseOrder</span><span class="p">(</span><span class="nv">$order</span><span class="p">)</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseLimit</span><span class="p">(</span><span class="nv">$limit</span><span class="p">);</span>
</span><span class='line'>             <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">execute</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 删除记录</span>
</span><span class='line'><span class="sd">         * @param  [type]  $table [description]</span>
</span><span class='line'><span class="sd">         * @param  [type]  $where [description]</span>
</span><span class='line'><span class="sd">         * @param  [type]  $order [description]</span>
</span><span class='line'><span class="sd">         * @param  integer $limit [description]</span>
</span><span class='line'><span class="sd">         * @return [type]         [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">delete</span><span class="p">(</span><span class="nv">$table</span><span class="p">,</span><span class="nv">$where</span><span class="o">=</span><span class="k">null</span><span class="p">,</span><span class="nv">$order</span><span class="o">=</span><span class="k">null</span><span class="p">,</span><span class="nv">$limit</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;delete from </span><span class="si">{</span><span class="nv">$table</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseWhere</span><span class="p">(</span><span class="nv">$where</span><span class="p">)</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseOrder</span><span class="p">(</span><span class="nv">$order</span><span class="p">)</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseLimit</span><span class="p">(</span><span class="nv">$limit</span><span class="p">);</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">execute</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 得到最后执行的ＳＱＬ语句</span>
</span><span class='line'><span class="sd">         * @return [type] [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getLastSql</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$link</span><span class="o">=</span><span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$link</span><span class="p">){</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$queryStr</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 得到上一步插入操作的ＩＤ</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getLsetInsertId</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$link</span><span class="o">=</span><span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$link</span><span class="p">)</span><span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$lastInsertId</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 得到数据库版本</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getDbVersion</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$link</span><span class="o">=</span><span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$link</span><span class="p">)</span><span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$dbVersion</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 得到数据库有哪些表</span>
</span><span class='line'><span class="sd">         * @return [type] [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span>  <span class="k">static</span> <span class="k">function</span> <span class="nf">showTables</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$tables</span><span class="o">=</span><span class="k">array</span><span class="p">();</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;SHOW TABLES&#39;</span><span class="p">)){</span>
</span><span class='line'>                <span class="nv">$result</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">getAll</span><span class="p">();</span>
</span><span class='line'>                <span class="k">foreach</span> <span class="p">(</span><span class="nv">$result</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="c1"># code...</span>
</span><span class='line'>                    <span class="nv">$tables</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span><span class="o">=</span><span class="nb">current</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="nv">$tables</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 解析ｗｈｅｒｅ条件</span>
</span><span class='line'><span class="sd">         * @param  [type] $where [description]</span>
</span><span class='line'><span class="sd">         * @return [type]        [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">parseWhere</span><span class="p">(</span><span class="nv">$where</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$whereStr</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$where</span><span class="p">)</span><span class="o">&amp;&amp;!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$where</span><span class="p">)){</span>
</span><span class='line'>                <span class="nv">$whereStr</span><span class="o">=</span><span class="nv">$where</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$whereStr</span><span class="p">)</span><span class="o">?</span><span class="s1">&#39;&#39;</span><span class="o">:</span><span class="s1">&#39; WHERE &#39;</span><span class="o">.</span><span class="nv">$whereStr</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 解析分组</span>
</span><span class='line'><span class="sd">         * @param  [type] $group [description]</span>
</span><span class='line'><span class="sd">         * @return [type]        [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">parseGroup</span><span class="p">(</span><span class="nv">$group</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$groupStr</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$group</span><span class="p">)){</span>
</span><span class='line'>                <span class="nv">$groupStr</span><span class="o">.=</span><span class="s1">&#39; GROUP BY &#39;</span><span class="o">.</span><span class="nb">implode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="nv">$group</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span><span class="k">elseif</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$group</span><span class="p">)</span><span class="o">&amp;&amp;!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$group</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$groupStr</span><span class="o">.=</span><span class="s1">&#39; GROUP BY &#39;</span><span class="o">.</span><span class="nv">$group</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$groupStr</span><span class="p">)</span><span class="o">?</span><span class="s1">&#39;&#39;</span><span class="o">:</span><span class="nv">$groupStr</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 对分组结果通过Ｈａｖｉｎｇ子句进行二次删选</span>
</span><span class='line'><span class="sd">         * @param  [type] $having [description]</span>
</span><span class='line'><span class="sd">         * @return [type]         [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">parseHaving</span><span class="p">(</span><span class="nv">$having</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$havingStr</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$having</span><span class="p">)</span><span class="o">&amp;&amp;!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$having</span><span class="p">)){</span>
</span><span class='line'>                <span class="nv">$havingStr</span><span class="o">.=</span><span class="s1">&#39; HAVING &#39;</span><span class="o">.</span><span class="nv">$having</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="nv">$havingStr</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 解析order by</span>
</span><span class='line'><span class="sd">         * @param  [type] $order [description]</span>
</span><span class='line'><span class="sd">         * @return [type]        [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span>  <span class="k">static</span> <span class="k">function</span> <span class="nf">parseOrder</span><span class="p">(</span><span class="nv">$order</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$orderStr</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$order</span><span class="p">)){</span>
</span><span class='line'>                <span class="nv">$orderStr</span><span class="o">.=</span><span class="s1">&#39; ORDER BY &#39;</span><span class="o">.</span><span class="nb">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="nv">$order</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span><span class="k">elseif</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$order</span><span class="p">)</span><span class="o">&amp;&amp;!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$order</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$orderStr</span><span class="o">.=</span><span class="s1">&#39; ORDER BY &#39;</span><span class="o">.</span><span class="nv">$order</span><span class="p">;</span>
</span><span class='line'>                <span class="c1"># code...</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="nv">$orderStr</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 解析限制条数</span>
</span><span class='line'><span class="sd">         * ｌｉｍｉｔ 3</span>
</span><span class='line'><span class="sd">         * ｌｉｍｉｔ 0,3</span>
</span><span class='line'><span class="sd">         * @param  [type] $limit [description]</span>
</span><span class='line'><span class="sd">         * @return [type]        [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span>  <span class="k">static</span> <span class="k">function</span> <span class="nf">parseLimit</span><span class="p">(</span><span class="nv">$limit</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$limitStr</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$limit</span><span class="p">)){</span>
</span><span class='line'>                <span class="k">if</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$limit</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">){</span>
</span><span class='line'>                    <span class="nv">$limitStr</span><span class="o">.=</span><span class="s1">&#39; LIMIT &#39;</span><span class="o">.</span><span class="nv">$limit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="nv">$limit</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'>                <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nv">$limitStr</span><span class="o">.=</span><span class="s1">&#39; LIMIT &#39;</span><span class="o">.</span><span class="nv">$limit</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span><span class="k">elseif</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$limit</span><span class="p">)</span><span class="o">&amp;&amp;!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$limit</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$limitStr</span><span class="o">.=</span><span class="s1">&#39; LIMIT &#39;</span><span class="o">.</span><span class="nv">$limit</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="nv">$limitStr</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 执行增删改，返回受影响的条数</span>
</span><span class='line'><span class="sd">         * @param  [type] $sql [description]</span>
</span><span class='line'><span class="sd">         * @return [type]      [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">execute</span><span class="p">(</span><span class="nv">$sql</span><span class="o">=</span><span class="k">null</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$link</span><span class="o">=</span><span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$link</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>            <span class="nx">self</span><span class="o">::</span><span class="nv">$queryStr</span><span class="o">=</span><span class="nv">$sql</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$PDOStatement</span><span class="p">))</span><span class="nx">self</span><span class="o">::</span><span class="na">free</span><span class="p">();</span>
</span><span class='line'>            <span class="nv">$result</span><span class="o">=</span><span class="nv">$link</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$queryStr</span><span class="p">);</span>
</span><span class='line'>            <span class="nx">self</span><span class="o">::</span><span class="na">haveErrorThrowException</span><span class="p">();</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nv">$result</span><span class="p">){</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="nv">$lastInsertId</span><span class="o">=</span><span class="nv">$link</span><span class="o">-&gt;</span><span class="na">lastInsertId</span><span class="p">();</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="nv">$numRows</span><span class="o">=</span><span class="nv">$result</span><span class="p">;;</span>
</span><span class='line'>                <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$numRows</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         *释放结果集</span>
</span><span class='line'><span class="sd">         * @return [type] [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span>  <span class="k">static</span> <span class="k">function</span> <span class="nf">free</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nx">self</span><span class="o">::</span><span class="nv">$PDOStatement</span><span class="o">=</span><span class="k">null</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 执行ｓｑｌ语句</span>
</span><span class='line'><span class="sd">         * @param  string $sql [description]</span>
</span><span class='line'><span class="sd">         * @return [type]      [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">query</span><span class="p">(</span><span class="nv">$sql</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$link</span><span class="o">=</span><span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$link</span><span class="p">)</span><span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>            <span class="c1">//判断之前是否有结果集，如果有的话，释放结果集</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="p">))</span> <span class="nx">self</span><span class="o">::</span><span class="na">free</span><span class="p">();</span>
</span><span class='line'>            <span class="nx">self</span><span class="o">::</span><span class="nv">$queryStr</span><span class="o">=</span><span class="nv">$sql</span><span class="p">;</span>
</span><span class='line'>            <span class="nx">self</span><span class="o">::</span><span class="nv">$PDOStatement</span><span class="o">=</span><span class="nv">$link</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$queryStr</span><span class="p">);</span>
</span><span class='line'>            <span class="nv">$res</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$PDOStatement</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</span><span class='line'>            <span class="nx">self</span><span class="o">::</span><span class="na">haveErrorThrowException</span><span class="p">();</span>
</span><span class='line'>            <span class="k">return</span> <span class="nv">$res</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 如果有错误，抛出</span>
</span><span class='line'><span class="sd">         * @return [type] [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">haveErrorThrowException</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$obj</span><span class="o">=</span><span class="k">empty</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$PDOStatement</span><span class="p">)</span><span class="o">?</span><span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="o">:</span><span class="nx">self</span><span class="o">::</span><span class="nv">$PDOStatement</span><span class="p">;</span>
</span><span class='line'>            <span class="nv">$arrError</span><span class="o">=</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">errorInfo</span><span class="p">();</span>
</span><span class='line'>            <span class="c1">// print_r($arrError);</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nv">$arrError</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;00000&#39;</span><span class="p">){</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="nv">$error</span><span class="o">=</span><span class="s2">&quot;SQLSTATE&quot;</span><span class="o">.</span><span class="nv">$arrError</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;SQL Error&quot;</span><span class="o">.</span><span class="nv">$arrError</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;&lt;br/&gt;Error SQL&quot;</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="nv">$queryStr</span><span class="p">;</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="na">throw_excption</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$error</span><span class="p">);</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$queryStr</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">){</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="na">throw_excption</span><span class="p">(</span><span class="s1">&#39;没有执行的ＳＱＬ语句&#39;</span><span class="p">);</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 自定义错误处理</span>
</span><span class='line'><span class="sd">         * @param  [type] $errMsg [description]</span>
</span><span class='line'><span class="sd">         * @return [type]         [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">function</span> <span class="nf">throw_excption</span><span class="p">(</span><span class="nv">$errMsg</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">echo</span> <span class="s2">&quot;&lt;div style=&#39;width:80%;background-color:#ABCDEF;colod:black;font-size:20px;padding:20px 0px;&#39;&gt;</span>
</span><span class='line'><span class="s2">            &quot;</span><span class="o">.</span><span class="nv">$errMsg</span><span class="o">.</span><span class="s2">&quot;</span>
</span><span class='line'><span class="s2">            &lt;/div&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 销毁链接对象，关闭数据库。</span>
</span><span class='line'><span class="sd">         * @return [type] [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">close</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="o">=</span><span class="k">null</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="k">require_once</span><span class="s2">&quot;config.php&quot;</span><span class="p">;</span>
</span><span class='line'><span class="c1">// $PdoMySQL=new PdoMySQL;</span>
</span><span class='line'><span class="c1">// // var_dump($PdoMySQL);</span>
</span><span class='line'><span class="c1">// // $sql=&quot;insert user (username,password,email) values(&#39;reane23&#39;,&#39;sdf&#39;,&#39;sdf&#39;)&quot;;</span>
</span><span class='line'><span class="c1">// $tables=&#39;user&#39;;</span>
</span><span class='line'><span class="c1">// $res=$PdoMySQL-&gt;find($tables,&#39;id&gt;=19&#39;,&#39;*&#39;,null,null,null,&#39;3&#39;);</span>
</span><span class='line'><span class="c1">// var_dump($res);</span>
</span><span class='line'><span class="c1">// echo $PdoMySQL::$lastInsertId;</span>
</span><span class='line'><span class="c1">// print_r($res);</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>config.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s2">&quot;DB_HOST&quot;</span><span class="p">,</span><span class="s2">&quot;localhost&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s2">&quot;DB_USER&quot;</span><span class="p">,</span><span class="s2">&quot;root&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s2">&quot;DB_PWD&quot;</span><span class="p">,</span><span class="s2">&quot;123456&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s2">&quot;DB_NAME&quot;</span><span class="p">,</span><span class="s2">&quot;test&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s2">&quot;DB_PORT&quot;</span><span class="p">,</span><span class="s2">&quot;3306&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s2">&quot;DB_TYPE&quot;</span><span class="p">,</span><span class="s2">&quot;mysql&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s2">&quot;DB_CHARSET&quot;</span><span class="p">,</span><span class="s2">&quot;utf8&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[php手机归属地查询Demo]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/18/php-phone-location/"/>
    <updated>2016-05-18T22:37:17+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/18/php-phone-location</id>
    <content type="html"><![CDATA[<blockquote><p>看了视频过后准备自己撸一个PHP的手机归属地查询。这个Demo的思路和方法其实算不上难。但是这个Demo作者使用了框架的思维并且用到了SPL等知识。以前没有写过这样的代码，所以决定自己写一次。</p></blockquote>

<h1>下面具体说说这个Demo中遇到的一些问题。</h1>

<p><strong>SPL-AutoLoad</strong></p>

<p>在使用SPL的autoload时，借助以前的Spl的代码来实际使用，发现在实际的项目中老是出现无法加载的情况。
先把具体代码贴出来</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="k">use</span> <span class="nx">app\MobileQuery</span><span class="p">;</span>
</span><span class='line'>    <span class="nb">spl_autoload_extensions</span><span class="p">();</span>
</span><span class='line'>    <span class="nb">set_include_path</span><span class="p">(</span><span class="nb">get_include_path</span><span class="p">()</span><span class="o">.</span><span class="nx">PATH_SEPARATOR</span><span class="o">.</span><span class="s2">&quot;libs/&quot;</span><span class="o">.</span><span class="nx">PATH_SEPARATOR</span><span class="o">.</span><span class="s2">&quot;app/&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nb">spl_autoload_register</span><span class="p">();</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='PHP'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span> <span class="nx">libs</span><span class="o">/</span><span class="nx">mypdo</span><span class="o">.</span><span class="nx">php</span>
</span><span class='line'><span class="k">namespace</span> <span class="nx">libs</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">\PDO</span><span class="p">;</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">mypdo</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>如上，当我将<code>libs/mypdo.php</code>命名为<code>MyPdo.php</code>时，在实例化<code>mypdo</code>就会发生不能加载的情况，而如果命名成小写就没有问题。
原因如下:</p>

<pre class="prettyprint linenums">
WINDOWS大小写不敏感，而在LINUX下区分大小写，
spl_autoload会把类名转化为小写进行文件搜索，
这样就造成linux下无法正常include文件.
解决办法:
1.索性把被包含文件改成小写；
2.扫目录得到文件列表，然后遍历列表去匹配出正确文件名，包含之。
</pre>


<p><strong>PHP内存不够</strong></p>

<p>这个其实问题是出在对命名空间理解不透彻。</p>

<p>之前在使用PDO的时候为了方便，直接将自定义的PDO操作类命名为<code>PDO.php</code>并且在构造函数中实例化PDO对象。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="k">namespace</span> <span class="nx">libs</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">\PDO</span><span class="p">;</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">PDO</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s2">&quot;mysql:host=&quot;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db_host</span><span class="o">.</span><span class="s2">&quot;;dbname=&quot;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db_name</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db_user</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db_pass</span><span class="p">);</span>
</span><span class='line'>                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s2">&quot;SET CHARACTER SET&quot;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db_charset</span><span class="p">);</span>
</span><span class='line'>                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s2">&quot;SET NAMES&quot;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db_charset</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">print</span> <span class="s2">&quot;Error!:&quot;</span><span class="o">.</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>                <span class="k">die</span><span class="p">();</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>一直报错，PHP每次不够，改了很多次<code>php.ini</code>都没用。后来突然发现是我在<code>new PDO</code>的时候它实际上是<code>new</code>的自己本身，造成了一个死循环。</p>

<p>后来将类名改成<code>mypdo</code>后发现找不到PDO。</p>

<p>原来是我这里用了命名空间的概念，如果想用PDO需要在前面加入</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">use</span> <span class="nx">\PDO</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>。</p>

<p><em>*MySQL删除json_encode()出来的*</em></p>

<p>在将数据保存到数据库后，在读数据时不能<code>json_decode</code>对应的中文。</p>

<p>后来发现是在存入数据库时，中文编码出来的<code>\</code>被删除了。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="o">:</span><span class="s2">&quot;\u232e234\e23&quot;</span><span class="p">}</span><span class="c1">//json_encode的结果</span>
</span><span class='line'><span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="o">:</span><span class="s2">&quot;u232e234e23&quot;</span><span class="p">}</span><span class="c1">//存到数据库的结果</span>
</span></code></pre></td></tr></table></div></figure>


<p>解决方法:
在外层调用一下函数addslashes();这个函数会在每个反斜杠的前面添加反斜杠，如此这般就可以存进数据库了。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'>  <span class="nv">$info</span> <span class="o">=</span> <span class="nb">addslashes</span><span class="p">(</span><span class="nb">json_encode</span><span class="p">(</span><span class="nv">$review_log</span><span class="p">));</span><span class="c1">//这样处理后存进数据库就不回丢失“\&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>最后我将这个Demo放到了GitHub：<a href="https://github.com/EwanReton/PhpPhoneLocation">https://github.com/EwanReton/PhpPhoneLocation</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PHP-namespace-use用法]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/18/php-namespace-use/"/>
    <updated>2016-05-18T22:14:17+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/18/php-namespace-use</id>
    <content type="html"><![CDATA[<blockquote><p>今天在看视频的时候发现作者用到了namespce和use。以前只在ThinkPHP框架中看到过这种用法，以为是ThinkPHP框架特有的，也就一直没上心。今天有又看到了觉定深入了解下。</p></blockquote>

<!--more-->


<h1>什么是命名空间？</h1>

<p>从广义上来说，命名空间是一种封装事物的方法。在很多地方都可以见到这种抽象概念。例如，在操作系统中目录用来将相关文件分组，对于目录中的文件来说，它就扮演了命名空间的角色。具体举个例子，文件 foo.txt 可以同时在目录/home/greg 和 /home/other 中存在，但在同一个目录中不能存在两个 foo.txt 文件。另外，在目录 /home/greg 外访问 foo.txt 文件时，我们必须将目录名以及目录分隔符放在文件名之前得到 /home/greg/foo.txt。这个原理应用到程序设计领域就是命名空间的概念。</p>

<p>在PHP中，命名空间用来解决在编写类库或应用程序时创建可重用的代码如类或函数时碰到的两类问题：</p>

<ol>
<li>用户编写的代码与PHP内部的类/函数/常量或第三方类/函数/常量之间的名字冲突。</li>
<li>为很长的标识符名称(通常是为了缓解第一类问题而定义的)创建一个别名（或简短）的名称，提高源代码的可读性。</li>
</ol>


<p>下面介绍几种使用namespace和use的方法:</p>

<p>namespace（以下简称ns）。在定义了一个ns之后，下面所申明的class、interface、const（不包含variable）都是在申明的ns这个“域”里面的。当引用一个申明了ns的包含文件，想要调用这个ns里面的东西，那必须调整当前脚本也到此ns域，否则就得用全称（）包含ns全称）：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1">// inc.php  </span>
</span><span class='line'><span class="k">namespace</span> <span class="nx">Foo</span><span class="p">;</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Bar</span> <span class="p">{}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 访问Foo的第一种方法，用全称  </span>
</span><span class='line'><span class="k">require</span> <span class="s1">&#39;inc.php&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Foo\Bar</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 访问Foo的第二种方法  </span>
</span><span class='line'><span class="k">namespace</span> <span class="nx">Foo</span><span class="p">;</span> <span class="c1">// 调整当前脚本到Foo这个ns域，而且namespace申明必须在第一句  </span>
</span><span class='line'><span class="k">require</span> <span class="s1">&#39;inc.php&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Bar</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>use关键字目的是使用ns的别名：</em></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1">// 比如  </span>
</span><span class='line'><span class="k">use</span> <span class="nx">A\Very\Long\Namespace</span> <span class="k">as</span> <span class="nx">Ns</span><span class="p">;</span>
</span><span class='line'><span class="c1">// 这样就可以用Ns来代替A/Very/Long/Namespace这个ns下定义的东西  </span>
</span><span class='line'><span class="nv">$foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Ns\Foo</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>但是在一些开源项目里面经常会看到use Ns\Component这样的用法，没有用as，这让我以前一直在思考use是否还有第二种用法，糟糕的是php的文档里面也没有对此用法有描述，只能靠猜测，后来仔细想过这个问题，得出一个比较靠谱的结论是use可以省略as以及后面的别名而直接把ns最后一个节点的名字当作别名，感觉是不是很像ln -s命令的用法呢：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1">// 第三种用法  </span>
</span><span class='line'><span class="k">require</span> <span class="s1">&#39;inc.php&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Foo\Bar</span><span class="p">;</span> <span class="c1">// 这样Bar就等于Foo\Bar了  </span>
</span><span class='line'><span class="nv">$foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Bar</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PHP获取远程文件的几种方式]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/18/php-get-remote-file/"/>
    <updated>2016-05-18T14:18:15+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/18/php-get-remote-file</id>
    <content type="html"><![CDATA[<blockquote><p>接上次的内容，今天结合代码来分析下PHP获取远程文件的几种方式。</p></blockquote>

<!--more-->


<ul>
<li>fopen

<ul>
<li>获取本地文件</li>
<li>获取到的资源绑定到一个流上面</li>
</ul>
</li>
<li>file_get_centents

<ul>
<li>获取一些Get获得的数据，也可以POST，</li>
<li>可以做断点续传</li>
</ul>
</li>
<li>socket</li>
<li>curl

<ul>
<li>可以保存cookie 并且在下一次发送出去</li>
<li>做模拟登陆</li>
</ul>
</li>
</ul>


<h1>fopen</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;common.php&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;&lt;h2&gt;fopen获取文件测试&lt;/h2&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="cm">/*fopen打开本地文件*/</span>
</span><span class='line'>  <span class="nv">$filename</span><span class="o">=</span><span class="s2">&quot;test.html&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$fp</span><span class="o">=</span><span class="nb">fopen</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span><span class="s2">&quot;r+&quot;</span><span class="p">);</span><span class="c1">//r+ 只读，+表示如果不存在则创建</span>
</span><span class='line'>  <span class="nv">$fc</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$fp</span><span class="p">)){</span>
</span><span class='line'>      <span class="nv">$fc</span><span class="o">.=</span><span class="nb">fgets</span><span class="p">(</span><span class="nv">$fp</span><span class="p">,</span><span class="mi">1024</span><span class="p">);</span><span class="c1">//获取到的资源绑定到流上。这样来获取流数据</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fp</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;&lt;h4&gt;输出http_response_header&lt;/h4&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">dumpout</span><span class="p">(</span><span class="nv">$http_response_header</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;&lt;h3&gt;本地文件：&quot;</span><span class="o">.</span><span class="nv">$fc</span><span class="o">.</span><span class="s2">&quot;&lt;/h3&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="cm">/*fopen打开远程url*/</span>
</span><span class='line'>  <span class="nv">$filename</span><span class="o">=</span><span class="s2">&quot;http://localhost/Login/02/test.html&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$fp</span><span class="o">=</span><span class="nb">fopen</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;&lt;h4&gt;输出stream_get_meta_data&lt;/h4&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">dumpArr</span><span class="p">(</span><span class="nb">stream_get_meta_data</span><span class="p">(</span><span class="nv">$fp</span><span class="p">));</span>
</span><span class='line'>  <span class="nv">$fc</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$fp</span><span class="p">)){</span>
</span><span class='line'>      <span class="nv">$fc</span><span class="o">=</span><span class="nb">fgets</span><span class="p">(</span><span class="nv">$fp</span><span class="p">,</span><span class="mi">1024</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fp</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;&lt;h4&gt;输出http_response_header&lt;/h4&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">dumpout</span><span class="p">(</span><span class="nv">$http_response_header</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;&lt;h3&gt;远程url：&quot;</span><span class="o">.</span><span class="nv">$fc</span><span class="o">.</span><span class="s2">&quot;&lt;/h3&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h1>file_get_centents</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;common.php&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;&lt;h2&gt;file_get_contents获取文件测试&lt;/h2&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="cm">/*file_get_contents打开本地文件*/</span>
</span><span class='line'>  <span class="nv">$filename</span><span class="o">=</span><span class="s2">&quot;test.html&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$fc</span><span class="o">=</span><span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;&lt;h3&gt;本地文件：&quot;</span><span class="o">.</span><span class="nv">$fc</span><span class="o">.</span><span class="s2">&quot;&lt;/h3&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="cm">/*fopen打开远程url  get方法*/</span>
</span><span class='line'>  <span class="nv">$filename</span><span class="o">=</span><span class="s2">&quot;http://localhost/Login/02/test.php&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$fc</span><span class="o">=</span><span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;&lt;h4&gt;输出http_response_header&lt;/h4&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">dumpout</span><span class="p">(</span><span class="nv">$http_response_header</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;&lt;h3&gt;get方法获取远程url：&quot;</span><span class="o">.</span><span class="nv">$fc</span><span class="o">.</span><span class="s2">&quot;&lt;/h3&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="cm">/*fopen打开远程url  post方法*/</span>
</span><span class='line'>  <span class="nv">$filename</span><span class="o">=</span><span class="s2">&quot;http://localhost/Login/02/test.php&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="cm">/*构建请求头信息*/</span>
</span><span class='line'>  <span class="nv">$post</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span><span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$content</span> <span class="o">=</span> <span class="nb">http_build_query</span><span class="p">(</span><span class="nv">$post</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$content_length</span> <span class="o">=</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$content</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$options</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>      <span class="s1">&#39;http&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>          <span class="s1">&#39;method&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="s1">&#39;header&#39;</span> <span class="o">=&gt;</span>
</span><span class='line'>          <span class="s2">&quot;Content-type: application/x-www-form-urlencoded</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="o">.</span>
</span><span class='line'>          <span class="s2">&quot;Content-length: </span><span class="si">$content_length\r\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s1">&#39;content&#39;</span> <span class="o">=&gt;</span> <span class="nv">$content</span>
</span><span class='line'>      <span class="p">)</span>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'>  <span class="nv">$fc</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="nb">stream_context_create</span><span class="p">(</span><span class="nv">$options</span><span class="p">));</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;&lt;h4&gt;输出http_response_header&lt;/h4&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">dumpout</span><span class="p">(</span><span class="nv">$http_response_header</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;&lt;h3&gt;post方法获取远程url：&quot;</span><span class="o">.</span><span class="nv">$fc</span><span class="o">.</span><span class="s2">&quot;&lt;/h3&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h1>socket</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;common.php&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="cm">/*Accept: */</span>
</span><span class='line'>  <span class="cm">/* Accept-Language: zh-cn,en-us;q=0.5</span>
</span><span class='line'><span class="cm">     Content-Type: application/x-www-form-urlencoded</span>
</span><span class='line'><span class="cm">     /*模拟浏览器信息*/</span>
</span><span class='line'>      <span class="nx">User</span><span class="o">-</span><span class="nx">Agent</span><span class="o">:</span> <span class="nx">Mozilla</span><span class="o">/</span><span class="mf">4.0</span> <span class="p">(</span><span class="nx">compatible</span><span class="p">;</span> <span class="nx">MSIE</span> <span class="mf">5.0</span><span class="p">;</span> <span class="nx">Windows</span> <span class="nx">NT</span><span class="p">;</span> <span class="o">.</span><span class="nx">NET</span> <span class="nx">CLR</span> <span class="mf">1.0</span><span class="o">.</span><span class="mi">3705</span><span class="p">;</span> <span class="o">.</span><span class="nx">NET</span> <span class="nx">CLR</span> <span class="mf">1.1</span><span class="o">.</span><span class="mi">4322</span><span class="p">)</span>
</span><span class='line'>      <span class="nx">Host</span><span class="o">:</span> <span class="nx">要发送到的主机地址</span>
</span><span class='line'>      <span class="nx">Content</span><span class="o">-</span><span class="nx">Length</span><span class="o">:</span> <span class="nx">发送数据的长度</span>
</span><span class='line'>      <span class="nx">Pragma</span><span class="o">:</span> <span class="nx">no</span><span class="o">-</span><span class="nx">cache</span>
</span><span class='line'>      <span class="nx">Cache</span><span class="o">-</span><span class="nx">Control</span><span class="o">:</span> <span class="nx">no</span><span class="o">-</span><span class="nx">cache</span>
</span><span class='line'>      <span class="nx">username</span><span class="o">=</span><span class="nx">php</span><span class="o">&amp;</span><span class="nx">password</span><span class="o">=</span><span class="nx">iask</span>   <span class="c1">//post发送的数据</span>
</span><span class='line'>   <span class="o">*</span>
</span><span class='line'>   <span class="o">*/</span>
</span><span class='line'>  
</span><span class='line'>  
</span><span class='line'>  <span class="cm">/*fsocket模拟get提交*/</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;&lt;h2&gt;fsocket模拟get提交&lt;/h2&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$url</span><span class="o">=</span><span class="s2">&quot;http://localhost/Login/02/test.php?type=1&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$info</span> <span class="o">=</span> <span class="nb">parse_url</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$fp</span> <span class="o">=</span> <span class="nb">fsockopen</span><span class="p">(</span><span class="nv">$info</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">],</span> <span class="mi">80</span><span class="p">,</span> <span class="nv">$errno</span><span class="p">,</span> <span class="nv">$errstr</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$head</span> <span class="o">=</span> <span class="s2">&quot;GET &quot;</span><span class="o">.</span><span class="nv">$info</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;?&quot;</span><span class="o">.</span><span class="nv">$info</span><span class="p">[</span><span class="s2">&quot;query&quot;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot; HTTP/1.0</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$head</span> <span class="o">.=</span> <span class="s2">&quot;Host: &quot;</span><span class="o">.</span><span class="nv">$info</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$head</span> <span class="o">.=</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$write</span> <span class="o">=</span> <span class="nb">fputs</span><span class="p">(</span><span class="nv">$fp</span><span class="p">,</span> <span class="nv">$head</span><span class="p">);</span>
</span><span class='line'>  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$fp</span><span class="p">)){</span>
</span><span class='line'>      <span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$fp</span><span class="p">);</span>
</span><span class='line'>      <span class="k">echo</span> <span class="nv">$line</span><span class="o">.</span><span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="cm">/*fsocket模拟post提交*/</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;&lt;h2&gt;fsocket模拟post提交&lt;/h2&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$query</span><span class="o">=</span><span class="s2">&quot;type=1&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$info</span> <span class="o">=</span> <span class="nb">parse_url</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$fp</span> <span class="o">=</span> <span class="nb">fsockopen</span><span class="p">(</span><span class="nv">$info</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">],</span> <span class="mi">80</span><span class="p">,</span> <span class="nv">$errno</span><span class="p">,</span> <span class="nv">$errstr</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$head</span> <span class="o">=</span> <span class="s2">&quot;POST &quot;</span><span class="o">.</span><span class="nv">$info</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot; HTTP/1.0</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$head</span> <span class="o">.=</span> <span class="s2">&quot;Host: &quot;</span><span class="o">.</span><span class="nv">$info</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$head</span> <span class="o">.=</span> <span class="s2">&quot;Referer: http://&quot;</span><span class="o">.</span><span class="nv">$info</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">]</span><span class="o">.</span><span class="nv">$info</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$head</span> <span class="o">.=</span> <span class="s2">&quot;Content-type: application/x-www-form-urlencoded</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$head</span> <span class="o">.=</span> <span class="s2">&quot;Content-Length: &quot;</span><span class="o">.</span><span class="nb">strlen</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$query</span><span class="p">))</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$head</span> <span class="o">.=</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$head</span> <span class="o">.=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$write</span> <span class="o">=</span> <span class="nb">fputs</span><span class="p">(</span><span class="nv">$fp</span><span class="p">,</span> <span class="nv">$head</span><span class="p">);</span>
</span><span class='line'>  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$fp</span><span class="p">))</span>  <span class="p">{</span>
</span><span class='line'>      <span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$fp</span><span class="p">);</span>
</span><span class='line'>      <span class="k">echo</span> <span class="nv">$line</span><span class="o">.</span><span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h1>cURL</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;common.php&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="cm">/*curl模拟get提交*/</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;&lt;h2&gt;curl模拟get提交&lt;/h2&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$url</span><span class="o">=</span><span class="s2">&quot;http://localhost/Login/02/test.php?type=1&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//初始化</span>
</span><span class='line'>  <span class="nv">$ch</span><span class="o">=</span><span class="nb">curl_init</span><span class="p">();</span>
</span><span class='line'>  <span class="c1">//设置选项，包括URL</span>
</span><span class='line'>  <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">//执行并获取HTML文档内容</span>
</span><span class='line'>  <span class="nv">$output</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;&lt;h2&gt;输出curl_getinfo相关信息&lt;/h2&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$info</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">dumpArr</span><span class="p">(</span><span class="nv">$info</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">//释放curl句柄</span>
</span><span class='line'>  <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">//打印获得的数据</span>
</span><span class='line'>  <span class="nb">print_r</span><span class="p">(</span><span class="nv">$output</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;&lt;h2&gt;curl模拟post提交&lt;/h2&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$url</span><span class="o">=</span><span class="s2">&quot;http://localhost/Login/02/test.php&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$post_data</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span><span class="s2">&quot;type&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;1&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
</span><span class='line'>  <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// post数据</span>
</span><span class='line'>  <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// post的变量</span>
</span><span class='line'>  <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nv">$post_data</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$output</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;&lt;h2&gt;输出curl_getinfo相关信息&lt;/h2&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$info</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">dumpArr</span><span class="p">(</span><span class="nv">$info</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">//打印获得的数据</span>
</span><span class='line'>  <span class="nb">print_r</span><span class="p">(</span><span class="nv">$output</span><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>上面的文件引用的common.php</p>

<figure class='code'><figcaption><span>common.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Content-type:text/html;charset:utf-8&quot;</span><span class="p">);</span>
</span><span class='line'><span class="cm">/*获取当前访问用户IP*/</span>
</span><span class='line'><span class="k">function</span> <span class="nf">GetIP</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;HTTP_CLIENT_IP&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">strcasecmp</span><span class="p">(</span><span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;HTTP_CLIENT_IP&quot;</span><span class="p">),</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)){</span>
</span><span class='line'>      <span class="nv">$ip</span> <span class="o">=</span> <span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;HTTP_CLIENT_IP&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;HTTP_X_FORWARDED_FOR&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">strcasecmp</span><span class="p">(</span><span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;HTTP_X_FORWARDED_FOR&quot;</span><span class="p">),</span> <span class="s2">&quot;unknown&quot;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>      <span class="nv">$ip</span> <span class="o">=</span> <span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;HTTP_X_FORWARDED_FOR&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;REMOTE_ADDR&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">strcasecmp</span><span class="p">(</span><span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;REMOTE_ADDR&quot;</span><span class="p">),</span> <span class="s2">&quot;unknown&quot;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>      <span class="nv">$ip</span> <span class="o">=</span> <span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;REMOTE_ADDR&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REMOTE_ADDR&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REMOTE_ADDR&#39;</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nb">strcasecmp</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REMOTE_ADDR&#39;</span><span class="p">],</span> <span class="s2">&quot;unknown&quot;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>      <span class="nv">$ip</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REMOTE_ADDR&#39;</span><span class="p">];</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="nv">$ip</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span><span class="p">(</span><span class="nv">$ip</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'> <span class="cm">/*格式化header*/</span>
</span><span class='line'><span class="k">function</span> <span class="nf">parseHeaders</span><span class="p">(</span> <span class="nv">$headers</span> <span class="p">){</span>
</span><span class='line'>    <span class="nv">$head</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>    <span class="k">foreach</span><span class="p">(</span> <span class="nv">$headers</span> <span class="k">as</span> <span class="nv">$k</span><span class="o">=&gt;</span><span class="nv">$v</span> <span class="p">){</span>
</span><span class='line'>        <span class="nv">$t</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="nv">$v</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span> <span class="nb">isset</span><span class="p">(</span> <span class="nv">$t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="p">){</span>
</span><span class='line'>            <span class="nv">$head</span><span class="p">[</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">]</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span> <span class="nv">$t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">);</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="k">else</span><span class="p">{</span>
</span><span class='line'>            <span class="nv">$head</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$v</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span> <span class="nb">preg_match</span><span class="p">(</span> <span class="s2">&quot;#HTTP/[0-9\.]+\s+([0-9]+)#&quot;</span><span class="p">,</span><span class="nv">$v</span><span class="p">,</span> <span class="nv">$out</span> <span class="p">)</span> <span class="p">){</span>
</span><span class='line'>                <span class="nv">$head</span><span class="p">[</span><span class="s1">&#39;reponse_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$out</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nv">$head</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cm">/*数组格式化输出header*/</span>
</span><span class='line'><span class="k">function</span> <span class="nf">dumpout</span><span class="p">(</span><span class="nv">$vars</span><span class="p">,</span> <span class="nv">$label</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$return</span> <span class="o">=</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nv">$vars</span><span class="o">=</span><span class="nx">parseHeaders</span><span class="p">(</span><span class="nv">$vars</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nb">ini_get</span><span class="p">(</span><span class="s1">&#39;html_errors&#39;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$content</span> <span class="o">=</span> <span class="s2">&quot;&lt;pre&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nv">$label</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$content</span> <span class="o">.=</span> <span class="s2">&quot;&lt;strong&gt;</span><span class="si">{</span><span class="nv">$label</span><span class="si">}</span><span class="s2"> :&lt;/strong&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="nv">$content</span> <span class="o">.=</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nb">print_r</span><span class="p">(</span><span class="nv">$vars</span><span class="p">,</span> <span class="k">true</span><span class="p">));</span>
</span><span class='line'>        <span class="nv">$content</span> <span class="o">.=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&lt;/pre&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$label</span> <span class="o">.</span> <span class="s2">&quot; :</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">.</span> <span class="nb">print_r</span><span class="p">(</span><span class="nv">$vars</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nv">$return</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$content</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nv">$content</span><span class="p">;</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cm">/*数组格式化输出arr*/</span>
</span><span class='line'><span class="k">function</span> <span class="nf">dumpArr</span><span class="p">(</span><span class="nv">$vars</span><span class="p">,</span> <span class="nv">$label</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$return</span> <span class="o">=</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nb">ini_get</span><span class="p">(</span><span class="s1">&#39;html_errors&#39;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$content</span> <span class="o">=</span> <span class="s2">&quot;&lt;pre&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nv">$label</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$content</span> <span class="o">.=</span> <span class="s2">&quot;&lt;strong&gt;</span><span class="si">{</span><span class="nv">$label</span><span class="si">}</span><span class="s2"> :&lt;/strong&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="nv">$content</span> <span class="o">.=</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nb">print_r</span><span class="p">(</span><span class="nv">$vars</span><span class="p">,</span> <span class="k">true</span><span class="p">));</span>
</span><span class='line'>        <span class="nv">$content</span> <span class="o">.=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&lt;/pre&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$label</span> <span class="o">.</span> <span class="s2">&quot; :</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">.</span> <span class="nb">print_r</span><span class="p">(</span><span class="nv">$vars</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nv">$return</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$content</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nv">$content</span><span class="p">;</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<p>以上几种方式用得较为多的是cURl,因为它可以保存COOKIE的特性，在PHP的网络爬虫中都离不开它。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PHP爬虫和微信自动投票]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/17/wechat-auto-vote/"/>
    <updated>2016-05-17T23:38:25+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/17/wechat-auto-vote</id>
    <content type="html"><![CDATA[<blockquote><p>今天接触了PHP的模拟登陆和爬虫实战，涉及到了PHP获取远程文件的几种方式，防采集的一些方法，以及微信自动投票实战。</p></blockquote>

<!--more-->


<h1>PHP获取远程文件</h1>

<p>PHP获取远程文件主要有以下几种方式：</p>

<ul>
<li>fopen</li>
<li>file_get_centents</li>
<li>socket</li>
<li>curl</li>
</ul>


<p>过几天我们在结合实际代码分析这几种方式</p>

<h1>防采集的一些方法</h1>

<p>防采集的方法有很多，这里主要列出几种比较有效的</p>

<ul>
<li>短时间访问次数限制</li>
<li>ip校验</li>
<li>机器特征校验</li>
<li>复杂加密</li>
<li>混淆代码</li>
</ul>


<h1>微信自动投票工具</h1>

<blockquote><p>这次主要分析这个。</p></blockquote>

<p>首先，我们需要将微信投票界面分析到PC端，并用浏览器F12里的功能抓取到投票的请求地址和返回数据。如下：</p>

<pre class="prettyprint linenums">
http://wx.asplay.cn/index.php?g=Wap&m=Vote&a=index&token=jdfsam1432614294&wecha_id=oQIrdjjmrAZXwKOh3Y6-1HeuwvEc&id=27&sgssz=mp.weixin.qq.com

http://wx.asplay.cn/index.php?
g=Wap&
m=Vote&
a=index&                    //ThinkPHP里面一些参数
token=jdfsam1432614294&     //当前主用户标示
wecha_id=oQIrdjjmrAZXwKOh3Y6-1HeuwvEc&
id=27&      //当前投票ID
sgssz=mp.weixin.qq.com
下面是请求的地址：
http://wx.asplay.cn/index.php?g=Wap&m=Vote&a=add_vote&token=jdfsam1432614294&wecha_id=oQIrdjjArAZYwKOh3Y6-1HeuwvEc
发送的数据：
wecha_id=oQIrdjjArAZYwKOh3Y6-1HeuwvEc&tid=27&chid=53%2C&token=jdfsam1432614294&action=add_vote、
投票成功返回的数据：
{"success":1,"token":"jdfsam1432614294","wecha_id":"oQIrdjjArAZYwKOh3Y6-1HeuwvEc","tid":"27","chid":"53","arrpre":{"53":33.33,"54":0,"55":0,"56":66.67}}
</pre>


<p>基于以上的这些信息，我们就能自己模拟POST的数据，和用户标示了。但是仅仅做到这些是不够的，我们还需要模拟微信的内核。</p>

<pre class="prettyprint linenums">
微信内核的ua：//网上能找到
Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/28.0.158888800.95 Safari/537.36 SE 2.X MetaSr 1.0
</pre>


<figure class='code'><figcaption><span>../03/curlajax.class.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="k">class</span> <span class="nc">curlajax</span><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="nv">$cookiejar</span><span class="p">;</span>
</span><span class='line'>  <span class="k">public</span> <span class="nv">$cookiefile</span><span class="p">;</span>
</span><span class='line'>  <span class="k">public</span> <span class="nv">$ua</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="nv">$debug</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">function</span> <span class="nf">__construct</span><span class="p">(){</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">debug</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ua</span> <span class="o">=</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/28.0.158888800.95 Safari/537.36 SE 2.X MetaSr 1.0&#39;</span><span class="p">;</span> <span class="c1">//这里模拟微信内核</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cookiejar</span> <span class="o">=</span> <span class="s1">&#39;cookie.txt&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cookiefile</span> <span class="o">=</span> <span class="s1">&#39;cookie.txt&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/****************************</span>
</span><span class='line'><span class="sd">    *get 请求资源</span>
</span><span class='line'><span class="sd">    *@param string 地址</span>
</span><span class='line'><span class="sd">    *@param string referer</span>
</span><span class='line'><span class="sd">    *@param boolen 是否返回头部</span>
</span><span class='line'><span class="sd">    *@param array 头部附加cookie</span>
</span><span class='line'><span class="sd">    ****************************/</span>
</span><span class='line'>    <span class="k">function</span> <span class="nf">httpget</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span><span class="nv">$referer</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="nv">$withhead</span><span class="o">=</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>        <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
</span><span class='line'>        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span><span class="nx">CURLOPT_URL</span><span class="p">,</span><span class="nv">$url</span><span class="p">);</span>
</span><span class='line'>      <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span><span class="nx">CURLOPT_COOKIEJAR</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cookiejar</span><span class="p">);</span>
</span><span class='line'>      <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span><span class="nx">CURLOPT_COOKIEFILE</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cookiefile</span><span class="p">);</span>
</span><span class='line'>        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span><span class="nx">CURLOPT_HEADER</span><span class="p">,</span><span class="nv">$withhead</span><span class="p">);</span>
</span><span class='line'>        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span><span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span><span class="nx">CURLOPT_FOLLOWLOCATION</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">//curl_setopt($ch,CURLOPT_AUTOREFERER,1);</span>
</span><span class='line'>        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span><span class="nx">CURLOPT_USERAGENT</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ua</span><span class="p">);</span>
</span><span class='line'>        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span><span class="nx">CURLOPT_REFERER</span><span class="p">,</span><span class="nv">$referer</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$r</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">debug</span><span class="p">){</span>
</span><span class='line'>            <span class="k">echo</span> <span class="s1">&#39;&lt;pre&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="nb">var_dump</span><span class="p">(</span><span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">));</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$r</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/****************************</span>
</span><span class='line'><span class="sd">    *post 请求资源</span>
</span><span class='line'><span class="sd">    *@param string 地址</span>
</span><span class='line'><span class="sd">    *@param string referer</span>
</span><span class='line'><span class="sd">    *@param array 提交数据</span>
</span><span class='line'><span class="sd">    *@param boolen 是否返回头部</span>
</span><span class='line'><span class="sd">    ****************************/</span>
</span><span class='line'>    <span class="k">function</span> <span class="nf">httppost</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span><span class="nv">$referer</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="nv">$postdata</span><span class="o">=</span><span class="k">array</span><span class="p">(),</span><span class="nv">$withhead</span><span class="o">=</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>        <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
</span><span class='line'>        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span><span class="nx">CURLOPT_URL</span><span class="p">,</span><span class="nv">$url</span><span class="p">);</span>
</span><span class='line'>        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span><span class="nx">CURLOPT_HEADER</span><span class="p">,</span><span class="nv">$withhead</span><span class="p">);</span>
</span><span class='line'>        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span><span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span><span class="nx">CURLOPT_FOLLOWLOCATION</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">//curl_setopt($ch,CURLOPT_AUTOREFERER,1);</span>
</span><span class='line'>        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span><span class="nx">CURLOPT_COOKIEJAR</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cookiejar</span><span class="p">);</span>
</span><span class='line'>        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span><span class="nx">CURLOPT_COOKIEFILE</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cookiefile</span><span class="p">);</span>
</span><span class='line'>        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span><span class="nx">CURLOPT_USERAGENT</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ua</span><span class="p">);</span>
</span><span class='line'>        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span><span class="nx">CURLOPT_REFERER</span><span class="p">,</span><span class="nv">$referer</span><span class="p">);</span>
</span><span class='line'>        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span><span class="nx">CURLOPT_POST</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span><span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span><span class="nv">$postdata</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$r</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">debug</span><span class="p">){</span>
</span><span class='line'>            <span class="k">echo</span> <span class="s1">&#39;&lt;pre&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="nb">var_dump</span><span class="p">(</span><span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">));</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$r</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>网上的cURL方法，我们这里有要用到</p>

<figure class='code'><figcaption><span>autoVote.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="k">require_once</span><span class="p">(</span><span class="s2">&quot;../03/curlajax.class.php&quot;</span><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
</span><span class='line'><span class="x">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span>
</span><span class='line'><span class="x">&lt;head&gt;</span>
</span><span class='line'><span class="x">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;</span>
</span><span class='line'><span class="x">&lt;title&gt;微信自动投票工具&lt;/title&gt;</span>
</span><span class='line'><span class="x">&lt;/head&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="x">&lt;body&gt;</span>
</span><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="cm">/*模拟POST登录*/</span>
</span><span class='line'><span class="k">echo</span> <span class="s2">&quot;&lt;h1&gt;这是微信自动投票工具&lt;/h1&gt;&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$jkxy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">curlajax</span><span class="p">();</span>
</span><span class='line'><span class="nv">$jkxy</span><span class="o">-&gt;</span><span class="na">debug</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="nv">$jkxy</span><span class="o">-&gt;</span><span class="na">cookiejar</span> <span class="o">=</span> <span class="nb">dirname</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;\cookie1.txt&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$jkxy</span><span class="o">-&gt;</span><span class="na">cookiefile</span> <span class="o">=</span> <span class="nb">dirname</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;\cookie1.txt&#39;</span><span class="p">;</span>
</span><span class='line'><span class="cm">/*模拟提交信息*/</span>
</span><span class='line'><span class="nv">$username</span><span class="o">=</span><span class="s2">&quot;oQIrdjj&quot;</span><span class="o">.</span><span class="nb">rand</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span><span class="mi">50000</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;wKOh3Y6-1HeuwvEc&quot;</span><span class="p">;</span><span class="c1">//用随机数来产生不同的用户ID</span>
</span><span class='line'><span class="nv">$data</span> <span class="o">=</span> <span class="s2">&quot;wecha_id=&quot;</span><span class="o">.</span><span class="nv">$username</span><span class="o">.</span><span class="s2">&quot;&amp;tid=27&amp;chid=53%2C&amp;token=jdfsam1432614294&amp;action=add_vote&quot;</span><span class="p">;</span><span class="c1">//模拟不同的用户提交的数据</span>
</span><span class='line'><span class="nv">$url</span> <span class="o">=</span> <span class="s1">&#39;http://wx.asplay.cn/index.php?g=Wap&amp;m=Vote&amp;a=add_vote&amp;token=jdfsam1432614294&amp;wecha_id=&#39;</span><span class="o">.</span><span class="nv">$username</span><span class="p">;</span>
</span><span class='line'><span class="nv">$r</span> <span class="o">=</span> <span class="nv">$jkxy</span><span class="o">-&gt;</span><span class="na">httppost</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span><span class="nv">$url</span><span class="p">,</span><span class="nv">$data</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="c1">//获取返回数据</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="nx">checkstr</span><span class="p">(</span><span class="nv">$r</span><span class="p">,</span><span class="s1">&#39;&quot;success&quot;:1&#39;</span><span class="p">)</span><span class="o">==</span><span class="k">true</span><span class="p">){</span> <span class="c1">//根据返回的数据判断是否投票成功</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;投票成功&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="k">else</span><span class="p">{</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;投票失败&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>    <span class="sd">/****************************</span>
</span><span class='line'><span class="sd">    *检查$needle中是否含有$findstr</span>
</span><span class='line'><span class="sd">    *@param string needle </span>
</span><span class='line'><span class="sd">    *@param string findstr</span>
</span><span class='line'><span class="sd">    ****************************/</span>
</span><span class='line'><span class="k">function</span> <span class="nf">checkstr</span><span class="p">(</span><span class="nv">$needle</span><span class="p">,</span><span class="nv">$findstr</span><span class="p">){</span>
</span><span class='line'>  <span class="nv">$tempstr</span><span class="o">=</span><span class="nb">explode</span><span class="p">(</span><span class="nv">$findstr</span><span class="p">,</span><span class="nv">$needle</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nv">$tempstr</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">){</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;/body&gt;</span>
</span><span class='line'><span class="x">&lt;/html&gt; </span>
</span></code></pre></td></tr></table></div></figure>


<p>通过这个实战，感觉突然打开了一扇大门。要仔细研究下爬虫的相关知识了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Linx-Atom-PHP代码规范和插件推荐]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/17/linux-atom-php-cs-fixer/"/>
    <updated>2016-05-17T21:11:42+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/17/linux-atom-php-cs-fixer</id>
    <content type="html"><![CDATA[<blockquote><p>今天在使用Atom的过程中，突然好怀念以前PHPStrom的代码的格式化。就开始找Atom的插件。</p>

<h1>Atom-beautify</h1>

<ul>
<li>首先是代码格式化插件<code>Atom-Beautify</code>这个插件支持大部分的语言的格式化。</li>
</ul>
</blockquote>

<!--more-->


<ul>
<li>快捷键是<code>Ctrl+Alt+b</code>但是在实际使用过程中发现这个插件对PHP的支持并不好，首先需要安装<code>php-cs-fixer</code>还需要配置其路径。</li>
<li>在终端用<code>which php-cs-fixer</code>找到php-cs-fixer的路径。</li>
<li>但是配置好后，在PHP页面调用<code>Ctrl+Alt+b</code>并任何效果，SAD~~</li>
</ul>


<h1>Atom-php-cs-fixer</h1>

<ul>
<li>先安装<a href="http://cs.sensiolabs.org/">php-cs-fixer</a></li>
</ul>


<pre class="prettyprint">
wget http://get.sensiolabs.org/php-cs-fixer.phar -O php-cs-fixer
sudo chmod a+x php-cs-fixer
sudo mv php-cs-fixer /usr/local/bin/php-cs-fixer
</pre>


<ul>
<li>首先在Atom中搜索<code>php-cs-fixer</code>安装好后。</li>
<li>配置php-cs-fixer</li>
</ul>


<p><img src="http://g.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=a8014d177bd98d1072d40c341104c933/a2cc7cd98d1001e9bfddcfe4bf0e7bec55e7977c.jpg?referer=4dcfa78f0e23dd5478649358d112&amp;x=.jpg" alt="php-cs-fixer" /></p>

<pre class="prettyprint">
第一个红框为php-cs-fixer路径，通过
which php-cs-fixer 
获取
第二个红框为php路径，通过
which php 
获取
</pre>


<p>其他配置为一些规范规则。
<a href="http://cs.sensiolabs.org/">php-cs-fixer</a>这里进一步了解。</p>

<p>我这里使用的是PSR-2规则，现在还没有具体了解各种规则，以后进一步学习再重新写博客补充。</p>

<hr />

<h1>插件推荐</h1>

<ul>
<li><p><code>linter</code> 代码检验工具</p>

<ul>
<li>要检验PHP还需要安装<code>linter-php</code></li>
</ul>
</li>
<li><p><code>minimap</code> 和sublime右边一竖块，显示缩小版的代码</p></li>
<li><code>color-picker</code>写CSS时非常方便的调色板</li>
<li><code>autocomplete-paths</code>填写路径的时候有Sug提示</li>
<li><p><code>docblockr</code>方便写注释</p>

<ul>
<li>/** 回车 就出来注释快</li>
</ul>
</li>
<li><p><code>emmet</code>前端开发必备<a href="http://www.w3cplus.com/tools/emmet-cheat-sheet.html">Emmet使用手册</a></p></li>
<li><code>file-icons</code>美化文件类型对应的图标</li>
<li><code>active-power-mode</code>炫酷的代码输入，谁用谁知道</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Nginx下ThinkPHP应用Url重写]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/16/nginx-url-rewrite/"/>
    <updated>2016-05-16T23:36:12+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/16/nginx-url-rewrite</id>
    <content type="html"><![CDATA[<blockquote><p>在调Nginx的虚拟主机时发现，我之前的TP改写的商城没放过来（之前挂载BAE上），把BAE上的项目移植过来过后发现，只能访问主页其他页面全部都报404错误</p></blockquote>

<p>到处查资料过后发现，是因为nginx下ThinkPHP应用的url重写和Apache有点不一样。</p>

<!--more-->


<p><a href="http://www.kancloud.cn/manual/thinkphp/1866">官方手册</a>说在Nginx低版本中，是不支持PATHINFO的，但是可以通过在Nginx.conf中配置转发规则实现：</p>

<pre class="prettyprint linenums">
 location / { // …..省略部分代码
   if (!-e $request_filename) {
   rewrite  ^(.*)$  /index.php?s=$1  last;
   break;
    }
 }
</pre>


<p>但是好像对我并不适用，在网上找到一篇博文成功解决了问题。</p>

<p><a href="http://blog.jjonline.cn/linux/159.html">原文链接</a></p>

<p>按照博文的方法在我的虚拟主机配置中（/etc/nginx/conf.d/shop.ewanreton.cn.conf）添加了如下代码：</p>

<pre class="prettyprint linenums">
location / {
 root /usr/share/nginx/html/shop;
 index index.html index.htm index.php;
 if (!-e $request_filename) {
 rewrite ^/index.php(.*)$ /index.php?s=$1 last;
 rewrite ^(.*)$ /index.php?s=$1 last;
 break;
 }
}
</pre>


<p>这里我仅仅对我用ThinkPHP框架写的应用进行了配置，如果需要所有都配置的话，推荐直接写在Nginx的配置文件中。</p>

<p>虽然解决了这个问题，但是对这个问题的核心还是没有搞太懂，以后深入学习过后再回来补充这篇文章。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Nginx虚拟主机配置]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/16/nginx-virtualhost/"/>
    <updated>2016-05-16T23:36:00+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/16/nginx-virtualhost</id>
    <content type="html"><![CDATA[<blockquote><p>今天闲下来决定把腾讯云服务器上的网站弄成虚拟主机。毕竟通过 /xx/xx访问也不成样子 0.0</p></blockquote>

<!--more-->


<h1>增加虚拟主机</h1>

<ol>
<li>进入 <code>/etc/nginx/conf.d</code> 目录, 创建虚拟主机配置文件 demo.neoease.com.conf ({域名}.conf) 这个目录每个人都是不同的，进到你的配置目录就好了</li>
<li>打开配置文件, 添加服务如下:</li>
</ol>


<pre class="prettyprint linenums">
server {
    listen       80;
    server_name demo.neoease.com;
    index index.html index.htm index.php;
    root  /var/www/demo_neoease_com;
 
    log_format demo.neoease.com '$remote_addr - $remote_user [$time_local] $request'
    '$status $body_bytes_sent $http_referer '
    '$http_user_agent $http_x_forwarded_for';
    access_log  /var/log/demo.neoease.com.log demo.neoease.com;
}
</pre>


<ol>
<li>打开 Nginx 配置文件 /usr/local/nginx/conf/nginx.conf, 在 http 范围引入虚拟主机配置文件如下:</li>
</ol>


<pre class="prettyprint">
include vhost/*.conf;
这个一般来说都是有的。
</pre>


<p></p>

<h1>让 Nginx 虚拟主机支持 PHP</h1>

<p>在前面第 2 步的虚拟主机服务对应的目录加入对 PHP 的支持, 这里使用的是 FastCGI, 修改如下.</p>

<pre class="prettyprint linenums">
server {
        listen       80;
        server_name class.ewanreton.cn;
        index index.html index.htm index.php;
        root  /usr/share/nginx/html/class;

            location ~ \.php$ {
        root           /usr/share/nginx/html/class;
        fastcgi_pass   127.0.0.1:9000;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
        include        fastcgi_params;
    }

        log_format class.ewanreton.cn '$remote_addr - $remote_user [$time_local] $request'
        '$status $body_bytes_sent $http_referer '
        '$http_user_agent $http_x_forwarded_for';
        access_log  /var/log/class.ewanreton.cn.log class.ewanreton.cn;
}
这个是我腾讯云服务器上的版本。中间配置PHP支持与原博文有所不一样。
</pre>


<p></p>

<p>重启 Nginx 服务, 执行以下语句.</p>

<pre class="prettyprint linenums">
service nginx restart
</pre>


<p><a href="http://www.neoease.com/nginx-virtual-host/">参考博客</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[QQ登录Demo]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/15/qq-login/"/>
    <updated>2016-05-15T16:12:15+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/15/qq-login</id>
    <content type="html"><![CDATA[<blockquote><p>今天完成了一个QQ登录的小Deom</p></blockquote>

<h1>前置条件</h1>

<ul>
<li>一个QQ号</li>
<li>一台公网通过域名可访问的web服务器</li>
</ul>


<!--more-->


<h1>申请AppID和AppKey</h1>

<p><a href="http://connect.qq.com/">QQ开放平台</a></p>

<p>如果是第一次登录，会跳转到管理中心，应用开发者注册
<img src="http://d.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=b43ea01c0d46f21fcd345e56c61f1a5d/7acb0a46f21fbe0908972df36c600c338644ad08.jpg?referer=6f234af490dda144831e58820b06&amp;x=.jpg" alt="开发者注册" />
注册后悔跳转到管理中心，点击创建应用</p>

<p><img src="http://c.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=7ab420c84634970a4373102aa5f1a0f5/fc1f4134970a304ef778481dd6c8a786c8175cfb.jpg?referer=ebbc6b2a5566d016270eaa189c99&amp;x=.jpg" alt="创建应用" />
回调地址，可以和上面一样，在开发的时候再修改。
<img src="http://f.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=f47f75cf902bd40746c7d3f84bb2ef6c/aa18972bd40735fa1b96a55e99510fb30e2408f7.jpg?referer=8ed677a03e12b31b9e7bf91968ae&amp;x=.jpg" alt="验证" />
将下面这段代码，复制到服务器首页<code>&lt;head&gt;</code>标签中。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;meta</span> <span class="na">property=</span><span class="s">&quot;qc:admins&quot;</span> <span class="na">content=</span><span class="s">&quot;43216566776571625476636&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>添加测试回调地址</h1>

<p>在QQ开放平台应用详情中，选择信息管理，</p>

<p>在回调地址中添加</p>

<p><img src="http://g.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=2bafae5c4010b912bbc1f6fbf3c68d3e/738b4710b912c8fc25701f2afb039245d7882152.jpg?referer=37adaf2785025aaf8a254afb8f30&amp;x=.jpg" alt="添加回调地址" />
其中的callback.php可以自定义。</p>

<p>记得保存之前需要验证。</p>

<h1>引入官方SDK</h1>

<p><a href="http://wiki.connect.qq.com/">官方SDK</a></p>

<p>找到PHP下载（有能力可以自己手工开发，造车轮。）</p>

<p>放到站点根目录</p>

<h1>SDK参数配置</h1>

<p>访问<code>http://localhost/Connect2.1/install.php</code>
<img src="http://a.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=b155c91931d3d539c53d0fc60abc986d/14ce36d3d539b600424ce650ee50352ac75cb753.jpg?referer=0353883031d12f2e97129a50f131&amp;x=.jpg" alt="参数配置" />
配置成功后,保留API下的文件，其他的都可删除。</p>

<h1>SDK解读</h1>

<p><img src="http://g.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=440c3587322ac65c63056676cbc9c32c/e850352ac65c10382dc82725b5119313b17e89a7.jpg?referer=314909b58235e5ddc93b91eff77d&amp;x=.jpg" alt="" />
<img src="http://b.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=4c5e0d1fa086c9170c03523cf90601f2/d0c8a786c9177f3ebe9d15ea77cf3bc79e3d56a8.jpg?referer=4ebf08d032fae6cd55a39f519266&amp;x=.jpg" alt="" />
<img src="http://h.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=327017c44e540923ae69637ba263a034/ca1349540923dd54e98f4e8fd609b3de9d82485d.jpg?referer=cd4a9bc7be12c8fcede4c2fda833&amp;x=.jpg" alt="" />
<img src="http://a.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=22750c750bf431adb8d2433c7b0ddd92/d1a20cf431adcbefe6cb97e1abaf2edda2cc9f5e.jpg?referer=bd373c299e25bc31724a35a8d934&amp;x=.jpg" alt="" />
<img src="http://f.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=3ede9315d262853596e0d224a0d407fb/4ec2d5628535e5dd429f4c3871c6a7efcf1b62a2.jpg?referer=bc5660e9b63533faaca1a71ece60&amp;x=.jpg" alt="" />
<img src="http://b.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=9a446d86ff1986184547ef817ad65f4e/b151f8198618367af3eb973a29738bd4b21ce5f3.jpg?referer=7862fb405eee3d6d7bd1b3fb4391&amp;x=.jpg" alt="" />
<img src="http://g.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=f77b76cf902bd40746c7d3f84bb2ef6c/aa18972bd40735fa1892a65e99510fb30e2408f3.jpg?referer=8dd274a03e12b31b9e7bf9196892&amp;x=.jpg" alt="" />
<img src="http://a.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=4d470c1fa086c9170c03523cf90601f2/d0c8a786c9177f3ebf8414ea77cf3bc79e3d56a1.jpg?referer=4fa609d032fae6cd55a39f51927f&amp;x=.jpg" alt="" /></p>

<h1>将SDK整合到web中</h1>

<p>Connect2.1
放在同级目录下</p>

<figure class='code'><figcaption><span>index.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="k">require_once</span> <span class="s2">&quot;Connect2.1/qqConnectAPI.php&quot;</span><span class="p">;</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="x">&lt;html&gt;</span>
</span><span class='line'><span class="x">  &lt;head&gt;</span>
</span><span class='line'><span class="x">      &lt;meta charset=&quot;utf-8&quot;&gt;</span>
</span><span class='line'><span class="x">      &lt;title&gt;&lt;/title&gt;</span>
</span><span class='line'><span class="x">  &lt;/heda&gt;</span>
</span><span class='line'><span class="x">    &lt;body&gt;</span>
</span><span class='line'><span class="x">        </span><span class="cp">&lt;?php</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;qq_accesstokebn&#39;</span><span class="p">])</span><span class="o">||!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;qq_openid&#39;</span><span class="p">])){</span><span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">        &lt;a href=&quot;qqlogin.php&quot;&gt;登录QQ&lt;/a&gt;</span>
</span><span class='line'><span class="x">        </span><span class="cp">&lt;?php</span> <span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">          &lt;a href=&quot;qqlogout.php&quot;&gt;退出QQ&lt;/a&gt;</span>
</span><span class='line'><span class="x">          </span><span class="cp">&lt;?php</span>
</span><span class='line'>            <span class="nv">$qc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">QC</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;qq_accesstokebn&#39;</span><span class="p">],</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;qq_openid&#39;</span><span class="p">]);</span>
</span><span class='line'>            <span class="nv">$userinfo</span> <span class="o">=</span><span class="nv">$qc</span><span class="o">-&gt;</span><span class="na">get_user_info</span><span class="p">();</span>
</span><span class='line'>            <span class="nb">print_r</span><span class="p">(</span><span class="nv">$userinfo</span><span class="p">);</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>          <span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">    &lt;/body&gt;</span>
</span><span class='line'><span class="x">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>qqlogin.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="k">require_once</span> <span class="s1">&#39;Connect2.1/qqConnectAPI.php&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">//访问QQ页面</span>
</span><span class='line'>  <span class="nv">$oauth</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Oauth</span><span class="p">();</span>
</span><span class='line'>  <span class="nv">$oauth</span><span class="o">-&gt;</span><span class="na">qq_login</span><span class="p">();</span>
</span><span class='line'> <span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>qqlogout.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="nb">setcookie</span><span class="p">(</span><span class="s1">&#39;qq_accesstokebn&#39;</span><span class="p">,</span><span class="k">null</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">setcookie</span><span class="p">(</span><span class="s1">&#39;qq_openid&#39;</span><span class="p">,</span><span class="k">null</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Location:index.php&quot;</span><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>callback.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="k">require_once</span> <span class="s1">&#39;Connect2.1/qqConnectAPI.php&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">//echo $_GET[&#39;code&#39;];</span>
</span><span class='line'>  <span class="c1">//请求accesstoken</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$oauth</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Oauth</span><span class="p">();</span>
</span><span class='line'><span class="nv">$accesstoken</span> <span class="o">=</span> <span class="nv">$oauth</span><span class="o">-&gt;</span><span class="na">qq_callback</span><span class="p">();</span>
</span><span class='line'><span class="nv">$openid</span> <span class="o">=</span> <span class="nv">$oauth</span><span class="o">-&gt;</span><span class="na">get_openid</span><span class="p">();</span>
</span><span class='line'><span class="nb">setcookie</span><span class="p">(</span><span class="s2">&quot;qq_accesstokebn&quot;</span><span class="p">,</span><span class="nv">$accesstoken</span><span class="p">,</span><span class="nb">time</span><span class="p">()</span><span class="o">+</span><span class="mi">86400</span><span class="p">);</span>
</span><span class='line'><span class="nb">setcookie</span><span class="p">(</span><span class="s2">&quot;qq_openid&quot;</span><span class="p">,</span><span class="nv">$openid</span><span class="p">,</span><span class="nb">time</span><span class="p">()</span><span class="o">+</span><span class="mi">86400</span><span class="p">);</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Location:index.php&quot;</span><span class="p">)</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PHP-Memcache]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/14/memcache/"/>
    <updated>2016-05-14T20:08:26+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/14/memcache</id>
    <content type="html"><![CDATA[<h1>什么是Memcache</h1>

<blockquote><p>Memcache通过缓存服务器信息的方式来加速服务器处理能力的系统。Memcache分配一块服务器上的内存来缓存一段特定时间之内的最近的查询数据。一旦某个数据被再次请求，那么Memcache就直接从内存中返回这个数据，而不是从数据库中，所以这将会加速查询速度。</p></blockquote>

<!--more-->


<h1>Memcache使用场景</h1>

<ul>
<li>非持久化存储：对数据存储要求不高</li>
<li>分布式存储：不适合单机（对内存消耗很大）</li>
<li>ke/value存储：格式简单，不支持List，Array数据格式

<h1>Memcache服务端的安装</h1></li>
<li>编译安装 Libevent Memcache</li>
<li>依赖管理工具 yum apt-get</li>
<li>Memcache 和Memcached

<ul>
<li>Memcached 是Memcache的升级版本 推荐使用</li>
</ul>
</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$sudo apt-get install memcached</span></code></pre></td></tr></table></div></figure>


<p>安装完Memcache服务端以后，我们需要启动该服务：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>memcached -d -m 128 -p 11211 -u root</span></code></pre></td></tr></table></div></figure>


<p>使用</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ps -ef |grep memcach</span></code></pre></td></tr></table></div></figure>


<p>查看是否启动
这里需要说明一下memcached服务的启动参数：</p>

<ul>
<li>-p 监听的端口</li>
<li>-l 连接的IP地址, 默认是本机</li>
<li>-d start 启动memcached服务

<ul>
<li>-d restart 重起memcached服务</li>
<li>-d stop|shutdown 关闭正在运行的memcached服务</li>
<li>-d install 安装memcached服务</li>
<li>-d uninstall 卸载memcached服务</li>
</ul>
</li>
<li>-u 以的身份运行 (仅在以root运行的时候有效)</li>
<li>-m 最大内存使用，单位MB。默认64MB</li>
<li>-M 内存耗尽时返回错误，而不是删除项</li>
<li>-c 最大同时连接数，默认是1024</li>
<li>-f 块大小增长因子，默认是1.25-n 最小分配空间，key+value+flags默认是48</li>
<li>-h 显示帮助

<h1>Memcache客户端的安装</h1></li>
<li>安装Libmemcached</li>
<li>为PHP安装memcached扩展</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$sudo apt-get install php5-memcache</span></code></pre></td></tr></table></div></figure>


<p>安装完以后我们需要在php.ini里进行简单的配置,打开/etc/php5/apache2/php.ini文件在末尾添加如下内容：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="p">[</span><span class="nx">Memcache</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="p">;</span> <span class="nx">一个高性能的分布式的内存对象缓存系统，通过在内存里维护一个统一的巨大的hash表，</span>
</span><span class='line'><span class="p">;</span> <span class="nx">它能够用来存储各种格式的数据，包括图像、视频、文件以及数据库检索的结果等。</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="p">;</span> <span class="nx">是否在遇到错误时透明地向其他服务器进行故障转移。</span>
</span><span class='line'><span class="nx">memcache</span><span class="o">.</span><span class="nx">allow_failover</span> <span class="o">=</span> <span class="nx">On</span>
</span><span class='line'>
</span><span class='line'><span class="p">;</span> <span class="nx">接受和发送数据时最多尝试多少个服务器，只在打开memcache</span><span class="o">.</span><span class="nx">allow_failover时有效。memcache</span><span class="o">.</span><span class="nx">max_failover_attempts</span> <span class="o">=</span> <span class="mi">20</span>
</span><span class='line'>
</span><span class='line'><span class="p">;</span> <span class="nx">数据将按照此值设定的块大小进行转移。此值越小所需的额外网络传输越多。</span>
</span><span class='line'><span class="p">;</span> <span class="nx">如果发现无法解释的速度降低，可以尝试将此值增加到32768。</span>
</span><span class='line'><span class="nx">memcache</span><span class="o">.</span><span class="nx">chunk_size</span> <span class="o">=</span> <span class="mi">8192</span>
</span><span class='line'>
</span><span class='line'><span class="p">;</span> <span class="nx">连接到memcached服务器时使用的默认TCP端口。</span>
</span><span class='line'><span class="nx">memcache</span><span class="o">.</span><span class="nx">default_port</span> <span class="o">=</span> <span class="mi">11211</span>
</span><span class='line'>
</span><span class='line'><span class="p">;</span> <span class="nx">控制将key映射到server的策略。默认值”standard”表示使用先前版本的老hash策略。</span>
</span><span class='line'><span class="p">;</span> <span class="nx">设为”consistent”可以允许在连接池中添加</span><span class="o">/</span><span class="nx">删除服务器时不必重新计算key与server之间的映射关系。</span>
</span><span class='line'><span class="p">;</span><span class="nx">memcache</span><span class="o">.</span><span class="nx">hash_strategy</span> <span class="o">=</span> <span class="nx">“standard”</span><span class="p">;</span> <span class="nx">控制将key映射到server的散列函数。默认值”crc32″使用CRC32算法，而”fnv”则表示使用FNV</span><span class="o">-</span><span class="mi">1</span><span class="nx">a算法。</span>
</span><span class='line'><span class="p">;</span> <span class="nx">FNV</span><span class="o">-</span><span class="mi">1</span><span class="nx">a比CRC32速度稍低，但是散列效果更好。</span>
</span><span class='line'><span class="p">;</span><span class="nx">memcache</span><span class="o">.</span><span class="nx">hash_function</span> <span class="o">=</span> <span class="nx">“crc32″</span>
</span></code></pre></td></tr></table></div></figure>


<p>保存<code>php.ini</code>,执行<code>service apache2 restart</code>重启Apache。使用<code>php -m |grep memchched</code>查看是否安装成功</p>

<h1>Memcached 常见操作</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nv">$m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Memcached</span><span class="p">();</span>
</span><span class='line'><span class="nv">$array</span><span class="o">=</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>  <span class="k">array</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span><span class="mi">11211</span><span class="p">),</span>
</span><span class='line'>
</span><span class='line'><span class="p">);</span>
</span><span class='line'><span class="nv">$m</span><span class="o">-&gt;</span><span class="na">addServers</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span> <span class="c1">//添加服务器 添加多条为addServers 一条为 addServer（“127.0.0.1”，11211）；</span>
</span><span class='line'><span class="c1">// // echo &quot;11&quot;;</span>
</span><span class='line'><span class="c1">// $info=$m-&gt;getStats();</span>
</span><span class='line'><span class="c1">// print_r($info);</span>
</span><span class='line'><span class="c1">//数据类操作</span>
</span><span class='line'><span class="c1">//add</span>
</span><span class='line'><span class="nv">$m</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s2">&quot;mkey&quot;</span><span class="p">,</span><span class="s2">&quot;mvalue&quot;</span><span class="p">,</span><span class="mi">600</span><span class="p">);</span><span class="c1">//key value time</span>
</span><span class='line'><span class="nv">$m</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s2">&quot;mkey&quot;</span><span class="p">,</span><span class="s2">&quot;mvalue2&quot;</span><span class="p">,</span><span class="mi">600</span><span class="p">);</span><span class="c1">//两次赋值不会改变它的值</span>
</span><span class='line'><span class="nv">$m</span><span class="o">-&gt;</span><span class="na">replace</span><span class="p">(</span><span class="s2">&quot;mkey&quot;</span><span class="p">,</span><span class="s2">&quot;mvalue3&quot;</span><span class="p">,</span><span class="mi">600</span><span class="p">);</span><span class="c1">//替换</span>
</span><span class='line'><span class="k">echo</span> <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s2">&quot;mkey&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$m</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s2">&quot;mkey&quot;</span><span class="p">,</span><span class="s2">&quot;mvalue&quot;</span><span class="p">,</span><span class="mi">600</span><span class="p">);</span><span class="c1">//常用，如果不存在mkey则创建，如果存在则覆盖</span>
</span><span class='line'><span class="nv">$m</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="s2">&quot;mkey&quot;</span><span class="p">);</span><span class="c1">//删除</span>
</span><span class='line'><span class="nv">$m</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span><span class="c1">//清空memcache中的所有缓存</span>
</span><span class='line'><span class="nv">$m</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="nv">$m</span><span class="o">-&gt;</span><span class="na">increment</span><span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span><span class="c1">//每次刷新num+5</span>
</span><span class='line'><span class="nv">$m</span><span class="o">-&gt;</span><span class="na">decrement</span><span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span><span class="c1">//每次刷新num-5</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="nv">$m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Memcached</span><span class="p">();</span>
</span><span class='line'>  <span class="nv">$array</span><span class="o">=</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>    <span class="k">array</span><span class="p">(</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span><span class="mi">11211</span><span class="p">),</span>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'>  <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">addServers</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$data</span><span class="o">=</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>    <span class="s2">&quot;key&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;key2&quot;</span> <span class="o">=&gt;</span><span class="s2">&quot;value2&quot;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'>  <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">setMulti</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span> <span class="c1">//一次设置多个值</span>
</span><span class='line'> <span class="nv">$result</span><span class="o">=</span>  <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">getMulti</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">,</span><span class="s2">&quot;key2&quot;</span><span class="p">));</span><span class="c1">//一次获取多个值</span>
</span><span class='line'> <span class="nb">print_r</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
</span><span class='line'> <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">deleteMulti</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">,</span><span class="s2">&quot;key2&quot;</span><span class="p">));</span><span class="c1">//一次删除多个值</span>
</span><span class='line'> <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">getResultCode</span><span class="p">();</span><span class="c1">//获取上次操作返回值</span>
</span><span class='line'> <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">getResultMessage</span><span class="p">();</span><span class="c1">//获取上次操作的信息</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://php.net/manual/zh/book.memcached.php">官方说明文档</a></p>

<h1>项目中使用Memcached</h1>

<ul>
<li>即时生成缓存　

<ul>
<li>类似于新闻详情页，第一个人来了生成缓存，第二个人再来直接读缓存</li>
</ul>
</li>
<li>提前生成缓存

<ul>
<li>适合高访问量</li>
</ul>
</li>
<li>永久缓存

<ul>
<li>关于我们 这种基本不变的网页</li>
</ul>
</li>
</ul>


<h1>注意事项</h1>

<ul>
<li>不要在单机模式中使用Memcached</li>
<li>不要在Memcached保存重要数据。掉电会丢失。</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[spl初识]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/13/spl/"/>
    <updated>2016-05-13T20:26:58+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/13/spl</id>
    <content type="html"><![CDATA[<h1>什么是SPL</h1>

<blockquote><p>SPL是Standard PHP Library（PHP标准库）的缩写。
根据官方定义，它是"a collection of interfaces and classes that are meant to solve standard problems"。但是，目前在使用中，SPL更多地被看作是一种使object（物体）模仿array（数组）行为的interfaces和classes。</p></blockquote>

<!--more-->


<h1>SPL的常用数据结构</h1>

<h2>双向链表</h2>

<ul>
<li>SplDoublyLinkedList类</li>
<li>操作

<ul>
<li>当前节点操作：

<ul>
<li>rewind:使当前节点指向Buttom（头部）</li>
<li>next：指向下一个节点</li>
<li>prev：指向上一个节点</li>
<li>current：指向链表当前节点的指针，调用前需调用rewind，指向的节点被删除后会指向一个空节点</li>
</ul>
</li>
<li>增加节点操作：

<ul>
<li>push：向链表的顶部（尾部）插入一个节点</li>
<li>unshift：向链表的底部插入一个节点（头部）</li>
</ul>
</li>
<li>删除节点操作：

<ul>
<li>pop：获取链表中顶部（尾部）的节点并删除，不改变当前指针的位置</li>
<li>shift：删除连边底部（头部）的节点</li>
</ul>
</li>
<li>定位操作

<ul>
<li>bottom：获得链表底部（头部）的元素，指针位置不变</li>
<li>top：获得链表顶部（尾部）的元素，指针位置不变</li>
</ul>
</li>
<li>特定节点操作

<ul>
<li>offsetExists</li>
<li>offsetGet</li>
<li>offsetSet</li>
<li>offsetUnset</li>
</ul>
</li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">=</span><span class="k">new</span> <span class="nx">SplDoublyLinkedList</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">push</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="c1">//把节点添加到顶部</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">push</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">push</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">unshift</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="c1">//将新的节点添加到底部（bottom）</span>
</span><span class='line'>    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$obj</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">rewind</span><span class="p">();</span><span class="c1">//rewind操作用于把节点指针指向bottom所在的节点</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;current:&quot;</span><span class="o">.</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> <span class="c1">//获取节点指针指向的节点（当前）</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span><span class="c1">//指向下一节点</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">prev</span><span class="p">();</span><span class="c1">//指向上一节点</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;next:&quot;</span><span class="o">.</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span><span class="c1">//指向下一节点</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span><span class="c1">//指向下一节点</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span><span class="c1">//指向下一节点</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span><span class="c1">//指向下一节点</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()){</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s2">&quot;Current node valid</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s2">&quot;Current node invalid</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">valid</span><span class="p">()){</span><span class="c1">//如果当前节点有效，valid返回true</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s2">&quot;valid list&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s2">&quot;invalid list&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;pop value&quot;</span><span class="o">.</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">pop</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span><span class="c1">//把TOP位置的节点从链表中弹出。pop不影响指针指向的节点。如果pop指向的是top，调用POP后会指向NULL</span>
</span><span class='line'>    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$obj</span><span class="p">);</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;current:&quot;</span><span class="o">.</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">shift</span><span class="p">();</span><span class="c1">//把bottom位置的节点从链表中删除。并返回</span>
</span><span class='line'>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h2>堆栈</h2>

<ul>
<li>继承自SplDoublyLinkedList类的SplStack类</li>
<li>先进后出</li>
<li>操作

<ul>
<li>push：压入堆栈</li>
<li>pop：弹出堆栈</li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>    <span class="nv">$stack</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SplStack</span><span class="p">();</span>
</span><span class='line'>    <span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">push</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">push</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">push</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$stack</span><span class="p">);</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;Bottom:&quot;</span><span class="o">.</span><span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">bottom</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;Top:&quot;</span><span class="o">.</span><span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">top</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">offsetSet</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;C&quot;</span><span class="p">);</span><span class="c1">//在Stack里面offset=0是TOP所在的位置，offset=1是top位置节点靠近bottom位置的相邻节点</span>
</span><span class='line'>    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$stack</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">rewind</span><span class="p">();</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;Current:&quot;</span><span class="o">.</span><span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span><span class="c1">//双向链表的rewind和堆栈的rewind相反，堆栈的rewind使得当前指针指向TOP所在的位置，而双向链表的rewind指向bottom所在的位置</span>
</span><span class='line'>    <span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;Current:&quot;</span><span class="o">.</span><span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">//遍历堆栈</span>
</span><span class='line'>    <span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">rewind</span><span class="p">();</span>
</span><span class='line'>    <span class="k">while</span><span class="p">(</span><span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">valid</span><span class="p">()){</span>
</span><span class='line'>      <span class="k">echo</span> <span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">key</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;=&gt;&quot;</span><span class="o">.</span><span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//删除堆栈</span>
</span><span class='line'>    <span class="nv">$popObj</span> <span class="o">=</span> <span class="nv">$stack</span><span class="o">-&gt;</span><span class="na">pop</span><span class="p">();</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;PopED object:&quot;</span><span class="o">.</span><span class="nv">$popObj</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$stack</span><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h2>队列</h2>

<ul>
<li>继承自SplDoublyLinkedList类的SplQueue类</li>
<li>先进先出</li>
<li>操作

<ul>
<li>enqueue：进入队里</li>
<li>duqueue：退出对列</li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="nv">$obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SplQueue</span><span class="p">();</span>
</span><span class='line'>  <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">enqueue</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">);</span><span class="c1">//插入一个节点到TOP位置</span>
</span><span class='line'>  <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">enqueue</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">enqueue</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">print_r</span><span class="p">(</span><span class="nv">$obj</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;bottom:&quot;</span><span class="o">.</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">bottom</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;top:&quot;</span><span class="o">.</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">top</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">offsetSet</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;A&quot;</span><span class="p">);</span><span class="c1">//队列里面的offset=0是bottom所在的位置</span>
</span><span class='line'>  <span class="nb">print_r</span><span class="p">(</span><span class="nv">$obj</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">rewind</span><span class="p">();</span><span class="c1">//队列的rewind指向bottom所在的位置</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;current:&quot;</span><span class="o">.</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">valid</span><span class="p">()){</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">key</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;=&gt;&quot;</span><span class="o">.</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;dequeue obj:&quot;</span><span class="o">.</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">dequeue</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span><span class="c1">//从队列中提取bottom位置的节点并删除</span>
</span><span class='line'>  <span class="nb">print_r</span><span class="p">(</span><span class="nv">$obj</span><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h1>迭代器</h1>

<h2>什么是迭代器</h2>

<blockquote><p>通过某种同意的方式遍历链表或数组中的元素的过程叫做迭代遍历，而这种统一的遍历工具我们叫做迭代器</p></blockquote>

<p>在PHP中迭代器是通过Iterator接口定义的。</p>

<h2>常用的迭代器 ArrayIterator</h2>

<ul>
<li>熟悉使用foreach和while语句通过ArrayIterator遍历数组的方法</li>
<li>熟悉使用seek跳过某些元素的方法</li>
<li>熟悉使用ArrayIerator进行排序的方法</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>    <span class="nv">$fruits</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>      <span class="s2">&quot;apple&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;appale value&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;orange&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;orange value&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;grape&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;grape value&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;plum&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;plum value&quot;</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'>    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$fruits</span><span class="p">);</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;use fruits directly </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$fruits</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">echo</span> <span class="nv">$key</span><span class="o">.</span><span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="nv">$value</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//使用ArrayIterator 遍历数组</span>
</span><span class='line'>    <span class="nv">$obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayObject</span><span class="p">(</span><span class="nv">$fruits</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$it</span> <span class="o">=</span> <span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">getIterator</span><span class="p">();</span><span class="c1">//获取迭代器</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;use ArrayIterator in foreach </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$it</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">echo</span> <span class="nv">$key</span><span class="o">.</span><span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="nv">$value</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;use ArrayIterator in while </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">rewind</span><span class="p">();</span><span class="c1">//ccurretn前需要rewind</span>
</span><span class='line'>    <span class="k">while</span> <span class="p">(</span><span class="nv">$it</span><span class="o">-&gt;</span><span class="na">valid</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">echo</span> <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">key</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">();</span>
</span><span class='line'>      <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//跳过某些元素进行打印</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s2">&quot;use seek befor while </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">rewind</span><span class="p">();</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="nv">$it</span><span class="o">-&gt;</span><span class="na">valid</span><span class="p">()){</span>
</span><span class='line'>      <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">seek</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>      <span class="k">while</span> <span class="p">(</span><span class="nv">$it</span><span class="o">-&gt;</span><span class="na">valid</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">echo</span> <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">key</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">();</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//实现排序</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;use ksort </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">ksort</span><span class="p">();</span><span class="c1">//对key字典序排序</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$it</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">echo</span> <span class="nv">$key</span><span class="o">.</span><span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="nv">$value</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;use asort </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">ksort</span><span class="p">();</span><span class="c1">//对value字典序排序</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$it</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">echo</span> <span class="nv">$key</span><span class="o">.</span><span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="nv">$value</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h2>常用的迭代器 AppendIterator</h2>

<ul>
<li>AppendIterator能陆续遍历几个迭代器

<ul>
<li>按顺序迭代访问几个不同的迭代器。 例如，希望在一些循环中迭代访问两个或多个组合。</li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="nv">$array_a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayIterator</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="s2">&quot;b&quot;</span><span class="p">,</span><span class="s2">&quot;c&quot;</span><span class="p">,</span><span class="s2">&quot;d&quot;</span><span class="p">));</span>
</span><span class='line'>  <span class="nv">$array_b</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayIterator</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,</span><span class="s2">&quot;f&quot;</span><span class="p">,</span><span class="s2">&quot;g&quot;</span><span class="p">,</span><span class="s2">&quot;h&quot;</span><span class="p">));</span>
</span><span class='line'>  <span class="nv">$it</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AppendIterator</span><span class="p">();</span>
</span><span class='line'>  <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">append</span><span class="p">(</span><span class="nv">$array_a</span><span class="p">);</span><span class="c1">//通过append方法把迭代器对象添加到AppendIterator对象中</span>
</span><span class='line'>  <span class="nv">$it</span><span class="o">-&gt;</span><span class="na">append</span><span class="p">(</span><span class="nv">$array_b</span><span class="p">);</span>
</span><span class='line'>  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$it</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nv">$value</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h2>常用的迭代器 MultipleIterator</h2>

<ul>
<li>MultipleIterator用于把多个Iterator里面的数据组合为一个整体来访问</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="nv">$idIter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayIterator</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">&quot;01&quot;</span><span class="p">,</span><span class="s2">&quot;02&quot;</span><span class="p">,</span><span class="s2">&quot;03&quot;</span><span class="p">));</span>
</span><span class='line'>  <span class="nv">$nameIter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayIterator</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">&quot;张三&quot;</span><span class="p">,</span><span class="s2">&quot;李四&quot;</span><span class="p">,</span><span class="s2">&quot;王五&quot;</span><span class="p">));</span>
</span><span class='line'>  <span class="nv">$ageIter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayIterator</span><span class="p">(</span> <span class="k">array</span><span class="p">(</span><span class="s2">&quot;22&quot;</span><span class="p">,</span><span class="s2">&quot;23&quot;</span><span class="p">,</span><span class="s2">&quot;24&quot;</span><span class="p">));</span>
</span><span class='line'>  <span class="nv">$mit</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MultipleIterator</span><span class="p">(</span><span class="nx">MultipleIterator</span><span class="o">::</span><span class="na">MIT_KEYS_ASSOC</span><span class="p">);</span><span class="c1">//知明当你拼凑起来过后Key也是一个Array</span>
</span><span class='line'>  <span class="nv">$mit</span><span class="o">-&gt;</span><span class="na">attachIterator</span><span class="p">(</span><span class="nv">$idIter</span><span class="p">,</span><span class="s2">&quot;ID&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$mit</span><span class="o">-&gt;</span><span class="na">attachIterator</span><span class="p">(</span><span class="nv">$nameIter</span><span class="p">,</span><span class="s2">&quot;NAME&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$mit</span><span class="o">-&gt;</span><span class="na">attachIterator</span><span class="p">(</span><span class="nv">$ageIter</span><span class="p">,</span><span class="s2">&quot;AGE&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$mit</span> <span class="k">as</span>  <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h2>常用的迭代器 FilesystemIterator</h2>

<ul>
<li>FilesystemIterator能遍历文件系统</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>    <span class="nb">date_default_timezone_set</span><span class="p">(</span><span class="s2">&quot;PRC&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$it</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FilesystemIterator</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$it</span> <span class="k">as</span>  <span class="nv">$finfo</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%s</span><span class="se">\t</span><span class="s2">%s</span><span class="se">\t</span><span class="s2">%8s</span><span class="se">\t</span><span class="s2">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nb">date</span><span class="p">(</span><span class="s2">&quot;Y-m-d H:i:s&quot;</span><span class="p">,</span><span class="nv">$finfo</span><span class="o">-&gt;</span><span class="na">getMTime</span><span class="p">()),</span>
</span><span class='line'>      <span class="nv">$finfo</span><span class="o">-&gt;</span><span class="na">isDir</span><span class="p">()</span><span class="o">?</span><span class="s2">&quot;&lt;DIR&gt;&quot;</span><span class="o">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nb">number_format</span><span class="p">(</span><span class="nv">$finfo</span><span class="o">-&gt;</span><span class="na">getSize</span><span class="p">()),</span>
</span><span class='line'>      <span class="nv">$finfo</span><span class="o">-&gt;</span><span class="na">getFileName</span><span class="p">()</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'>    <span class="c1">// echo $finfo-&gt;isDir()?&quot;&lt;DIR&gt;&quot;:&quot;&quot;,</span>
</span><span class='line'>      <span class="c1">// echo date(&quot;Y-m-d H:i:s&quot;,$finfo-&gt;getMTime()).&quot;\n&quot;;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h1>SPL基础接口</h1>

<h2>Countable</h2>

<ul>
<li>继承了该接口的类可以直接调用count（）得到元素个数。</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">date_default_timezone_set</span><span class="p">(</span><span class="s2">&quot;PRC&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>      <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;张三&#39;</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;5&#39;</span><span class="p">),</span>
</span><span class='line'>      <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;李四&#39;</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;6&#39;</span><span class="p">),</span>
</span><span class='line'>      <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;王五&#39;</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;7&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">);</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$array</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$array</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">CountMe</span> <span class="k">implements</span> <span class="nx">Countable</span><span class="p">{</span> <span class="c1">//实现Countable接口，</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$_myCount</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">count</span><span class="p">(){</span>
</span><span class='line'>      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_myCount</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nv">$obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CountMe</span><span class="p">();</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$obj</span><span class="p">);</span><span class="c1">//实现了Countable接口就能通过cout函数直接调用到之前定义好的Count方法</span>
</span><span class='line'> <span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h2>OuterIterator</h2>

<ul>
<li>如果想对迭代器进行一定的处理之后再返回，可以用这个接口</li>
<li>继承自IteratorIterator这个类</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>    <span class="nb">date_default_timezone_set</span><span class="p">(</span><span class="s2">&quot;PRC&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">&quot;value1&quot;</span><span class="p">,</span><span class="s2">&quot;value2&quot;</span><span class="p">,</span><span class="s2">&quot;value3&quot;</span><span class="p">,</span><span class="s2">&quot;value4&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$outerObj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OuterImpl</span><span class="p">(</span> <span class="k">new</span> <span class="nx">ArrayIterator</span><span class="p">(</span><span class="nv">$array</span><span class="p">));</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$outerObj</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1"># code...</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s2">&quot;++&quot;</span><span class="o">.</span><span class="nv">$key</span><span class="o">.</span><span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="nv">$value</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">OuterImpl</span> <span class="k">extends</span> <span class="nx">IteratorIterator</span><span class="p">{</span>
</span><span class='line'>      <span class="k">public</span> <span class="k">function</span> <span class="nf">current</span><span class="p">(){</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="na">current</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;_tail&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">public</span> <span class="k">function</span> <span class="nf">key</span><span class="p">(){</span>
</span><span class='line'>        <span class="k">return</span> <span class="s2">&quot;pre_&quot;</span><span class="o">.</span><span class="k">parent</span><span class="o">::</span><span class="na">key</span><span class="p">();</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'> <span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h2>RecursiveTterator</h2>

<ul>
<li>可以对多次结构的迭代器进行迭代，比如遍历一棵树</li>
<li>所有具有层次结构特点的数据都可以用这个接口遍历

<ul>
<li>如文件夹</li>
</ul>
</li>
<li>关键方法

<ul>
<li>hasChildren :用于判断当前节点是否存在子节点</li>
<li>getChileren :用于得到当前节点子节点的迭代器</li>
</ul>
</li>
<li>SPL中实现该接口的类

<ul>
<li>RecursiveArrayIterator，RecursiveCachingIterator等以 Recursive开头的类都能进行多层次结构化的遍历

<h2>SeekableIterator</h2></li>
</ul>
</li>
<li>可以通过seek方法定位到集合里面的某个元素</li>
<li>seek方法的参数是元素的位置，从0开始</li>
</ul>


<h1>SPL基础函数的使用</h1>

<h2>Autoload</h2>

<ul>
<li>为了初始化PHP中的类对象，需要通过一定的方法寻找到类的定义。通常情况下，类会定义在一个单独的文件中。</li>
<li>Autoload就是PHP找到这些文件的方法。</li>
</ul>


<figure class='code'><figcaption><span>libs/test.class.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="sd">/**</span>
</span><span class='line'><span class="sd">   *</span>
</span><span class='line'><span class="sd">   */</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">test</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s2">&quot;Loading Class Libs/test.class.php</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>libs/test.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Test</span><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(){</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s2">&quot;Loading Class Libs/test.php</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'> <span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>Autoload01.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="nb">spl_autoload_extensions</span><span class="p">(</span><span class="s2">&quot;.class.php,.php&quot;</span><span class="p">);</span><span class="c1">//设置autoload寻找php定义的类文件的扩展名，多个扩展名用逗号分开,前面的扩招名优先匹配</span>
</span><span class='line'>  <span class="nb">set_include_path</span><span class="p">(</span><span class="nb">get_include_path</span><span class="p">()</span><span class="o">.</span><span class="nx">PATH_SEPARATOR</span><span class="o">.</span><span class="s2">&quot;libs/&quot;</span><span class="p">);</span><span class="c1">//设置autoload寻找php定义的类文件的目录，多个目录用PATH_SEPARATOR分隔</span>
</span><span class='line'>  <span class="nb">spl_autoload_register</span><span class="p">();</span><span class="c1">//提示PHP使用autoload机制查找类定义</span>
</span><span class='line'>  <span class="k">new</span> <span class="nx">test</span><span class="p">();</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>Autoload02.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="k">function</span> <span class="nf">__autoload</span><span class="p">(</span><span class="nv">$class_name</span><span class="p">){</span><span class="c1">//定义__autoload函数，可以不调用spl_autoload_register函数的情况下完成类的装载</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;__autoload class:&quot;</span><span class="o">.</span><span class="nv">$class_name</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">require_once</span><span class="p">(</span><span class="s2">&quot;libs/&quot;</span><span class="o">.</span><span class="nv">$class_name</span><span class="o">.</span><span class="s2">&quot;.php&quot;</span><span class="p">);</span><span class="c1">//装载类</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">function</span> <span class="nf">classLoader</span><span class="p">(</span><span class="nv">$class_name</span><span class="p">){</span><span class="c1">//定义一个替换__autoload函数的类文件装载函数</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;classLoader() load class:&quot;</span><span class="o">.</span><span class="nv">$class_name</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">require_once</span><span class="p">(</span><span class="s2">&quot;libs/&quot;</span><span class="o">.</span><span class="nv">$class_name</span><span class="o">.</span><span class="s2">&quot;.php&quot;</span><span class="p">);</span><span class="c1">//装载类</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nb">spl_autoload_register</span><span class="p">(</span><span class="s2">&quot;classLoader&quot;</span><span class="p">);</span><span class="c1">//传入定义好的装载类的函数的名称替换__autoload函数</span>
</span><span class='line'>  <span class="k">new</span> <span class="nx">test</span><span class="p">();</span>
</span><span class='line'> <span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>Autoload03.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="k">function</span> <span class="nf">classLoader</span><span class="p">(</span><span class="nv">$class_name</span><span class="p">){</span><span class="c1">//定义一个替换__autoload函数的类文件装载函数</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;classLoader() load class:&quot;</span><span class="o">.</span><span class="nv">$class_name</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nb">set_include_path</span><span class="p">(</span><span class="s2">&quot;lib/&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nb">spl_autoload</span><span class="p">(</span><span class="nv">$class_name</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nb">spl_autoload_register</span><span class="p">(</span><span class="s2">&quot;classLoader&quot;</span><span class="p">);</span><span class="c1">//传入定义好的装载类的函数的名称替换__autoload函数</span>
</span><span class='line'><span class="k">new</span> <span class="nx">test</span><span class="p">();</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h1>SPL其他函数</h1>

<ul>
<li><p>迭代器相关</p>

<ul>
<li>iterator_apply :为迭代器中的每个元素调用一个用户自定义函数</li>
<li>iterator_count ：计算迭代器元素个数</li>
<li>iterator_to_array ：将迭代器的元素拷贝到数组</li>
</ul>
</li>
<li><p>类信息相关函数</p>

<ul>
<li>class_implements 返回指定类实现的所有接口

<ul>
<li>可以用instanceof判断某个对象时候实现某个接口或者某个类的实例</li>
</ul>
</li>
<li>class_parents 返回指定类的父类

<ul>
<li>如果继承了多次，会把所有父类都打印出来</li>
</ul>
</li>
</ul>
</li>
</ul>


<h1>文件处理类库</h1>

<ul>
<li>SPLFileInfo 用于获得文件的基本信息，比如修改时间，大小，目录等</li>
<li>SplFileObject用于操作文件的内容，比如读写</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>  <span class="nv">$file</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SplFileInfo</span><span class="p">(</span><span class="s2">&quot;temp.txt&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;File is cerated at &quot;</span><span class="o">.</span><span class="nb">date</span><span class="p">(</span><span class="s2">&quot;Y-m-d H:i:s&quot;</span><span class="p">,</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getCTime</span><span class="p">())</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;File is modified at &quot;</span><span class="o">.</span><span class="nb">date</span><span class="p">(</span><span class="s2">&quot;Y-m-d H:i:s&quot;</span><span class="p">,</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getMTime</span><span class="p">())</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;File is size is&quot;</span><span class="o">.</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">getSize</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">//读取文件里面的内容</span>
</span><span class='line'>  <span class="nv">$fileObj</span> <span class="o">=</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">openFile</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">while</span> <span class="p">(</span><span class="nv">$fileObj</span><span class="o">-&gt;</span><span class="na">valid</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nv">$fileObj</span><span class="o">-&gt;</span><span class="na">fgets</span><span class="p">();</span><span class="c1">//获取文件里慢的一行数据</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nv">$fileObj</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$file</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">;</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[cURL]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/12/php-curl/"/>
    <updated>2016-05-12T20:52:24+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/12/php-curl</id>
    <content type="html"><![CDATA[<h1>cURl的概念</h1>

<blockquote><p>cURL（Client URL Library Functions）使用URL语法传输数据的命令行工具</p></blockquote>

<!--more-->


<h1>使用场景</h1>

<ul>
<li>网页资源

<ul>
<li>网页爬虫</li>
</ul>
</li>
<li><p>WebService数据接口资源</p>

<ul>
<li>动态获取接口数据，如天气 号码归属地等</li>
</ul>
</li>
<li><p>FTP服务器里面的文件资源</p>

<ul>
<li>下载Ftp里面的文件</li>
</ul>
</li>
<li><p>其他资源</p>

<ul>
<li>所有网络上的资源都可以用cURL访问和下载</li>
</ul>
</li>
</ul>


<p>确定是否支持cURL<code>php -i |grep cURL</code></p>

<h1>cURL操作步骤</h1>

<ul>
<li>初始化

<ul>
<li>curl_init()</li>
</ul>
</li>
<li>执行

<ul>
<li>curl_exec()</li>
</ul>
</li>
<li><p>关闭</p>

<ul>
<li>curl_close()

<h1>实例</h1></li>
</ul>
</li>
<li><p>简单的网页爬虫</p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nv">$curl</span><span class="o">=</span><span class="nb">curl_init</span><span class="p">(</span><span class="s1">&#39;http://www.baidu.com&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curl</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_close</span><span class="p">(</span><span class="nv">$curl</span><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>抓取网页并替换部分内容</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * 在网络上下载一个网页并把内容中的“百度”替换为“GOOD”之后输出</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="nv">$curlobj</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>         <span class="c1">// 初始化</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="s2">&quot;http://www.baidu.com&quot;</span><span class="p">);</span>     <span class="c1">// 设置访问网页的URL</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>           <span class="c1">// 执行之后不直接打印出来</span>
</span><span class='line'><span class="nv">$output</span><span class="o">=</span><span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span> <span class="c1">// 执行</span>
</span><span class='line'><span class="nb">curl_close</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>           <span class="c1">// 关闭cURL</span>
</span><span class='line'><span class="k">echo</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">&quot;百度&quot;</span><span class="p">,</span><span class="s2">&quot;GOOD&quot;</span><span class="p">,</span><span class="nv">$output</span><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>调用WebService获取天气信息
代码需要修改</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nv">$data</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
</span><span class='line'><span class="s1">&lt;soap:Envelope </span>
</span><span class='line'><span class="s1">xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; </span>
</span><span class='line'><span class="s1">xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; </span>
</span><span class='line'><span class="s1">xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;</span>
</span><span class='line'><span class="s1">  &lt;soap:Body&gt;</span>
</span><span class='line'><span class="s1">    &lt;getWeatherbyCityName xmlns=&quot;http://WebXml.com.cn/&quot;&gt;</span>
</span><span class='line'><span class="s1">      &lt;theCityName&gt;%s&lt;/theCityName&gt;</span>
</span><span class='line'><span class="s1">    &lt;/getWeatherbyCityName&gt;</span>
</span><span class='line'><span class="s1">  &lt;/soap:Body&gt;</span>
</span><span class='line'><span class="s1">&lt;/soap:Envelope&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;北京&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$curlobj</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span> 
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="s2">&quot;http://www.webxml.com.cn/WebServices/WeatherWebService.asmx&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s2">&quot;Content-Type: application/soap+xml; charset=utf-8&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;Content-length: &quot;</span><span class="o">.</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$data</span><span class="p">),</span>
</span><span class='line'>  <span class="s2">&quot;SOAPAction:</span><span class="se">\&quot;</span><span class="s2">http://WebXml.com.cn/getWeatherbyCityName</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">));</span>
</span><span class='line'><span class="nv">$rtn</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">curl_errno</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">)){</span>
</span><span class='line'>  <span class="nv">$info</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">print_r</span><span class="p">(</span><span class="nv">$info</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;RETURN: &quot;</span> <span class="o">.</span> <span class="nv">$rtn</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;Curl error: &#39;</span> <span class="o">.</span> <span class="nb">curl_error</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nb">curl_close</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>登录网站并下载个人空间页面</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * 登录慕课网并下载个人空间页面</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="nv">$data</span><span class="o">=</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;promonkey&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1q2w3e&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;remember&#39;</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="nv">$data</span><span class="o">=</span><span class="s1">&#39;username=xxx&amp;password=xxx&amp;remember=1&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$curlobj</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>         <span class="c1">// 初始化</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="s2">&quot;http://www.imooc.com/user/login&quot;</span><span class="p">);</span>      <span class="c1">// 设置访问网页的URL</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>           <span class="c1">// 执行之后不直接打印出来</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Cookie相关设置，这部分设置需要在所有会话开始之前设置</span>
</span><span class='line'><span class="nb">date_default_timezone_set</span><span class="p">(</span><span class="s1">&#39;PRC&#39;</span><span class="p">);</span> <span class="c1">// 使用Cookie时，必须先设置时区</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_COOKIESESSION</span><span class="p">,</span> <span class="k">TRUE</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_FOLLOWLOCATION</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// 这样能够让cURL支持页面链接跳转</span>
</span><span class='line'>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s2">&quot;application/x-www-form-urlencoded; charset=utf-8&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;Content-length: &quot;</span><span class="o">.</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span>
</span><span class='line'>  <span class="p">));</span>
</span><span class='line'><span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>    <span class="c1">// 执行</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="s2">&quot;http://www.imooc.com/space/index&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s2">&quot;Content-type: text/xml&quot;</span>
</span><span class='line'>  <span class="p">));</span>
</span><span class='line'><span class="nv">$output</span><span class="o">=</span><span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span> <span class="c1">// 执行</span>
</span><span class='line'><span class="nb">curl_close</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>           <span class="c1">// 关闭cURL</span>
</span><span class='line'><span class="k">echo</span> <span class="nv">$output</span><span class="p">;</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>FTP服务器下载文件</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * 从FTP服务器下载一个文件到本地</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="nv">$curlobj</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span> 
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="s2">&quot;ftp://xxx(ip)/downloaddemo.txt&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_TIMEOUT</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span> <span class="c1">// times out after 300s</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">&quot;xxx:xxx&quot;</span><span class="p">);</span><span class="c1">//FTP用户名：密码</span>
</span><span class='line'><span class="c1">// Sets up the output file</span>
</span><span class='line'><span class="nv">$outfile</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;dest.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">);</span><span class="c1">//保存到本地的文件名</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_FILE</span><span class="p">,</span> <span class="nv">$outfile</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$rtn</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>
</span><span class='line'><span class="nb">fclose</span><span class="p">(</span><span class="nv">$outfile</span><span class="p">);</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">curl_errno</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">)){</span>
</span><span class='line'>  <span class="c1">// $info = curl_getinfo($curlobj); </span>
</span><span class='line'>  <span class="c1">// print_r($info);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;RETURN: &quot;</span> <span class="o">.</span> <span class="nv">$rtn</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;Curl error: &#39;</span> <span class="o">.</span> <span class="nb">curl_error</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nb">curl_close</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>上传文件到FTP</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * 把本地文件上传到FTP服务器上</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="nv">$curlobj</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span> 
</span><span class='line'><span class="nv">$localfile</span> <span class="o">=</span> <span class="s1">&#39;ftp01.php&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$fp</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$localfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="s2">&quot;ftp://xxx/ftp01_uploaded.php&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_TIMEOUT</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span> <span class="c1">// times out after 300s</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="s2">&quot;xxx:xxx&quot;</span><span class="p">);</span><span class="c1">//FTP用户名：密码</span>
</span><span class='line'>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_UPLOAD</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_INFILE</span><span class="p">,</span> <span class="nv">$fp</span><span class="p">);</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_INFILESIZE</span><span class="p">,</span> <span class="nb">filesize</span><span class="p">(</span><span class="nv">$localfile</span><span class="p">));</span>
</span><span class='line'><span class="nv">$rtn</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>
</span><span class='line'><span class="nb">fclose</span><span class="p">(</span><span class="nv">$fp</span><span class="p">);</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">curl_errno</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">)){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s2">&quot;Uploaded successfully.&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;Curl error: &#39;</span> <span class="o">.</span> <span class="nb">curl_error</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nb">curl_close</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>访问HTTPS资源</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * 下载网络上面的一个HTTPS的资源</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="nv">$curlobj</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>         <span class="c1">// 初始化</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="s2">&quot;https://ajax.aspnetcdn.com/ajax/jquery.validate/1.12.0/jquery.validate.js&quot;</span><span class="p">);</span>        <span class="c1">// 设置访问网页的URL</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>           <span class="c1">// 执行之后不直接打印出来</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 设置HTTPS支持</span>
</span><span class='line'><span class="nb">date_default_timezone_set</span><span class="p">(</span><span class="s1">&#39;PRC&#39;</span><span class="p">);</span> <span class="c1">// 使用Cookie时，必须先设置时区</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_SSL_VERIFYPEER</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// 对认证证书来源的检查从证书中检查SSL加密算法是否存在</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">,</span> <span class="nx">CURLOPT_SSL_VERIFYHOST</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// </span>
</span><span class='line'>
</span><span class='line'><span class="nv">$output</span><span class="o">=</span><span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span> <span class="c1">// 执行</span>
</span><span class='line'><span class="nb">curl_close</span><span class="p">(</span><span class="nv">$curlobj</span><span class="p">);</span>           <span class="c1">// 关闭cURL</span>
</span><span class='line'><span class="k">echo</span> <span class="nv">$output</span><span class="p">;</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ubuntu环境搭建]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/12/ubuntu-huan-jing-da-jian/"/>
    <updated>2016-05-12T14:58:33+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/12/ubuntu-huan-jing-da-jian</id>
    <content type="html"><![CDATA[<blockquote><p>在经历上次把Centos玩坏的经历过后，我还是回到Ubuntu吧。毕竟这个环境配置，软件安装都要简单得多0 0.</p></blockquote>

<!--more-->


<p>重新下了一个Ubuntu 12.04.5 LTS 。</p>

<p>在虚拟机中装好了系统过后出现了一个问题，在登录界面输入密码登录过后一直黑屏。当时人都懵逼了，用了这么久Ubuntu从来没出过这种问题啊，重装了很多次系统都不行。百度了很多过后发现他们的情况和我的都不太一样。到是看到有一个看起来很不靠谱的回答解决了问题。</p>

<pre class="prettyprint linenums">
    在登录时点击登录框右上角那个Ubuntu图标选择 ubuntu 2D
</pre>


<p>5/12/2016 7:18:20 PM
找到了上述问题的原因<a href="http://tieba.baidu.com/p/2535671580">传送门</a></p>

<pre class="prettyprint linenums>
1.双显卡问题 
双显卡的普遍组合为intel集成到其CPU上的显卡（称为核显）+Nvidia独立显卡或AMD显卡。在linux系统下，双显卡因驱动原因不能很好协调工作，N卡和A卡会一直处于高负荷运行状态，导致电脑发热严重,或是X-org罢工，开机无画面，等常见问题。
linux下是以工具Bumlebee（大黄蜂）来调度显卡工作来解决，运行模式为：通常关闭非核卡，让核卡来负责图形工作，但可在终端输入命令“optirun xxx"用非核卡运行程序xxx。
2.安装Bumblebee
2.1 卸载N卡驱动
如果有安装N卡驱动（不管是开源还是闭源），必须先卸载；没有则跳过此步。
打开终端（ctrl+alt+t），输入下面的命令（复制也可）：
————————————复制————————————————————————
sudo apt-get remove --purge nvidia*
————————————复制————————————————————————
完成后，重启。
2.2 安装Bumblebee
打开终端（ctrl+alt+t），分次按序输入下面的命令（红字部分，复制也可）：
————————————复制————————————————————————
1. sudo add-apt-repository ppa:bumblebee/stable
2. sudo apt-get update
3. sudo apt-get install bumblebee virtualgl linux-headers-generic
————————————复制————————————————————————
每步的时间较长，请耐心等待；完成后，重启。
2.3 验证效果
打开终端（ctrl+alt+t），输入下面的的命令（红字部分，复制也可）：
————————————复制————————————————————————
lspci |grep VGA
————————————复制————————————————————————
终端返回类似如下两条信息：
A、00:02.0 VGA compatible controller: Intel Corporation 3rd Gen Core processor Graphics Controller (rev 09)
B、01:00.0 VGA compatible controller: NVIDIA Corporation GK104M [GeForce GTX 670MX] (rev ff)"
其中，A条信息关于I卡，"rev 09“表示I卡运作；B条信息关于N卡，”rev ff“表示N卡被关闭，若未被关闭，显示为“rev a1”。

3、调用N卡工作
命令“optirun xxx"可用来调用N卡运作处理程序xxx（程序名）的图形计算 ，不过图形渲染仍由I卡负责。
</pre>


<p>抱着试一试的心态结果成功登录了。
下面是Ubuntu的环境搭建，以前都是看别人的博客，现在既然自己有了博客就整理了一下。</p>

<hr />

<p>安装Gnome <code>apt-get install gnome-session-fallback</code></p>

<h1>一、安装LAMP环境</h1>

<p>两种方式</p>

<ol>
<li>分步安装</li>
</ol>


<pre class="prettyprint linenums">
sudo apt-get update //获取最新列表
Apache:
sudo apt-get install apache2
apache2 -v //查看是否安装好
浏览器访问服务器IP
php：
sudo apt-get install php5
php5 -v
cat /etc/apache2/mod-enabled/php5.load //查看阿帕奇是否加载PHP
mysql：
sudo apt-get install mysql-server
输入root密码 //注意这里的密码不是你root用户的密码，是设置mysql-root用户的密码
cat /etc/php5/conf.d/mysql.ini
提示没有文件 说明mysql还没有被php加载 需要安装mysql扩展
sudo apt-get install php5-mysql
cat /etc/php5/conf.d/mysql.ini
extension=mysql.so //说明正确加载
</pre>


<p>2.tasksel</p>

<pre class="prettyprint linenums">
sudo tasksel install lamp-server
tasksel 提供多种软件套装
</pre>


<hr />

<p><strong>安装PHP常用扩展</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">apt</span><span class="o">-</span><span class="nx">get</span> <span class="nx">install</span>  <span class="nx">php5</span><span class="o">-</span><span class="nx">curl</span> <span class="nx">php5</span><span class="o">-</span><span class="nx">gd</span>  <span class="nx">libcurl3</span> <span class="nx">libcurl3</span><span class="o">-</span><span class="nx">dev</span> <span class="nx">php5</span><span class="o">-</span><span class="nx">curl</span>
</span><span class='line'><span class="nx">可以先用sudo</span> <span class="nx">apt</span><span class="o">-</span><span class="nx">cache</span> <span class="nx">search</span> <span class="nx">php5</span> <span class="nx">查看关于PHP5的组件</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>安装mysqladmin</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">phpmyadmin</span>
</span><span class='line'><span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">phpmyadmin</span><span class="o">/</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">pma</span>
</span><span class='line'><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">php5</span><span class="o">-</span><span class="n">mcrypt</span> <span class="n">libmcrypt</span><span class="o">-</span><span class="n">dev</span>
</span><span class='line'><span class="n">service</span> <span class="n">apache2</span> <span class="n">restart</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>开启mysql remote access</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">my</span><span class="o">.</span><span class="na">cnf</span>
</span><span class='line'><span class="n">找到bind</span><span class="o">-</span><span class="n">address</span>  <span class="n">将这行注释掉</span> <span class="n">这是允许访问的白名单</span>
</span><span class='line'><span class="n">在mysqladmin中添加一个用户</span> <span class="n">主机选择任意主机</span> <span class="n">输入</span><span class="o">%</span><span class="n">其他的按个人设置即可</span><span class="err">。</span>
</span></code></pre></td></tr></table></div></figure>


<h1>二、SSH配置</h1>

<blockquote><p>习惯了用Xshell，今天直接用Xshell连接新安装的ubuntu连接失败，好一会才反应过来还没安装ssh</p></blockquote>

<pre class="prettyprint linenums">
sudo apt-get install openssh-server
</pre>


<p>其他配置就不多写了。可以参考<a href="http://jingyan.baidu.com/article/9c69d48fb9fd7b13c8024e6b.html">传送门</a></p>

<h1>三、 ubuntu终端su认证失败：允许su到root</h1>

<blockquote><p>Ubuntu 安装后，root用户默认被锁定，不允许登录，也不允许“su”到 root。对于桌面用户来说，这样安全性更高一些，但对于服务器可以设置成“允许 su 到root，但不允许root用户直接登录”。为了开发时的方便，我们常希望都采用这种方式。</p></blockquote>

<p>1.允许 su 到 root</p>

<pre class="prettyprint linenums">
sudo passwd 
Password: <--- 输入安装时那个用户的密码 
Enter new UNIX password: <--- 新的Root用户密码 
Retype new UNIX password: <--- 重复新的Root用户密码 
passwd：已成功更新密码  
</pre>


<p>2.允许root登录</p>

<pre class="prettyprint linenums">
gksu /usr/sbin/gdmsetup  
</pre>


<p>（或者使用桌面菜单：系统＞系统管理＞登录窗口）
点“安全”选项页，选择“允许本地管理员登录”。
注：这一步依赖上一步</p>

<p>3.不输入密码直接登录
    在上一步的“安全”选项页中，勾选：“启用自动登录”，“用户”选择（如：“me”）</p>

<p>参考<a href="http://blog.csdn.net/ccrong/article/details/8133736">传送门</a></p>

<h1>四、Git</h1>

<p>Git的安装就非常简单了。</p>

<pre class="prettyprint linenums">
sudo apt-get install git
</pre>


<p>配置请看<a href="http://blog.ewanreton.cn/blog/2016/04/18/git-plus-octopressda-jian-ge-ren-bo-ke/">这里</a></p>

<p>五、Atom</p>

<blockquote><p>对的，还是它，这是一种信仰0 0</p></blockquote>

<p><strong>Requirements</strong></p>

<ul>
<li>OS with 64-bit or 32-bit architecture</li>
<li>C++ toolchain</li>
<li>Git</li>
<li>Node.js (0.10.x or above)</li>
<li>npm v1.4.x or above (automatically bundled with Node.js)

<ul>
<li><code>npm -v</code> to check the version.</li>
<li><code>npm config set python /usr/bin/python2 -g</code> to ensure that gyp uses python2.

<ul>
<li>You might need to run this command as <code>sudo</code>, depending on how you have set up npm.</li>
</ul>
</li>
</ul>
</li>
<li>development headers for GNOME Keyring</li>
</ul>


<hr />

<p><strong>Ubuntu / Debian</strong></p>

<ul>
<li><code>sudo apt-get install build-essential git libgnome-keyring-dev fakeroot</code></li>
<li>Instructions for Node.js.

<ul>
<li>Make sure the command node is available after Node.js installation (some systems install it as nodejs).</li>
<li>Use <code>which node</code> to check if it is available.</li>
<li>Use <code>sudo update-alternatives --install /usr/bin/node node /usr/bin/nodejs 10 to</code> update it.</li>
</ul>
</li>
</ul>


<p>这里我用了其他的方法更新我的node和npm</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'> <span class="nx">apt</span><span class="o">-</span><span class="nx">get</span> <span class="nx">update</span>
</span><span class='line'> <span class="nx">apt</span><span class="o">-</span><span class="nx">get</span> <span class="nx">install</span> <span class="o">-</span><span class="nx">y</span> <span class="nx">python</span><span class="o">-</span><span class="nx">software</span><span class="o">-</span><span class="nx">properties</span> <span class="nx">software</span><span class="o">-</span><span class="nx">properties</span><span class="o">-</span><span class="nx">common</span>
</span><span class='line'> <span class="nx">add</span><span class="o">-</span><span class="nx">apt</span><span class="o">-</span><span class="nx">repository</span> <span class="nx">ppa</span><span class="o">:</span><span class="nx">chris</span><span class="o">-</span><span class="nx">lea</span><span class="o">/</span><span class="nx">node</span><span class="o">.</span><span class="nx">js</span>
</span><span class='line'> <span class="nx">apt</span><span class="o">-</span><span class="nx">get</span> <span class="nx">update</span>
</span><span class='line'> <span class="nx">apt</span><span class="o">-</span><span class="nx">get</span> <span class="nx">install</span> <span class="nx">nodejs</span>
</span></code></pre></td></tr></table></div></figure>


<p>这样环境就好了，就可以开始安装了。</p>

<p><strong>Debian Linux (Ubuntu)</strong></p>

<p>Currently only a 64-bit version is available.</p>

<ol>
<li>Download <code>atom-amd64.deb</code> from the <a href="https://github.com/atom/atom/releases/latest">Atom releases page.</a></li>
<li>Run <code>sudo dpkg --install atom-amd64.deb</code> on the downloaded package.</li>
<li>Launch Atom using the installed <code>atom</code> command.</li>
</ol>


<p>The Linux version does not currently automatically update so you will need to repeat these steps to upgrade to future releases.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[做死的Centos-Atom]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/10/linux-atom-error/"/>
    <updated>2016-05-10T20:37:45+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/10/linux-atom-error</id>
    <content type="html"><![CDATA[<blockquote><p>昨天晚上突然冒出一个念头在我的Centos6.5的虚拟机上装Atom并且装上那个炫酷的插件来装波大逼。然后很悲催，软件没装上不说，系统也被搞坏了。</p></blockquote>

<!--more-->


<h1>兴高采烈的去下Atom</h1>

<p>在github上找到了Atom的<a href="https://github.com/atom/atom">开源项目</a>，根据指引下载好了rpm包。</p>

<p>然后<code>sudo yum localinstall atom.x86_64.rpm</code></p>

<p>不出意外出现了问题。</p>

<p>当时忘了截图，不过我大概都还记得出了哪些问题。</p>

<blockquote><p>这里有个极度懵逼的事情</p></blockquote>

<pre><code>我最开始在Centos中下Atom由于网络不好，时断时续就没管，后来切过去看。
咦~为什么这么快就下好了，开心的安装。恩，问题来了 libnode.so 找不到。
恩，有问题嘛很正常。度娘之。

度娘好像并不能告诉我什么，是时候翻墙了。翻出去过后的答案也是牛头不对马嘴。

忧郁了好一会，突然发现尼玛，这个包只有20+MB啊！！！！
</code></pre>

<p><strong>这次包下好了完全没问题</strong></p>

<p>安装中也出了一些问题。</p>

<p>但是我记不太清楚了0。0</p>

<pre><code>其实是因为出的问题太多了，本来想安装成功过后做一个总结，之前查得解决方案的网页也都存了书签。

可是，后来软件没装好，系统被玩坏了。。书签和历史记录全部丢失了，，我就有点懵逼了。。。
</code></pre>

<p>解决了一些问题过后，安装完成了。</p>

<p><strong>开心的atom想打开atom</strong></p>

<p>恩，提莫的。</p>

<p>error！ error！！</p>

<p><strong>version GLIBCXX_3.4.9 not found</strong></p>

<p>因为我解决问题的博文已经搞丢了，刚刚重新找了一篇大概差不多
<a href="http://blog.csdn.net/officercat/article/details/39520227">传送门</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">ll</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libc</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">6</span>
</span><span class='line'><span class="nx">lrwxrwxrwx</span> <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">19</span> <span class="nx">Sep</span> <span class="mi">23</span> <span class="mi">08</span><span class="o">:</span><span class="mi">29</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libc</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">6</span> <span class="o">-&gt;</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libc</span><span class="o">-</span><span class="mf">2.12</span><span class="o">.</span><span class="nx">so</span>
</span></code></pre></td></tr></table></div></figure>


<p>libc.so.6是一个软连接，当前的glibc是2.12版本,我遇到的事GLIBC_2.15找不到的问题，所以需至少升级到2.15
首先，从网上下载glibc 2.15的rpm安装包，但这个不容易，因为.rpm针对的是centOS和redhat，高版本安装包很少见。也可以直接从其他系统上好一个编译好的文件
libc.so.6（对应glibc 2.15或者更高的），不过最保险的方式就是下载源代码在本地编译一次（有的人实在编译不成功，那也只能从别的地方找一份了）
各个版本的glibc可以从<a href="http://ftp.gnu.org/gnu/glibc/">下载地址</a>找，包括其插件glibc-port
最新到2.20，我保守的选择2.15
对于低版本glibc，还有glibc-linuxthreads-2.x需要编译，可参考很多网上文档，但2.15没有，所以不用了</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">wget</span> <span class="nx">http</span><span class="o">://</span><span class="nx">ftp</span><span class="o">.</span><span class="nx">gnu</span><span class="o">.</span><span class="nx">org</span><span class="o">/</span><span class="nx">gnu</span><span class="o">/</span><span class="nx">glibc</span><span class="o">/</span><span class="nx">glibc</span><span class="o">-</span><span class="mf">2.15</span><span class="o">.</span><span class="nx">tar</span><span class="o">.</span><span class="nx">gz</span>
</span><span class='line'><span class="nx">wget</span> <span class="nx">http</span><span class="o">://</span><span class="nx">ftp</span><span class="o">.</span><span class="nx">gnu</span><span class="o">.</span><span class="nx">org</span><span class="o">/</span><span class="nx">gnu</span><span class="o">/</span><span class="nx">glibc</span><span class="o">/</span><span class="nx">glibc</span><span class="o">-</span><span class="nx">ports</span><span class="o">-</span><span class="mf">2.15</span><span class="o">.</span><span class="nx">tar</span><span class="o">.</span><span class="nx">gz</span>
</span><span class='line'><span class="nx">tar</span> <span class="o">-</span><span class="nx">xvf</span>  <span class="nx">glibc</span><span class="o">-</span><span class="mf">2.15</span><span class="o">.</span><span class="nx">tar</span><span class="o">.</span><span class="nx">gz</span>
</span><span class='line'><span class="nx">tar</span> <span class="o">-</span><span class="nx">xvf</span>  <span class="nx">glibc</span><span class="o">-</span><span class="nx">ports</span><span class="o">-</span><span class="mf">2.15</span><span class="o">.</span><span class="nx">tar</span><span class="o">.</span><span class="nx">gz</span>
</span><span class='line'><span class="nx">mv</span> <span class="nx">glibc</span><span class="o">-</span><span class="nx">ports</span><span class="o">-</span><span class="mf">2.15</span> <span class="nx">glibc</span><span class="o">-</span><span class="mf">2.15</span><span class="o">/</span><span class="nx">ports</span>
</span><span class='line'><span class="nb">mkdir</span> <span class="nx">glibc</span><span class="o">-</span><span class="nx">build</span><span class="o">-</span><span class="mf">2.15</span>
</span><span class='line'><span class="nx">cd</span> <span class="nx">glibc</span><span class="o">-</span><span class="nx">build</span><span class="o">-</span><span class="mf">2.15</span>
</span><span class='line'><span class="o">../</span><span class="nx">glibc</span><span class="o">-</span><span class="mf">2.15</span><span class="o">/</span><span class="nx">configure</span>  <span class="o">--</span><span class="nx">prefix</span><span class="o">=/</span><span class="nx">usr</span> <span class="o">--</span><span class="nx">disable</span><span class="o">-</span><span class="nx">profile</span> <span class="o">--</span><span class="nx">enable</span><span class="o">-</span><span class="nx">add</span><span class="o">-</span><span class="nx">ons</span> <span class="o">--</span><span class="nx">with</span><span class="o">-</span><span class="nx">headers</span><span class="o">=/</span><span class="nx">usr</span><span class="o">/</span><span class="k">include</span> <span class="o">--</span><span class="nx">with</span><span class="o">-</span><span class="nx">binutils</span><span class="o">=/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">bin</span>
</span><span class='line'><span class="nx">make</span>
</span><span class='line'><span class="nx">make</span> <span class="nx">install</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果提示install成功，去看glibc所在的共享库：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">ll</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libc</span><span class="o">*</span>
</span><span class='line'> <span class="sb">``</span><span class="err">`</span>
</span><span class='line'><span class="nx">可以看到2</span><span class="o">.</span><span class="mi">12</span><span class="nx">的旧库文件还在，多了2</span><span class="o">.</span><span class="mi">15</span><span class="nx">版本的库文件，而且软链接文件全部指向了2</span><span class="o">.</span><span class="mi">15</span><span class="nx">版本。</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;prettyprint linenums&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">1921096</span> <span class="nx">Aug</span> <span class="mi">30</span> <span class="mo">02</span><span class="o">:</span><span class="mi">16</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libc</span><span class="o">-</span><span class="mf">2.12</span><span class="o">.</span><span class="nx">so</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span> <span class="mi">9801632</span> <span class="nx">Sep</span> <span class="mi">25</span> <span class="mi">13</span><span class="o">:</span><span class="mi">46</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libc</span><span class="o">-</span><span class="mf">2.15</span><span class="o">.</span><span class="nx">so</span>
</span><span class='line'><span class="nx">lrwxrwxrwx</span><span class="o">.</span> <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>      <span class="mi">18</span> <span class="nx">May</span> <span class="mi">19</span> <span class="mi">18</span><span class="o">:</span><span class="mi">51</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcap</span><span class="o">-</span><span class="nx">ng</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">0</span> <span class="o">-&gt;</span> <span class="na">libcap</span><span class="o">-</span><span class="nx">ng</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mf">0.0</span><span class="o">.</span><span class="mi">0</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span><span class="o">.</span> <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>   <span class="mi">18672</span> <span class="nx">Jun</span> <span class="mi">25</span>  <span class="mi">2011</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcap</span><span class="o">-</span><span class="nx">ng</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mf">0.0</span><span class="o">.</span><span class="mi">0</span>
</span><span class='line'><span class="nx">lrwxrwxrwx</span><span class="o">.</span> <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>      <span class="mi">14</span> <span class="nx">May</span> <span class="mi">19</span> <span class="mi">18</span><span class="o">:</span><span class="mi">51</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcap</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">2</span> <span class="o">-&gt;</span> <span class="na">libcap</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mf">2.16</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>   <span class="mi">19016</span> <span class="nx">Dec</span>  <span class="mi">8</span>  <span class="mi">2011</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcap</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mf">2.16</span>
</span><span class='line'><span class="nx">lrwxrwxrwx</span><span class="o">.</span> <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>      <span class="mi">19</span> <span class="nx">May</span> <span class="mi">19</span> <span class="mi">18</span><span class="o">:</span><span class="mi">57</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcgroup</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="na">libcgroup</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mf">1.0</span><span class="o">.</span><span class="mi">40</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>   <span class="mi">97016</span> <span class="nx">Dec</span>  <span class="mi">9</span>  <span class="mi">2013</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcgroup</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mf">1.0</span><span class="o">.</span><span class="mi">40</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>  <span class="mi">197064</span> <span class="nx">Aug</span> <span class="mi">30</span> <span class="mo">02</span><span class="o">:</span><span class="mi">16</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcidn</span><span class="o">-</span><span class="mf">2.12</span><span class="o">.</span><span class="nx">so</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>  <span class="mi">267972</span> <span class="nx">Sep</span> <span class="mi">25</span> <span class="mi">13</span><span class="o">:</span><span class="mi">46</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcidn</span><span class="o">-</span><span class="mf">2.15</span><span class="o">.</span><span class="nx">so</span>
</span><span class='line'><span class="nx">lrwxrwxrwx</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>      <span class="mi">15</span> <span class="nx">Sep</span> <span class="mi">25</span> <span class="mi">13</span><span class="o">:</span><span class="mi">52</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcidn</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="na">libcidn</span><span class="o">-</span><span class="mf">2.15</span><span class="o">.</span><span class="nx">so</span>
</span><span class='line'><span class="nx">lrwxrwxrwx</span><span class="o">.</span> <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>      <span class="mi">17</span> <span class="nx">May</span> <span class="mi">19</span> <span class="mi">18</span><span class="o">:</span><span class="mi">51</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcom_err</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">2</span> <span class="o">-&gt;</span> <span class="na">libcom_err</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mf">2.1</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>   <span class="mi">17256</span> <span class="nx">Nov</span> <span class="mi">22</span>  <span class="mi">2013</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcom_err</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mf">2.1</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>   <span class="mi">40400</span> <span class="nx">Aug</span> <span class="mi">30</span> <span class="mo">02</span><span class="o">:</span><span class="mi">16</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcrypt</span><span class="o">-</span><span class="mf">2.12</span><span class="o">.</span><span class="nx">so</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>  <span class="mi">142947</span> <span class="nx">Sep</span> <span class="mi">25</span> <span class="mi">13</span><span class="o">:</span><span class="mi">46</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcrypt</span><span class="o">-</span><span class="mf">2.15</span><span class="o">.</span><span class="nx">so</span>
</span><span class='line'><span class="nx">lrwxrwxrwx</span><span class="o">.</span> <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>      <span class="mi">22</span> <span class="nx">May</span> <span class="mi">19</span> <span class="mi">18</span><span class="o">:</span><span class="mi">57</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcryptsetup</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="na">libcryptsetup</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mf">1.1</span><span class="o">.</span><span class="mi">0</span>
</span><span class='line'><span class="o">-</span><span class="nx">rwxr</span><span class="o">-</span><span class="nx">xr</span><span class="o">-</span><span class="nx">x</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>   <span class="mi">97072</span> <span class="nx">Jun</span> <span class="mi">22</span>  <span class="mi">2012</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcryptsetup</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mf">1.1</span><span class="o">.</span><span class="mi">0</span>
</span><span class='line'><span class="nx">lrwxrwxrwx</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>      <span class="mi">16</span> <span class="nx">Sep</span> <span class="mi">25</span> <span class="mi">13</span><span class="o">:</span><span class="mi">52</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libcrypt</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="na">libcrypt</span><span class="o">-</span><span class="mf">2.15</span><span class="o">.</span><span class="nx">so</span>
</span><span class='line'><span class="nx">lrwxrwxrwx</span>  <span class="mi">1</span> <span class="nx">root</span> <span class="nx">root</span>      <span class="mi">12</span> <span class="nx">Sep</span> <span class="mi">25</span> <span class="mi">13</span><span class="o">:</span><span class="mi">52</span> <span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libc</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">6</span> <span class="o">-&gt;</span> <span class="na">libc</span><span class="o">-</span><span class="mf">2.15</span><span class="o">.</span><span class="nx">so</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">有些人会在make</span> <span class="nx">install后出现error。这儿error我没去细究</span><span class="p">,</span><span class="nx">经过网友提醒，可能是因为没有sudo造成的，因为make</span> <span class="nx">install就是把文件拷贝到几个受保护的系统目录下。</span>
</span><span class='line'>
</span><span class='line'><span class="nx">如果还是不行，可以查看一下系统此时的GLIBC版本，参考一开始的做法。如果版本未升级，我们只能手动安装一下：</span>
</span><span class='line'>
</span><span class='line'><span class="nx">首先make是成功了，那么我们会发现build目录下编译出了一个新的libc</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">6</span> <span class="nx">（</span><span class="o">/</span><span class="nx">glibc</span><span class="o">-</span><span class="nx">build</span><span class="o">-</span><span class="mf">2.15</span><span class="o">/</span><span class="nx">libc</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">6</span><span class="nx">，</span> <span class="nx">我们会发现这实际上也是一个软连接，真实的lib文件时libc</span><span class="o">.</span><span class="nx">so，</span> <span class="nx">输出</span>
</span></code></pre></td></tr></table></div></figure>


<p>php</p>

<p>$ ll  libc.so.6<br/>
lrwxrwxrwx 1 root root 7 Sep 23 07:41 libc.so.6 -> libc.so<br/>
$ strings libc.so | grep GLIBC<br/>
GLIBC_2.2.5<br/>
GLIBC_2.2.6<br/>
GLIBC_2.3<br/>
GLIBC_2.3.2<br/>
GLIBC_2.3.3<br/>
GLIBC_2.3.4<br/>
GLIBC_2.4<br/>
GLIBC_2.5<br/>
GLIBC_2.6<br/>
GLIBC_2.7<br/>
GLIBC_2.8<br/>
GLIBC_2.9<br/>
GLIBC_2.10<br/>
GLIBC_2.11<br/>
GLIBC_2.12<br/>
GLIBC_2.13<br/>
GLIBC_2.14<br/>
GLIBC_2.15<br/>
GLIBC_PRIVATE</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">这是我们需要的lib了，然后去更新系统的库。</span>
</span><span class='line'>
</span><span class='line'><span class="nx">这里要注意，更新系统里的链接（我的是</span><span class="o">/</span><span class="nx">lib64</span><span class="o">/</span><span class="nx">libc</span><span class="o">.</span><span class="nx">so</span><span class="o">.</span><span class="mi">6</span><span class="p">)</span> <span class="nx">很容易出错，我不清楚有没有更好的办法，一般都是删除旧链接，建立新链接</span>
</span><span class='line'>
</span><span class='line'><span class="nx">但删除旧链接后，很多命令直接不能用了，因为此时中不到glibc的库了。这个时候就需要临时指定一个glibc库，方法如下（libc</span><span class="o">.</span><span class="nx">so改个名以便好以后更新的其他版本区分）</span>
</span></code></pre></td></tr></table></div></figure>


<p>php
 cp /****/glibc-build-2.15/libc.so /lib64/libc-2.15.so</p>

<p>rm -rf /lib64/libc.so.6<br/>
LD_PRELOAD=/lib64/libc-2.15.so ln -s/lib64/libc-2.15.so  lib64/libc.so.6</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">连接更新成功，再编译的话，GLIBC_2</span><span class="o">.</span><span class="mi">15</span><span class="nx">及以下版本的依赖问题就不会出现了。</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;</span><span class="nx">恩，到这里我也有话要说，我当时也是耿直，在这一步我重复了两三次！！！我耿直到从低版本一个一个往高版本安装啊。我真傻，真的。。。</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="o">***</span>
</span><span class='line'>
</span><span class='line'><span class="o">**</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">libstdc</span><span class="o">++.</span><span class="nx">so</span><span class="o">.</span><span class="mi">6</span><span class="o">:</span> <span class="nx">version</span> <span class="sb">`GLIBCXX_3.4.14&#39; not found**</span>
</span><span class='line'>
</span><span class='line'><span class="sb">[传送门](http://blog.csdn.net/xiaolong2w/article/details/23915171)</span>
</span><span class='line'>
</span><span class='line'><span class="sb">出现这种问题就是因为编译库的编译器和编译当前程序的编译器版本是不一样的，在具体一点就是因为，当前程序的编译器的版本是比较低的，只要升级一下就可以了。可以用如下命令查看一下当前GCC版本：</span>
</span><span class='line'>
</span><span class='line'><span class="sb">&lt;pre class=&quot;prettyprint linenums&quot;&gt;</span>
</span><span class='line'><span class="sb">strings /usr/lib/libstdc++.so.6 | grep GLIBCXX  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.1  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.2  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.3  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.4  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.5  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.6  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.7  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.8  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.9  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.10  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.11  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.12  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.13  </span>
</span><span class='line'><span class="sb">GLIBCXX_FORCE_NEW  </span>
</span><span class='line'><span class="sb">GLIBCXX_DEBUG_MESSAGE_LENGTH  </span>
</span><span class='line'><span class="sb">&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sb">并没有动态库中要求的GCC版本 “GLIBCXX_3.4.14”，所以需要进行升级一下我们的GCC版本，升级过程如下：</span>
</span><span class='line'>
</span><span class='line'><span class="sb">下载新版本的GCC，地址为[点击打开链接](http://ftp.de.debian.org/debian/pool/main/g/gcc-4.7/libstdc++6_4.7.2-5_i386.deb) （这里也有一个坑，今天真的是傻！！！）</span>
</span><span class='line'>
</span><span class='line'><span class="sb">下载下来之后，用如下命令开始解压</span>
</span><span class='line'><span class="sb">&lt;pre class=&quot;prettyprint linenums&quot;&gt;</span>
</span><span class='line'><span class="sb">ar -x libstdc++6_4.7.2-5_i386.deb &amp;&amp; tar xvf data.tar.gz  </span>
</span><span class='line'><span class="sb">如果你的文件目录为GCC（如果不是，把GCC改为相应的目录即可），依次执行下面命令：</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="sb">cd GCC/usr/lib/i380-linux-gun </span>
</span><span class='line'><span class="sb">su root  </span>
</span><span class='line'><span class="sb">cp libstdc++.so.6.0.17 /usr/lib </span>
</span><span class='line'><span class="sb">cd /usr/lib   </span>
</span><span class='line'><span class="sb">rm libstdc++.so.6  </span>
</span><span class='line'><span class="sb">ln -s libstdc++.so.6.0.17 libstdc++.so.6 </span>
</span><span class='line'><span class="sb">strings /usr/lib/libstdc++.so.6 | grep GLIBCXX  </span>
</span><span class='line'>
</span><span class='line'><span class="sb">GLIBCXX_3.4  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.1  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.2  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.3  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.4  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.5  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.6  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.7  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.8  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.9  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.10  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.11  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.12  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.13  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.14  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.15  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.16  </span>
</span><span class='line'><span class="sb">GLIBCXX_3.4.17  </span>
</span><span class='line'><span class="sb">GLIBCXX_DEBUG_MESSAGE_LENGTH  </span>
</span><span class='line'><span class="sb">&lt;/pre&gt;</span>
</span><span class='line'><span class="sb">到这里其实就改结束了。可是回去atom </span>
</span><span class='line'>
</span><span class='line'><span class="sb">恩。不错，不是原来的错误了，重新报了一个错误。（具体的错误我忘了）</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="sb">后来在解决的时候才发现这个错误是因为我之前下载安装的libstdc是32位的，但是我的Atom是64位的就出错了。然后再这个过程中，我之前以为是我创建软链接的时候创建错误，我把lib和lib64里面的```</span><span class="nx">libstdc</span><span class="o">++.</span><span class="nx">so</span><span class="o">.</span><span class="mi">6</span><span class="sb">``` 都删了重新创建了一次。然后就GG了，这个时候连firefox浏览器都跟着崩溃了。后来意识到这个问题过后重新安装了64位的```</span><span class="nx">libstdc</span><span class="o">++.</span><span class="nx">so</span><span class="o">.</span><span class="mi">6</span><span class="sb">``</span><span class="err">`</span><span class="nx">解决了这个问题。</span>
</span><span class='line'>
</span><span class='line'><span class="o">**</span><span class="nx">undefined</span> <span class="nx">symbol</span> <span class="nx">g_bytes_unref</span><span class="o">**</span>
</span><span class='line'>
</span><span class='line'><span class="nx">这是遇到的最后的问题，也是彻底解决我的问题。。</span>
</span><span class='line'>
</span><span class='line'><span class="nx">在国内的网站上很少有这个问题的解决方法，后来找到一个论坛说是因为</span>
</span></code></pre></td></tr></table></div></figure>


<p>GBytes is relatively new, only since glib-2.32``` 准备更新glib库</p>

<p><a href="http://blog.chinaunix.net/uid-26000296-id-5159364.html">博文</a></p>

<p>检查系统当前的版本</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'> <span class="nx">rpm</span> <span class="o">-</span><span class="nx">qi</span> <span class="nx">glibc</span>
</span></code></pre></td></tr></table></div></figure>


<p>在CentOS中用更新命令到2.5已经是最新版本了，只好手动下载 glibc的源码包编译安装更新。
可以在 <a href="http://ftp.gnu.org/pub/gnu/glibc/%E7%9C%8B%E5%88%B0%E5%BD%93%E5%89%8D%E7%9A%84%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%EF%BC%8C">http://ftp.gnu.org/pub/gnu/glibc/%E7%9C%8B%E5%88%B0%E5%BD%93%E5%89%8D%E7%9A%84%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%EF%BC%8C</a>
我看到的最新版本是glibc-2.22。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'> <span class="nx">cd</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">src</span>
</span><span class='line'> <span class="nb">mkdir</span> <span class="nx">glibc</span><span class="o">-</span><span class="mf">2.22</span><span class="o">-</span><span class="nx">build</span>
</span><span class='line'> <span class="nx">wget</span> <span class="nx">http</span><span class="o">://</span><span class="nx">ftp</span><span class="o">.</span><span class="nx">gnu</span><span class="o">.</span><span class="nx">org</span><span class="o">/</span><span class="nx">pub</span><span class="o">/</span><span class="nx">gnu</span><span class="o">/</span><span class="nx">glibc</span><span class="o">/</span><span class="nx">glibc</span><span class="o">-</span><span class="mf">2.22</span><span class="o">.</span><span class="nx">tar</span><span class="o">.</span><span class="nx">gz</span>
</span><span class='line'> <span class="nx">tar</span> <span class="nx">zxvf</span> <span class="nx">glibc</span><span class="o">-</span><span class="mf">2.22</span><span class="o">.</span><span class="nx">tar</span><span class="o">.</span><span class="nx">gz</span>
</span><span class='line'> <span class="nx">cd</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">src</span><span class="o">/</span><span class="nx">glibc</span><span class="o">-</span><span class="mf">2.22</span><span class="o">-</span><span class="nx">build</span><span class="o">/</span>
</span><span class='line'> <span class="nx">export</span> <span class="nx">CFLAGS</span><span class="o">=</span><span class="s2">&quot;-g -O2 -march=i686&quot;</span>
</span><span class='line'>  <span class="nx">网上有些地方加优化开关</span> <span class="o">-</span><span class="nx">O2</span>  <span class="nx">时（大写字母O），写的是</span> <span class="o">-</span><span class="mo">02</span> <span class="nx">（数字零），</span>
</span><span class='line'>  <span class="nx">所以拷贝过来仍然出现3中的错误，所以请注意。</span>
</span><span class='line'> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">src</span><span class="o">/</span><span class="nx">glibc</span><span class="o">-</span><span class="mf">2.22</span><span class="o">-</span><span class="nx">build</span><span class="o">/</span><span class="nx">glibc</span><span class="o">-</span><span class="mf">2.22</span><span class="o">/</span><span class="nx">configure</span> <span class="o">--</span><span class="nx">prefix</span><span class="o">=/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">src</span><span class="o">/</span><span class="nx">glibc</span><span class="o">-</span><span class="mf">2.22</span><span class="o">-</span><span class="nx">build</span><span class="o">/</span> <span class="o">--</span><span class="nx">with</span><span class="o">-</span><span class="nx">headers</span><span class="o">=/</span><span class="nx">usr</span><span class="o">/</span><span class="k">include</span>
</span><span class='line'> <span class="nx">make</span>
</span><span class='line'> <span class="nx">make</span> <span class="nx">install</span>
</span></code></pre></td></tr></table></div></figure>


<p>报错</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">***</span> <span class="nx">These</span> <span class="nx">critical</span> <span class="nx">programs</span> <span class="nx">are</span> <span class="nx">missing</span> <span class="k">or</span> <span class="nx">too</span> <span class="nx">old</span><span class="o">:</span> <span class="k">as</span> <span class="nx">ld</span> <span class="nx">compiler</span>
</span><span class='line'><span class="o">***</span> <span class="nx">Check</span> <span class="nx">the</span> <span class="nx">INSTALL</span> <span class="nb">file</span> <span class="k">for</span> <span class="nx">required</span> <span class="nx">versions</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="nx">解决办法</span><span class="o">:</span>
</span><span class='line'><span class="nx">问题原因：</span>
</span><span class='line'><span class="nx">缺少autoconf或版本太低</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nx">下载安装新版本</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'> <span class="nx">wget</span> <span class="nx">ftp</span><span class="o">://</span><span class="nx">ftp</span><span class="o">.</span><span class="nx">gnu</span><span class="o">.</span><span class="nx">org</span><span class="o">/</span><span class="nx">gnu</span><span class="o">/</span><span class="nx">autoconf</span><span class="o">/</span><span class="nx">autoconf</span><span class="o">-</span><span class="mf">2.68</span><span class="o">.</span><span class="nx">tar</span><span class="o">.</span><span class="nx">gz</span>
</span><span class='line'> <span class="nx">tar</span> <span class="nx">zxvf</span> <span class="nx">autoconf</span><span class="o">-</span><span class="mf">2.68</span><span class="o">.</span><span class="nx">tar</span><span class="o">.</span><span class="nx">gz</span>
</span><span class='line'> <span class="nx">cd</span> <span class="nx">autoconf</span><span class="o">-</span><span class="mf">2.68</span>
</span><span class='line'> <span class="o">./</span><span class="nx">configure</span> <span class="o">--</span><span class="nx">prefix</span><span class="o">=/</span><span class="nx">usr</span><span class="o">/</span>
</span><span class='line'> <span class="nx">make</span> <span class="o">&amp;&amp;</span> <span class="nx">make</span> <span class="nx">install</span>
</span></code></pre></td></tr></table></div></figure>


<p>我进行到了这一步，然后虚拟机卡住了，卡了好久。。</p>

<p>然后我干出了今天干过最蠢的事<strong>我直接用VM重启了它</strong>（我的Windows卡住就是这样干的(尴尬脸)）</p>

<p>然后再开机我就懵逼了，我firefox的书签没了，历史记录没有，系统还报错。运行几分钟就一直卡住。。</p>

<p>然后我就决定果断弃坑！！！！！</p>

<p>PS：</p>

<p><strong>这篇博文还很不完整，以后有机会再在Centos上装Atom成功的话在回来补充</strong></p>

<pre class="prettyprint linenums">
多么痛的领悟
绝对不要随便强制重启！！！！
用浏览器一定要登录，书签和历史记录才能同步啊！！！
下次更新东西别再一个版本一个版本的往上装了，耿直过头啊！！！
</pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Linx下安装Git]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/09/linux-git/"/>
    <updated>2016-05-09T23:25:34+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/09/linux-git</id>
    <content type="html"><![CDATA[<blockquote><p>考试季过去了，准备开始将日常使用迁移到Linux下，今天想在Linux下装Git，开始觉得这应该是个很简单的事，谁知道这个花了好多时间。</p></blockquote>

<!--more-->


<p>首先在网上找了一个博文作为参考，<a href="http://blog.csdn.net/naola2001/article/details/43228769">传送门</a></p>

<p>服务器端：</p>

<pre class="prettyprint linenums">
yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel perl-devel
wget https://github.com/git/git/archive/v2.2.0.tar.gz
tar zxvf git-2.2.0.tar.gz
cd git-2.2.0
make prefix=/usr/local all
make prefix=/usr/local install  root用户运行
</pre>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">如果编译时提示错误：</span>
</span><span class='line'><span class="nx">LINK</span> <span class="nx">git</span><span class="o">-</span><span class="nx">credential</span><span class="o">-</span><span class="nx">store</span>
</span><span class='line'><span class="nx">libgit</span><span class="o">.</span><span class="nx">a</span><span class="p">(</span><span class="nx">utf8</span><span class="o">.</span><span class="nx">o</span><span class="p">)</span><span class="o">:</span> <span class="nx">In</span> <span class="k">function</span> <span class="err">`</span><span class="nf">reencode_string_iconv’</span><span class="o">:</span>
</span><span class='line'><span class="o">/</span><span class="nx">opt</span><span class="o">/</span><span class="nx">git</span><span class="o">-</span><span class="nx">master</span><span class="o">/</span><span class="nx">utf8</span><span class="o">.</span><span class="nx">c</span><span class="o">:</span><span class="mi">530</span><span class="o">:</span> <span class="nx">undefined</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="sb">`libiconv’</span>
</span><span class='line'><span class="sb">libgit.a(utf8.o): In function `</span><span class="nx">reencode_string_len’</span><span class="o">:</span>
</span><span class='line'><span class="o">/</span><span class="nx">opt</span><span class="o">/</span><span class="nx">git</span><span class="o">-</span><span class="nx">master</span><span class="o">/</span><span class="nx">utf8</span><span class="o">.</span><span class="nx">c</span><span class="o">:</span><span class="mi">569</span><span class="o">:</span> <span class="nx">undefined</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="sb">`libiconv_open’</span>
</span><span class='line'><span class="sb">/opt/git-master/utf8.c:588: undefined reference to `</span><span class="nx">libiconv_close’</span>
</span><span class='line'><span class="o">/</span><span class="nx">opt</span><span class="o">/</span><span class="nx">git</span><span class="o">-</span><span class="nx">master</span><span class="o">/</span><span class="nx">utf8</span><span class="o">.</span><span class="nx">c</span><span class="o">:</span><span class="mi">582</span><span class="o">:</span> <span class="nx">undefined</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="err">`</span><span class="nx">libiconv_open’</span>
</span><span class='line'><span class="nx">collect2</span><span class="o">:</span> <span class="nx">ld</span> <span class="nx">返回</span> <span class="mi">1</span>
</span><span class='line'><span class="nx">make</span><span class="o">:</span> <span class="o">***</span> <span class="p">[</span><span class="nx">git</span><span class="o">-</span><span class="nx">credential</span><span class="o">-</span><span class="nx">store</span><span class="p">]</span> <span class="nx">错误</span> <span class="mi">1</span>
</span><span class='line'><span class="nx">解决办法：</span>
</span><span class='line'>
</span><span class='line'><span class="nx">cd</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">local</span><span class="o">/</span><span class="nx">src</span><span class="o">/</span>
</span><span class='line'><span class="nx">wget</span> <span class="nx">http</span><span class="o">://</span><span class="nx">ftp</span><span class="o">.</span><span class="nx">gnu</span><span class="o">.</span><span class="nx">org</span><span class="o">/</span><span class="nx">pub</span><span class="o">/</span><span class="nx">gnu</span><span class="o">/</span><span class="nx">libiconv</span><span class="o">/</span><span class="nx">libiconv</span><span class="o">-</span><span class="mf">1.14</span><span class="o">.</span><span class="nx">tar</span><span class="o">.</span><span class="nx">gz</span>
</span><span class='line'><span class="nx">tar</span> <span class="o">-</span><span class="nx">zxvf</span> <span class="nx">libiconv</span><span class="o">-</span><span class="mf">1.14</span><span class="o">.</span><span class="nx">tar</span><span class="o">.</span><span class="nx">gz</span>
</span><span class='line'><span class="nx">cd</span> <span class="nx">libiconv</span><span class="o">-</span><span class="mf">1.14</span>
</span><span class='line'><span class="o">./</span><span class="nx">configure</span> <span class="o">-</span><span class="nx">prefix</span><span class="o">=/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">local</span><span class="o">/</span><span class="nx">libiconv</span>  <span class="o">&amp;&amp;</span>  <span class="nx">make</span>  <span class="o">&amp;&amp;</span> <span class="nx">sudo</span>  <span class="nx">make</span> <span class="nx">install</span>
</span><span class='line'><span class="nx">然后回到git继续编译：</span>
</span><span class='line'>
</span><span class='line'><span class="nx">cd</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">local</span><span class="o">/</span><span class="nx">src</span><span class="o">/</span><span class="nx">git</span><span class="o">-</span><span class="mf">1.8</span><span class="o">.</span><span class="mi">5</span>
</span><span class='line'><span class="nx">make</span> <span class="nx">configure</span>
</span><span class='line'><span class="o">./</span><span class="nx">configure</span> <span class="o">--</span><span class="nx">prefix</span><span class="o">=/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">local</span> <span class="o">-</span><span class="nx">with</span><span class="o">-</span><span class="nb">iconv</span><span class="o">=/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">local</span><span class="o">/</span><span class="nx">libiconv</span>
</span><span class='line'><span class="nx">make</span>
</span><span class='line'><span class="nx">make</span> <span class="nx">install</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1"># git --version</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">version</span> <span class="mf">2.2</span><span class="o">.</span><span class="mi">0</span>
</span></code></pre></td></tr></table></div></figure>


<p>按照教程，到这里应该就成功了。
但是在解决了lib的错误后在回来执行 make 时遇到了错误</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">In</span> <span class="k">function</span> <span class="err">`</span><span class="nf">init_gettext_charset</span><span class="s1">&#39;: </span>
</span><span class='line'><span class="s1">/root/soft/git-2012-01-19/gettext.c:115: undefined reference to `locale_charset&#39;</span>
</span><span class='line'><span class="nx">collect2</span><span class="o">:</span> <span class="nx">ld</span> <span class="nx">returned</span> <span class="mi">1</span> <span class="k">exit</span> <span class="nx">status</span>
</span></code></pre></td></tr></table></div></figure>


<p>解决方法：<a href="http://mono.1490590.n4.nabble.com/Can-t-compile-git-for-a-long-time-td3336232.html#a4312244">传送门</a>
其中一个corey_yan的回答成功解决了问题</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">I</span> <span class="nx">encounter</span> <span class="nx">the</span> <span class="nx">same</span> <span class="nx">problem</span> <span class="nx">in</span> <span class="nx">centos</span> <span class="mf">5.2</span> <span class="k">and</span> <span class="k">try</span> <span class="nx">to</span> <span class="nx">solve</span> <span class="nx">it</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">long</span> <span class="nb">time</span>
</span><span class='line'>
</span><span class='line'><span class="nx">libgit</span><span class="o">.</span><span class="nx">a</span><span class="p">(</span><span class="nb">gettext</span><span class="o">.</span><span class="nx">o</span><span class="p">)</span><span class="o">:</span> <span class="nx">In</span> <span class="k">function</span> <span class="err">`</span><span class="nf">init_gettext_charset</span><span class="s1">&#39;: </span>
</span><span class='line'><span class="s1">/root/soft/git-2012-01-19/gettext.c:115: undefined reference to `locale_charset&#39;</span>
</span><span class='line'><span class="nx">collect2</span><span class="o">:</span> <span class="nx">ld</span> <span class="nx">returned</span> <span class="mi">1</span> <span class="k">exit</span> <span class="nx">status</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nx">After</span> <span class="nx">checking</span> <span class="nx">the</span> <span class="nx">detail</span> <span class="nx">Link</span> <span class="nx">command</span>
</span><span class='line'><span class="nx">make</span> <span class="o">-</span><span class="nx">n</span> <span class="o">|</span> <span class="nx">grep</span> <span class="s2">&quot;git-daemon&quot;</span>
</span><span class='line'><span class="k">echo</span> <span class="s1">&#39;   &#39;</span> <span class="nx">LINK</span> <span class="nx">git</span><span class="o">-</span><span class="nx">daemon</span><span class="p">;</span>
</span><span class='line'><span class="nx">cc</span>  <span class="o">-</span><span class="nx">g</span> <span class="o">-</span><span class="nx">O2</span> <span class="o">-</span><span class="nx">I</span><span class="o">.</span> <span class="o">-</span><span class="nx">pthread</span> <span class="o">-</span><span class="nx">DHAVE_PATHS_H</span> <span class="o">-</span><span class="nx">DHAVE_LIBCHARSET_H</span> <span class="o">-</span><span class="nx">DHAVE_DEV_TTY</span> <span class="o">-</span><span class="nx">DSHA1_HEADER</span><span class="o">=</span><span class="s1">&#39;&lt;openssl/sha.h&gt;&#39;</span>  <span class="o">-</span><span class="nx">DNO_STRLCPY</span> <span class="o">-</span><span class="nx">DNO_MKSTEMPS</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">git</span><span class="o">-</span><span class="nx">daemon</span>   <span class="nx">daemon</span><span class="o">.</span><span class="nx">o</span> <span class="nx">libgit</span><span class="o">.</span><span class="nx">a</span> <span class="nx">xdiff</span><span class="o">/</span><span class="nx">lib</span><span class="o">.</span><span class="nx">a</span>  <span class="o">-</span><span class="nx">lz</span>  <span class="o">-</span><span class="nx">liconv</span>  <span class="o">-</span><span class="nx">lcrypto</span> <span class="o">-</span><span class="nx">pthread</span>
</span><span class='line'>
</span><span class='line'><span class="nx">I</span> <span class="k">try</span> <span class="nx">to</span> <span class="nx">change</span> <span class="nx">to</span>
</span><span class='line'><span class="nx">cc</span>  <span class="o">-</span><span class="nx">g</span> <span class="o">-</span><span class="nx">O2</span> <span class="o">-</span><span class="nx">I</span><span class="o">.</span> <span class="o">-</span><span class="nx">pthread</span> <span class="o">-</span><span class="nx">DHAVE_PATHS_H</span> <span class="o">-</span><span class="nx">DHAVE_LIBCHARSET_H</span> <span class="o">-</span><span class="nx">DHAVE_DEV_TTY</span> <span class="o">-</span><span class="nx">DSHA1_HEADER</span><span class="o">=</span><span class="s1">&#39;&lt;openssl/sha.h&gt;&#39;</span>  <span class="o">-</span><span class="nx">DNO_STRLCPY</span> <span class="o">-</span><span class="nx">DNO_MKSTEMPS</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">git</span><span class="o">-</span><span class="nx">daemon</span>   <span class="nx">daemon</span><span class="o">.</span><span class="nx">o</span> <span class="nx">libgit</span><span class="o">.</span><span class="nx">a</span> <span class="nx">xdiff</span><span class="o">/</span><span class="nx">lib</span><span class="o">.</span><span class="nx">a</span>  <span class="o">-</span><span class="nx">lz</span>  <span class="o">-</span><span class="nx">liconv</span>  <span class="o">-</span><span class="nx">lcharset</span> <span class="o">-</span><span class="nx">lcrypto</span> <span class="o">-</span><span class="nx">pthread</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Link</span> <span class="nx">error</span> <span class="nx">is</span> <span class="nx">missing</span><span class="o">:</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nx">I</span> <span class="k">try</span> <span class="nx">to</span> <span class="nx">modify</span> <span class="nx">Makefile</span>
</span><span class='line'>        <span class="nx">EXTLIBS</span> <span class="o">+=</span> <span class="err">$</span><span class="p">(</span><span class="nx">ICONV_LINK</span><span class="p">)</span> <span class="o">-</span><span class="nx">liconv</span> <span class="o">-</span><span class="nx">lcharset</span>
</span><span class='line'>
</span><span class='line'><span class="nx">then</span>
</span><span class='line'><span class="nx">make</span> <span class="nx">successfully</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Hope</span> <span class="nx">it</span> <span class="nx">can</span> <span class="nx">help</span> <span class="nx">you</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>步骤为:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">make</span> <span class="o">-</span><span class="nx">n</span> <span class="o">|</span> <span class="nx">grep</span> <span class="s2">&quot;git-daemon&quot;</span>
</span><span class='line'><span class="k">echo</span> <span class="s1">&#39;   &#39;</span> <span class="nx">LINK</span> <span class="nx">git</span><span class="o">-</span><span class="nx">daemon</span><span class="p">;</span>
</span><span class='line'><span class="nx">cc</span>  <span class="o">-</span><span class="nx">g</span> <span class="o">-</span><span class="nx">O2</span> <span class="o">-</span><span class="nx">I</span><span class="o">.</span> <span class="o">-</span><span class="nx">pthread</span> <span class="o">-</span><span class="nx">DHAVE_PATHS_H</span> <span class="o">-</span><span class="nx">DHAVE_LIBCHARSET_H</span> <span class="o">-</span><span class="nx">DHAVE_DEV_TTY</span> <span class="o">-</span><span class="nx">DSHA1_HEADER</span><span class="o">=</span><span class="s1">&#39;&lt;openssl/sha.h&gt;&#39;</span>  <span class="o">-</span><span class="nx">DNO_STRLCPY</span> <span class="o">-</span><span class="nx">DNO_MKSTEMPS</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">git</span><span class="o">-</span><span class="nx">daemon</span>   <span class="nx">daemon</span><span class="o">.</span><span class="nx">o</span> <span class="nx">libgit</span><span class="o">.</span><span class="nx">a</span> <span class="nx">xdiff</span><span class="o">/</span><span class="nx">lib</span><span class="o">.</span><span class="nx">a</span>  <span class="o">-</span><span class="nx">lz</span>  <span class="o">-</span><span class="nx">liconv</span>  <span class="o">-</span><span class="nx">lcrypto</span> <span class="o">-</span><span class="nx">pthread</span>
</span><span class='line'><span class="c1">//会报一个link错误</span>
</span><span class='line'><span class="nx">cc</span>  <span class="o">-</span><span class="nx">g</span> <span class="o">-</span><span class="nx">O2</span> <span class="o">-</span><span class="nx">I</span><span class="o">.</span> <span class="o">-</span><span class="nx">pthread</span> <span class="o">-</span><span class="nx">DHAVE_PATHS_H</span> <span class="o">-</span><span class="nx">DHAVE_LIBCHARSET_H</span> <span class="o">-</span><span class="nx">DHAVE_DEV_TTY</span> <span class="o">-</span><span class="nx">DSHA1_HEADER</span><span class="o">=</span><span class="s1">&#39;&lt;openssl/sha.h&gt;&#39;</span>  <span class="o">-</span><span class="nx">DNO_STRLCPY</span> <span class="o">-</span><span class="nx">DNO_MKSTEMPS</span> <span class="o">-</span><span class="nx">o</span> <span class="nx">git</span><span class="o">-</span><span class="nx">daemon</span>   <span class="nx">daemon</span><span class="o">.</span><span class="nx">o</span> <span class="nx">libgit</span><span class="o">.</span><span class="nx">a</span> <span class="nx">xdiff</span><span class="o">/</span><span class="nx">lib</span><span class="o">.</span><span class="nx">a</span>  <span class="o">-</span><span class="nx">lz</span>  <span class="o">-</span><span class="nx">liconv</span>  <span class="o">-</span><span class="nx">lcharset</span> <span class="o">-</span><span class="nx">lcrypto</span> <span class="o">-</span><span class="nx">pthread</span>
</span><span class='line'><span class="c1">//Link error is missing:) </span>
</span><span class='line'><span class="nx">vim</span> <span class="nx">Makefile</span>
</span><span class='line'><span class="nx">找到</span> <span class="nx">EXTLIBS</span> <span class="o">+=</span> <span class="err">$</span><span class="p">(</span><span class="nx">ICONV_LINK</span><span class="p">)</span> <span class="o">-</span><span class="nx">liconv</span>
</span><span class='line'><span class="nx">改为</span> <span class="nx">EXTLIBS</span> <span class="o">+=</span> <span class="err">$</span><span class="p">(</span><span class="nx">ICONV_LINK</span><span class="p">)</span> <span class="o">-</span><span class="nx">liconv</span> <span class="o">-</span><span class="nx">lcharset</span>  <span class="c1">//保存退出</span>
</span><span class='line'><span class="nx">重新make</span>
</span><span class='line'><span class="nx">make</span> <span class="nx">install</span>
</span></code></pre></td></tr></table></div></figure>


<p>成功解决问题。</p>

<hr />

<h1>在原博文下面还有一些功能的安装，现在还没设计到，不过也先贴出来</h1>

<p><strong>下面来安装 gitosis</strong></p>

<blockquote><p>gitosis为Git用户权限管理系统,通过管理服务端的authorized_key文件来执行对用户权限的管理，是一个Python模块包</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">yum</span> <span class="nx">install</span> <span class="nx">python</span> <span class="nx">python</span><span class="o">-</span><span class="nx">setuptools</span>
</span><span class='line'><span class="nx">cd</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">local</span><span class="o">/</span><span class="nx">src</span>
</span><span class='line'><span class="nx">git</span> <span class="k">clone</span> <span class="nx">git</span><span class="o">://</span><span class="nx">github</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">res0nat0r</span><span class="o">/</span><span class="nx">gitosis</span><span class="o">.</span><span class="nx">git</span>
</span><span class='line'><span class="nx">cd</span> <span class="nx">gitosis</span>
</span><span class='line'><span class="nx">python</span> <span class="nx">setup</span><span class="o">.</span><span class="nx">py</span> <span class="nx">install</span>
</span><span class='line'>
</span><span class='line'><span class="nx">OK</span> <span class="nx">gitosis</span> <span class="nx">安装成功！</span>
</span><span class='line'>
</span><span class='line'> <span class="nx">配置服务器git：</span>
</span><span class='line'><span class="mf">0.1</span> <span class="nx">输入以下两条命令</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">config</span> <span class="o">--</span><span class="k">global</span> <span class="nx">user</span><span class="o">.</span><span class="nx">name</span> <span class="s2">&quot;Your Name Here&quot;</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">config</span> <span class="o">--</span><span class="k">global</span> <span class="nx">user</span><span class="o">.</span><span class="nx">email</span> <span class="s2">&quot;your_email@example.com&quot;</span>
</span><span class='line'><span class="nx">可以再输入git</span> <span class="nx">config</span> <span class="o">-</span><span class="nx">l查看上面两个是否设置</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>在开发机上生成密钥并上传到服务器上</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">ssh</span><span class="o">-</span><span class="nx">keygen</span> <span class="o">-</span><span class="nx">t</span> <span class="nx">rsa</span>   <span class="c1">#一路回车，不需要设置密码</span>
</span><span class='line'><span class="nx">scp</span> <span class="o">~/.</span><span class="nx">ssh</span><span class="o">/</span><span class="nx">id_rsa</span><span class="o">.</span><span class="nx">pub</span> <span class="nx">root</span><span class="o">@</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">103.10</span><span class="o">:/</span><span class="nx">tmp</span>   <span class="c1">#上传公钥到服务器(默认SSH端口22)</span>
</span><span class='line'><span class="nx">或</span>
</span><span class='line'><span class="nx">scp</span> <span class="o">-</span><span class="nx">P</span> <span class="mi">3600</span>  <span class="o">~/.</span><span class="nx">ssh</span><span class="o">/</span><span class="nx">id_rsa</span><span class="o">.</span><span class="nx">pub</span> <span class="nx">root</span><span class="o">@</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">103.10</span><span class="o">:/</span><span class="nx">tmp</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="mi">5</span><span class="nx">、服务器上生成git用户，使用git用户并初始化gitosis</span>
</span><span class='line'><span class="nx">adduser</span> <span class="o">-</span><span class="nx">m</span> <span class="nx">git</span>
</span><span class='line'><span class="nx">su</span> <span class="nx">–</span> <span class="nx">git</span>
</span><span class='line'><span class="nx">gitosis</span><span class="o">-</span><span class="nx">init</span> <span class="o">&lt;</span> <span class="o">/</span><span class="nx">tmp</span><span class="o">/</span><span class="nx">id_rsa</span><span class="o">.</span><span class="nx">pub</span>
</span><span class='line'><span class="c1">#显示以下信息即表示成功</span>
</span><span class='line'><span class="c1">#Initialized empty Git repository in /home/git/repositories/gitosis-admin.git/</span>
</span><span class='line'><span class="c1">#Reinitialized existing Git repository in /home/git/repositories/gitosis-admin.git/</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">#删除密钥</span>
</span><span class='line'><span class="nx">su</span> <span class="nx">–</span> <span class="nx">root</span>
</span><span class='line'><span class="nx">rm</span> <span class="o">-</span><span class="nx">rf</span> <span class="o">/</span><span class="nx">tmp</span><span class="o">/</span><span class="nx">id_rsa</span><span class="o">.</span><span class="nx">pub</span>
</span><span class='line'><span class="nx">禁用shell登录</span>
</span><span class='line'><span class="nx">注，出于安全考虑，第二步创建的git用户不允许登录shell，这可以通过编辑</span><span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">passwd文件完成。找到类似下面的一行：</span>
</span><span class='line'><span class="nx">\</span><span class="p">[</span><span class="nx">root</span><span class="o">@</span><span class="nx">git</span> <span class="o">~</span><span class="nx">\</span><span class="p">]</span><span class="c1"># cat /etc/passwd | grep git</span>
</span><span class='line'><span class="nx">git</span><span class="o">:</span><span class="nx">x</span><span class="o">:</span><span class="mi">1001</span><span class="o">:</span><span class="mi">1001</span><span class="o">:</span><span class="nx">git</span> <span class="nx">version</span> <span class="nx">control</span><span class="o">:/</span><span class="nx">home</span><span class="o">/</span><span class="nx">git</span><span class="o">:/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">bash</span>
</span><span class='line'>
</span><span class='line'><span class="nx">改为：</span>
</span><span class='line'><span class="nx">\</span><span class="p">[</span><span class="nx">root</span><span class="o">@</span><span class="nx">git</span> <span class="o">~</span><span class="nx">\</span><span class="p">]</span><span class="c1"># vim /etc/passwd</span>
</span><span class='line'><span class="nx">git</span><span class="o">:</span><span class="nx">x</span><span class="o">:</span><span class="mi">1001</span><span class="o">:</span><span class="mi">1001</span><span class="o">:</span><span class="nx">git</span> <span class="nx">version</span> <span class="nx">control</span><span class="o">:/</span><span class="nx">home</span><span class="o">/</span><span class="nx">git</span><span class="o">:/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">git</span><span class="o">-</span><span class="nx">shell</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nx">这样，git用户可以正常通过ssh使用git，但无法登录shell，因为我们为git用户指定的git</span><span class="o">-</span><span class="nx">shell每次一登录就自动退出。</span>
</span><span class='line'>
</span><span class='line'><span class="mi">2</span><span class="nx">，在git用户下，生成私钥和公钥。</span>
</span><span class='line'><span class="nv">$ssh</span><span class="o">-</span><span class="nx">keygen</span> <span class="nx">–t</span> <span class="nx">rsa</span>
</span><span class='line'><span class="mi">3</span><span class="nx">，在git用户下，拷入id_rsa</span><span class="o">.</span><span class="nx">pub文件。</span>
</span><span class='line'><span class="nv">$gitosis</span><span class="o">-</span><span class="nx">init</span> <span class="o">&lt;</span> <span class="nx">id_rsa</span><span class="o">.</span><span class="nx">pub</span>
</span><span class='line'><span class="nx">这样在git用户目录下生成了一些目录，gitosis，repositories。</span>
</span><span class='line'><span class="nx">至此，安装工作完成。</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>添加开发者</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">git服务器管理人员需要把所有的开发者公钥保存到authorized_keys文件中。</span>
</span><span class='line'><span class="nv">$cat</span> <span class="o">/</span><span class="nx">tmp</span><span class="o">/</span><span class="nx">id_rsa</span><span class="o">.</span><span class="nx">pub</span><span class="o">.</span><span class="nx">ubuntu</span> <span class="o">&gt;&gt;</span> <span class="nx">authorized_keys</span>
</span><span class='line'><span class="nx">创建项目仓库</span>
</span><span class='line'><span class="nx">git管理人员操作：</span>
</span><span class='line'><span class="nv">$mkdir</span> <span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">git</span><span class="o">/</span><span class="nx">gitproject</span>
</span><span class='line'><span class="nv">$cd</span> <span class="nx">gitproject</span>
</span><span class='line'><span class="nv">$git</span> <span class="o">--</span><span class="nx">bare</span> <span class="nx">init</span> <span class="nx">（创建一个空项目）</span>
</span><span class='line'><span class="nx">开发者提交项目</span>
</span><span class='line'><span class="nx">ubuntu开发者操作：</span>
</span><span class='line'><span class="nv">$git</span> <span class="nx">remote</span> <span class="nx">add</span> <span class="nx">origin</span> <span class="nx">git</span><span class="o">@</span><span class="nx">gitserver</span><span class="o">:/</span><span class="nx">opt</span><span class="o">/</span><span class="nx">git</span><span class="o">/</span><span class="nx">project</span><span class="o">.</span><span class="nx">git</span>
</span><span class='line'><span class="nv">$git</span> <span class="nx">push</span> <span class="nx">origin</span> <span class="nx">master</span>
</span><span class='line'><span class="nx">这样其他开发者的工作也比较简单了：</span>
</span><span class='line'><span class="nv">$git</span> <span class="k">clone</span> <span class="nx">…</span>
</span><span class='line'><span class="nv">$git</span> <span class="nx">push</span> <span class="nx">origin</span> <span class="nx">master</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nx">cd</span> <span class="o">/</span><span class="nx">repo</span><span class="o">/</span><span class="nx">gitosis</span><span class="o">-</span><span class="nx">admin</span>
</span><span class='line'><span class="nx">vim</span> <span class="nx">gitosis</span><span class="o">.</span><span class="nx">conf</span>
</span><span class='line'><span class="nx">在文件尾增加以下内容</span>
</span><span class='line'><span class="nx">\</span><span class="p">[</span><span class="nx">group</span> <span class="nx">test\</span><span class="p">]</span>  <span class="nx">组名称</span>
</span><span class='line'><span class="nx">writable</span> <span class="o">=</span> <span class="nx">test</span>  <span class="nx">项目名称</span>
</span><span class='line'><span class="nx">members</span> <span class="o">=</span> <span class="nx">jankerli</span> <span class="nx">密钥用户名</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#提交修改</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">add</span> <span class="o">.</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">commit</span> <span class="o">-</span><span class="nx">a</span> <span class="o">-</span><span class="nx">m</span> <span class="nx">“add</span> <span class="nx">test</span> <span class="nx">repo”</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">push</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>初始，增加及使用项目test-git</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">cd</span> <span class="o">/</span><span class="nx">repo</span>
</span><span class='line'><span class="nb">mkdir</span> <span class="nx">test</span><span class="o">-</span><span class="nx">git</span>
</span><span class='line'><span class="nx">cd</span> <span class="nx">test</span><span class="o">-</span><span class="nx">git</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">inti</span>
</span><span class='line'><span class="nb">touch</span> <span class="nx">readme</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">add</span> <span class="o">.</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">commit</span> <span class="o">-</span><span class="nx">a</span> <span class="o">-</span><span class="nx">m</span> <span class="nx">“init</span> <span class="nx">test</span><span class="o">-</span><span class="nx">git”</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">remote</span> <span class="nx">add</span> <span class="nx">origin</span> <span class="nx">git</span><span class="o">@</span><span class="nx">xxx</span><span class="o">:</span><span class="nx">test</span><span class="o">.</span><span class="nx">git</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">push</span> <span class="nx">origin</span> <span class="nx">master</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>在 test 项目新增用户</strong>
①在新增用户的本机输入ssh-keygen -t rsa生成私钥公钥；
②把生成的公钥id_rsa.pub上传或复制到 gitosis-admin/keydir文件夹下，并重名，如：jankerli.pub；
③vim gitosis.conf</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">在文件尾增加以下内容</span>
</span><span class='line'><span class="nx">\</span><span class="p">[</span><span class="nx">group</span> <span class="nx">test\</span><span class="p">]</span>
</span><span class='line'><span class="nx">writable</span> <span class="o">=</span> <span class="nx">test</span>
</span><span class='line'><span class="nx">members</span> <span class="o">=</span> <span class="nx">jankerli</span> <span class="nx">（此处增加新用户的名称，名称必须与上面重名的jankerli</span><span class="o">.</span><span class="nx">pub一致，去掉</span><span class="o">.</span><span class="nx">pub）</span>
</span><span class='line'><span class="nx">④提交修改</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">add</span> <span class="o">.</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">commit</span> <span class="o">-</span><span class="nx">a</span> <span class="o">-</span><span class="nx">m</span> <span class="nx">“add</span> <span class="nx">test</span> <span class="nx">repo”</span>
</span><span class='line'><span class="nx">git</span> <span class="nx">push</span>
</span></code></pre></td></tr></table></div></figure>


<p>⑤新用户便可通过 git clone git@xxx:test.git 克隆代码到本机了。</p>
]]></content>
  </entry>
  
</feed>
