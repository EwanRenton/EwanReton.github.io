
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Learn-more-PDO - Ewan Reton</title>
	<meta name="author" content="Ewan Reton">

	
	<meta name="description" content="Learn-more-PDO 前段时间在做手机归属地查询的Demo时突然发现自己对PDO还是太生疏，一直都是用的以前的代码。很多都不太了解，于是重新系统的学习了一下PDO类。 什么是PDO PDO（PHP Data Object）数据库访问抽象层，统一各种数据库的访问接口。
特性
* 编码一致性 &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Ewan Reton" type="application/atom+xml">
	
	<link rel="canonical" href="http://ewanreton.github.io/blog/2016/05/19/learn-more-pdo/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'>	<link type="text/css" rel="stylesheet" href='/prettify/prettify.css' >
	<script src="//libs.baidu.com/jquery/1.9.1/jquery.min.js"></script>
	<script type="text/javascript" src="/prettify/prettify.js"></script>
	<!--<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>-->
	<script>
  function addBlankTargetForLinks () {
    $('a[href^="http"]').each(function(){
      $(this).attr('target', '_blank');
    });
  }
  $(document).bind('DOMNodeInserted', function(event) {
    addBlankTargetForLinks();
  });
</script>
  

</head>


<body onload="prettyPrint()">
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript" src="/prettify/prettify.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("liukedi001@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
			
		});
	</script>
	
</div>

<div>
	<h1><a href="/">Ewan Reton</a></h1>
	
		<h2 style="color:#666">Never be touched by yourself</h2>
	
</div>
<nav id="main-nav"><ul class="main">
    <li><a href="/">Blog</a></li>
    <li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="main-nav"><section>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/git/'>git (3)</a></li>
<li class='category'><a href='/blog/categories/java/'>java (1)</a></li>
<li class='category'><a href='/blog/categories/javascript/'>javascript (2)</a></li>
<li class='category'><a href='/blog/categories/linux/'>linux (6)</a></li>
<li class='category'><a href='/blog/categories/mysql/'>mysql (4)</a></li>
<li class='category'><a href='/blog/categories/nginx/'>nginx (5)</a></li>
<li class='category'><a href='/blog/categories/octopress/'>octopress (3)</a></li>
<li class='category'><a href='/blog/categories/php/'>php (22)</a></li>
<li class='category'><a href='/blog/categories/weixin/'>weixin (1)</a></li>

  </ul>
</section></nav> 
<nav id="sub-nav">
	<div class="social">
		
			<a class="email" href="mailto:liukedi001@gmail.com" title="Email">Email</a>
		
		
		
			<a class="google" href="https://plus.google.com/116687730759120454062" rel="author" title="Google+">Google+</a>
		
		
		
			<a class="github" href="https://github.com/EwanReton" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		
		
		
    	
    	
			<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Learn-more-PDO</h1>
	<div class="entry-content" itemprop="articleBody"><blockquote><p>前段时间在做手机归属地查询的Demo时突然发现自己对PDO还是太生疏，一直都是用的以前的代码。很多都不太了解，于是重新系统的学习了一下PDO类。</p></blockquote>

<!--more-->


<h1>什么是PDO</h1>

<p>PDO（PHP Data Object）数据库访问抽象层，统一各种数据库的访问接口。
<strong>特性</strong>
* 编码一致性
* 灵活性
* 高性能
* 面向对象特性</p>

<p>PDO的安装与配置，和PHP其他扩展的开启一样，只需要在<code>php.ini</code>里设置即可，这里就不多说了。</p>

<h1>PDO连接数据库</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="c1">//通过参数形式连接数据库</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$dsn</span><span class="o">=</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$username</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$passwd</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$passwd</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$pdo</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://b.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=d2ce6c87044f78f0840b9af6490a7b68/aa64034f78f0f73686e0bed20d55b319eac413c2.jpg?referer=c0077f7aae014c08402c1c955dc1&amp;x=.jpg" alt="" /></p>

<h1>PDO exec</h1>

<blockquote><p>增删改，返回得是受影响的行数</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">//exec():执行一条sql语句并返回其受影响的记录的条数,如果没有受影响的记录，他返回0</span>
</span><span class='line'>  <span class="c1">//exec对于select没有作用</span>
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=&lt;&lt;&lt;</span><span class="nx">EOF</span>
</span><span class='line'>      <span class="nx">CREATE</span> <span class="nx">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="nx">EXISTS</span> <span class="nx">user</span><span class="p">(</span>
</span><span class='line'>      <span class="nx">id</span> <span class="nx">INT</span> <span class="nx">UNSIGNED</span> <span class="nx">AUTO_INCREMENT</span> <span class="nx">KEY</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">username</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="nx">UNIQUE</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">password</span> <span class="nx">CHAR</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">email</span> <span class="nx">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
</span><span class='line'>      <span class="p">);</span>
</span><span class='line'><span class="nx">EOF</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">//$sql=&#39;INSERT user(username,password,email) VALUES(&quot;reton&quot;,&quot;reton&quot;,&quot;reton@qq.com&quot;)&#39;;</span>
</span><span class='line'>  <span class="c1">//$res=$pdo-&gt;exec($sql);</span>
</span><span class='line'>  <span class="c1">//echo &#39;受影响的记录的条数为：&#39;.$res,&#39;&lt;br/&gt;&#39;;</span>
</span><span class='line'>  <span class="c1">//$pdo-&gt;lastInsertId():得到新插入记录的ID号</span>
</span><span class='line'>  <span class="c1">//echo &#39;最后插入的ID号为&#39;.$pdo-&gt;lastInsertId();</span>
</span><span class='line'>  <span class="nv">$res</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$res</span><span class="p">);</span>   
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s1">&#39;INSERT user(username,password,email) VALUES(&quot;reton&quot;,&quot;&#39;</span><span class="o">.</span><span class="nb">md5</span><span class="p">(</span><span class="s1">&#39;reton&#39;</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;&quot;,&quot;test@qq.com&quot;)&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//echo $sql;</span>
</span><span class='line'>  <span class="nv">$res</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$res</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>PDO error 获取错误信息</h1>

<blockquote><p>获取错误码和错误信息</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s1">&#39;delete from user12 where id=1&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$res</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">//echo $res.&#39;条记录被影响&#39;;</span>
</span><span class='line'>  <span class="c1">//var_dump($res);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nv">$res</span><span class="o">===</span><span class="k">false</span><span class="p">){</span>
</span><span class='line'>      <span class="c1">//$pdo-&gt;errorCode():SQLSTATE的值</span>
</span><span class='line'>      <span class="k">echo</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">errorCode</span><span class="p">();</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s1">&#39;&lt;hr/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="c1">//$pdo-&gt;errorInfo():返回的错误信息的数组，数组中包含3个单元</span>
</span><span class='line'>      <span class="c1">//0=&gt;SQLSTATE,1=&gt;CODE,2=&gt;INFO</span>
</span><span class='line'>      <span class="nv">$errInfo</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">errorInfo</span><span class="p">();</span>
</span><span class='line'>      <span class="nb">print_r</span><span class="p">(</span><span class="nv">$errInfo</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="c1">//   echo &#39;&lt;hr/&gt;&#39;;</span>
</span><span class='line'><span class="c1">//   echo $pdo-&gt;lastInsertId();</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>PDO query</h1>

<blockquote><p>执行查询，返回的是PDOStatement对象</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">//$sql=&#39;select * from user where id=2&#39;;</span>
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s1">&#39;select id,username,email from user&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">//$pdo-&gt;query($sql)，执行SQL语句，返回PDOStatement对象</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$stmt</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;&lt;hr/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">foreach</span><span class="p">(</span><span class="nv">$stmt</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">){</span>
</span><span class='line'>      <span class="c1">//print_r($row);</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s1">&#39;编号：&#39;</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span><span class="s1">&#39;&lt;br/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s1">&#39;用户名：&#39;</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">],</span><span class="s1">&#39;&lt;br/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s1">&#39;邮箱：&#39;</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">],</span><span class="s1">&#39;&lt;br/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s1">&#39;&lt;hr/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>PDO prepare</h1>

<blockquote><p>prepare 准备方法</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s1">&#39;select * from user where username=&quot;reton&quot;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">//prepare($sql):准备SQL语句</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">//execute():执行预处理语句</span>
</span><span class='line'>  <span class="nv">$res</span><span class="o">=</span><span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</span><span class='line'>  <span class="c1">//var_dump($res);</span>
</span><span class='line'>  <span class="c1">//fetch():得到结果集中的一条记录</span>
</span><span class='line'>  <span class="nv">$row</span><span class="o">=</span><span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">();</span>
</span><span class='line'>  <span class="nb">print_r</span><span class="p">(</span><span class="nv">$row</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">//var_dump($stmt);</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>fetch.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s1">&#39;select * from user&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$res</span><span class="o">=</span><span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</span><span class='line'><span class="c1">//   if($res){</span>
</span><span class='line'><span class="c1">//       while($row=$stmt-&gt;fetch()){</span>
</span><span class='line'><span class="c1">//           print_r($row);</span>
</span><span class='line'><span class="c1">//           echo &#39;&lt;hr/&gt;&#39;;</span>
</span><span class='line'><span class="c1">//       }</span>
</span><span class='line'><span class="c1">//   }</span>
</span><span class='line'>  <span class="nv">$rows</span><span class="o">=</span><span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">();</span>
</span><span class='line'>  <span class="nb">print_r</span><span class="p">(</span><span class="nv">$rows</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">//var_dump($stmt);</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>setFetchMode.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s1">&#39;select * from user&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$res</span><span class="o">=</span><span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</span><span class='line'><span class="c1">//   if($res){</span>
</span><span class='line'><span class="c1">//       while($row=$stmt-&gt;fetch(PDO::FETCH_OBJ)){//返回对象</span>
</span><span class='line'><span class="c1">//           print_r($row);</span>
</span><span class='line'><span class="c1">//           echo &#39;&lt;hr/&gt;&#39;;</span>
</span><span class='line'><span class="c1">//       }</span>
</span><span class='line'><span class="c1">//   }</span>
</span><span class='line'><span class="c1">//   $rows=$stmt-&gt;fetchAll(PDO::FETCH_ASSOC);//返回关联数组BOTH为数组加索引</span>
</span><span class='line'><span class="c1">//   print_r($rows);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;&lt;hr/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">setFetchMode</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">);</span><span class="c1">//set了就不用传参了    </span>
</span><span class='line'>  <span class="c1">//var_dump($stmt);</span>
</span><span class='line'>  <span class="nv">$rows</span><span class="o">=</span><span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">();</span>
</span><span class='line'>  <span class="nb">print_r</span><span class="p">(</span><span class="nv">$rows</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>PDO getAttribute</h1>

<blockquote><p>获得数据库连接属性</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$dsn</span><span class="o">=</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$username</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$passwd</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$passwd</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;自动提交：&#39;</span><span class="o">.</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">getAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_AUTOCOMMIT</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;&lt;br/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;PDO默认的错误处理模式：&#39;</span><span class="o">.</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">getAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_AUTOCOMMIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;&lt;br/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;自动提交：&#39;</span><span class="o">.</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">getAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_AUTOCOMMIT</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>获取常用属性 并不是所有环境都支持一下的属性</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$dsn</span><span class="o">=</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$username</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$passwd</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$passwd</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$attrArr</span><span class="o">=</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>      <span class="s1">&#39;AUTOCOMMIT&#39;</span><span class="p">,</span><span class="s1">&#39;ERRMODE&#39;</span><span class="p">,</span><span class="s1">&#39;CASE&#39;</span><span class="p">,</span><span class="s1">&#39;PERSISTENT&#39;</span><span class="p">,</span><span class="s1">&#39;TIMEOUT&#39;</span><span class="p">,</span><span class="s1">&#39;ORACLE_NULLS&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="s1">&#39;SERVER_INFO&#39;</span><span class="p">,</span><span class="s1">&#39;SERVER_VERSION&#39;</span><span class="p">,</span><span class="s1">&#39;CLIENT_VERSION&#39;</span><span class="p">,</span><span class="s1">&#39;CONNECTION_STATUS&#39;</span>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'>  <span class="k">foreach</span><span class="p">(</span><span class="nv">$attrArr</span> <span class="k">as</span> <span class="nv">$attr</span><span class="p">){</span>
</span><span class='line'>      <span class="k">echo</span> <span class="s2">&quot;PDO::ATTR_</span><span class="si">$attr</span><span class="s2">: &quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">echo</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">getAttribute</span><span class="p">(</span><span class="nb">constant</span><span class="p">(</span><span class="s2">&quot;PDO::ATTR_</span><span class="si">$attr</span><span class="s2">&quot;</span><span class="p">)),</span><span class="s1">&#39;&lt;br/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>PDO setAttribute</h1>

<blockquote><p>设置数据库连接属性</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$dsn</span><span class="o">=</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$username</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$passwd</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$options</span><span class="o">=</span><span class="k">array</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_AUTOCOMMIT</span><span class="o">=&gt;</span><span class="mi">0</span><span class="p">,</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="o">=&gt;</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$passwd</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">getAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_AUTOCOMMIT</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;&lt;br/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">getAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>PDOStatement 对象的使用</h1>

<p><strong>quote防注入</strong></p>

<figure class='code'><figcaption><span>login.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'> <span class="cp">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
</span><span class='line'><span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'><span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;title&gt;</span>Insert title here<span class="nt">&lt;/title&gt;</span>
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&#39;doAction2.php&#39;</span> <span class="na">method=</span><span class="s">&#39;post&#39;</span><span class="nt">&gt;</span>
</span><span class='line'>用户名：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&#39;text&#39;</span> <span class="na">name=</span><span class="s">&#39;username&#39;</span> <span class="nt">/&gt;&lt;br/&gt;</span>
</span><span class='line'>密码：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&#39;password&#39;</span> <span class="na">name=</span><span class="s">&#39;password&#39;</span><span class="nt">/&gt;&lt;br/&gt;</span>
</span><span class='line'><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&#39;submit&#39;</span> <span class="na">value=</span><span class="s">&#39;登陆&#39;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/form&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>doAction2.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$username</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">];</span>
</span><span class='line'><span class="nv">$password</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">];</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>   
</span><span class='line'>  <span class="c1">//echo $pdo-&gt;quote($username);</span>
</span><span class='line'>  <span class="c1">//$sql=&quot;select * from user where username=&#39;{$username}&#39; and password=&#39;{$password}&#39;&quot;;</span>
</span><span class='line'>  <span class="c1">//echo $sql;</span>
</span><span class='line'>  <span class="c1">//通过quote():返回带引号的字符串，过滤字符串中的特殊字符</span>
</span><span class='line'>  <span class="nv">$username</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">quote</span><span class="p">(</span><span class="nv">$username</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;select * from user where username=</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2"> and password=&#39;</span><span class="si">{</span><span class="nv">$password</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$sql</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">//PDOStatement对象的方法：rouCount()：对于select操作返回的结果集中记录的条数，</span>
</span><span class='line'>  <span class="c1">//对于INSERT、UPDATE、DELETE返回受影响的记录的条数</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">rowCount</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>预处理语句的占位符</strong>
第一种用：xxx</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$username</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">];</span>
</span><span class='line'><span class="nv">$password</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">];</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>   
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;select * from user where username=:username and password=:password&quot;</span><span class="p">;</span> <span class="c1">//占位</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">&quot;:username&quot;</span><span class="o">=&gt;</span><span class="nv">$username</span><span class="p">,</span><span class="s2">&quot;:password&quot;</span><span class="o">=&gt;</span><span class="nv">$password</span><span class="p">));</span><span class="nx">赋值</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">rowCount</span><span class="p">();</span>
</span><span class='line'>  
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>第二种用？</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$username</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">];</span>
</span><span class='line'><span class="nv">$password</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">];</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>   
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;select * from user where username=? and password=?&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">));</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">rowCount</span><span class="p">();</span>
</span><span class='line'>  
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>bindParam()方法绑定参数到变量</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>   
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;INSERT user(username,password,email) VALUES(:username,:password,:email)&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>   
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="s2">&quot;:username&quot;</span><span class="p">,</span><span class="nv">$username</span><span class="p">,</span><span class="nx">PDO</span><span class="o">::</span><span class="na">PARAM_STR</span><span class="p">);</span><span class="c1">//绑定参数，被绑定的项，绑定的地址（不能直接写值），参数类型。如果是用的？第一个参数要写1,2,3。表示第几个占位符</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="s2">&quot;:password&quot;</span><span class="p">,</span><span class="nv">$password</span><span class="p">,</span><span class="nx">PDO</span><span class="o">::</span><span class="na">PARAM_STR</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="s2">&quot;:email&quot;</span><span class="p">,</span><span class="nv">$email</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$username</span><span class="o">=</span><span class="s1">&#39;imooc1&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$password</span><span class="o">=</span><span class="s1">&#39;imooc1&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$email</span><span class="o">=</span><span class="s1">&#39;imooc1@imooc.com&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</span><span class='line'>  <span class="nv">$username</span><span class="o">=</span><span class="s1">&#39;MR.KING1&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$password</span><span class="o">=</span><span class="s1">&#39;MR.KING1&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$email</span><span class="o">=</span><span class="s1">&#39;MR.KING1@imooc.com&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">rowCount</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>PDO错误处理模式</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> PDO::ERRMODE_SLIENT:默认模式，静默模式</span>
</span><span class='line'><span class="cm"> PDO::ERRMODE_WARNING:警告模式</span>
</span><span class='line'><span class="cm"> PDO::ERRMODE_EXCEPTION:异常模式</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="s1">&#39;root&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s1">&#39;SELECT * FROM noneTable&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">errorCode</span><span class="p">();</span>
</span><span class='line'>  <span class="k">echo</span> <span class="s1">&#39;&lt;br/&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nb">print_r</span><span class="p">(</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">errorInfo</span><span class="p">());</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://d.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=d28d1e1ad02a60595610e11f180f45a6/d8f9d72a6059252d57a8efd7339b033b5ab5b9a2.jpg?referer=c8b46b4c29dda3cc52f38c100760&amp;x=.jpg" alt="" />
<strong>PDO事务处理模式</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;content-type:text/html;charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>  <span class="nv">$dsn</span><span class="o">=</span><span class="s1">&#39;mysql:host=localhost;dbname=test&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$username</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$passwd</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$options</span><span class="o">=</span><span class="k">array</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_AUTOCOMMIT</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$passwd</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">inTransaction</span><span class="p">());</span>
</span><span class='line'>  <span class="c1">//开启事务</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">beginTransaction</span><span class="p">();</span>
</span><span class='line'>  <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">inTransaction</span><span class="p">());</span>
</span><span class='line'>  <span class="c1">//$sql=&#39;UPDATE userAccount SET money=money-2000 WHERE username=&quot;imooc&quot;&#39;;</span>
</span><span class='line'>  <span class="nv">$sql</span><span class="o">=</span><span class="s1">&#39;UPDATE userAccount SET money=money-2000 WHERE username=&quot;imooc&quot;&#39;</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="nv">$res1</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nv">$res1</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="k">throw</span> <span class="k">new</span> <span class="nx">PDOException</span><span class="p">(</span><span class="s1">&#39;imooc 转账失败&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nv">$res2</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s1">&#39;UPDATE userAccount SET money=money+2000 WHERE username=&quot;king1&quot;&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nv">$res2</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="k">throw</span> <span class="k">new</span> <span class="nx">PDOException</span><span class="p">(</span><span class="s1">&#39;king 接收失败&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="c1">//提交事务</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">commit</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="c1">//回滚事务</span>
</span><span class='line'>  <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">rollBack</span><span class="p">();</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>PDO操作类封装</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
<span class='line-number'>310</span>
<span class='line-number'>311</span>
<span class='line-number'>312</span>
<span class='line-number'>313</span>
<span class='line-number'>314</span>
<span class='line-number'>315</span>
<span class='line-number'>316</span>
<span class='line-number'>317</span>
<span class='line-number'>318</span>
<span class='line-number'>319</span>
<span class='line-number'>320</span>
<span class='line-number'>321</span>
<span class='line-number'>322</span>
<span class='line-number'>323</span>
<span class='line-number'>324</span>
<span class='line-number'>325</span>
<span class='line-number'>326</span>
<span class='line-number'>327</span>
<span class='line-number'>328</span>
<span class='line-number'>329</span>
<span class='line-number'>330</span>
<span class='line-number'>331</span>
<span class='line-number'>332</span>
<span class='line-number'>333</span>
<span class='line-number'>334</span>
<span class='line-number'>335</span>
<span class='line-number'>336</span>
<span class='line-number'>337</span>
<span class='line-number'>338</span>
<span class='line-number'>339</span>
<span class='line-number'>340</span>
<span class='line-number'>341</span>
<span class='line-number'>342</span>
<span class='line-number'>343</span>
<span class='line-number'>344</span>
<span class='line-number'>345</span>
<span class='line-number'>346</span>
<span class='line-number'>347</span>
<span class='line-number'>348</span>
<span class='line-number'>349</span>
<span class='line-number'>350</span>
<span class='line-number'>351</span>
<span class='line-number'>352</span>
<span class='line-number'>353</span>
<span class='line-number'>354</span>
<span class='line-number'>355</span>
<span class='line-number'>356</span>
<span class='line-number'>357</span>
<span class='line-number'>358</span>
<span class='line-number'>359</span>
<span class='line-number'>360</span>
<span class='line-number'>361</span>
<span class='line-number'>362</span>
<span class='line-number'>363</span>
<span class='line-number'>364</span>
<span class='line-number'>365</span>
<span class='line-number'>366</span>
<span class='line-number'>367</span>
<span class='line-number'>368</span>
<span class='line-number'>369</span>
<span class='line-number'>370</span>
<span class='line-number'>371</span>
<span class='line-number'>372</span>
<span class='line-number'>373</span>
<span class='line-number'>374</span>
<span class='line-number'>375</span>
<span class='line-number'>376</span>
<span class='line-number'>377</span>
<span class='line-number'>378</span>
<span class='line-number'>379</span>
<span class='line-number'>380</span>
<span class='line-number'>381</span>
<span class='line-number'>382</span>
<span class='line-number'>383</span>
<span class='line-number'>384</span>
<span class='line-number'>385</span>
<span class='line-number'>386</span>
<span class='line-number'>387</span>
<span class='line-number'>388</span>
<span class='line-number'>389</span>
<span class='line-number'>390</span>
<span class='line-number'>391</span>
<span class='line-number'>392</span>
<span class='line-number'>393</span>
<span class='line-number'>394</span>
<span class='line-number'>395</span>
<span class='line-number'>396</span>
<span class='line-number'>397</span>
<span class='line-number'>398</span>
<span class='line-number'>399</span>
<span class='line-number'>400</span>
<span class='line-number'>401</span>
<span class='line-number'>402</span>
<span class='line-number'>403</span>
<span class='line-number'>404</span>
<span class='line-number'>405</span>
<span class='line-number'>406</span>
<span class='line-number'>407</span>
<span class='line-number'>408</span>
<span class='line-number'>409</span>
<span class='line-number'>410</span>
<span class='line-number'>411</span>
<span class='line-number'>412</span>
<span class='line-number'>413</span>
<span class='line-number'>414</span>
<span class='line-number'>415</span>
<span class='line-number'>416</span>
<span class='line-number'>417</span>
<span class='line-number'>418</span>
<span class='line-number'>419</span>
<span class='line-number'>420</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">PdoMySQL</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="nv">$config</span><span class="o">=</span><span class="k">array</span><span class="p">();</span><span class="c1">//设置链接参数，配置信息</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="nv">$link</span><span class="o">=</span><span class="k">null</span><span class="p">;</span><span class="c1">//保存链接标识符</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="nv">$pconnect</span><span class="o">=</span><span class="k">false</span><span class="p">;</span><span class="c1">//是否开启长链接</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="nv">$dbVersion</span><span class="o">=</span><span class="k">null</span><span class="p">;</span><span class="c1">//保存数据库版本</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="nv">$connected</span><span class="o">=</span><span class="k">false</span><span class="p">;</span><span class="c1">//是否链接成共</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="nv">$PDOStatement</span><span class="o">=</span><span class="k">null</span><span class="p">;</span><span class="c1">//保存ＰＤＯStatement对象</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="nv">$queryStr</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span><span class="c1">//保存最后执行的操作</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="nv">$error</span><span class="o">=</span><span class="k">null</span><span class="p">;</span><span class="c1">//保存错误信息</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="nv">$lastInsertId</span><span class="o">=</span><span class="k">null</span><span class="p">;</span><span class="c1">//最后插入记录的id</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="nv">$numRows</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="c1">//保存上一步影响的行数</span>
</span><span class='line'>        <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$dbConfig</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">class_exists</span><span class="p">(</span><span class="s2">&quot;PDO&quot;</span><span class="p">)){</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="na">throw_excption</span><span class="p">(</span><span class="s2">&quot;不支持ＰＤＯ，请先开启&quot;</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$dbConfig</span><span class="p">)){</span>
</span><span class='line'>                <span class="nv">$dbConfig</span><span class="o">=</span><span class="k">array</span><span class="p">(</span>
</span><span class='line'>                    <span class="s2">&quot;hostname&quot;</span> <span class="o">=&gt;</span> <span class="nx">DB_HOST</span><span class="p">,</span>
</span><span class='line'>                    <span class="s2">&quot;username&quot;</span> <span class="o">=&gt;</span> <span class="nx">DB_USER</span><span class="p">,</span>
</span><span class='line'>                    <span class="s2">&quot;password&quot;</span> <span class="o">=&gt;</span> <span class="nx">DB_PWD</span><span class="p">,</span>
</span><span class='line'>                    <span class="s2">&quot;database&quot;</span> <span class="o">=&gt;</span> <span class="nx">DB_NAME</span><span class="p">,</span>
</span><span class='line'>                    <span class="s2">&quot;hostport&quot;</span> <span class="o">=&gt;</span> <span class="nx">DB_PORT</span><span class="p">,</span>
</span><span class='line'>                    <span class="s2">&quot;dbms&quot;</span>     <span class="o">=&gt;</span> <span class="nx">DB_TYPE</span><span class="p">,</span>
</span><span class='line'>                    <span class="s2">&quot;dsn&quot;</span> <span class="o">=&gt;</span><span class="nx">DB_TYPE</span><span class="o">.</span><span class="s2">&quot;:host=&quot;</span><span class="o">.</span><span class="nx">DB_HOST</span><span class="o">.</span><span class="s2">&quot;;dbname=&quot;</span><span class="o">.</span><span class="nx">DB_NAME</span>
</span><span class='line'>                <span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$dbConfig</span><span class="p">[</span><span class="s1">&#39;hostname&#39;</span><span class="p">]))</span><span class="nx">self</span><span class="o">::</span><span class="na">throw_excption</span><span class="p">(</span><span class="s2">&quot;没有定义数据库配置，请先定义。&quot;</span><span class="p">);</span>
</span><span class='line'>            <span class="nx">self</span><span class="o">::</span><span class="nv">$config</span><span class="o">=</span><span class="nv">$dbConfig</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$config</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]))</span><span class="nx">self</span><span class="o">::</span><span class="nv">$config</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span><span class="o">=</span><span class="k">array</span><span class="p">();</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="p">)){</span>
</span><span class='line'>                <span class="nv">$configs</span><span class="o">=</span><span class="nx">self</span><span class="o">::</span><span class="nv">$config</span><span class="p">;</span>
</span><span class='line'>                <span class="k">if</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$pconnect</span><span class="p">){</span>
</span><span class='line'>                    <span class="c1">//开启长链接，添加到配置数组中</span>
</span><span class='line'>                    <span class="nv">$configs</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="nb">constant</span><span class="p">(</span><span class="s2">&quot;PDO::ATTR_PERSISTENT&quot;</span><span class="p">)]</span><span class="o">=</span><span class="k">true</span><span class="p">;</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>                <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nv">$configs</span><span class="p">[</span><span class="s1">&#39;dsn&#39;</span><span class="p">],</span><span class="nv">$configs</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span><span class="nv">$configs</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">],</span><span class="nv">$configs</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]);</span>
</span><span class='line'>                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nx">self</span><span class="o">::</span><span class="na">throw_excption</span><span class="p">(</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">());</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>                <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="p">){</span>
</span><span class='line'>                    <span class="nx">self</span><span class="o">::</span><span class="na">throw_excption</span><span class="p">(</span><span class="s2">&quot;PDO链接错误&quot;</span><span class="p">);</span>
</span><span class='line'>                    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s1">&#39;SET NAMES&#39;</span><span class="o">.</span><span class="nx">DB_CHARSET</span><span class="p">);</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="nv">$dbVersion</span><span class="o">=</span><span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="o">-&gt;</span><span class="na">getAttribute</span><span class="p">(</span><span class="nb">constant</span><span class="p">(</span><span class="s2">&quot;PDO::ATTR_SERVER_VERSION&quot;</span><span class="p">));</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="nv">$connected</span><span class="o">=</span><span class="k">true</span><span class="p">;</span>
</span><span class='line'>                <span class="nb">unset</span><span class="p">(</span><span class="nv">$configs</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 得到所有记录</span>
</span><span class='line'><span class="sd">         * @param  [type] $sql [description]</span>
</span><span class='line'><span class="sd">         * @return [type]      [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>         <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getAll</span><span class="p">(</span><span class="nv">$sql</span><span class="o">=</span><span class="k">null</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nv">$sql</span><span class="o">!=</span><span class="k">null</span><span class="p">){</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="nv">$result</span><span class="o">=</span><span class="nx">self</span><span class="o">::</span><span class="nv">$PDOStatement</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">(</span><span class="nb">constant</span><span class="p">(</span><span class="s2">&quot;PDO::FETCH_ASSOC&quot;</span><span class="p">));</span>
</span><span class='line'>            <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 得到结果集中的一条记录</span>
</span><span class='line'><span class="sd">         * @param  [type] $sql [description]</span>
</span><span class='line'><span class="sd">         * @return [type]      [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getRow</span><span class="p">(</span><span class="nv">$sql</span><span class="o">=</span><span class="k">null</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nv">$sql</span><span class="o">!=</span><span class="k">null</span><span class="p">){</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="nv">$result</span> <span class="o">=</span><span class="nx">self</span><span class="o">::</span><span class="nv">$PDOStatement</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">(</span><span class="nb">constant</span><span class="p">(</span><span class="s2">&quot;PDO::FETCH_ASSOC&quot;</span><span class="p">));</span>
</span><span class='line'>            <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 解析字段</span>
</span><span class='line'><span class="sd">         * @param  [type] $fields [description]</span>
</span><span class='line'><span class="sd">         * @return [type]         [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span>  <span class="k">static</span> <span class="k">function</span> <span class="nf">parseFields</span><span class="p">(</span><span class="nv">$fields</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$fields</span><span class="p">)){</span>
</span><span class='line'>                    <span class="nb">array_walk</span><span class="p">(</span><span class="nv">$fields</span><span class="p">,</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;PdoMySQL&#39;</span><span class="p">,</span><span class="s1">&#39;addSpecilChar&#39;</span><span class="p">));</span>
</span><span class='line'>                    <span class="nv">$fieldsStr</span><span class="o">=</span><span class="nb">implode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="nv">$fields</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span><span class="k">elseif</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$fields</span><span class="p">)</span><span class="o">&amp;&amp;!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$fields</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">if</span><span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$fields</span><span class="p">,</span><span class="s1">&#39;`&#39;</span><span class="p">)</span><span class="o">===</span><span class="k">false</span><span class="p">){</span>
</span><span class='line'>                    <span class="nv">$fields</span><span class="o">=</span><span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="nv">$fields</span><span class="p">);</span>
</span><span class='line'>                    <span class="nb">array_walk</span><span class="p">(</span><span class="nv">$fields</span><span class="p">,</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;PdoMySQL&#39;</span><span class="p">,</span><span class="s1">&#39;addSpecilChar&#39;</span><span class="p">));</span>
</span><span class='line'>                    <span class="nv">$fieldsStr</span><span class="o">=</span><span class="nb">implode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="nv">$fields</span><span class="p">);</span>
</span><span class='line'>                <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nv">$fieldsStr</span><span class="o">=</span><span class="nv">$fields</span><span class="p">;</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$fieldsStr</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="nv">$fieldsStr</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 通过反引号引用字段，</span>
</span><span class='line'><span class="sd">         * @param [type] $value [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">addSpecilChar</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$value</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nv">$value</span><span class="o">===</span><span class="s1">&#39;*&#39;</span><span class="o">||</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">!==</span><span class="k">false</span><span class="o">||</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span><span class="s1">&#39;`&#39;</span><span class="p">)</span><span class="o">!==</span><span class="k">false</span><span class="p">){</span>
</span><span class='line'>                <span class="c1">//不用做处理</span>
</span><span class='line'>            <span class="p">}</span><span class="k">elseif</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span><span class="s1">&#39;`&#39;</span><span class="p">)</span><span class="o">===</span><span class="k">false</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="c1"># code...</span>
</span><span class='line'>                <span class="nv">$value</span><span class="o">=</span><span class="s1">&#39;`&#39;</span><span class="o">.</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;`&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="nv">$value</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 根据主键查记录</span>
</span><span class='line'><span class="sd">         * @param  [type] $tabName [description]</span>
</span><span class='line'><span class="sd">         * @param  [type] $priId   [description]</span>
</span><span class='line'><span class="sd">         * @param  string $fields  [description]</span>
</span><span class='line'><span class="sd">         * @return [type]          [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span>  <span class="k">static</span> <span class="k">function</span> <span class="nf">findById</span><span class="p">(</span><span class="nv">$tabName</span><span class="p">,</span><span class="nv">$priId</span><span class="p">,</span><span class="nv">$fields</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;SELECT %s FROM %s WHERE id =%d&quot;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">getRow</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="nv">$sql</span><span class="p">,</span><span class="nx">self</span><span class="o">::</span><span class="na">parseFields</span><span class="p">(</span><span class="nv">$fields</span><span class="p">),</span><span class="nv">$tabName</span><span class="p">,</span><span class="nv">$priId</span><span class="p">));</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 执行普通查询，</span>
</span><span class='line'><span class="sd">         * @param  [type] $tables [description]</span>
</span><span class='line'><span class="sd">         * @param  [type] $where  [description]</span>
</span><span class='line'><span class="sd">         * @param  string $fields [description]</span>
</span><span class='line'><span class="sd">         * @param  [type] $group  [description]</span>
</span><span class='line'><span class="sd">         * @param  [type] $having [description]</span>
</span><span class='line'><span class="sd">         * @param  [type] $order  [description]</span>
</span><span class='line'><span class="sd">         * @param  [type] $limit  [description]</span>
</span><span class='line'><span class="sd">         * @return [type]         [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">find</span><span class="p">(</span><span class="nv">$tables</span><span class="p">,</span><span class="nv">$where</span><span class="o">=</span><span class="k">null</span><span class="p">,</span><span class="nv">$fields</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="nv">$group</span><span class="o">=</span><span class="k">null</span><span class="p">,</span><span class="nv">$having</span><span class="o">=</span><span class="k">null</span><span class="p">,</span><span class="nv">$order</span><span class="o">=</span><span class="k">null</span><span class="p">,</span><span class="nv">$limit</span><span class="o">=</span><span class="k">null</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$sql</span><span class="o">=</span><span class="s1">&#39;SELECT &#39;</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseFields</span><span class="p">(</span><span class="nv">$fields</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39; FROM &#39;</span><span class="o">.</span><span class="nv">$tables</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseWhere</span><span class="p">(</span><span class="nv">$where</span><span class="p">)</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseGroup</span><span class="p">(</span><span class="nv">$group</span><span class="p">)</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseHaving</span><span class="p">(</span><span class="nv">$having</span><span class="p">)</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseOrder</span><span class="p">(</span><span class="nv">$order</span><span class="p">)</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseLimit</span><span class="p">(</span><span class="nv">$limit</span><span class="p">);</span>
</span><span class='line'>            <span class="nv">$dataAll</span><span class="o">=</span><span class="nx">self</span><span class="o">::</span><span class="na">getAll</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>            <span class="c1">// if(count($dataAll)==1){</span>
</span><span class='line'>            <span class="c1">//     $rlt=$dataAll[0];</span>
</span><span class='line'>            <span class="c1">// }else {</span>
</span><span class='line'>            <span class="c1">//     $rlt=$dataAll;</span>
</span><span class='line'>            <span class="c1">// }</span>
</span><span class='line'>            <span class="c1">// return $rlt;</span>
</span><span class='line'>            <span class="k">return</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$dataAll</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="o">?</span><span class="nv">$dataAll</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">:</span><span class="nv">$dataAll</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 添加记录</span>
</span><span class='line'><span class="sd">         * array(</span>
</span><span class='line'><span class="sd">         *</span>
</span><span class='line'><span class="sd">         * )</span>
</span><span class='line'><span class="sd">         * @param string $value [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">add</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span><span class="nv">$table</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$keys</span><span class="o">=</span><span class="nb">array_keys</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span><span class='line'>            <span class="nb">array_walk</span><span class="p">(</span><span class="nv">$keys</span><span class="p">,</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;PdoMySQL&#39;</span><span class="p">,</span><span class="s1">&#39;addSpecilChar&#39;</span><span class="p">));</span>
</span><span class='line'>            <span class="nv">$fieldsStr</span><span class="o">=</span><span class="nb">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="nv">$keys</span><span class="p">);</span>
</span><span class='line'>            <span class="nv">$values</span><span class="o">=</span><span class="s2">&quot;&#39;&quot;</span><span class="o">.</span><span class="nb">join</span><span class="p">(</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="p">,</span><span class="nb">array_values</span><span class="p">(</span><span class="nv">$data</span><span class="p">))</span><span class="o">.</span><span class="s2">&quot;&#39;&quot;</span><span class="p">;</span>
</span><span class='line'>            <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;INSERT </span><span class="si">{</span><span class="nv">$table</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="nv">$fieldsStr</span><span class="si">}</span><span class="s2">) VALUES(</span><span class="si">{</span><span class="nv">$values</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">execute</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 更新记录</span>
</span><span class='line'><span class="sd">         * @param  [array] $data  [description]</span>
</span><span class='line'><span class="sd">         * @param  [string] $table [description]</span>
</span><span class='line'><span class="sd">         * @param  [string] $where [description]</span>
</span><span class='line'><span class="sd">         * @param  [string] $order [description]</span>
</span><span class='line'><span class="sd">         * @param  [string] $limit [description]</span>
</span><span class='line'><span class="sd">         * @return [type]        [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span>  <span class="k">static</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span><span class="nv">$table</span><span class="p">,</span><span class="nv">$where</span><span class="o">=</span><span class="k">null</span><span class="p">,</span><span class="nv">$order</span><span class="o">=</span><span class="k">null</span><span class="p">,</span><span class="nv">$limit</span><span class="o">=</span><span class="k">null</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$data</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$set</span><span class="o">.=</span><span class="nv">$key</span><span class="o">.</span><span class="s2">&quot;=&#39;&quot;</span><span class="o">.</span><span class="nv">$value</span><span class="o">.</span><span class="s2">&quot;&#39;,&quot;</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="nv">$sets</span><span class="o">=</span><span class="nb">rtrim</span><span class="p">(</span><span class="nv">$sets</span><span class="p">,</span><span class="s1">&#39;,&#39;</span><span class="p">);</span>
</span><span class='line'>            <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;UPDATE </span><span class="si">{</span><span class="nv">$table</span><span class="si">}</span><span class="s2"> SET </span><span class="si">{</span><span class="nv">$sets</span><span class="si">}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseWhere</span><span class="p">(</span><span class="nv">$where</span><span class="p">)</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseOrder</span><span class="p">(</span><span class="nv">$order</span><span class="p">)</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseLimit</span><span class="p">(</span><span class="nv">$limit</span><span class="p">);</span>
</span><span class='line'>             <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">execute</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 删除记录</span>
</span><span class='line'><span class="sd">         * @param  [type]  $table [description]</span>
</span><span class='line'><span class="sd">         * @param  [type]  $where [description]</span>
</span><span class='line'><span class="sd">         * @param  [type]  $order [description]</span>
</span><span class='line'><span class="sd">         * @param  integer $limit [description]</span>
</span><span class='line'><span class="sd">         * @return [type]         [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">delete</span><span class="p">(</span><span class="nv">$table</span><span class="p">,</span><span class="nv">$where</span><span class="o">=</span><span class="k">null</span><span class="p">,</span><span class="nv">$order</span><span class="o">=</span><span class="k">null</span><span class="p">,</span><span class="nv">$limit</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;delete from </span><span class="si">{</span><span class="nv">$table</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseWhere</span><span class="p">(</span><span class="nv">$where</span><span class="p">)</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseOrder</span><span class="p">(</span><span class="nv">$order</span><span class="p">)</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="na">parseLimit</span><span class="p">(</span><span class="nv">$limit</span><span class="p">);</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">execute</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 得到最后执行的ＳＱＬ语句</span>
</span><span class='line'><span class="sd">         * @return [type] [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getLastSql</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$link</span><span class="o">=</span><span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$link</span><span class="p">){</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$queryStr</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 得到上一步插入操作的ＩＤ</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getLsetInsertId</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$link</span><span class="o">=</span><span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$link</span><span class="p">)</span><span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$lastInsertId</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 得到数据库版本</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getDbVersion</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$link</span><span class="o">=</span><span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$link</span><span class="p">)</span><span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$dbVersion</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 得到数据库有哪些表</span>
</span><span class='line'><span class="sd">         * @return [type] [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span>  <span class="k">static</span> <span class="k">function</span> <span class="nf">showTables</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$tables</span><span class="o">=</span><span class="k">array</span><span class="p">();</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;SHOW TABLES&#39;</span><span class="p">)){</span>
</span><span class='line'>                <span class="nv">$result</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">getAll</span><span class="p">();</span>
</span><span class='line'>                <span class="k">foreach</span> <span class="p">(</span><span class="nv">$result</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="c1"># code...</span>
</span><span class='line'>                    <span class="nv">$tables</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span><span class="o">=</span><span class="nb">current</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="nv">$tables</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 解析ｗｈｅｒｅ条件</span>
</span><span class='line'><span class="sd">         * @param  [type] $where [description]</span>
</span><span class='line'><span class="sd">         * @return [type]        [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">parseWhere</span><span class="p">(</span><span class="nv">$where</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$whereStr</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$where</span><span class="p">)</span><span class="o">&amp;&amp;!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$where</span><span class="p">)){</span>
</span><span class='line'>                <span class="nv">$whereStr</span><span class="o">=</span><span class="nv">$where</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$whereStr</span><span class="p">)</span><span class="o">?</span><span class="s1">&#39;&#39;</span><span class="o">:</span><span class="s1">&#39; WHERE &#39;</span><span class="o">.</span><span class="nv">$whereStr</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 解析分组</span>
</span><span class='line'><span class="sd">         * @param  [type] $group [description]</span>
</span><span class='line'><span class="sd">         * @return [type]        [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">parseGroup</span><span class="p">(</span><span class="nv">$group</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$groupStr</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$group</span><span class="p">)){</span>
</span><span class='line'>                <span class="nv">$groupStr</span><span class="o">.=</span><span class="s1">&#39; GROUP BY &#39;</span><span class="o">.</span><span class="nb">implode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="nv">$group</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span><span class="k">elseif</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$group</span><span class="p">)</span><span class="o">&amp;&amp;!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$group</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$groupStr</span><span class="o">.=</span><span class="s1">&#39; GROUP BY &#39;</span><span class="o">.</span><span class="nv">$group</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$groupStr</span><span class="p">)</span><span class="o">?</span><span class="s1">&#39;&#39;</span><span class="o">:</span><span class="nv">$groupStr</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 对分组结果通过Ｈａｖｉｎｇ子句进行二次删选</span>
</span><span class='line'><span class="sd">         * @param  [type] $having [description]</span>
</span><span class='line'><span class="sd">         * @return [type]         [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">parseHaving</span><span class="p">(</span><span class="nv">$having</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$havingStr</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$having</span><span class="p">)</span><span class="o">&amp;&amp;!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$having</span><span class="p">)){</span>
</span><span class='line'>                <span class="nv">$havingStr</span><span class="o">.=</span><span class="s1">&#39; HAVING &#39;</span><span class="o">.</span><span class="nv">$having</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="nv">$havingStr</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 解析order by</span>
</span><span class='line'><span class="sd">         * @param  [type] $order [description]</span>
</span><span class='line'><span class="sd">         * @return [type]        [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span>  <span class="k">static</span> <span class="k">function</span> <span class="nf">parseOrder</span><span class="p">(</span><span class="nv">$order</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$orderStr</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$order</span><span class="p">)){</span>
</span><span class='line'>                <span class="nv">$orderStr</span><span class="o">.=</span><span class="s1">&#39; ORDER BY &#39;</span><span class="o">.</span><span class="nb">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="nv">$order</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span><span class="k">elseif</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$order</span><span class="p">)</span><span class="o">&amp;&amp;!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$order</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$orderStr</span><span class="o">.=</span><span class="s1">&#39; ORDER BY &#39;</span><span class="o">.</span><span class="nv">$order</span><span class="p">;</span>
</span><span class='line'>                <span class="c1"># code...</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="nv">$orderStr</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 解析限制条数</span>
</span><span class='line'><span class="sd">         * ｌｉｍｉｔ 3</span>
</span><span class='line'><span class="sd">         * ｌｉｍｉｔ 0,3</span>
</span><span class='line'><span class="sd">         * @param  [type] $limit [description]</span>
</span><span class='line'><span class="sd">         * @return [type]        [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span>  <span class="k">static</span> <span class="k">function</span> <span class="nf">parseLimit</span><span class="p">(</span><span class="nv">$limit</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$limitStr</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$limit</span><span class="p">)){</span>
</span><span class='line'>                <span class="k">if</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$limit</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">){</span>
</span><span class='line'>                    <span class="nv">$limitStr</span><span class="o">.=</span><span class="s1">&#39; LIMIT &#39;</span><span class="o">.</span><span class="nv">$limit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="nv">$limit</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'>                <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nv">$limitStr</span><span class="o">.=</span><span class="s1">&#39; LIMIT &#39;</span><span class="o">.</span><span class="nv">$limit</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span><span class="k">elseif</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$limit</span><span class="p">)</span><span class="o">&amp;&amp;!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$limit</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$limitStr</span><span class="o">.=</span><span class="s1">&#39; LIMIT &#39;</span><span class="o">.</span><span class="nv">$limit</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="nv">$limitStr</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 执行增删改，返回受影响的条数</span>
</span><span class='line'><span class="sd">         * @param  [type] $sql [description]</span>
</span><span class='line'><span class="sd">         * @return [type]      [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">execute</span><span class="p">(</span><span class="nv">$sql</span><span class="o">=</span><span class="k">null</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$link</span><span class="o">=</span><span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$link</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>            <span class="nx">self</span><span class="o">::</span><span class="nv">$queryStr</span><span class="o">=</span><span class="nv">$sql</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$PDOStatement</span><span class="p">))</span><span class="nx">self</span><span class="o">::</span><span class="na">free</span><span class="p">();</span>
</span><span class='line'>            <span class="nv">$result</span><span class="o">=</span><span class="nv">$link</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$queryStr</span><span class="p">);</span>
</span><span class='line'>            <span class="nx">self</span><span class="o">::</span><span class="na">haveErrorThrowException</span><span class="p">();</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nv">$result</span><span class="p">){</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="nv">$lastInsertId</span><span class="o">=</span><span class="nv">$link</span><span class="o">-&gt;</span><span class="na">lastInsertId</span><span class="p">();</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="nv">$numRows</span><span class="o">=</span><span class="nv">$result</span><span class="p">;;</span>
</span><span class='line'>                <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$numRows</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         *释放结果集</span>
</span><span class='line'><span class="sd">         * @return [type] [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span>  <span class="k">static</span> <span class="k">function</span> <span class="nf">free</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nx">self</span><span class="o">::</span><span class="nv">$PDOStatement</span><span class="o">=</span><span class="k">null</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 执行ｓｑｌ语句</span>
</span><span class='line'><span class="sd">         * @param  string $sql [description]</span>
</span><span class='line'><span class="sd">         * @return [type]      [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">query</span><span class="p">(</span><span class="nv">$sql</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$link</span><span class="o">=</span><span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$link</span><span class="p">)</span><span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>            <span class="c1">//判断之前是否有结果集，如果有的话，释放结果集</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="p">))</span> <span class="nx">self</span><span class="o">::</span><span class="na">free</span><span class="p">();</span>
</span><span class='line'>            <span class="nx">self</span><span class="o">::</span><span class="nv">$queryStr</span><span class="o">=</span><span class="nv">$sql</span><span class="p">;</span>
</span><span class='line'>            <span class="nx">self</span><span class="o">::</span><span class="nv">$PDOStatement</span><span class="o">=</span><span class="nv">$link</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$queryStr</span><span class="p">);</span>
</span><span class='line'>            <span class="nv">$res</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$PDOStatement</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</span><span class='line'>            <span class="nx">self</span><span class="o">::</span><span class="na">haveErrorThrowException</span><span class="p">();</span>
</span><span class='line'>            <span class="k">return</span> <span class="nv">$res</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 如果有错误，抛出</span>
</span><span class='line'><span class="sd">         * @return [type] [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">haveErrorThrowException</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nv">$obj</span><span class="o">=</span><span class="k">empty</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$PDOStatement</span><span class="p">)</span><span class="o">?</span><span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="o">:</span><span class="nx">self</span><span class="o">::</span><span class="nv">$PDOStatement</span><span class="p">;</span>
</span><span class='line'>            <span class="nv">$arrError</span><span class="o">=</span><span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">errorInfo</span><span class="p">();</span>
</span><span class='line'>            <span class="c1">// print_r($arrError);</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nv">$arrError</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;00000&#39;</span><span class="p">){</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="nv">$error</span><span class="o">=</span><span class="s2">&quot;SQLSTATE&quot;</span><span class="o">.</span><span class="nv">$arrError</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;SQL Error&quot;</span><span class="o">.</span><span class="nv">$arrError</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;&lt;br/&gt;Error SQL&quot;</span><span class="o">.</span><span class="nx">self</span><span class="o">::</span><span class="nv">$queryStr</span><span class="p">;</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="na">throw_excption</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$error</span><span class="p">);</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$queryStr</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">){</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="na">throw_excption</span><span class="p">(</span><span class="s1">&#39;没有执行的ＳＱＬ语句&#39;</span><span class="p">);</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 自定义错误处理</span>
</span><span class='line'><span class="sd">         * @param  [type] $errMsg [description]</span>
</span><span class='line'><span class="sd">         * @return [type]         [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">function</span> <span class="nf">throw_excption</span><span class="p">(</span><span class="nv">$errMsg</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">echo</span> <span class="s2">&quot;&lt;div style=&#39;width:80%;background-color:#ABCDEF;colod:black;font-size:20px;padding:20px 0px;&#39;&gt;</span>
</span><span class='line'><span class="s2">            &quot;</span><span class="o">.</span><span class="nv">$errMsg</span><span class="o">.</span><span class="s2">&quot;</span>
</span><span class='line'><span class="s2">            &lt;/div&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="sd">/**</span>
</span><span class='line'><span class="sd">         * 销毁链接对象，关闭数据库。</span>
</span><span class='line'><span class="sd">         * @return [type] [description]</span>
</span><span class='line'><span class="sd">         */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">close</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nx">self</span><span class="o">::</span><span class="nv">$link</span><span class="o">=</span><span class="k">null</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="k">require_once</span><span class="s2">&quot;config.php&quot;</span><span class="p">;</span>
</span><span class='line'><span class="c1">// $PdoMySQL=new PdoMySQL;</span>
</span><span class='line'><span class="c1">// // var_dump($PdoMySQL);</span>
</span><span class='line'><span class="c1">// // $sql=&quot;insert user (username,password,email) values(&#39;reane23&#39;,&#39;sdf&#39;,&#39;sdf&#39;)&quot;;</span>
</span><span class='line'><span class="c1">// $tables=&#39;user&#39;;</span>
</span><span class='line'><span class="c1">// $res=$PdoMySQL-&gt;find($tables,&#39;id&gt;=19&#39;,&#39;*&#39;,null,null,null,&#39;3&#39;);</span>
</span><span class='line'><span class="c1">// var_dump($res);</span>
</span><span class='line'><span class="c1">// echo $PdoMySQL::$lastInsertId;</span>
</span><span class='line'><span class="c1">// print_r($res);</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span>config.php</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s2">&quot;DB_HOST&quot;</span><span class="p">,</span><span class="s2">&quot;localhost&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s2">&quot;DB_USER&quot;</span><span class="p">,</span><span class="s2">&quot;root&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s2">&quot;DB_PWD&quot;</span><span class="p">,</span><span class="s2">&quot;123456&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s2">&quot;DB_NAME&quot;</span><span class="p">,</span><span class="s2">&quot;test&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s2">&quot;DB_PORT&quot;</span><span class="p">,</span><span class="s2">&quot;3306&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s2">&quot;DB_TYPE&quot;</span><span class="p">,</span><span class="s2">&quot;mysql&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s2">&quot;DB_CHARSET&quot;</span><span class="p">,</span><span class="s2">&quot;utf8&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>

</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	
	 
  <!-- JiaThis Button BEGIN -->
<div class="jiathis_style_32x32">
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_tqq"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_renren"></a>
	<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->
  
</div>



  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="/blog/2016/05/19/learn-more-pdo" data-title="Learn-more-PDO" data-url="http://ewanreton.github.io/blog/2016/05/19/learn-more-pdo/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"ewanreton"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end --></div>
  </section>
</div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2016

    Ewan Reton


Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
		</div>
	</div>
	






<!--
-->


</body>
</html>
