
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>PHP无限级分类 - Blog Like A Hacker</title>
	<meta name="author" content="Ewan Reton">

	
	<meta name="description" content="PHP无限级分类主要有两种实现方式，通过递归和全路径实现 一、递归实现 在数据库中存储如下格式的表： ID
pid
catename
cateorder
createtime 1
0
新闻
0
0 2
0
图片
0
0 3
1
国内新闻
0
0 4
1
国际新闻
0
0 5
3
北京新闻
0
0 &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Blog Like A Hacker" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//libs.baidu.com/jquery/1.9.1/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Blog Like A Hacker</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/aboutme">About Me</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/aboutme">About Me</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.baidu.com" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:ewanreton.github.io">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="https://www.baidu.com" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:ewanreton.github.io">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">PHP无限级分类</h2>
	<div class="entry-content"><blockquote><p>PHP无限级分类主要有两种实现方式，通过递归和全路径实现</p></blockquote>

<h1>一、递归实现</h1>

<pre><code>在数据库中存储如下格式的表：
</code></pre>

<table>
<thead>
<tr>
<th>ID</th>
<th style="text-align:center;">pid</th>
<th style="text-align:center;">catename</th>
<th style="text-align:center;">cateorder</th>
<th style="text-align:right;">createtime</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td style="text-align:center;">0</td>
<td style="text-align:center;">新闻</td>
<td style="text-align:center;">0</td>
<td style="text-align:right;">0</td>
</tr>
<tr>
<td>2</td>
<td style="text-align:center;">0</td>
<td style="text-align:center;">图片</td>
<td style="text-align:center;">0</td>
<td style="text-align:right;">0</td>
</tr>
<tr>
<td>3</td>
<td style="text-align:center;">1</td>
<td style="text-align:center;">国内新闻</td>
<td style="text-align:center;">0</td>
<td style="text-align:right;">0</td>
</tr>
<tr>
<td>4</td>
<td style="text-align:center;">1</td>
<td style="text-align:center;">国际新闻</td>
<td style="text-align:center;">0</td>
<td style="text-align:right;">0</td>
</tr>
<tr>
<td>5</td>
<td style="text-align:center;">3</td>
<td style="text-align:center;">北京新闻</td>
<td style="text-align:center;">0</td>
<td style="text-align:right;">0</td>
</tr>
<tr>
<td>6</td>
<td style="text-align:center;">4</td>
<td style="text-align:center;">美国新闻</td>
<td style="text-align:center;">0</td>
<td style="text-align:right;">0</td>
</tr>
<tr>
<td>7</td>
<td style="text-align:center;">2</td>
<td style="text-align:center;">美女图片</td>
<td style="text-align:center;">0</td>
<td style="text-align:right;">0</td>
</tr>
<tr>
<td>8</td>
<td style="text-align:center;">2</td>
<td style="text-align:center;">风景图片</td>
<td style="text-align:center;">0</td>
<td style="text-align:right;">0</td>
</tr>
</tbody>
</table>


<p>···
create table deepcate
(
id int(10) unsigned not null  auto_increment primary key,
pid int(11) unsigned    not null,
catename    varchar(30) not null,
cateorder   int(11) unsigned    default 0,
createtime  int(10) not null
);</p>

<p>insert into deepcate(pid,catename,cateorder,createtime)values(0,&lsquo;新闻&rsquo;,0,0);
insert into deepcate(pid,catename,cateorder,createtime)values(0,&lsquo;图片&rsquo;,0,0);
insert into deepcate(pid,catename,cateorder,createtime)values(1,&lsquo;国内新闻&rsquo;,0,0);
insert into deepcate(pid,catename,cateorder,createtime)values(1,&lsquo;国际新闻&rsquo;,0,0);
insert into deepcate(pid,catename,cateorder,createtime)values(3,&lsquo;北京新闻&rsquo;,0,0);
insert into deepcate(pid,catename,cateorder,createtime)values(4,&lsquo;美国新闻&rsquo;,0,0);
insert into deepcate(pid,catename,cateorder,createtime)values(2,&lsquo;美女图片&rsquo;,0,0);
insert into deepcate(pid,catename,cateorder,createtime)values(2,&lsquo;风景图片&rsquo;,0,0);
insert into deepcate(pid,catename,cateorder,createtime)values(7,&lsquo;日韩明星&rsquo;,0,0);
insert into deepcate(pid,catename,cateorder,createtime)values(9,&lsquo;日本AV&rsquo;,0,0);</p>

<p>select * from deepcate;
···</p>

<blockquote><p>php 代码实现</p></blockquote>

<p>···
&lt;?php
header(&ldquo;Content-Type:text/html;Charset=UTF-8&rdquo;);
// php无限分类下拉列表的代码实现
include_once(&lsquo;db.inc.php&rsquo;) ;</p>

<p>function getList($pid=0,&amp;$result=array(),$spac=0)
{
    $spac=$spac+2;
    $sql=&ldquo; SELECT * FROM deepcate WHERE pid=$pid &rdquo;;
    $res=mysql_query($sql);</p>

<pre><code>while($row=mysql_fetch_assoc($res)){
    $row['catename']=str_repeat('&amp;nbsp;&amp;nbsp;',$spac).'|--'.$row['catename'];
    $result[]=$row;
    getList($row['id'],$result,$spac);
}
return $result;
</code></pre>

<p>}</p>

<p>function displayCate($pid=0,$selected=0){
     $rs=getList($pid);
     $str=&ldquo;&rdquo;;
     $str.=&ldquo;<select name='cate'>&rdquo;;
    foreach($rs as $v){
        if($v[&lsquo;id&rsquo;]==$selected){
            $selected=&ldquo;selected&rdquo;;
        }
       $str.=&ldquo;<option {$selected}>&rdquo;;
       $str.= $v[&lsquo;catename&rsquo;];
       $str.= &ldquo;</option>&rdquo;;
    }
    return $str.= &ldquo;</select>&rdquo;;
}</p>

<p>echo displayCate();</p>

<p>echo &ldquo;<hr/><hr/>&rdquo;;
function getCatePath($cid,&amp;$result){
    $sql=&ldquo;SELECT * FROM deepcate WHERE id=$cid &rdquo;;
    $rs=mysql_query($sql);
    $row=mysql_fetch_assoc($rs);
    if($row){
        $result[]=$row;
        getCatePath($row[&lsquo;pid&rsquo;],$result);
    }
    krsort($result);
    return $result;
}</p>

<p>function displayCatePath($cid,$url=&ldquo;deepcate.php?cid=&rdquo;){
    $res=getCatePath($cid,$result);
    $str=&ldquo;&rdquo;;
    foreach($res as $v){
        $str.= &ldquo;<a href='{$url}{$v['id']}'>{$v[&lsquo;catename&rsquo;]}</a>>>&rdquo;;
    }return $str;
}</p>

<p>echo displayCatePath(10);
···</p>

<h1>二、全路径实现</h1>

<p>···
use imooc;
create table    likecate
(
id  int(11) not null  auto_increment primary key,
path    varchar(200)    not null,
catename    varchar(30) not null,
cateorder   int(11) not null    default 0,
createtime  int(11) not null
);</p>

<p>insert into likecate(path,catename,cateorder,createtime)values(&lsquo;&rsquo;,&lsquo;手机&rsquo;,0,0);
insert into likecate(path,catename,cateorder,createtime)values(&lsquo;1&rsquo;,&lsquo;功能手机&rsquo;,0,0);
insert into likecate(path,catename,cateorder,createtime)values(&lsquo;1,2&rsquo;,&lsquo;老人手机&rsquo;,0,0);
insert into likecate(path,catename,cateorder,createtime)values(&lsquo;1,2&rsquo;,&lsquo;儿童手机&rsquo;,0,0);
insert into likecate(path,catename,cateorder,createtime)values(&lsquo;1&rsquo;,&lsquo;智能手机&rsquo;,0,0);
insert into likecate(path,catename,cateorder,createtime)values(&lsquo;1,5&rsquo;,&lsquo;andriod手机&rsquo;,0,0);
insert into likecate(path,catename,cateorder,createtime)values(&lsquo;1,5&rsquo;,&lsquo;ios手机&rsquo;,0,0);
insert into likecate(path,catename,cateorder,createtime)values(&lsquo;1,5&rsquo;,&lsquo;winphoto手机&rsquo;,0,0);
insert into likecate(path,catename,cateorder,createtime)values(&lsquo;1,2,4&rsquo;,&lsquo;色盲手机&rsquo;,0,0);
insert into likecate(path,catename,cateorder,createtime)values(&lsquo;1,2,3&rsquo;,&lsquo;大字手机&rsquo;,0,0);</p>

<p>select * from likecate;</p>

<p>select id,catename,path,concat(path,&lsquo;,&rsquo;,id) as fullpath from likecate where 1 order by fullpath asc;</p>

<h1>结果显示如图</h1>

<p>+&mdash;-+&mdash;&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;-+&mdash;&mdash;&mdash;-+
| id | catename     | path  | fullpath |
+&mdash;-+&mdash;&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;-+&mdash;&mdash;&mdash;-+
|  1 | 手机         |       | ,1       |
|  2 | 功能手机     | 1     | 1,2      |
|  3 | 老人手机     | 1,2   | 1,2,3    |
| 10 | 大字手机     | 1,2,3 | 1,2,3,10 |
|  4 | 儿童手机     | 1,2   | 1,2,4    |
|  9 | 色盲手机     | 1,2,4 | 1,2,4,9  |
|  5 | 智能手机     | 1     | 1,5      |
|  6 | andriod手机  | 1,5   | 1,5,6    |
|  7 | ios手机      | 1,5   | 1,5,7    |
|  8 | winphoto手机 | 1,5   | 1,5,8    |
+&mdash;-+&mdash;&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;-+&mdash;&mdash;&mdash;-+
···</p>

<blockquote><p>php代码实现</p></blockquote>

<p>···
&lt;?php
header(&ldquo;Content-Type:text/html;Charset=UTF-8&rdquo;);
//递归无限分类原理
include_once (&lsquo;db.inc.php&rsquo;);</p>

<p>function likecate(){
    $sql=&ldquo;select id,catename,path,concat(path,&lsquo;,&rsquo;,id) as fullpath from likecate where 1 order by fullpath asc&rdquo;;
    $res=mysql_query($sql);
    $result=array();
    while($row=mysql_fetch_assoc($res)){
        $deep=count(explode(&lsquo;,&rsquo;,trim($row[&lsquo;fullpath&rsquo;],&lsquo;,&rsquo;)));</p>

<pre><code>    $row['catename']=str_repeat('&amp;nbsp;&amp;nbsp;',$deep*4).'|--'.$row['catename'];
    $result[]=$row;
}
return $result;
</code></pre>

<p>}</p>

<p>$res=likecate();
echo &ldquo;<select name='cate'>&rdquo;;
foreach($res as $v){
    echo &ldquo;<option>{$v[&lsquo;catename&rsquo;]}</option>&rdquo;;
}
echo &ldquo;</select>&rdquo;;</p>

<p>echo &ldquo;<hr/><hr/>&rdquo;;
function getPathCate($cateid){
    $sql=&ldquo;select *,concat(path,&lsquo;,&rsquo;,id)fullpath from likecate where id=$cateid&rdquo;;
    $res=mysql_query($sql);
    $row=mysql_fetch_assoc($res);
    $ids=$row[&lsquo;fullpath&rsquo;];
    $sql=&ldquo;select * from likecate where id in($ids) order by id asc&rdquo;;
    $res=mysql_query($sql);
    $result=array();
    while($row=mysql_fetch_assoc($res)){
        $result[]=$row;
    }
    return $result;
}</p>

<p>function displayCatePath($cateid,$link=&lsquo;likecate.php?cid=&rsquo;){
    $res=getPathCate($cateid);
    $str=&ldquo;&rdquo;;
    foreach($res as $v){
        $str.=&ldquo;<a href='{$link}'>{$v[&lsquo;catename&rsquo;]}</a>>&rdquo;;
    }
    return $str;
}</p>

<p>echo displayCatePath(4,&lsquo;likecate.php?p=1&amp;cid=&rsquo;);
···</p>
</div>


<div class="meta">
	<div class="date">




Apr 29th, 2016</div>
	<div class="tags">


	<a class='category' href='/blog/categories/php/'>php</a>


</div>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		
		
		
	</div>
	
	
   <!-- JiaThis Button BEGIN -->
<div class="jiathis_style_32x32">
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_tqq"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_renren"></a>
	<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->
  
</div>



<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="/blog/2016/04/29/wu-xian-ji-fen-lei" data-title="PHP无限级分类" data-url="http://ewanreton.github.io/blog/2016/04/29/wu-xian-ji-fen-lei/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"ewanreton"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end --></div>
</section>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2016

    Ewan Reton

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>