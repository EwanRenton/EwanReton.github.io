<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: php | Ewan Reton]]></title>
  <link href="http://ewanreton.github.io/blog/categories/php/atom.xml" rel="self"/>
  <link href="http://ewanreton.github.io/"/>
  <updated>2016-06-06T10:43:05+08:00</updated>
  <id>http://ewanreton.github.io/</id>
  <author>
    <name><![CDATA[Ewan Reton]]></name>
    <email><![CDATA[liukedi001@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[PHP设计模式(三)-策略模式]]></title>
    <link href="http://ewanreton.github.io/blog/2016/06/06/php-design-3/"/>
    <updated>2016-06-06T10:32:22+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/06/06/php-design-3</id>
    <content type="html"><![CDATA[<blockquote><p>在之前学习了PHP设计模式中的工厂模式，单例模式，注册树模式，适配器模式。今天来学习一下策略模式。</p></blockquote>

<h1>一、策略模式概念</h1>

<p>策略模式针对一组算法，将每一个算法封装到具有共同接口的独立的类中,此模式让算法的变化独立于使用算法的客户。从而让程序结构更灵活，具有更好的扩展性和维护性。</p>

<p>策略模式:定义了算法族,分别封装起来，让它们之间可以互相替换，此模式让算法的变化独立于使用算法的客户。</p>

<p>封装:把行为用接口封装起来，我们可以把那些经常变化的部分，从当前的类中单独取出来，用接口进行单独的封装。
互相替换:我们封装好了接口，通过指定不同的接口实现类进行算法的变化。</p>

<h1>二、策略模式结构图</h1>

<p><img src="http://www.phpddt.com/usr/uploads/2014/01/2390999757.jpg" alt="" /></p>

<h1>三、策略模式角色说明</h1>

<p> 抽象策略(Strategy）角色：定义所有支持的算法的公共接口。通常是以一个接口或抽象来实现。Context使用这个接口来调用其ConcreteStrategy定义的算法。</p>

<p>具体策略(ConcreteStrategy)角色：以Strategy接口实现某具体算法</p>

<p>环境(Context)角色：持有一个Strategy类的引用，用一个ConcreteStrategy对象来配置</p>

<h1>四、实例一</h1>

<p>比如说购物车系统，在给商品计算总价的时候，普通会员肯定是商品单价乘以数量，但是对中级会员提供8者折扣，对高级会员提供7折折扣，这种场景就可以使用策略模式实现：</p>

<pre><code class="php">/**
 * 策略模式实例
 * 
 */
//抽象策略角色《为接口或者抽象类，给具体策略类继承》
interface Strategy
{
    public function computePrice($price);
}

//具体策略角色-普通会员策略类
class GenernalMember implements Strategy
{
    public function computePrice($price)
    {
        return $price;
    }
}

//具体策略角色-中级会员策略类
class MiddleMember implements Strategy
{
    public function computePrice($price)
    {
        return $price * 0.8;
    }
}

//具体策略角色-高级会员策略类
class HignMember implements Strategy
{
    public function computePrice($price)
    {
        return $price * 0.7;
    }
}

//环境角色实现类
class Price 
{
    //具体策略对象
    private $strategyInstance;

    //构造函数
    public function __construct($instance)
    {
        $this-&gt;strategyInstance = $instance;
    }

    public function compute($price)
    {
        return $this-&gt;strategyInstance-&gt;computePrice($price);
    }
}

//客户端使用
$p = new Price(new HignMember());

$totalPrice = $p-&gt;compute(100);

echo $totalPrice; //70
</code></pre>

<h1>实例二</h1>

<p><img src="http://pic002.cnblogs.com/images/2012/152332/2012022715404617.png" alt="" /></p>

<p>我来解释下这个思维导图的过程：
1.Joe做了一套相当成功的模拟鸭子的游戏。设计了一个超类Duck,然后让各种鸭子继承这个类。</p>

<p>2.后来客户提出要让鸭子有飞的能力。所以Joe就在超类中加了个fly()方法，这样下面的子类都有飞行的行为。</p>

<p> 问题来了：</p>

<ul>
<li>原来Duck的子类中竟然有橡皮鸭，橡皮鸭是不会飞的。——Joe用重载的方式，把橡皮鸭的fly()方法设置为空.</li>
<li>覆盖fly()，我们看到了橡皮鸭的fly()里，没有任何代码，如果以后我们再添加别的不会飞的鸭子，那我么还要这么处理吗?——那么代码重复了!</li>
</ul>


<p>3.上面2的方式我们知道是有问题的，所以Joe想到把Duck做成接口，这样每个子类必须实现Duck里的方法。这样就保证每个鸭子都能根据自己的需要添加行为。</p>

<p>问题来了：</p>

<ul>
<li>产品经常处于更新中，规格也在不断的变化。导致每当有新鸭子的时候，Joe就要被迫检查一遍子类是否覆盖了fly()方法。——当你修改某个行为的时候，你必须得往下追踪并在每一个定义此行为的类中修改它。</li>
</ul>


<p>4.综合以上问题，Joe想到了把那些变化的部分从不变化的位置中抽出来。比如，我们对fly()行为，做了单独的接口FlyBehavior。如果鸭子想要飞行功能的时候，我们就让鸭子实现FlyBehavior.</p>

<p>5.深造:我们想让鸭子有不同的飞行功能，让它在运行时候做不同的飞行动作。让鸭子类实现接口，只能让鸭子有一种行为。</p>

<p>所以Joe，想到用组合的防止，当鸭子需要其他飞行功能要求的时候，我们可以用setBehavior()方式，指定性的飞行方式。</p>

<pre><code class="php">interface FlyBehavior{
    public function fly();
}

class FlyWithWings implements FlyBehavior{
    public function fly(){
        echo "Fly With Wings \n";
    }
}

class FlyWithNo implements FlyBehavior{
    public function fly(){
        echo "Fly With No Wings \n";
    }
}
class Duck{
    private $_flyBehavior;
    public function performFly(){
        $this-&gt;_flyBehavior-&gt;fly();
    }

    public function setFlyBehavior(FlyBehavior $behavior){
        $this-&gt;_flyBehavior = $behavior;
    }
}

class RubberDuck extends Duck{
}
// Test Case
$duck = new RubberDuck();

/*  想让鸭子用翅膀飞行 */
$duck-&gt;setFlyBehavior(new FlyWithWings());
$duck-&gt;performFly();            

/*  想让鸭子不用翅膀飞行 */
$duck-&gt;setFlyBehavior(new FlyWithNo());
$duck-&gt;performFly();
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PHP设计模式(二)-适配器模式]]></title>
    <link href="http://ewanreton.github.io/blog/2016/06/04/php-design-2/"/>
    <updated>2016-06-04T12:21:09+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/06/04/php-design-2</id>
    <content type="html"><![CDATA[<h1>适配器模式</h1>

<ol>
<li>适配器模式，可将一个类的接口转换成客户希望的另外一个接口，使得原本不兼容的接口能够一起工作。通俗的理解就是将不同接口适配成统一的API接口。</li>
<li>实际应用举例，PHP的数据库操作有mysql，mysqli，pdo3种，可以用适配器模式改成统一致的，类似的还有cache适配器，将memcache，redis，file，apc等不同的缓存函数，统一成一致的。</li>
</ol>


<p>角色：</p>

<ul>
<li>Target适配目标，该角色定义把其他类转换为何种接口，也就是我们的期望接口。</li>
<li>Adaptee被适配者，就是需要被适配的接口。</li>
<li>Adapter适配器，其他的两个角色都是已经存在的角色，而适配器角色是需要新建立的，它用来对Adaptee与Target接口进行适配。</li>
</ul>


<p>优势：</p>

<p>被适配者通过适配器完成对适配目标的适配，以达到对客户使用透明的目的。</p>

<pre><code class="php">//适配目标，规定的接口将被适配对象实现
interface IDatabase
{
    public function connect($host, $username, $password, $database);
    public function query($sql);
}
 
//适配器
class Mysql implements IDatabase
{
    protected $connect;
 
    public function connect($host, $username, $password, $database)
    {
        $connect = mysql_connect($host, $username, $password);
        mysql_select_db($database, $connect);
        $this-&gt;connect = $connect;
        //...
    }
 
    public function query($sql)
    {
        //...
    }
}
 
//适配器
class Postgresql implements IDatabase
{
    protected $connect;
 
    public function connect($host, $username, $password, $database)
    {
        $this-&gt;connect = pg_connect("host=$host dbname=$database user=$username password=$password");
        //...
    }
 
    public function query($sql)
    {
        //...
    }
}
 
 
//客户端使用
$client = new Postgresql();
$client-&gt;query($sql);
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[php加密]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/24/php-jia-mi/"/>
    <updated>2016-05-24T10:38:59+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/24/php-jia-mi</id>
    <content type="html"><![CDATA[<h1>PHP中几种常见的加密方式</h1>

<ul>
<li>Md5()加密算法</li>
<li>Crypt()加密算法</li>
<li>Sha1()加密算法</li>
<li>URL编码加密</li>
<li>Base64编码加密</li>
</ul>


<hr />

<!--more-->


<p><strong>MD5()</strong></p>

<ul>
<li>单向加密算法，不可逆</li>
</ul>


<pre><code class="php">string md5(string $str[,bool $raw=output = false])
</code></pre>

<p>单向加密，不可逆</p>

<p>$str:原始字符串</p>

<p>$raw_output：一般不用，如果被设置为true，那么md5报文摘要将以16字节长度的原始二进制格式返回。否则返回以32为字符十六进制数字形式返回散列值。
使用过程中最好使用多次md5</p>

<pre><code class="php">$str='EwanReton';
$code=md5(md5($str,true));
</code></pre>

<p><strong>Crypt()</strong></p>

<ul>
<li>单向加密算法，不可逆</li>
</ul>


<pre><code class="php">string crypt(string $str[,string $salt])
</code></pre>

<p>$str:需要加密的字符串</p>

<p>$salt：盐值。加密时的干扰串，使编码更安全 DES算法标准长度为2 MD5为12
若没有传$salt 将随机生成 否则每次刷新密文不变</p>

<pre><code class="php">crypt('EwanReton','ly');//EDS根据盐值的长度自动选用
输出:lyxxxxxxxxx
crypt('EwanReton','$1$ly6661$');//MD5盐值的格式 最多12位
输出：$1$ly6661$xxxxxxx
</code></pre>

<p>当盐值超过了长度限制会截取相应长度，如EDS中<code>test</code>
会截取成<code>te</code></p>

<p><strong>Sha1()</strong></p>

<ul>
<li>单向加密算法，不可逆</li>
</ul>


<pre><code class="php">string sha1(string $str[,bool $raw=output = false])
</code></pre>

<p>和md5类似使用也和md5类似多次sha1</p>

<p>$str:原始字符串</p>

<p>$raw_output：一般不用，如果被设置为true，那么sha1摘要将以20字节长度的原始二进制格式返回。否则返回以40为字符十六进制数字形式返回散列值。</p>

<p><strong>URL编码加密</strong></p>

<ul>
<li>urlencode(string $str) //编码字符串</li>
<li>urldecode(string $str) //解码</li>
<li>rawurlencode(string $str) //按照RFC1738进行编码

<ul>
<li>解码也可以用urldecode(string $str)</li>
</ul>
</li>
<li>rawurldecode(string $str)</li>
</ul>


<p>编码规范：除了<code>-_.</code>之外所有非字母数字字符都被替换成百分号（%）后跟两位十六进制数，空格则编码为加号（+）</p>

<pre><code class="php">$str='Ewan Reton';
echo urlencode($str);
echo "&lt;hr/&gt;";
$str="Ewan Reton.php?act=test";
echo urlencode($str);
</code></pre>

<p>输出</p>

<pre class="prettyprint linenums">
Ewan+Reton
Ewan+Reton.php%3Fact%3Dtest
</pre>


<p>常见的编码：</p>

<pre class="prettyprint linenums">
? %3F
= %3D
空格 + 按照RFC1738进行编码 为%20
% %25
& %26
\ %5C
+ %2B
</pre>


<p>应用：</p>

<hr />

<p>在使用<code>get</code>方式传值时格式为<code>?key1=vaule&amp;key2=value2</code></p>

<p>但是当我们<code>key1</code>的<code>value</code>为<code>Ewan&amp;Reton</code>在解析时会把Reton也解析成一个传的变量并且值为<code>null</code></p>

<p>为了解决这个问题可以这样处理:</p>

<pre><code class="php">$value="Ewan&amp;Reton";
$str="key1=".urlcode($value)."&amp;key2=value2";
echo "&lt;a href="test.php?'{$str}'&gt;test&lt;/a&gt;";
</code></pre>

<p>注意：</p>

<p>这里不需要解码，在识别时会自动识别成<code>key1=Ewan&amp;Reton&amp;key2=value2</code></p>

<hr />

<p><strong>base64编码加密</strong></p>

<ul>
<li>base64_encode(string $data)</li>
<li>base64_decode(string $data[,bool $strict=false])

<ul>
<li>//如果输出的数据超出了base64字母表则返回false</li>
</ul>
</li>
</ul>


<p>将任何2进制字符编码到一个可打印的64字符中，中文和图片都可编码。解决早起邮件网关只能识别ASCII。</p>

<p>主要作用将非ASCII码的数据转换成ASCII，其实是一个数据编码并算不上加密算法。</p>

<h1>加密技术分类</h1>

<p><strong>单向散列加密</strong></p>

<p>通过对不同输入长度的信息进行散列计算，得到固定长度的输出，这个散列计算过程是单向的，即不能通过输出反推输入。</p>

<p><strong>对称加密技术</strong></p>

<p>加密和解密使用的密钥是同一个密钥或者可以相互推算。</p>

<p><strong>非对称加密技术</strong></p>

<p>加密和解密使用的密钥不是同一个，其中一个对外公开，被称为公钥，另一个只有拥有者知道。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PDO实例-发送邮件激活账户]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/22/pdo-shi-li/"/>
    <updated>2016-05-22T16:07:33+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/22/pdo-shi-li</id>
    <content type="html"><![CDATA[<blockquote><p>实现注册发送邮件激活账户</p>

<p>使用swiftmailer-master发送邮件</p></blockquote>

<!--more-->


<p>核心代码:
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">content</span><span class="o">-</span><span class="nx">type</span><span class="o">:</span><span class="nx">text</span><span class="o">/</span><span class="nx">html</span><span class="p">;</span><span class="nx">charset</span><span class="o">=</span><span class="nx">utf</span><span class="o">-</span><span class="mi">8</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;);</span>
</span><span class='line'><span class="c1">//1.包含所需文件</span>
</span><span class='line'><span class="k">require_once</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">swiftmailer</span><span class="o">-</span><span class="nx">master</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">swift_required</span><span class="o">.</span><span class="nx">php</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'><span class="k">require_once</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">PdoMySQL</span><span class="o">.</span><span class="nx">class</span><span class="o">.</span><span class="nx">php</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'><span class="k">require_once</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">config</span><span class="o">.</span><span class="nx">php</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'><span class="k">require_once</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">pwd</span><span class="o">.</span><span class="nx">php</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'><span class="c1">//2.接收信息</span>
</span><span class='line'><span class="nv">$act</span><span class="o">=</span><span class="err">$</span><span class="o">&lt;</span><span class="nx">em</span><span class="o">&gt;</span><span class="nx">GET</span><span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">act</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;];</span>
</span><span class='line'><span class="nv">$username</span><span class="o">=</span><span class="nb">addslashes</span><span class="p">(</span><span class="err">$</span><span class="o">&lt;/</span><span class="nx">em</span><span class="o">&gt;</span><span class="nx">POST</span><span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">username</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;]);</span>
</span><span class='line'><span class="nv">$password</span><span class="o">=</span><span class="nb">md5</span><span class="p">(</span><span class="err">$</span><span class="o">&lt;</span><span class="nx">em</span><span class="o">&gt;</span><span class="nx">POST</span><span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">password</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;]);</span>
</span><span class='line'><span class="nv">$email</span><span class="o">=</span><span class="err">$</span><span class="o">&lt;/</span><span class="nx">em</span><span class="o">&gt;</span><span class="nx">POST</span><span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">email</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;];</span>
</span><span class='line'><span class="nv">$table</span><span class="o">=&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">user</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'><span class="c1">//3.得到连接对象</span>
</span><span class='line'><span class="nv">$PdoMySQL</span><span class="o">=</span><span class="k">new</span> <span class="nx">PdoMySQL</span><span class="p">();</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="nv">$act</span><span class="o">===&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">reg</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;){</span>
</span><span class='line'>    <span class="nv">$regtime</span><span class="o">=</span><span class="nb">time</span><span class="p">();</span>
</span><span class='line'>    <span class="c1">//完成注册的功能</span>
</span><span class='line'>    <span class="nv">$token</span><span class="o">=</span><span class="nb">md5</span><span class="p">(</span><span class="nv">$username</span><span class="o">.</span><span class="nv">$password</span><span class="o">.</span><span class="nv">$regtime</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$token_exptime</span><span class="o">=</span><span class="nv">$regtime</span><span class="o">+</span><span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="p">;</span><span class="c1">//过期时间</span>
</span><span class='line'>    <span class="nv">$data</span><span class="o">=</span><span class="nb">compact</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">username</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">password</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">email</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">token</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">token_exptime</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">regtime</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;);</span>
</span><span class='line'>    <span class="nv">$res</span><span class="o">=</span><span class="nv">$PdoMySQL</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$table</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$lastInsertId</span><span class="o">=</span><span class="nv">$PdoMySQL</span><span class="o">-&gt;</span><span class="na">getLastInsertId</span><span class="p">();</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="nv">$res</span><span class="p">){</span>
</span><span class='line'>        <span class="c1">//发送邮件，以QQ邮箱为例</span>
</span><span class='line'>        <span class="c1">//配置邮件服务器，得到传输对象</span>
</span><span class='line'>        <span class="nv">$transport</span><span class="o">=</span><span class="nx">Swift_SmtpTransport</span><span class="o">::</span><span class="na">newInstance</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">smtp</span><span class="o">.</span><span class="nx">qq</span><span class="o">.</span><span class="nx">com</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span><span class="mi">25</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">//设置登陆帐号和密码</span>
</span><span class='line'>        <span class="nv">$transport</span><span class="o">-&gt;</span><span class="na">setUsername</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#97;&amp;#105;&amp;#x6c;&amp;#116;&amp;#x6f;&amp;#58;&amp;#120;&amp;#x78;&amp;#120;&amp;#x78;&amp;#120;&amp;#120;&amp;#120;&amp;#120;&amp;#x78;&amp;#64;&amp;#113;&amp;#113;&amp;#x2e;&amp;#x63;&amp;#x6f;&amp;#109;&quot;</span><span class="o">&gt;&amp;</span><span class="c1">#120;&amp;#120;&amp;#x78;&amp;#x78;&amp;#x78;&amp;#x78;&amp;#x78;&amp;#120;&amp;#120;&amp;#64;&amp;#x71;&amp;#x71;&amp;#46;&amp;#x63;&amp;#111;&amp;#109;&lt;/a&gt;&amp;rsquo;);</span>
</span><span class='line'>        <span class="nv">$transport</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$emailPassword</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">//得到发送邮件对象Swift_Mailer对象</span>
</span><span class='line'>        <span class="nv">$mailer</span><span class="o">=</span><span class="nx">Swift_Mailer</span><span class="o">::</span><span class="na">newInstance</span><span class="p">(</span><span class="nv">$transport</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">//得到邮件信息对象</span>
</span><span class='line'>        <span class="nv">$message</span><span class="o">=</span><span class="nx">Swift_Message</span><span class="o">::</span><span class="na">newInstance</span><span class="p">();</span>
</span><span class='line'>        <span class="c1">//设置管理员的信息</span>
</span><span class='line'>        <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">setFrom</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;&amp;#x6d;&amp;#x61;&amp;#x69;&amp;#108;&amp;#x74;&amp;#x6f;&amp;#58;&amp;#120;&amp;#x78;&amp;#120;&amp;#120;&amp;#120;&amp;#x78;&amp;#120;&amp;#x78;&amp;#x78;&amp;#64;&amp;#113;&amp;#113;&amp;#46;&amp;#99;&amp;#111;&amp;#x6d;&quot;</span><span class="o">&gt;&amp;</span><span class="c1">#120;&amp;#x78;&amp;#x78;&amp;#120;&amp;#x78;&amp;#x78;&amp;#x78;&amp;#120;&amp;#120;&amp;#x40;&amp;#x71;&amp;#x71;&amp;#46;&amp;#99;&amp;#x6f;&amp;#x6d;&lt;/a&gt;&amp;rsquo;=&gt;&amp;lsquo;Reton&amp;rsquo;));</span>
</span><span class='line'>        <span class="c1">//将邮件发给谁</span>
</span><span class='line'>        <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">setTo</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$email</span><span class="o">=&gt;&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">reton</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;));</span>
</span><span class='line'>        <span class="c1">//设置邮件主题</span>
</span><span class='line'>        <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">setSubject</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">激活邮件</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;);</span>
</span><span class='line'>        <span class="nv">$url</span><span class="o">=&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;http://&quot;</span><span class="o">&gt;</span><span class="nx">http</span><span class="o">://&lt;/</span><span class="nx">a</span><span class="o">&gt;&amp;</span><span class="nx">rdquo</span><span class="p">;</span><span class="o">.</span><span class="err">$</span><span class="o">&lt;</span><span class="nx">em</span><span class="o">&gt;</span><span class="nx">SERVER</span><span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">HTTP_HOST</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;]</span><span class="o">.</span><span class="err">$</span><span class="o">&lt;/</span><span class="nx">em</span><span class="o">&gt;</span><span class="nx">SERVER</span><span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">PHP_SELF</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;]</span><span class="o">.&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="o">?</span><span class="nx">act</span><span class="o">=</span><span class="nx">active</span><span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span><span class="nx">token</span><span class="o">=</span><span class="p">{</span><span class="nv">$token</span><span class="p">}</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;;</span>
</span><span class='line'>        <span class="nv">$urlencode</span><span class="o">=</span><span class="nb">urlencode</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$str</span><span class="o">=&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">&lt;</span><span class="nx">EOF</span>
</span><span class='line'>        <span class="nx">亲爱的</span><span class="p">{</span><span class="nv">$username</span><span class="p">}</span><span class="nx">您好</span><span class="o">~</span><span class="nx">！感谢您注册我们网站</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
</span><span class='line'>        <span class="nx">请点击此链接激活帐号即可登陆！</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{</span><span class="nv">$url</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">&gt;</span><span class="p">{</span><span class="nv">$urlencode</span><span class="p">}</span><span class="o">&lt;/</span><span class="nx">a</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
</span><span class='line'>        <span class="nx">如果点此链接无反映，可以将其复制到浏览器中来执行，链接的有效时间为24小时。</span>    <span class="o">&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
</span><span class='line'><span class="nx">EOF</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">setBody</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;{</span><span class="nv">$str</span><span class="p">}</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;,</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">text</span><span class="o">/</span><span class="nx">html</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">utf</span><span class="o">-</span><span class="mi">8</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;);</span>
</span><span class='line'>        <span class="k">try</span><span class="p">{</span>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$message</span><span class="p">)){</span>
</span><span class='line'>                <span class="k">echo</span> <span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">恭喜您</span><span class="p">{</span><span class="nv">$username</span><span class="p">}</span><span class="nx">注册成功，请到邮箱激活之后登陆</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">/&gt;&amp;</span><span class="nx">rdquo</span><span class="p">;;</span>
</span><span class='line'>                <span class="k">echo</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="mi">3</span><span class="nx">秒钟后跳转到登陆页面</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>                <span class="k">echo</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="o">=</span><span class="s2">&quot;refresh&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;3;url=index.php#tologin&quot;</span><span class="o">/&gt;&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>                <span class="nv">$PdoMySQL</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="nv">$table</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">id</span><span class="o">=&amp;</span><span class="nx">rsquo</span><span class="p">;</span><span class="o">.</span><span class="nv">$lastInsertId</span><span class="p">);</span>
</span><span class='line'>                <span class="k">echo</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">注册失败，请重新注册</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>                <span class="k">echo</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="mi">3</span><span class="nx">秒钟后跳转到注册页面</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>                <span class="k">echo</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="o">=</span><span class="s2">&quot;refresh&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;3;url=index.php#toregister&quot;</span><span class="o">/&gt;&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">Swift_ConnectionException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>            <span class="k">echo</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">邮件发送错误</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;</span><span class="o">.</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>        <span class="k">echo</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">用户注册失败</span><span class="p">,</span><span class="mi">3</span><span class="nx">秒钟后跳转到注册页面</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>        <span class="k">echo</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="o">=</span><span class="s2">&quot;refresh&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;3;url=index.php#toregister&quot;</span><span class="o">/&gt;&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span><span class="k">elseif</span><span class="p">(</span><span class="nv">$act</span><span class="o">===&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">login</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;){</span>
</span><span class='line'>    <span class="c1">//完成登陆的功能</span>
</span><span class='line'>    <span class="nv">$row</span><span class="o">=</span><span class="nv">$PdoMySQL</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$table</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">username</span><span class="o">=&amp;</span><span class="nx">lsquo</span><span class="p">;{</span><span class="nv">$username</span><span class="p">}</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;</span> <span class="k">AND</span> <span class="nx">password</span><span class="o">=&amp;</span><span class="nx">lsquo</span><span class="p">;{</span><span class="nv">$password</span><span class="p">}</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;,</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">status</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;);</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">status</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;]</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>        <span class="k">echo</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">请先激活在登陆</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>        <span class="k">echo</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="o">=</span><span class="s2">&quot;refresh&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;3;url=index.php#tologin&quot;</span><span class="o">/&gt;&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>        <span class="k">echo</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">登陆成功</span><span class="p">,</span><span class="mi">3</span><span class="nx">秒钟后跳转到首页</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>        <span class="k">echo</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="o">=</span><span class="s2">&quot;refresh&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;3;url=http://www.imooc.com&quot;</span><span class="o">/&gt;&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>    <span class="p">}</span><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">}</span><span class="k">elseif</span><span class="p">(</span><span class="nv">$act</span><span class="o">===&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">active</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;){</span>
</span><span class='line'>    <span class="nv">$token</span><span class="o">=</span><span class="nb">addslashes</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">token</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;]);</span>
</span><span class='line'>    <span class="nv">$row</span><span class="o">=</span><span class="nv">$PdoMySQL</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$table</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">token</span><span class="o">=&amp;</span><span class="nx">lsquo</span><span class="p">;{</span><span class="nv">$token</span><span class="p">}</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;</span> <span class="k">AND</span> <span class="nx">status</span><span class="o">=</span><span class="mi">0</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;,</span><span class="k">array</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">id</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">token_exptime</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;));</span>
</span><span class='line'>    <span class="nv">$now</span><span class="o">=</span><span class="nb">time</span><span class="p">();</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="nv">$now</span><span class="o">&gt;</span><span class="nv">$row</span><span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">token_exptime</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;]){</span>
</span><span class='line'>        <span class="k">echo</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">激活时间过期，请重新登陆激活</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>        <span class="nv">$res</span><span class="o">=</span><span class="nv">$PdoMySQL</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">status</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">),</span><span class="nv">$table</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">id</span><span class="o">=&amp;</span><span class="nx">rsquo</span><span class="p">;</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">id</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;]);</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="nv">$res</span><span class="p">){</span>
</span><span class='line'>            <span class="k">echo</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">激活成功</span><span class="p">,</span><span class="mi">3</span><span class="nx">秒钟后跳转到登陆页面</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>            <span class="k">echo</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="o">=</span><span class="s2">&quot;refresh&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;3;url=index.php#tologin&quot;</span><span class="o">/&gt;&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>            <span class="k">echo</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">激活失败，请重新激活</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>            <span class="k">echo</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="o">=</span><span class="s2">&quot;refresh&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;3;url=index.php&quot;</span><span class="o">/&gt;&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">code</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">code</span><span class="o">&gt;</span><span class="nx">html</span> <span class="nx">index</span><span class="o">.</span><span class="nx">php</span>
</span><span class='line'><span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">!</span><span class="nx">DOCTYPE</span> <span class="nx">html</span><span class="o">&gt;&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;!--</span><span class="p">[</span><span class="k">if</span> <span class="nx">lt</span> <span class="nx">IE</span> <span class="mi">7</span> <span class="p">]</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="nx">html</span> <span class="nx">lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;no-js ie6 lt8&quot;</span><span class="o">&gt;</span> <span class="o">&lt;!</span><span class="p">[</span><span class="k">endif</span><span class="p">]</span><span class="o">--&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;!--</span><span class="p">[</span><span class="k">if</span> <span class="nx">IE</span> <span class="mi">7</span> <span class="p">]</span><span class="o">&gt;</span>    <span class="o">&lt;</span><span class="nx">html</span> <span class="nx">lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;no-js ie7 lt8&quot;</span><span class="o">&gt;</span> <span class="o">&lt;!</span><span class="p">[</span><span class="k">endif</span><span class="p">]</span><span class="o">--&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;!--</span><span class="p">[</span><span class="k">if</span> <span class="nx">IE</span> <span class="mi">8</span> <span class="p">]</span><span class="o">&gt;</span>    <span class="o">&lt;</span><span class="nx">html</span> <span class="nx">lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;no-js ie8 lt8&quot;</span><span class="o">&gt;</span> <span class="o">&lt;!</span><span class="p">[</span><span class="k">endif</span><span class="p">]</span><span class="o">--&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;!--</span><span class="p">[</span><span class="k">if</span> <span class="nx">IE</span> <span class="mi">9</span> <span class="p">]</span><span class="o">&gt;</span>    <span class="o">&lt;</span><span class="nx">html</span> <span class="nx">lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;no-js ie9&quot;</span><span class="o">&gt;</span> <span class="o">&lt;!</span><span class="p">[</span><span class="k">endif</span><span class="p">]</span><span class="o">--&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;!--</span><span class="p">[</span><span class="k">if</span> <span class="p">(</span><span class="nx">gt</span> <span class="nx">IE</span> <span class="mi">9</span><span class="p">)</span><span class="o">|!</span><span class="p">(</span><span class="nx">IE</span><span class="p">)]</span><span class="o">&gt;&lt;!--&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="nx">html</span> <span class="nx">lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;no-js&quot;</span><span class="o">&gt;</span> <span class="o">&lt;!--&lt;!</span><span class="p">[</span><span class="k">endif</span><span class="p">]</span><span class="o">--&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">charset</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>        <span class="o">&lt;!--</span> <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="o">=</span><span class="s2">&quot;X-UA-Compatible&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;IE=edge,chrome=1&quot;</span><span class="o">&gt;</span>  <span class="o">&amp;</span><span class="nx">ndash</span><span class="p">;</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">Login</span> <span class="k">and</span> <span class="nx">Registration</span> <span class="nx">Form</span> <span class="nx">with</span> <span class="nx">HTML5</span> <span class="k">and</span> <span class="nx">CSS3</span><span class="o">&lt;/</span><span class="nx">title</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;viewport&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;description&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;Login and Registration Form with HTML5 and CSS3&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;keywords&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;html5, css3, form, switch, animation, :target, pseudo-class&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;author&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;Codrops&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nb">link</span> <span class="nx">rel</span><span class="o">=</span><span class="s2">&quot;shortcut icon&quot;</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;../favicon.ico&quot;</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nb">link</span> <span class="nx">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/css&quot;</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;css/demo.css&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nb">link</span> <span class="nx">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/css&quot;</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;css/style.css&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nb">link</span> <span class="nx">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/css&quot;</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;css/animate-custom.css&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>    <span class="o">&lt;/</span><span class="nx">head</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span>
</span><span class='line'>            <span class="o">&lt;</span><span class="nb">header</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">It</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;</span><span class="nx">s</span> <span class="nx">Reton</span><span class="o">&lt;</span><span class="nx">span</span><span class="o">&gt;</span><span class="k">This</span> <span class="nx">Is</span> <span class="nx">Reton</span><span class="o">&lt;/</span><span class="nx">span</span><span class="o">&gt;&lt;/</span><span class="nx">h1</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;</span><span class="nx">nav</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;codrops-demos&quot;</span><span class="o">&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="nx">span</span><span class="o">&gt;</span><span class="nx">Click</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">Join</span> <span class="nx">us</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;</span><span class="o">&lt;/</span><span class="nx">strong</span><span class="o">&gt;</span> <span class="nx">to</span> <span class="nx">Register</span> <span class="nx">the</span> <span class="nx">reton</span><span class="o">&lt;/</span><span class="nx">span</span><span class="o">&gt;</span>
</span><span class='line'>                <span class="o">&lt;/</span><span class="nx">nav</span><span class="o">&gt;</span>
</span><span class='line'>            <span class="o">&lt;/</span><span class="nb">header</span><span class="o">&gt;</span>
</span><span class='line'>            <span class="o">&lt;</span><span class="nx">section</span><span class="o">&gt;</span>             <span class="o">&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
</span><span class='line'>                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;container_demo&quot;</span> <span class="o">&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;hiddenanchor&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;toregister&quot;</span><span class="o">&gt;&lt;/</span><span class="nx">a</span><span class="o">&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;hiddenanchor&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;tologin&quot;</span><span class="o">&gt;&lt;/</span><span class="nx">a</span><span class="o">&gt;</span>
</span><span class='line'>                    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;wrapper&quot;</span><span class="o">&gt;</span>
</span><span class='line'>                        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;login&quot;</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;animate form&quot;</span><span class="o">&gt;</span>
</span><span class='line'>                            <span class="o">&lt;</span><span class="nx">form</span>  <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;doAction.php?act=login&quot;</span> <span class="nx">autocomplete</span><span class="o">=</span><span class="s2">&quot;on&quot;</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="o">&gt;</span>
</span><span class='line'>                                <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Log</span> <span class="nx">in</span><span class="o">&lt;/</span><span class="nx">h1</span><span class="o">&gt;</span>
</span><span class='line'>                                <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>                                    <span class="o">&lt;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&quot;username&quot;</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;uname&quot;</span> <span class="nx">data</span><span class="o">-</span><span class="nx">icon</span><span class="o">=</span><span class="s2">&quot;u&quot;</span> <span class="o">&gt;</span> <span class="nx">Your</span> <span class="nx">username</span> <span class="o">&lt;/</span><span class="nx">label</span><span class="o">&gt;</span>
</span><span class='line'>                                    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;username&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;username&quot;</span> <span class="nx">required</span><span class="o">=</span><span class="s2">&quot;required&quot;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;My Username&quot;</span><span class="o">/&gt;</span>
</span><span class='line'>                                <span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>                                <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>                                    <span class="o">&lt;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;youpasswd&quot;</span> <span class="nx">data</span><span class="o">-</span><span class="nx">icon</span><span class="o">=</span><span class="s2">&quot;p&quot;</span><span class="o">&gt;</span> <span class="nx">Your</span> <span class="nx">password</span> <span class="o">&lt;/</span><span class="nx">label</span><span class="o">&gt;</span>
</span><span class='line'>                                    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nx">required</span><span class="o">=</span><span class="s2">&quot;required&quot;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;*****&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>                                <span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>                                <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;keeplogin&quot;</span><span class="o">&gt;</span>
</span><span class='line'>                                    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;checkbox&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;loginkeeping&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;loginkeeping&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;loginkeeping&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>                                    <span class="o">&lt;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&quot;loginkeeping&quot;</span><span class="o">&gt;</span><span class="nx">Keep</span> <span class="nx">me</span> <span class="nx">logged</span> <span class="nx">in</span><span class="o">&lt;/</span><span class="nx">label</span><span class="o">&gt;</span>
</span><span class='line'>                                <span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>                                <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;login button&quot;</span><span class="o">&gt;</span>
</span><span class='line'>                                    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;Login&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>                                <span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>                                <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;change_link&quot;</span><span class="o">&gt;</span>
</span><span class='line'>                                    <span class="k">Not</span> <span class="nx">a</span> <span class="nx">member</span> <span class="nx">yet</span> <span class="o">?</span>
</span><span class='line'>                                    <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;#toregister&quot;</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;to_register&quot;</span><span class="o">&gt;</span><span class="nx">Join</span> <span class="nx">us</span><span class="o">&lt;/</span><span class="nx">a</span><span class="o">&gt;</span>
</span><span class='line'>                                <span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>                            <span class="o">&lt;/</span><span class="nx">form</span><span class="o">&gt;</span>
</span><span class='line'>                        <span class="o">&lt;/</span><span class="nx">div</span><span class="o">&gt;&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span>                    <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;register&quot;</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;animate form&quot;</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>                        <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">form</span>  <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;doAction.php?act=reg&quot;</span> <span class="nx">autocomplete</span><span class="o">=</span><span class="s2">&quot;on&quot;</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>                            <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">h1</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span> <span class="nx">Sign</span> <span class="nx">up</span> <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">/</span><span class="nx">h1</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>                            <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">p</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>                                <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&quot;usernamesignup&quot;</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;uname&quot;</span> <span class="nx">data</span><span class="o">-</span><span class="nx">icon</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span><span class="nx">Your</span> <span class="nx">username</span><span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">/</span><span class="nx">label</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>                                <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">input</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;usernamesignup&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;username&quot;</span> <span class="nx">required</span><span class="o">=</span><span class="s2">&quot;required&quot;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;Mr.King&quot;</span> <span class="o">/&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>                            <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">/</span><span class="nx">p</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>                            <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">p</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>                                <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&quot;emailsignup&quot;</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;youmail&quot;</span> <span class="nx">data</span><span class="o">-</span><span class="nx">icon</span><span class="o">=</span><span class="s2">&quot;e&quot;</span> <span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span> <span class="nx">Your</span> <span class="nx">email</span><span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">/</span><span class="nx">label</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>                                <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">input</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;emailsignup&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;email&quot;</span> <span class="nx">required</span><span class="o">=</span><span class="s2">&quot;required&quot;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;email&quot;</span> <span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;xxxx@mail.com&quot;</span><span class="o">/&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>                            <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">/</span><span class="nx">p</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>                            <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">p</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>                                <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&quot;passwordsignup&quot;</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;youpasswd&quot;</span> <span class="nx">data</span><span class="o">-</span><span class="nx">icon</span><span class="o">=</span><span class="s2">&quot;p&quot;</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span><span class="nx">Your</span> <span class="nx">password</span> <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">/</span><span class="nx">label</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>                                <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">input</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;passwordsignup&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nx">required</span><span class="o">=</span><span class="s2">&quot;required&quot;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;******&quot;</span><span class="o">/&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>                            <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">/</span><span class="nx">p</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>                            <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">p</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;signin button&quot;</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>                                <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;Sign up&quot;</span><span class="o">/&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>                            <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">/</span><span class="nx">p</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>                            <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">p</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;change_link&quot;</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>                                <span class="nx">Already</span> <span class="nx">a</span> <span class="nx">member</span> <span class="o">?</span>
</span><span class='line'>                                <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;#tologin&quot;</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;to_register&quot;</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span> <span class="nx">Go</span> <span class="k">and</span> <span class="nb">log</span> <span class="nx">in</span> <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">/</span><span class="nx">a</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>                            <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">/</span><span class="nx">p</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>                        <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">/</span><span class="nx">form</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>                    <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">/</span><span class="nx">div</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>                <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">/</span><span class="nx">div</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>            <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">/</span><span class="nx">div</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>        <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">/</span><span class="nx">section</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'>    <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">/</span><span class="nx">div</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'><span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">/</span><span class="nx">body</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">code</span><span class="o">&gt;&lt;/</span><span class="nx">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;&lt;/</span><span class="nx">html</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Learn-more-PDO]]></title>
    <link href="http://ewanreton.github.io/blog/2016/05/19/learn-more-pdo/"/>
    <updated>2016-05-19T18:47:27+08:00</updated>
    <id>http://ewanreton.github.io/blog/2016/05/19/learn-more-pdo</id>
    <content type="html"><![CDATA[<blockquote><p>前段时间在做手机归属地查询的Demo时突然发现自己对PDO还是太生疏，一直都是用的以前的代码。很多都不太了解，于是重新系统的学习了一下PDO类。</p></blockquote>

<!--more-->


<h1>什么是PDO</h1>

<p>PDO（PHP Data Object）数据库访问抽象层，统一各种数据库的访问接口。
<strong>特性</strong>
* 编码一致性
* 灵活性
* 高性能
* 面向对象特性</p>

<p>PDO的安装与配置，和PHP其他扩展的开启一样，只需要在<code>php.ini</code>里设置即可，这里就不多说了。</p>

<h1>PDO连接数据库</h1>

<pre><code class="php">&lt;?php 
//通过参数形式连接数据库
try{
    $dsn='mysql:host=localhost;dbname=test';
    $username='root';
    $passwd='root';
    $pdo=new PDO($dsn, $username, $passwd);
    var_dump($pdo);
}catch(PDOException $e){
    echo $e-&gt;getMessage();
}
</code></pre>

<p><img src="http://b.picphotos.baidu.com/album/s%3D550%3Bq%3D90%3Bc%3Dxiangce%2C100%2C100/sign=d2ce6c87044f78f0840b9af6490a7b68/aa64034f78f0f73686e0bed20d55b319eac413c2.jpg?referer=c0077f7aae014c08402c1c955dc1&amp;x=.jpg" alt="" /></p>

<h1>PDO exec</h1>

<blockquote><p>增删改，返回得是受影响的行数</p></blockquote>

<pre><code class="php">&lt;?php 
try{
    $pdo=new PDO('mysql:host=localhost;dbname=test','root','root');
    //exec():执行一条sql语句并返回其受影响的记录的条数,如果没有受影响的记录，他返回0
    //exec对于select没有作用
    $sql=&lt;&lt;&lt;EOF
        CREATE TABLE IF NOT EXISTS user(
        id INT UNSIGNED AUTO_INCREMENT KEY,
        username VARCHAR(20) NOT NULL UNIQUE,
        password CHAR(32) NOT NULL,
        email VARCHAR(30) NOT NULL
        );
EOF;
    //$sql='INSERT user(username,password,email) VALUES("reton","reton","reton@qq.com")';
    //$res=$pdo-&gt;exec($sql);
    //echo '受影响的记录的条数为：'.$res,'&lt;br/&gt;';
    //$pdo-&gt;lastInsertId():得到新插入记录的ID号
    //echo '最后插入的ID号为'.$pdo-&gt;lastInsertId();
    $res=$pdo-&gt;exec($sql);
    var_dump($res); 
    $sql='INSERT user(username,password,email) VALUES("reton","'.md5('reton').'","test@qq.com")';

    //echo $sql;
    $res=$pdo-&gt;exec($sql);
    echo $res;
}catch(PDOException $e){
    echo $e-&gt;getMessage();
}
</code></pre>

<h1>PDO error 获取错误信息</h1>

<blockquote><p>获取错误码和错误信息</p></blockquote>

<pre><code class="php">&lt;?php 
header('content-type:text/html;charset=utf-8');
try{
    $pdo=new PDO('mysql:host=localhost;dbname=test','root','root');
    $sql='delete from user12 where id=1';
    $res=$pdo-&gt;exec($sql);
    //echo $res.'条记录被影响';
    //var_dump($res);
    if($res===false){
        //$pdo-&gt;errorCode():SQLSTATE的值
        echo $pdo-&gt;errorCode();
        echo '&lt;hr/&gt;';
        //$pdo-&gt;errorInfo():返回的错误信息的数组，数组中包含3个单元
        //0=&gt;SQLSTATE,1=&gt;CODE,2=&gt;INFO
        $errInfo=$pdo-&gt;errorInfo();
        print_r($errInfo);
    }
//  echo '&lt;hr/&gt;';
//  echo $pdo-&gt;lastInsertId();
}catch(PDOException $e){
    echo $e-&gt;getMessage();
}
</code></pre>

<h1>PDO query</h1>

<blockquote><p>执行查询，返回的是PDOStatement对象</p></blockquote>

<pre><code class="php">&lt;?php 
header('content-type:text/html;charset=utf-8');
try{
    $pdo=new PDO('mysql:host=localhost;dbname=test','root','root');
    //$sql='select * from user where id=2';
    $sql='select id,username,email from user';
    //$pdo-&gt;query($sql)，执行SQL语句，返回PDOStatement对象
    $stmt=$pdo-&gt;query($sql);
    var_dump($stmt);
    echo '&lt;hr/&gt;';
    foreach($stmt as $row){
        //print_r($row);
        echo '编号：'.$row['id'],'&lt;br/&gt;';
        echo '用户名：'.$row['password'],'&lt;br/&gt;';
        echo '邮箱：'.$row['email'],'&lt;br/&gt;';
        echo '&lt;hr/&gt;';
    }
}catch(PDOException $e){
    echo $e-&gt;getMessage();
}
</code></pre>

<h1>PDO prepare</h1>

<blockquote><p>prepare 准备方法</p></blockquote>

<pre><code class="php">header('content-type:text/html;charset=utf-8');
try{
    $pdo=new PDO('mysql:host=localhost;dbname=test','root','root');
    $sql='select * from user where username="reton"';
    //prepare($sql):准备SQL语句
    $stmt=$pdo-&gt;prepare($sql);
    //execute():执行预处理语句
    $res=$stmt-&gt;execute();
    //var_dump($res);
    //fetch():得到结果集中的一条记录
    $row=$stmt-&gt;fetch();
    print_r($row);

    //var_dump($stmt);
}catch(PDOException $e){
    echo $e-&gt;getMessage();
}
</code></pre>

<pre><code class="php fetch.php">&lt;?php 
header('content-type:text/html;charset=utf-8');
try{
    $pdo=new PDO('mysql:host=localhost;dbname=test','root','root');
    $sql='select * from user';
    $stmt=$pdo-&gt;prepare($sql);
    $res=$stmt-&gt;execute();
//  if($res){
//      while($row=$stmt-&gt;fetch()){
//          print_r($row);
//          echo '&lt;hr/&gt;';
//      }
//  }
    $rows=$stmt-&gt;fetchAll();
    print_r($rows);

    //var_dump($stmt);
}catch(PDOException $e){
    echo $e-&gt;getMessage();
}
</code></pre>

<pre><code class="php setFetchMode.php">&lt;?php 
header('content-type:text/html;charset=utf-8');
try{
    $pdo=new PDO('mysql:host=localhost;dbname=test','root','root');
    $sql='select * from user';
    $stmt=$pdo-&gt;prepare($sql);
    $res=$stmt-&gt;execute();
//  if($res){
//      while($row=$stmt-&gt;fetch(PDO::FETCH_OBJ)){//返回对象
//          print_r($row);
//          echo '&lt;hr/&gt;';
//      }
//  }
//  $rows=$stmt-&gt;fetchAll(PDO::FETCH_ASSOC);//返回关联数组BOTH为数组加索引
//  print_r($rows);
    echo '&lt;hr/&gt;';
    $stmt-&gt;setFetchMode(PDO::FETCH_ASSOC);//set了就不用传参了    
    //var_dump($stmt);
    $rows=$stmt-&gt;fetchAll();
    print_r($rows);
}catch(PDOException $e){
    echo $e-&gt;getMessage();
}
</code></pre>

<h1>PDO getAttribute</h1>

<blockquote><p>获得数据库连接属性</p></blockquote>

<pre><code class="php">&lt;?php 
header('content-type:text/html;charset=utf-8');
try{
    $dsn='mysql:host=localhost;dbname=test';
    $username='root';
    $passwd='root';
    $pdo=new PDO($dsn, $username, $passwd);
    echo '自动提交：'.$pdo-&gt;getAttribute(PDO::ATTR_AUTOCOMMIT);
    echo '&lt;br/&gt;';
    echo 'PDO默认的错误处理模式：'.$pdo-&gt;getAttribute(PDO::ATTR_ERRMODE);
    $pdo-&gt;setAttribute(PDO::ATTR_AUTOCOMMIT, 0);
    echo '&lt;br/&gt;';
    echo '自动提交：'.$pdo-&gt;getAttribute(PDO::ATTR_AUTOCOMMIT);
}catch(PDOException $e){
    echo $e-&gt;getMessage();
}
</code></pre>

<p>获取常用属性 并不是所有环境都支持一下的属性
<code>php
&lt;?php
header('content-type:text/html;charset=utf-8');
try{
    $dsn='mysql:host=localhost;dbname=test';
    $username='root';
    $passwd='root';
    $pdo=new PDO($dsn, $username, $passwd);
    $attrArr=array(
        'AUTOCOMMIT','ERRMODE','CASE','PERSISTENT','TIMEOUT','ORACLE_NULLS',
            'SERVER_INFO','SERVER_VERSION','CLIENT_VERSION','CONNECTION_STATUS'
    );
    foreach($attrArr as $attr){
        echo "PDO::ATTR_$attr: ";
        echo $pdo-&gt;getAttribute(constant("PDO::ATTR_$attr")),'&lt;br/&gt;';
    }
}catch(PDOException $e){
    echo $e-&gt;getMessage();
}
</code></p>

<h1>PDO setAttribute</h1>

<blockquote><p>设置数据库连接属性</p></blockquote>

<pre><code class="php">&lt;?php 
header('content-type:text/html;charset=utf-8');
try{
    $dsn='mysql:host=localhost;dbname=test';
    $username='root';
    $passwd='root';
    $options=array(PDO::ATTR_AUTOCOMMIT=&gt;0,PDO::ATTR_ERRMODE=&gt;PDO::ERRMODE_EXCEPTION);
    $pdo=new PDO($dsn, $username, $passwd, $options);
    echo $pdo-&gt;getAttribute(PDO::ATTR_AUTOCOMMIT);
    echo '&lt;br/&gt;';
    echo $pdo-&gt;getAttribute(PDO::ATTR_ERRMODE);
}catch(PDOException $e){
    echo $e-&gt;getMessage();
}
</code></pre>

<h1>PDOStatement 对象的使用</h1>

<p><strong>quote防注入</strong>
<code>html login.php
 &lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;form action='doAction2.php' method='post'&gt;
用户名：&lt;input type='text' name='username' /&gt;&lt;br/&gt;
密码：&lt;input type='password' name='password'/&gt;&lt;br/&gt;
&lt;input type='submit' value='登陆'/&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code>
<code>php  doAction2.php
&lt;?php
&lt;?php
header('content-type:text/html;charset=utf-8');
$username=$_POST['username'];
$password=$_POST['password'];
try{
    $pdo=new PDO('mysql:host=localhost;dbname=test','root','root');
    //echo $pdo-&gt;quote($username);
    //$sql="select * from user where username='{$username}' and password='{$password}'";
    //echo $sql;
    //通过quote():返回带引号的字符串，过滤字符串中的特殊字符
    $username=$pdo-&gt;quote($username);
    $sql="select * from user where username={$username} and password='{$password}'";
    echo $sql;
    $stmt=$pdo-&gt;query($sql);
    //PDOStatement对象的方法：rouCount()：对于select操作返回的结果集中记录的条数，
    //对于INSERT、UPDATE、DELETE返回受影响的记录的条数
    echo $stmt-&gt;rowCount();
}catch(PDOException $e){
    echo $e-&gt;getMessage();
}
</code>
<strong>预处理语句的占位符</strong>
第一种用：xxx
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">content</span><span class="o">-</span><span class="nx">type</span><span class="o">:</span><span class="nx">text</span><span class="o">/</span><span class="nx">html</span><span class="p">;</span><span class="nx">charset</span><span class="o">=</span><span class="nx">utf</span><span class="o">-</span><span class="mi">8</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;);</span>
</span><span class='line'><span class="nv">$username</span><span class="o">=</span><span class="err">$</span><span class="o">&lt;</span><span class="nx">em</span><span class="o">&gt;</span><span class="nx">POST</span><span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">username</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;];</span>
</span><span class='line'><span class="nv">$password</span><span class="o">=</span><span class="err">$</span><span class="o">&lt;/</span><span class="nx">em</span><span class="o">&gt;</span><span class="nx">POST</span><span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">password</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;];</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>    <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">mysql</span><span class="o">:</span><span class="nx">host</span><span class="o">=</span><span class="nx">localhost</span><span class="p">;</span><span class="nx">dbname</span><span class="o">=</span><span class="nx">test</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">root</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">root</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;);</span>
</span><span class='line'>    <span class="nv">$sql</span><span class="o">=&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">user</span> <span class="nx">where</span> <span class="nx">username</span><span class="o">=:</span><span class="nx">username</span> <span class="k">and</span> <span class="nx">password</span><span class="o">=:</span><span class="nx">password</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;;</span> <span class="c1">//占位</span>
</span><span class='line'>    <span class="nv">$stmt</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="o">:</span><span class="nx">username</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;</span><span class="o">=&gt;</span><span class="nv">$username</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="o">:</span><span class="nx">password</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;</span><span class="o">=&gt;</span><span class="nv">$password</span><span class="p">));</span><span class="nx">赋值</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">rowCount</span><span class="p">();</span><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">code</span><span class="o">&gt;</span>
</span><span class='line'><span class="nx">第二种用？</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">code</span><span class="o">&gt;</span><span class="nx">php</span>
</span><span class='line'><span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">content</span><span class="o">-</span><span class="nx">type</span><span class="o">:</span><span class="nx">text</span><span class="o">/</span><span class="nx">html</span><span class="p">;</span><span class="nx">charset</span><span class="o">=</span><span class="nx">utf</span><span class="o">-</span><span class="mi">8</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;);</span>
</span><span class='line'><span class="nv">$username</span><span class="o">=</span><span class="err">$</span><span class="o">&lt;</span><span class="nx">em</span><span class="o">&gt;</span><span class="nx">POST</span><span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">username</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;];</span>
</span><span class='line'><span class="nv">$password</span><span class="o">=</span><span class="err">$</span><span class="o">&lt;/</span><span class="nx">em</span><span class="o">&gt;</span><span class="nx">POST</span><span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">password</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;];</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>    <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">mysql</span><span class="o">:</span><span class="nx">host</span><span class="o">=</span><span class="nx">localhost</span><span class="p">;</span><span class="nx">dbname</span><span class="o">=</span><span class="nx">test</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">root</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">root</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;);</span>
</span><span class='line'>    <span class="nv">$sql</span><span class="o">=&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">user</span> <span class="nx">where</span> <span class="nx">username</span><span class="o">=?</span> <span class="k">and</span> <span class="nx">password</span><span class="o">=?&amp;</span><span class="nx">rdquo</span><span class="p">;;</span>
</span><span class='line'>    <span class="nv">$stmt</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">));</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">rowCount</span><span class="p">();</span><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;**</span><span class="nx">bindParam</span><span class="p">()</span><span class="nx">方法绑定参数到变量</span><span class="o">**</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">code</span><span class="o">&gt;&lt;/</span><span class="nx">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">content</span><span class="o">-</span><span class="nx">type</span><span class="o">:</span><span class="nx">text</span><span class="o">/</span><span class="nx">html</span><span class="p">;</span><span class="nx">charset</span><span class="o">=</span><span class="nx">utf</span><span class="o">-</span><span class="mi">8</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;);</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>    <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">mysql</span><span class="o">:</span><span class="nx">host</span><span class="o">=</span><span class="nx">localhost</span><span class="p">;</span><span class="nx">dbname</span><span class="o">=</span><span class="nx">test</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">root</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">root</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;);</span>
</span><span class='line'>    <span class="nv">$sql</span><span class="o">=&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">INSERT</span> <span class="nx">user</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span><span class="nx">password</span><span class="p">,</span><span class="nx">email</span><span class="p">)</span> <span class="nx">VALUES</span><span class="p">(</span><span class="o">:</span><span class="nx">username</span><span class="p">,</span><span class="o">:</span><span class="nx">password</span><span class="p">,</span><span class="o">:</span><span class="nx">email</span><span class="p">)</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;;</span>
</span><span class='line'>    <span class="nv">$stmt</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
</span><span class='line'>    <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="o">:</span><span class="nx">username</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;,</span><span class="nv">$username</span><span class="p">,</span><span class="nx">PDO</span><span class="o">::</span><span class="na">PARAM_STR</span><span class="p">);</span><span class="c1">//绑定参数，被绑定的项，绑定的地址（不能直接写值），参数类型。如果是用的？第一个参数要写1,2,3。表示第几个占位符</span>
</span><span class='line'>    <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="o">:</span><span class="nx">password</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;,</span><span class="nv">$password</span><span class="p">,</span><span class="nx">PDO</span><span class="o">::</span><span class="na">PARAM_STR</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="o">:</span><span class="nx">email</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;,</span><span class="nv">$email</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$username</span><span class="o">=&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">imooc1</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>    <span class="nv">$password</span><span class="o">=&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">imooc1</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>    <span class="nv">$email</span><span class="o">=&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;&amp;#x6d;&amp;#97;&amp;#105;&amp;#x6c;&amp;#116;&amp;#x6f;&amp;#58;&amp;#x69;&amp;#x6d;&amp;#x6f;&amp;#x6f;&amp;#x63;&amp;#x31;&amp;#64;&amp;#105;&amp;#109;&amp;#x6f;&amp;#111;&amp;#99;&amp;#x2e;&amp;#x63;&amp;#x6f;&amp;#x6d;&quot;</span><span class="o">&gt;&amp;</span><span class="c1">#x69;&amp;#x6d;&amp;#x6f;&amp;#111;&amp;#x63;&amp;#x31;&amp;#64;&amp;#105;&amp;#109;&amp;#x6f;&amp;#x6f;&amp;#99;&amp;#x2e;&amp;#x63;&amp;#111;&amp;#x6d;&lt;/a&gt;&amp;rsquo;;</span>
</span><span class='line'>    <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</span><span class='line'>    <span class="nv">$username</span><span class="o">=&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">MR</span><span class="o">.</span><span class="nx">KING1</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>    <span class="nv">$password</span><span class="o">=&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">MR</span><span class="o">.</span><span class="nx">KING1</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>    <span class="nv">$email</span><span class="o">=&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#97;&amp;#105;&amp;#x6c;&amp;#116;&amp;#x6f;&amp;#x3a;&amp;#77;&amp;#x52;&amp;#x2e;&amp;#75;&amp;#x49;&amp;#x4e;&amp;#x47;&amp;#x31;&amp;#64;&amp;#x69;&amp;#x6d;&amp;#x6f;&amp;#111;&amp;#x63;&amp;#46;&amp;#99;&amp;#x6f;&amp;#109;&quot;</span><span class="o">&gt;&amp;</span><span class="c1">#x4d;&amp;#x52;&amp;#x2e;&amp;#x4b;&amp;#x49;&amp;#x4e;&amp;#71;&amp;#49;&amp;#64;&amp;#105;&amp;#109;&amp;#111;&amp;#111;&amp;#99;&amp;#46;&amp;#99;&amp;#x6f;&amp;#109;&lt;/a&gt;&amp;rsquo;;</span>
</span><span class='line'>    <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">rowCount</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">code</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">**</span><span class="nx">PDO错误处理模式</span><span class="o">**</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">code</span><span class="o">&gt;</span><span class="nx">php</span>
</span><span class='line'><span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">?</span><span class="nx">php</span>
</span><span class='line'><span class="o">/&lt;</span><span class="nx">em</span><span class="o">&gt;</span>
</span><span class='line'> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_SLIENT</span><span class="o">:</span><span class="nx">默认模式，静默模式</span>
</span><span class='line'> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_WARNING</span><span class="o">:</span><span class="nx">警告模式</span>
</span><span class='line'> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="o">:</span><span class="nx">异常模式</span>
</span><span class='line'> <span class="o">&lt;/</span><span class="nx">em</span><span class="o">&gt;/</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>    <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">mysql</span><span class="o">:</span><span class="nx">host</span><span class="o">=</span><span class="nx">localhost</span><span class="p">;</span><span class="nx">dbname</span><span class="o">=</span><span class="nx">test</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">root</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">root</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;);</span>
</span><span class='line'>    <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$sql</span><span class="o">=&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">SELECT</span> <span class="o">*</span> <span class="nx">FROM</span> <span class="nx">noneTable</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>    <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">errorCode</span><span class="p">();</span>
</span><span class='line'>    <span class="k">echo</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">/&gt;&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">errorInfo</span><span class="p">());</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">code</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">!</span><span class="p">[](</span><span class="nx">http</span><span class="o">://</span><span class="nx">d</span><span class="o">.</span><span class="nx">picphotos</span><span class="o">.</span><span class="nx">baidu</span><span class="o">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">album</span><span class="o">/</span><span class="nx">s</span><span class="o">%</span><span class="mi">3</span><span class="nx">D550</span><span class="o">%</span><span class="mi">3</span><span class="nx">Bq</span><span class="o">%</span><span class="mi">3</span><span class="nx">D90</span><span class="o">%</span><span class="mi">3</span><span class="nx">Bc</span><span class="o">%</span><span class="mi">3</span><span class="nx">Dxiangce</span><span class="o">%</span><span class="mi">2</span><span class="nx">C100</span><span class="o">%</span><span class="mi">2</span><span class="nx">C100</span><span class="o">/</span><span class="nx">sign</span><span class="o">=</span><span class="nx">d28d1e1ad02a60595610e11f180f45a6</span><span class="o">/</span><span class="nx">d8f9d72a6059252d57a8efd7339b033b5ab5b9a2</span><span class="o">.</span><span class="nx">jpg</span><span class="o">?</span><span class="nx">referer</span><span class="o">=</span><span class="nx">c8b46b4c29dda3cc52f38c100760</span><span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span><span class="nx">x</span><span class="o">=.</span><span class="nx">jpg</span><span class="p">)</span>
</span><span class='line'><span class="o">**</span><span class="nx">PDO事务处理模式</span><span class="o">**</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">code</span><span class="o">&gt;</span><span class="nx">php</span>
</span><span class='line'><span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">?</span><span class="nx">php</span>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">content</span><span class="o">-</span><span class="nx">type</span><span class="o">:</span><span class="nx">text</span><span class="o">/</span><span class="nx">html</span><span class="p">;</span><span class="nx">charset</span><span class="o">=</span><span class="nx">utf</span><span class="o">-</span><span class="mi">8</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;);</span>
</span><span class='line'><span class="k">try</span><span class="p">{</span>
</span><span class='line'>    <span class="nv">$dsn</span><span class="o">=&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">mysql</span><span class="o">:</span><span class="nx">host</span><span class="o">=</span><span class="nx">localhost</span><span class="p">;</span><span class="nx">dbname</span><span class="o">=</span><span class="nx">test</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>    <span class="nv">$username</span><span class="o">=&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">root</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>    <span class="nv">$passwd</span><span class="o">=&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">root</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>    <span class="nv">$options</span><span class="o">=</span><span class="k">array</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_AUTOCOMMIT</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$pdo</span><span class="o">=</span><span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$passwd</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
</span><span class='line'>    <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">inTransaction</span><span class="p">());</span>
</span><span class='line'>    <span class="c1">//开启事务</span>
</span><span class='line'>    <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">beginTransaction</span><span class="p">();</span>
</span><span class='line'>    <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">inTransaction</span><span class="p">());</span>
</span><span class='line'>    <span class="c1">//$sql=&amp;lsquo;UPDATE userAccount SET money=money-2000 WHERE username=&amp;ldquo;imooc&amp;rdquo;&amp;rsquo;;</span>
</span><span class='line'>    <span class="nv">$sql</span><span class="o">=&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">UPDATE</span> <span class="nx">userAccount</span> <span class="nx">SET</span> <span class="nx">money</span><span class="o">=</span><span class="nx">money</span><span class="o">-</span><span class="mi">2000</span> <span class="nx">WHERE</span> <span class="nx">username</span><span class="o">=&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">imooc</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span><span class="nv">$res1</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&amp;</span><span class="nx">gt</span><span class="p">;</span><span class="nb">exec</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="nv">$res1</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>    <span class="k">throw</span> <span class="k">new</span> <span class="nx">PDOException</span><span class="p">(</span><span class="s1">&#39;imooc 转账失败&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nv">$res2</span><span class="o">=</span><span class="nv">$pdo</span><span class="o">-&amp;</span><span class="nx">gt</span><span class="p">;</span><span class="nb">exec</span><span class="p">(</span><span class="s1">&#39;UPDATE userAccount SET money=money+2000 WHERE username=&quot;king1&quot;&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="nv">$res2</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>    <span class="k">throw</span> <span class="k">new</span> <span class="nx">PDOException</span><span class="p">(</span><span class="s1">&#39;king 接收失败&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">//提交事务</span>
</span><span class='line'><span class="nv">$pdo</span><span class="o">-&amp;</span><span class="nx">gt</span><span class="p">;</span><span class="nx">commit</span><span class="p">();</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">code</span><span class="o">&gt;&lt;/</span><span class="nx">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>    <span class="c1">//回滚事务</span>
</span><span class='line'>    <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">rollBack</span><span class="p">();</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<h1>PDO操作类封装</h1>

<pre><code class="php">&lt;?php
    /**
     *
     */
    class PdoMySQL
    {
        public static $config=array();//设置链接参数，配置信息
        public static $link=null;//保存链接标识符
        public static $pconnect=false;//是否开启长链接
        public static $dbVersion=null;//保存数据库版本
        public static $connected=false;//是否链接成共
        public static $PDOStatement=null;//保存ＰＤＯStatement对象
        public static $queryStr = null;//保存最后执行的操作
        public static $error=null;//保存错误信息
        public static $lastInsertId=null;//最后插入记录的id
        public static $numRows=0;//保存上一步影响的行数
        function __construct($dbConfig='')
        {
            if(!class_exists("PDO")){
                self::throw_excption("不支持ＰＤＯ，请先开启");
            }
            if(!is_array($dbConfig)){
                $dbConfig=array(
                    "hostname" =&gt; DB_HOST,
                    "username" =&gt; DB_USER,
                    "password" =&gt; DB_PWD,
                    "database" =&gt; DB_NAME,
                    "hostport" =&gt; DB_PORT,
                    "dbms"     =&gt; DB_TYPE,
                    "dsn" =&gt;DB_TYPE.":host=".DB_HOST.";dbname=".DB_NAME
                );
            }
            if(empty($dbConfig['hostname']))self::throw_excption("没有定义数据库配置，请先定义。");
            self::$config=$dbConfig;
            if(empty(self::$config['params']))self::$config['params']=array();
            if(!isset(self::$link)){
                $configs=self::$config;
                if(self::$pconnect){
                    //开启长链接，添加到配置数组中
                    $configs['params'][constant("PDO::ATTR_PERSISTENT")]=true;
                }
                try {
                    self::$link=new PDO($configs['dsn'],$configs['username'],$configs['password'],$configs['params']);
                } catch (PDOException $e) {
                    self::throw_excption($e-&gt;getMessage());
                }
                if(!self::$link){
                    self::throw_excption("PDO链接错误");
                    return false;
                }
                self::$link-&gt;exec('SET NAMES'.DB_CHARSET);
                self::$dbVersion=self::$link-&gt;getAttribute(constant("PDO::ATTR_SERVER_VERSION"));
                self::$connected=true;
                unset($configs);
            }
        }
        /**
         * 得到所有记录
         * @param  [type] $sql [description]
         * @return [type]      [description]
         */
         public static function getAll($sql=null)
        {
            if($sql!=null){
                self::query($sql);
            }
            $result=self::$PDOStatement-&gt;fetchAll(constant("PDO::FETCH_ASSOC"));
            return $result;
        }
        /**
         * 得到结果集中的一条记录
         * @param  [type] $sql [description]
         * @return [type]      [description]
         */
        public static function getRow($sql=null)
        {
            if($sql!=null){
                self::query($sql);
            }
            $result =self::$PDOStatement-&gt;fetch(constant("PDO::FETCH_ASSOC"));
            return $result;
        }
        /**
         * 解析字段
         * @param  [type] $fields [description]
         * @return [type]         [description]
         */
        public  static function parseFields($fields)
        {
            if(is_array($fields)){
                    array_walk($fields,array('PdoMySQL','addSpecilChar'));
                    $fieldsStr=implode(',',$fields);
            }elseif (is_string($fields)&amp;&amp;!empty($fields)) {
                if(strpos($fields,'`')===false){
                    $fields=explode(',',$fields);
                    array_walk($fields,array('PdoMySQL','addSpecilChar'));
                    $fieldsStr=implode(',',$fields);
                }else {
                    $fieldsStr=$fields;
                }
            }else {
                $fieldsStr='*';
            }
            return $fieldsStr;
        }
        /**
         * 通过反引号引用字段，
         * @param [type] $value [description]
         */
        public static function addSpecilChar(&amp;$value)
        {
            if($value==='*'||strpos($value,'.')!==false||strpos($value,'`')!==false){
                //不用做处理
            }elseif (strpos($value,'`')===false) {
                # code...
                $value='`'.trim($value).'`';
            }
            return $value;
        }
        /**
         * 根据主键查记录
         * @param  [type] $tabName [description]
         * @param  [type] $priId   [description]
         * @param  string $fields  [description]
         * @return [type]          [description]
         */
        public  static function findById($tabName,$priId,$fields='*')
        {
            $sql="SELECT %s FROM %s WHERE id =%d";
            return self::getRow(sprintf($sql,self::parseFields($fields),$tabName,$priId));
        }
        /**
         * 执行普通查询，
         * @param  [type] $tables [description]
         * @param  [type] $where  [description]
         * @param  string $fields [description]
         * @param  [type] $group  [description]
         * @param  [type] $having [description]
         * @param  [type] $order  [description]
         * @param  [type] $limit  [description]
         * @return [type]         [description]
         */
        public static function find($tables,$where=null,$fields='*',$group=null,$having=null,$order=null,$limit=null)
        {
            $sql='SELECT '.self::parseFields($fields).' FROM '.$tables.self::parseWhere($where).self::parseGroup($group).self::parseHaving($having).self::parseOrder($order).self::parseLimit($limit);
            $dataAll=self::getAll($sql);
            // if(count($dataAll)==1){
            //     $rlt=$dataAll[0];
            // }else {
            //     $rlt=$dataAll;
            // }
            // return $rlt;
            return count($dataAll)==1?$dataAll[0]:$dataAll;
        }
        /**
         * 添加记录
         * array(
         *
         * )
         * @param string $value [description]
         */
        public static function add($data,$table)
        {
            $keys=array_keys($data);
            array_walk($keys,array('PdoMySQL','addSpecilChar'));
            $fieldsStr=join(',',$keys);
            $values="'".join("','",array_values($data))."'";
            $sql="INSERT {$table}({$fieldsStr}) VALUES({$values})";
            return self::execute($sql);
        }
        /**
         * 更新记录
         * @param  [array] $data  [description]
         * @param  [string] $table [description]
         * @param  [string] $where [description]
         * @param  [string] $order [description]
         * @param  [string] $limit [description]
         * @return [type]        [description]
         */
        public  static function update($data,$table,$where=null,$order=null,$limit=null)
        {
            foreach ($data as $key =&gt; $value) {
                $set.=$key."='".$value."',";
            }
            $sets=rtrim($sets,',');
            $sql="UPDATE {$table} SET {$sets} ".self::parseWhere($where).self::parseOrder($order).self::parseLimit($limit);
             return self::execute($sql);
        }
        /**
         * 删除记录
         * @param  [type]  $table [description]
         * @param  [type]  $where [description]
         * @param  [type]  $order [description]
         * @param  integer $limit [description]
         * @return [type]         [description]
         */
        public static function delete($table,$where=null,$order=null,$limit=0)
        {
            $sql="delete from {$table} " .self::parseWhere($where).self::parseOrder($order).self::parseLimit($limit);
            return self::execute($sql);
        }
        /**
         * 得到最后执行的ＳＱＬ语句
         * @return [type] [description]
         */
        public static function getLastSql()
        {
            $link=self::$link;
            if(!$link){
                return false;
            }
            return self::$queryStr;
        }
        /**
         * 得到上一步插入操作的ＩＤ
         */
        public static function getLsetInsertId()
        {
            $link=self::$link;
            if(!$link)return false;
            return self::$lastInsertId;
        }
        /**
         * 得到数据库版本
         */
        public static function getDbVersion()
        {
            $link=self::$link;
            if(!$link)return false;
            return self::$dbVersion;
        }
        /**
         * 得到数据库有哪些表
         * @return [type] [description]
         */
        public  static function showTables()
        {
            $tables=array();
            if(self::query('SHOW TABLES')){
                $result = self::getAll();
                foreach ($result as $key =&gt; $value) {
                    # code...
                    $tables[$key]=current($value);
                }
            }
            return $tables;
        }
        /**
         * 解析ｗｈｅｒｅ条件
         * @param  [type] $where [description]
         * @return [type]        [description]
         */
        public static function parseWhere($where)
        {
            $whereStr='';
            if(is_string($where)&amp;&amp;!empty($where)){
                $whereStr=$where;
            }
            return empty($whereStr)?'':' WHERE '.$whereStr;
        }
        /**
         * 解析分组
         * @param  [type] $group [description]
         * @return [type]        [description]
         */
        public static function parseGroup($group)
        {
            $groupStr='';
            if(is_array($group)){
                $groupStr.=' GROUP BY '.implode(',',$group);
            }elseif (is_string($group)&amp;&amp;!empty($group)) {
                $groupStr.=' GROUP BY '.$group;
            }
            return empty($groupStr)?'':$groupStr;
        }
        /**
         * 对分组结果通过Ｈａｖｉｎｇ子句进行二次删选
         * @param  [type] $having [description]
         * @return [type]         [description]
         */
        public static function parseHaving($having)
        {
            $havingStr='';
            if(is_string($having)&amp;&amp;!empty($having)){
                $havingStr.=' HAVING '.$having;
            }
            return $havingStr;
        }
        /**
         * 解析order by
         * @param  [type] $order [description]
         * @return [type]        [description]
         */
        public  static function parseOrder($order)
        {
            $orderStr='';
            if(is_array($order)){
                $orderStr.=' ORDER BY '.join(',',$order);
            }elseif (is_string($order)&amp;&amp;!empty($order)) {
                $orderStr.=' ORDER BY '.$order;
                # code...
            }
            return $orderStr;
        }
        /**
         * 解析限制条数
         * ｌｉｍｉｔ 3
         * ｌｉｍｉｔ 0,3
         * @param  [type] $limit [description]
         * @return [type]        [description]
         */
        public  static function parseLimit($limit)
        {
            $limitStr='';
            if(is_array($limit)){
                if(count($limit)&gt;1){
                    $limitStr.=' LIMIT '.$limit[0].','.$limit[1];
                }else {
                    $limitStr.=' LIMIT '.$limit[0];
                }
            }elseif (is_string($limit)&amp;&amp;!empty($limit)) {
                $limitStr.=' LIMIT '.$limit;
            }
            return $limitStr;
        }
        /**
         * 执行增删改，返回受影响的条数
         * @param  [type] $sql [description]
         * @return [type]      [description]
         */
        public static function execute($sql=null)
        {
            $link=self::$link;
            if(!$link) return false;
            self::$queryStr=$sql;
            if(!empty(self::$PDOStatement))self::free();
            $result=$link-&gt;exec(self::$queryStr);
            self::haveErrorThrowException();
            if($result){
                self::$lastInsertId=$link-&gt;lastInsertId();
                self::$numRows=$result;;
                return self::$numRows;
            }else {
                return false;
            }
        }
        /**
         *释放结果集
         * @return [type] [description]
         */
        public  static function free()
        {
            self::$PDOStatement=null;
        }
        /**
         * 执行ｓｑｌ语句
         * @param  string $sql [description]
         * @return [type]      [description]
         */
        public static function query($sql='')
        {
            $link=self::$link;
            if(!$link)return false;
            //判断之前是否有结果集，如果有的话，释放结果集
            if(!empty(self::$link)) self::free();
            self::$queryStr=$sql;
            self::$PDOStatement=$link-&gt;prepare(self::$queryStr);
            $res = self::$PDOStatement-&gt;execute();
            self::haveErrorThrowException();
            return $res;
        }
        /**
         * 如果有错误，抛出
         * @return [type] [description]
         */
        public static function haveErrorThrowException()
        {
            $obj=empty(self::$PDOStatement)?self::$link:self::$PDOStatement;
            $arrError=$obj-&gt;errorInfo();
            // print_r($arrError);
            if($arrError[0]!='00000'){
                self::$error="SQLSTATE".$arrError[0]."SQL Error".$arrError[2]."&lt;br/&gt;Error SQL".self::$queryStr;
                self::throw_excption(self::$error);
                return false;
            }
            if(self::$queryStr==""){
                self::throw_excption('没有执行的ＳＱＬ语句');
                return false;
            }
        }
        /**
         * 自定义错误处理
         * @param  [type] $errMsg [description]
         * @return [type]         [description]
         */
        public function throw_excption($errMsg)
        {
            echo "&lt;div style='width:80%;background-color:#ABCDEF;colod:black;font-size:20px;padding:20px 0px;'&gt;
            ".$errMsg."
            &lt;/div&gt;";
        }
        /**
         * 销毁链接对象，关闭数据库。
         * @return [type] [description]
         */
        public static function close()
        {
            self::$link=null;
        }

    }
require_once"config.php";
// $PdoMySQL=new PdoMySQL;
// // var_dump($PdoMySQL);
// // $sql="insert user (username,password,email) values('reane23','sdf','sdf')";
// $tables='user';
// $res=$PdoMySQL-&gt;find($tables,'id&gt;=19','*',null,null,null,'3');
// var_dump($res);
// echo $PdoMySQL::$lastInsertId;
// print_r($res);
</code></pre>

<pre><code class="php config.php">&lt;?php
define("DB_HOST","localhost");
define("DB_USER","root");
define("DB_PWD","123456");
define("DB_NAME","test");
define("DB_PORT","3306");
define("DB_TYPE","mysql");
define("DB_CHARSET","utf8");
</code></pre>
]]></content>
  </entry>
  
</feed>
